(()=>{"use strict";var e,o,t,r={685701:(e,o,t)=>{t.d(o,{MAX_STORY_VIDEO_DURATION:()=>s,getStoryUploadUrl:()=>a,uploadStoryBlobToServer:()=>l,saveStoryOnServer:()=>d});var r=t(570655),n=t(40906),i=t(961540),s=16;function a(e){return new Promise((function(o,t){window.ajax.post((0,i.isMvk)()?"stories.php":"al_stories.php",(0,r.__assign)({act:"get_upload_url"},e),{onDone:o,onError:t,onFail:t})}))}function l(e,o){var t=new FormData,r=encodeURIComponent("edited_"+(0,n.irand)(0,99999)+".jpg");return t.append("file0",e,r),fetch(o,{method:"POST",body:t}).then((function(e){return e.json()}))}function d(e,o){return new Promise((function(t,r){window.ajax.post((0,i.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:o},{onDone:t,onError:r,onFail:r})}))}},613499:(e,o,t)=>{t.d(o,{Publisher:()=>c});var r=t(570655),n=t(785893),i=t(667294),s=t(654612),a=t(486125),l=t(40334),d=t(730365),u=t(41650),c=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.errorHandler=function(e,o){var t=e||(0,u.getLang)("global_error");(0,s.showFastBox)({title:(0,u.getLang)("global_error")},t,(0,u.getLang)("global_close"),(function(){o(),(0,a.curBox)().hide()}))},o.save=function(e,t,r){var n;void 0===r&&(r={}),o.props.onClickSave(),window.StoryPublisher.saveStory(e,{attachment:JSON.stringify(o.props.attachment),clickable_stickers:r.clickableStickers,mini_app_id:o.props.miniAppId,question_id:o.props.questionId,situational_suggest_id:null===(n=o.props.serviceInfo)||void 0===n?void 0:n.situational_suggest_id,analytics:r.analytics,mediaEditorAnalytics:r.mediaEditorAnalytics,hash:r.storyUploadUrlHash,entry_point:o.props.entrypoint,ref:window.cur.module},r.storySaveHash).then((function(e){o.onClose(!0,!1,e),t()})).catch((function(e){return o.errorHandler(e,t),!0}))},o.onClose=function(e,t,r){var n,i;if(t)o.props.onClose(!1);else if(e)window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),o.props.onClose(!0,r);else{(null===(i=null===(n=window.cur.photoEditorStore)||void 0===n?void 0:n.getState())||void 0===i?void 0:i.past.length)>1?(0,s.showFastBox)({title:(0,u.getLang)("photos_pe_story_editor_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",dark:1,forceNoBtn:1,onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},(0,u.getLang)("photos_pe_story_editor_close_text"),(0,u.getLang)("box_yes"),(function(){(0,a.curBox)().hide(),o.props.onClose(!1)}),(0,u.getLang)("box_no"),(function(){(0,a.curBox)().hide()})):o.props.onClose(!1)}},o}return(0,r.__extends)(o,e),o.prototype.render=function(){var e=this,o=Math.min(900,window.innerHeight-100),t=o/1.78;return(0,n.jsx)(d.default,(0,r.__assign)({disableBodyScroll:!0,onClose:function(){return e.onClose()}},{children:(0,n.jsx)(l.default,{context:"story",photoUrl:this.props.photoUrl,artboardWidth:t,artboardHeight:o,save:this.save,close:function(){return e.onClose()},attachment:this.props.attachment,stickers:this.props.stickers,serviceInfo:this.props.serviceInfo},void 0)}),void 0)},o}(i.Component)},969209:(e,o,t)=>{t.d(o,{StoryPublisher:()=>u});var r=t(785893),n=t(973935),i=t(613499),s=t(691267),a=t(486125),l=t(786067),d=t(685701),u={init:function(e,o,t){var r=this;this.onClickSave=o||function(){},this.cb=t,this.loadStatic().then((function(){r.render(e)})).catch((function(e){console.error(e)}))},loadStatic:function(){return window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"])},render:function(e){var o=(null==e?void 0:e.entrypoint)||"",t=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===o?(0,s.sendStat)(s.EVENTS.ADD_STORY_FROM_SHARING):(0,s.sendStat)(s.EVENTS.ADD_STORY);var a=document.querySelector(".StoryPublisher");a||((a=document.createElement("div")).classList.add("StoryPublisher"),document.body.appendChild(a)),n.render((0,r.jsx)(i.Publisher,{entrypoint:o,miniAppId:t,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers,serviceInfo:null==e?void 0:e.serviceInfo,questionId:null==e?void 0:e.questionId},void 0),a)},destroy:function(e,o){var t=document.querySelector(".StoryPublisher");t&&n.unmountComponentAtNode(t),this.cb&&this.cb(e,o),delete window.cur.photoEditorStore,delete window.cur.renderImageFromState,e&&(0,a.showDoneBox)((0,l.getLang)("photos_pe_story_published"))},saveStory:function(e,o,t){return(0,d.getStoryUploadUrl)(o).then((function(o){return(0,d.uploadStoryBlobToServer)(e,o)})).then((function(e){var o=e.response;return(0,d.saveStoryOnServer)(o&&o.upload_result,t)}))}}},629497:(e,o,t)=>{var r=t(969209);window.StoryPublisher=r.StoryPublisher;try{window.stManager.done(window.jsc("web/story_publisher.js"))}catch(e){}}},n={};function i(e){var o=n[e];if(void 0!==o)return o.exports;var t=n[e]={id:e,loaded:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.loaded=!0,t.exports}i.m=r,e=[],i.O=(o,t,r,n)=>{if(!t){var s=1/0;for(u=0;u<e.length;u++){for(var[t,r,n]=e[u],a=!0,l=0;l<t.length;l++)(!1&n||s>=n)&&Object.keys(i.O).every((e=>i.O[e](t[l])))?t.splice(l--,1):(a=!1,n<s&&(s=n));if(a){e.splice(u--,1);var d=r();void 0!==d&&(o=d)}}return o}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[t,r,n]},i.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return i.d(o,{a:o}),o},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var n=Object.create(null);i.r(n);var s={};o=o||[null,t({}),t([]),t(t)];for(var a=2&r&&e;"object"==typeof a&&!~o.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((o=>s[o]=()=>e[o]));return s.default=()=>e,i.d(n,s),n},i.d=(e,o)=>{for(var t in o)i.o(o,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},i.e=()=>Promise.resolve(),i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={55198:0};i.O.j=o=>0===e[o];var o=(o,t)=>{var r,n,[s,a,l]=t,d=0;for(r in a)i.o(a,r)&&(i.m[r]=a[r]);if(l)var u=l(i);for(o&&o(t);d<s.length;d++)n=s[d],i.o(e,n)&&e[n]&&e[n][0](),e[s[d]]=0;return i.O(u)},t=self.webpackChunkvk=self.webpackChunkvk||[];t.forEach(o.bind(null,0)),t.push=o.bind(null,t.push.bind(t))})();var s=i.O(void 0,[11216,24509,68592,4904,25901],(()=>i(629497)));s=i.O(s)})();