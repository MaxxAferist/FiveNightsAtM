(()=>{var __webpack_modules__={520797:e=>{e.exports={im_img_prebody:'<div class="im-prebody"> <img alt="" src="%photo%" /> </div>',im_admin_link:' (<a href="%href%" class="_im_admin_name" target="_blank">%name%</a>)',im_right_menu_tpl:'<a id="ui_rmenu_peer_%peer%" href="%href%" class="_im_peer_tab ui_rmenu_item %cls%" %attrs%>\n  <span class="ui_rmenu_item_label ">%label%</span>\n</a>',im_right_menu_sep:'<div class="ui_rmenu_sep"></div>',im_right_menu_ct:'<span class="ui_rmenu_count im-right-menu--count _im_r_ct">%count%</span> <button type="button" class="im-right-menu--close _im_r_cl"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button><span class="im-right-menu--text _im_r_tx">%name%</span>',im_dialogs_link_img:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank"><div class="im_grid">%photo%</div></a>',sImDialogImRowPhoto:'<div class="im_grid">%photo%</div>',im_dialogs_link:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank">%photo%</a>',im_peer_photo:'<div class="nim-peer %online_class% %modifier_class%"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> %owner_photo% </div> </div> </div>',sImContactAvatar:' <div class="ContactAvatar ContactAvatar--%size% %classes%">%name%</div>',sImUserAvatar:'<div class="ImUserAvatar _online %online_class% %classes%"> <img src="%src%" class="ImUserAvatar__img" alt=""> </div>',im_owner_item:'<a href="%link%" class="olist_item_wrap%cls%" id="olist_item_wrap%owner_id%" >\n  <div class="olist_item clear_fix">\n    <div class="olist_item_photo_wrap %img_cls%">\n      <img class="olist_item_photo" src="%photo%"/>\n    </div>\n    <div class="olist_item_name">%name%</div>\n    <div class="olist_checkbox"></div>\n  </div>\n</a>',im_simple_name:function(){return'<div class="im-page--title %more_cls%"> <span class="im-page--title-main" title="%name_attr%" %ads_union%> <span class="im-page--title-main-in"> <a href="%href%" target="_blank" class="im-page--title-main-inner _im_page_peer_name">%name%</a> <span class="im-page--title-main-verified _im_chat_verified"></span> <span class="im-page--title-main-donut _im_chat_donut"></span> </span> </span> <span class="im-page--title-meta _im_page_peer_online">%online%</span> <span class="im-page--title-status _im_page_status"></span> <button class="im-page--title-reconnect _im_page_reconnect">'+getLang("mail_network_reconnect")+"</button> %more_children%</div>"},im_simple_link:'<a href="%href%" class="_im_header_link" target="_blank">%content%</a>',im_selected_messages:'<span class="im-page--selected-messages-count">%label%</span> <button aria-label="%tip%" type="button" class="im-page--selected-messages-remove"></button>',sImSimpleNameBusinessNotifyLabel:'<span class="im-page--title-main-business-notify _im_chat_business_notify">%text%</span>',im_topic:"<div class='im-topic %cls%'>%topic%</div>",im_stack_date:' <a href="%link%" class="_im_mess_link" >%date%</a>',im_dialogs_none:'<li data-list-id="002300" class="im-page--dialogs-empty"> <div class="im-page--dialogs-empty--icon">%icon%</div> %msg%</li>',im_dialogs_active_folder_button:'<li class="im-page--dialogs-folder-button %class_name%" data-list-id="all"> <button class="im-page--dialogs-folder-button--back _im_dialog_folder_back"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.53 4.22a.75.75 0 0 1 0 1.06L7.8 10l4.72 4.72a.75.75 0 1 1-1.06 1.06l-5.25-5.25a.75.75 0 0 1 0-1.06l5.25-5.25a.75.75 0 0 1 1.05 0z" fill="currentColor"/></svg></button> <span class="im-page--dialogs-folder-button--text">%msg%</span> %actions%</li>',im_dialogs_active_folder_button_actions:'<button type="button" class="im-page--dialogs-folder-button--actions _im_dialog_folder_actions" data-folder="%folder%"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M9.53 6.42a.75.75 0 0 1 .94 0l5.25 4.25a.75.75 0 1 1-.94 1.16L10 7.96l-4.78 3.87a.75.75 0 1 1-.94-1.16z" fill="currentColor"/></svg></button>',im_dialogs_message_requests_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-message-requests-button _im_toggle_mr_tab" data-list-id="message_request_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2C4.44 2 1.5 4.52 1.5 7.75c0 1.09.34 2.12.95 3.02-.09.4-.36 1.04-.82 1.87-.3.55-.07 1.21.46 1.49.17.08.36.12.54.12A5.5 5.5 0 0 0 6 13.23a7.4 7.4 0 0 0 2 .28c3.56 0 6.5-2.52 6.5-5.76C14.5 4.52 11.56 2 8 2zm0 1.5c-2.92 0-5 2.02-5 4.25 0 .8.25 1.55.73 2.22l.13.19a.75.75 0 0 1 .13.57l-.04.23a7.08 7.08 0 0 1-.65 1.74c.87-.1 1.44-.36 1.8-.66l.23-.21a.75.75 0 0 1 .7-.15l.31.1c.52.15 1.08.23 1.66.23 2.92 0 5-2.02 5-4.26 0-2.23-2.08-4.25-5-4.25z" fill="currentColor"/><path d="M16.16 8.57a.75.75 0 1 1 1.18-.91A5.46 5.46 0 0 1 18.5 11a5.42 5.42 0 0 1-.91 3.01c.08.41.34 1.05.78 1.9a1.09 1.09 0 0 1-.99 1.59 5.18 5.18 0 0 1-3.23-1.01 6.8 6.8 0 0 1-1.9.27 6.73 6.73 0 0 1-2.57-.5.75.75 0 0 1 .57-1.39 5.22 5.22 0 0 0 3.57.15l.3-.09a.75.75 0 0 1 .71.16l.23.2c.33.3.85.54 1.66.65a7.34 7.34 0 0 1-.63-1.74l-.04-.23a.75.75 0 0 1 .12-.55l.13-.19A3.92 3.92 0 0 0 17 11c0-.9-.3-1.73-.84-2.43z" fill="currentColor"/></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button--mentions" data-mentions=""><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button--counter">%counter%</span> </li>',im_dialogs_message_requests_notice:'<li class="im-page--dialogs-message-requests-notice-w" data-list-id="message_request_notice"> <div class="im-page--dialogs-message-requests-notice BannerInfo BannerInfo--noMargin"> %msg% </div> </li>',im_dialogs_business_notify_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-business-notify-button _im_toggle_business_notify_tab %class_name%" data-list-id="business_notify_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="work_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="work_outline_20__Icons-20/work_outline_20"><g id="work_outline_20__work_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M10.8 2c1.11 0 1.51.12 1.92.33.4.22.73.54.95.95.2.38.31.76.33 1.71v.51h1.36c1.04 0 1.45.12 1.86.33.4.22.73.54.95.95.21.4.33.82.33 1.86v1.8c0 .89-.1 1.21-.27 1.54-.17.31-.41.57-.73.74v1.53a3.25 3.25 0 0 1-3.07 3.24l-.18.01h-8.5a3.25 3.25 0 0 1-3.24-3.07l-.01-.18v-1.53l-.13-.08c-.26-.17-.46-.4-.6-.66-.16-.3-.26-.6-.27-1.35v-2c0-1.03.12-1.44.33-1.85.22-.4.54-.73.95-.95.38-.2.76-.31 1.64-.33H6v-.3c0-1.11.12-1.51.33-1.92.22-.4.54-.73.95-.95.38-.2.76-.31 1.71-.33h1.8ZM16 13H4v1.25c0 .92.7 1.67 1.6 1.74l.15.01h8.5c.92 0 1.67-.7 1.74-1.6l.01-.15V13Zm-.47-6H4.47l-.31.01c-.36.02-.52.06-.67.15a.77.77 0 0 0-.33.33c-.1.2-.15.39-.16.98V10.82c.01.2.03.3.06.38l.03.07c.03.06.08.1.14.14l.07.03c.11.04.28.06.76.06h11.88c.48 0 .65-.02.76-.06l.07-.03c.06-.03.1-.08.14-.14l.03-.07c.04-.11.06-.28.06-.76v-1.8c0-.72-.04-.94-.16-1.15a.77.77 0 0 0-.33-.33c-.2-.1-.39-.15-.98-.16Zm-4.56-3.5H8.72c-.33.02-.5.05-.63.1l-.1.06a.77.77 0 0 0-.33.33l-.05.1c-.07.17-.1.4-.1.94l-.01.47h5v-.78a1.82 1.82 0 0 0-.1-.63l-.06-.1a.77.77 0 0 0-.33-.33l-.1-.05a2.6 2.6 0 0 0-.94-.1Z" id="work_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button--mentions" data-mentions=""><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button--counter">%counter%</span> <button class="im-page--dialogs-folder-button--hide _im_dialog_folder_button_hide"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button> </li>',sImBusinessNotifyDisableBoxContent:'<div class="im_bussiness_notify_disable_box"> <div class="im_bussiness_notify_disable_box_text"> %text% </div> </div>',im_dialogs_archives_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-archives-button _im_toggle_archives_tab %class_name%" data-list-id="archive_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M7 10.75c0-.41.34-.75.75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1-.75-.75z"/><path clip-rule="evenodd" d="M14.58 2H5.42c-.53 0-.98 0-1.34.03-.38.03-.74.1-1.08.27-.52.26-.94.68-1.2 1.2-.17.34-.24.7-.27 1.08-.03.36-.03.8-.03 1.34v.42c.02.13.05.3.14.48a1.25 1.25 0 0 0 1.02.67L3 7.5v4.98c0 .81 0 1.47.04 2 .05.55.14 1.03.37 1.47.36.7.93 1.28 1.64 1.64.44.23.92.32 1.47.37.53.04 1.19.04 2 .04h2.96c.81 0 1.47 0 2-.04a3.84 3.84 0 0 0 1.47-.37c.7-.36 1.28-.93 1.64-1.64.23-.44.32-.92.37-1.47.04-.53.04-1.19.04-2V7.5h.34c.13-.02.3-.05.48-.14a1.25 1.25 0 0 0 .67-1.02l.01-.37v-.05c0-.53 0-.98-.03-1.34-.03-.38-.1-.74-.27-1.08A2.75 2.75 0 0 0 17 2.3a2.8 2.8 0 0 0-1.08-.27C15.56 2 15.12 2 14.58 2zm.92 5.5h-11v4.95c0 .85 0 1.45.04 1.9.04.46.1.72.2.92.22.42.57.77.99.98.2.1.46.17.91.21.46.04 1.06.04 1.91.04h2.9c.85 0 1.45 0 1.9-.04.46-.04.72-.1.92-.2.42-.22.77-.57.98-.99.1-.2.17-.46.21-.91.04-.46.04-1.06.04-1.91zM17 6v-.05c0-.57 0-.96-.02-1.25a1.36 1.36 0 0 0-.12-.52 1.25 1.25 0 0 0-.54-.54c-.1-.05-.23-.1-.52-.12-.3-.02-.68-.02-1.25-.02h-9.1c-.57 0-.96 0-1.25.02-.29.03-.43.07-.52.12-.23.12-.42.3-.54.54-.05.1-.1.23-.12.52C3 5 3 5.38 3 5.95V6z" fill-rule="evenodd"/></g></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button--mentions" data-mentions="%mentions%"><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button--counter">%counter%</span> <button class="im-page--dialogs-folder-button--hide _im_dialog_folder_button_hide"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button> </li>',im_dialogs_archive_notice:'<li class="im-page--dialogs-archive-notice-w _im_archive_notice" data-list-id="archive_notice"> <div class="im-page--dialogs-archive-notice"> <span class="im-page--dialogs-archive-notice--title">%title%</span> <span class="im-page--dialogs-archive-notice--text">%text%</span> <button class="im-page--dialogs-archive-notice--close _im_archive_notice_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button> </div> </li>',im_dialogs_archive_notice_button:'<button class="im-page--dialogs-archive-notice--button _im_archive_notice_settings">%text%</button>',im_dialogs_new_ui_notice:'<li class="im-page--dialogs-new-ui-notice-w _im_new_ui_notice" data-list-id="new_ui_notice"> <div class="im-page--dialogs-new-ui-notice"> <span class="im-page--dialogs-new-ui-notice--title">%title%</span> <span class="im-page--dialogs-new-ui-notice--text">%text%</span> <button class="im-page--dialogs-new-ui-notice--close _im_new_ui_notice_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button> </div> </li>',im_filter:'<a class="im-page--dialogs-filter %cls%">%filter%</a>',im_drow_prebody:'<span class="nim-dialog--who">%prebody% </span> <span class="nim-dialog--inner-text">%body%</span>',im_attach_mess:' <div class="im-fwd %modifier%"> <span class="im-fwd--title"> <span class="im-fwd--title-name">%text%</span> <span class="im-fwd--date">%date%</span> </span> <span class="im-fwd--close _im_fwd_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></span> <div rel="button" tab-index="0" type="button" class="im-fwd--messages _im_will_fwd">%messages%</div> </div>',im_preloader:'<div class="im-preloader %cls%"> %preloader%</div>',im_service_row:'<ul class="ui_clean_list"> <li class="im-mess im-mess_srv _im_mess _im_mess_srv _im_mess_%message_id%" data-msgid="%message_id%" data-from="%from_id%" data-ts="%date%"> <div class="im-mess--text">%text%</div> </li> </ul>',im_chat_members:'<button type="button" class="_im_chat_members im-page--members">%name%</button>',im_vkcomgroup_members:'<span class="im-page--members im-page--members--nohover">%name%</span>',im_mess_stack:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peerId%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> <a target="_blank" class="im_grid" href="%href%"><img alt="%name%" src="%photo%" /></a> </div> </div> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_mess_stack_name:'<a href="%link%" class="im-mess-stack--lnk%class%" title="" target="_blank">%name%</a>',im_message_media:'<div class="_im_msg_%type%%messageId%" class="wall_module">%attaches%</div>%text%',im_dialog_media:'<span class="nim-dialog--preview nim-dialog--preview-attach">%name%</span>',im_typing:'<div class="im-page--typing _im_typing"> <div class="im-activity %cls%"><div class="pr im-activity--icon"><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><span class="_im_typing_name">&nbsp;</span></div> </div>',ctrl_submit_hint:function(){return'<div class="reply_submit_hint_wrap" >\n  <div class="reply_submit_hint_title">'+getLang("wall_reply_submit_settings")+'</div>\n  <div class="reply_submit_hint_opts" id="">\n    <div class="radiobtn %enter_on% _im_submit_btn" data-val="0" onclick="radiobtn(this, 0, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_1")+'</div></div>\n    <div class="radiobtn %ctrl_on% _im_submit_btn" data-val="1" onclick="radiobtn(this, 1, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_2")+"</div></div>\n  </div>\n</div>"},im_day_bar:'<h5 class="im-page--history-new-bar im-page--history-new-bar_days _im_bar_date %day_class%" data-date="%date%"><span>%day%</span></h5>',im_mess_bar:function(){return'<h4 class="im-page--history-new-bar _im_unread_bar_row"><span>'+getLang("mail_new_unread_msgs")+"</span></h4>"},im_replied_message:'<div class="im-replied"> <div class="im-replied--photo-wrapper"></div> <div class="im-replied--content"> <div class="im-replied--author"> <span class="im-replied--author-link">%authorName%</span> </div> <div class="im-replied--text">%text%</div> </div> </div>',im_drow:function(){return'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> %actions% <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0zm4.25 0a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l6-6a.75.75 0 0 1 1.06 0z" fill="currentColor"/></svg></button> <div class="_im_dialog_title" title="%title%"> <div class="nim-dialog--name" > <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--mute"><svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.69 5.5 11 11.8v1.7c0 .3-.23.47-.49.5l-3.63-3.5H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h.69Zm.77-2.85 2.2 2.19L10.5 2.5c.27.02.49.2.49.48v5.2l2.6 2.6a.75.75 0 0 1-1.06 1.06L4.4 3.71a.75.75 0 0 1 1.06-1.06Z" fill="currentColor"/></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg width="12" height="12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.84 1.49a.6.6 0 1 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0zM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0z" fill="currentColor"/><path d="M10.99 4.86a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7z" fill="currentColor"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_conversation_search_row:function(){return'<li data-list-id="%peer%" class="nim-dialog nim-conversation-search-row _im_dialog _im_dialog_%peer% %is_unread% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer nim-peer_search %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg width="12" height="12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.84 1.49a.6.6 0 1 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0zM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0z" fill="currentColor"/><path d="M10.99 4.86a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7z" fill="currentColor"/></svg> </div> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_drow_actions_menu:'<button type="button" class="nim-dialog--actions _im_dialog_actions" data-peer="%peer_id%"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M13 6.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"/></svg></button>',im_drow_close_button:'<button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer_id%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button>',im_page_inline_menu:'<ul class="im-page--inline-menu-list"> %actions%</ul>',im_page_inline_menu_item:'<li class="im-page--inline-menu--list-item"> <button class="im-page--inline-menu--button %class_name%" data-action="%action%"> <div class="im-page--inline-menu--button-icon">%icon%</div> <span class="im-page--inline-menu--button-text">%name%</span> </button> </li>',im_delete_actions:function(){return'<span class="nim-dialog--who">%text%</span> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="restore" type="button">'+getLang("mail_restore")+'</button> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="spam" type="button">'+getLang("mail_im_mark_spam")+'</button> <button class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="block" type="button">'+getLang("mail_user_black_list")+"</button>"},im_chat_change_topic:function(){return'<div class="im_change_topic_wrap clear_fix"> <div class="im_change_topic_label fl_l ta_r">'+getLang("mail_chat_topic_change_label")+'</div> <div class="im_change_topic_labeled fl_l"> <input class="text _im_chat_topic_change_input" value="%value%"/> </div> </div>'},im_msg_row:function(){return'<li class="im-mess %cls% _im_mess_noa _im_mess_%msg_id%" aria-hidden="%aria_hidden%" data-ts="%ts%" data-msgid="%msg_id%" data-cmid="%cmid%" data-peer="%from_id%"> <div class="im-mess--text wall_module _im_log_body">%text%</div> <span tabindex="0" role="link" aria-label="'+getLang("mail_select_message")+'" class="blind_label im-mess--blind-select _im_mess_blind_label_select"></span> <span class="blind_label im-mess--blind-read _im_mess_blind_unread_marker" %unread_params%></span> <span class="im-mess--marker _im_mess_marker" %marker_params%></span> </li>'},sImHistoryRowActions:function(){return'<div class="im-mess--actions"> <span role="link" aria-label="'+getLang("mail_im_mark_forward")+'" class="im-mess--forward _im_mess_forward"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M7.11 2.36a1.63 1.63 0 0 1 2.65 1.27v1.4c1.57.4 2.84 1.2 3.74 2.35a7.78 7.78 0 0 1 1.5 4.87.75.75 0 0 1-.46.7.75.75 0 0 1-.83-.18 6.23 6.23 0 0 0-1.96-1.48 5.8 5.8 0 0 0-2-.45v1.53a1.63 1.63 0 0 1-2.64 1.27L1.62 9.28a1.63 1.63 0 0 1 0-2.56l5.5-4.36Z"/></svg></span> <span role="link" aria-label="'+getLang("mail_im_reply")+'" class="im-mess--reply _im_mess_reply"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M7.11 2.36a1.63 1.63 0 0 1 2.65 1.27v1.4c1.57.4 2.84 1.2 3.74 2.35a7.78 7.78 0 0 1 1.5 4.87.75.75 0 0 1-.46.7.75.75 0 0 1-.83-.18 6.23 6.23 0 0 0-1.96-1.48 5.8 5.8 0 0 0-2-.45v1.53a1.63 1.63 0 0 1-2.64 1.27L1.62 9.28a1.63 1.63 0 0 1 0-2.56l5.5-4.36Z"/></svg></span> <span role="link" aria-label="'+getLang("mail_im_edit")+'" class="im-mess--edit _im_mess_edit"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="m9.49 3.95 2.56 2.56-6.14 6.14a4.82 4.82 0 0 1-2 1.2l-2.1.64a.24.24 0 0 1-.3-.3l.64-2.1a4.82 4.82 0 0 1 1.2-2L9.5 3.95Zm3.67-2.13 1.02 1.02c.4.4.42 1.03.08 1.45l-1.17 1.18-2.56-2.56 1.1-1.1c.42-.42 1.1-.42 1.53 0Z"/></svg></span> <span role="link" aria-label="'+getLang("mail_important_message")+'" class="im-mess--fav _im_mess_fav"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="m5.75 3.87-.43 1c-.03.06-.04.1-.07.12a.23.23 0 0 1-.07.06c-.03.02-.07.02-.15.03l-.62.1c-1.77.24-2.65.37-3.02.78a1.53 1.53 0 0 0-.37 1.32c.11.55.81 1.1 2.2 2.22l.24.2c.06.05.1.07.11.1a.23.23 0 0 1 .04.1l-.02.15-.07.38c-.39 2.06-.58 3.09-.28 3.59a1.53 1.53 0 0 0 1.24.73c.59.02 1.4-.65 3-1.99l.28-.22c.08-.08.12-.11.17-.12a.23.23 0 0 1 .13 0c.05.01.09.04.17.11l.28.24c1.6 1.33 2.41 2 3 1.98a1.53 1.53 0 0 0 1.24-.73c.3-.5.11-1.53-.28-3.6l-.07-.37a.51.51 0 0 1-.02-.15.23.23 0 0 1 .04-.1l.11-.1.24-.2c1.39-1.11 2.09-1.67 2.2-2.22a1.53 1.53 0 0 0-.37-1.32c-.37-.41-1.25-.54-3.02-.79l-.62-.09c-.08 0-.12-.01-.15-.03a.23.23 0 0 1-.07-.06c-.03-.02-.04-.06-.07-.13l-.43-1c-.71-1.63-1.06-2.45-1.56-2.7a1.52 1.52 0 0 0-1.37 0c-.5.25-.85 1.07-1.56 2.7Z"/></svg></span> </div> <div class="im-mess--check fl_l"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zM6 7.94a.75.75 0 1 0-1 1.12l1.46 1.3c.44.38 1.1.33 1.49-.1l.04-.05 2.9-3.75a.75.75 0 1 0-1.19-.92L7.1 8.91 6 7.94z"/></svg></div>'},im_wrap_mobile:'<b class="mob_onl %class%" %attrs% onmouseover="mobileOnlineTip(this, {%params%})"></b>',im_pinned_message:'<div class="im-page-pinned _im_pinned_message"> <button class="im-page-pinned--hide _im_pin_hide"></button> <div class="im-page-pinned--meta"> <a href="%link%" target="_blank" class="im-page-pinned--name">%name%</a> <span class="im-page-pinned--date">%date%</span> </div> <div class="im-page-pinned--content">%content%</div> </div>',im_pinned_message_media:'<span class="im-page-pinned--media">%text%</span>',im_pinned_message_media_bar:'<div class="im-page-pinned--media-bar">\n  <div class="im-page-pinned--media-bar_progress" style="width: %percent%%;"></div>\n</div>',im_pinned_messages_promo:'<div class="im-page--mess-actions-promo-content">%content%</div>',im_retry_link:function(){return'<button class="im-page--retry _im_retry_media">'+getLang("mail_retry")+"</button>"},sImLblWasEdited:function(){return" <span class='im-mess--lbl-was-edited _im_edit_time' data-time='%update_time%'>"+getLang("mail_was_edited_short")+"</span>"},sImLblWasSourceInfo:function(){return" <span class='im-mess--lbl-was-edited _im_page_info' data-info='%source%'>"+getLang("mail_was_source_short")+"</span>"},im_top_banner:'<div class="im-top-banner %classes%">\n  %icon%\n  <div class="im-top-banner--text">%text%</div>\n  <div class="im-top-banner--buttons">%buttons%</div>\n</div>',im_top_banner_icon:'<div class="im-top-banner--icon">\n  <img src="%icon%" alt=""/>\n</div>',im_top_banner_button_link:'<a href="%link%" target="_blank" class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small">%text%</a>',im_top_banner_button:'<button class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small" data-payload="%callback_data%">%text%</button>',im_top_banner_hide_btn:'<button class="im-top-banner--button im-top-banner--button_hide _im_top_banner_hide"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button>',im_calls_link:'<button class="im_srv_lnk_light _fc_call_link">%text%</button>',sImPeerMuteUnmute:'<button class="_im_peer_mute_unmute im-chat-input-block-control im-chat-input-block-control--with-icon im-chat-input-block-control--%type%">%text%</button>',sImPeerAcceptOrRejectMessageRequest:function(){return"<p>"+getLang("mail_message_request_user_notice")+'</p> <p> <button type="button" class="flat_button %cls_accept%">'+getLang("mail_message_request_accept")+'</button> <button type="button" class="flat_button secondary %cls_reject%">'+getLang("mail_message_request_reject")+"</button> </p>"},sImPeerReturnToChat:'<button class="_im_peer_return_to_chat im-chat-input-block-control">%text%</button>',sImCallSnippet:'<article class="CallSnippet %classes%" %attributes%> <div class="CallSnippet__users">%user_list%</div> <div class="CallSnippet__content"> <h3 class="CallSnippet__title">%title%</h3> <div class="CallSnippet__desc">%description%</div> </div> %button%</article>',sImMessageKeyboard:'<div class="MessageKeyboard">%content%</div>',sImMessageKeyboardRow:'<div class="MessageKeyboard__row">%content%</div>',sImMessageKeyboardButton:' <span class="MessageKeyboard__cell"> <%tagName% class="MessageKeyboard__button MessageKeyboard__button--%modifier% Button Button--size-s Button--%appearance% _im_mess_btn" %attributes% > <span class="MessageKeyboard__label">%label%</span> </%tagName%> </span>',sImBomb:'<span class="im-mess-stack--bomb %classnames%"></span>',sImEmptyCasper:function(){return' <div class="im-page--casper-empty"> '+getLang("mail_im_empty_casper_chat")+" </div>"},sImExpiredMessagePlaceholder:' <div class="im-expired-message _im_expired_message " data-last-msgid="%id_classes%" data-count="%count%"> <a href="/im?w=expired_messages" target="_blank" class="im-expired-message--in"> <span class="im-expired-message--inner">%text%</span> </a> </div>',sImGiftLabel:' <span class="im-mess-stack--gift">%content%</span>',sImMoneyTransferLabel:' <span class="im-mess-stack--money-transfer">%content%</span>',sUiActionsMenuSeparator:'<div class="ui_actions_menu_sep"></div>',sImUiActionMenuItem:'<a tabindex="0" role="link" class="ui_actions_menu_item im-action im-action_%icon% %classes%" data-action="%action%"> %name%</a>',sImPeerTagsItem:' <div class="PeerTagsItem _im_dialog_peer_tag" data-id="%tag_id%" style="background-color: %color%;">%name%</div>',sImPeerTagsAdTag:function(){return' <div class="PeerTagsItem PeerTagsItem--adTag %extra_class%"> <a href="%url%" target="_blank" class="PeerTagsItem__adTagLink"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </a> <button onclick="return showFastBox(\''+getLang("mail_ad_tag_no_access_box_title")+"', '"+getLang("mail_ad_tag_no_access_box_text")+'\');" class="PeerTagsItem__adTagAlert"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </button> </div>'},sImPeerTagsExtra:' <div class="PeerTagsItem PeerTagsItem--extra _im_peer_tags_extra">%text%</div>',sImPeerTagsExtraTooltipItem:' <div class="PeerTagsExtraTooltipItem"> <span class="PeerTagsExtraTooltipItem__color" style="background-color: %color%"></span> <span class="PeerTagsExtraTooltipItem__name">%name%</span> </div>',sImPeerTagsFilterItem:'<div class="PeerTagsFilterItem"> <input class="PeerTagsFilterItem__checkbox _im_peer_tags_filter_checkbox" type="checkbox" id="peer_tag_%tag_id%" %checked%> <label class="PeerTagsFilterItem__label" for="peer_tag_%tag_id%"> <span class="PeerTagsFilterItem__checkboxOff"> <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.05 2.53C4.79 2.13 5.52 2 7.13 2h5.74c1.61 0 2.34.14 3.08.53.65.35 1.17.87 1.52 1.52.4.74.53 1.47.53 3.08v5.74c0 1.61-.14 2.34-.53 3.08a3.64 3.64 0 0 1-1.52 1.52c-.74.4-1.47.53-3.08.53H7.13c-1.61 0-2.34-.14-3.08-.53a3.64 3.64 0 0 1-1.52-1.52c-.4-.74-.53-1.47-.53-3.08V7.13c0-1.61.14-2.34.53-3.08.35-.65.87-1.17 1.52-1.52Zm3.08.97c-1.53 0-1.96.14-2.38.36-.38.2-.69.5-.9.9-.21.4-.35.84-.35 2.37v5.74c0 1.53.14 1.96.36 2.38.2.38.5.69.9.9.4.21.84.35 2.37.35h5.74c1.53 0 1.96-.14 2.38-.36.38-.2.69-.5.9-.9.21-.4.35-.84.35-2.37V7.13c0-1.53-.14-1.96-.36-2.38-.2-.38-.5-.69-.9-.9-.4-.21-.84-.35-2.37-.35H7.13Z" fill="currentColor"/></svg> </span> <span class="PeerTagsFilterItem__checkboxOn"> <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.44 4.18C2 5.04 2 6.16 2 8.4v3.2c0 2.24 0 3.36.44 4.22a4 4 0 0 0 1.74 1.74c.86.44 1.98.44 4.22.44h3.2c2.24 0 3.36 0 4.22-.44a4 4 0 0 0 1.74-1.74c.44-.86.44-1.98.44-4.22V8.4c0-2.24 0-3.36-.44-4.22a4 4 0 0 0-1.74-1.74C14.96 2 13.84 2 11.6 2H8.4c-2.24 0-3.36 0-4.22.44a4 4 0 0 0-1.74 1.74Zm12.2 3.8a.9.9 0 1 0-1.28-1.27L8.7 11.38 6.64 9.33a.9.9 0 0 0-1.28 1.27l2.7 2.69a.9.9 0 0 0 1.27 0l5.3-5.3Z" fill="currentColor"/></svg> </span> <span class="PeerTagsFilterItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterItem__name">%name%</span> <span class="PeerTagsFilterItem__count">%count%</span> </label> </div>',sImPeerTagsFilterPaneItem:'<div class="PeerTagsFilterPaneItem _im_peer_tags_filter_pane_item" data-id="%tag_id%"> <span class="PeerTagsFilterPaneItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterPaneItem__name">%name%</span> <span class="PeerTagsFilterPaneItem__remove"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></span> </div>',sImCallUser:'<img src="%url%" alt="%name%" class="CallUsers__user">',sImCallUsers:'<div class="CallUsers"> <svg xmlns="http://www.w3.org/2000/svg" class="CallUsers__hidden"> <defs> <clipPath id="user-frame"> <path d="M12 0a12 12 0 11-7.97 20.97C5.89 18.47 7 15.37 7 12c0-3.36-1.1-6.47-2.97-8.97A11.95 11.95 0 0112 0z"/> </clipPath> </defs> </svg> <figure class="CallUsers__list"> %users% </figure> </div>',sImCallBannerContent:'<article class="CallBanner %cls%"> <div class="CallBanner__users">%user_list%</div> <div class="CallBanner__content"> <h3 class="CallBanner__title">%title%</h3> <div class="CallBanner__desc">%desc%</div> </div> </article>',sImCallBannerButton:function(){return'<button class="FlatButton FlatButton--secondary FlatButton--size-s _im_call_banner_join_btn _im_top_banner_button" type="button" data-link="%call_link%" >\n  <span class="FlatButton__in FlatButton__in--noPointerEvents">\n    \n    <span class="FlatButton__content">\n  '+getLang("mail_join_chat")+"\n</span>\n    \n  </span>\n</button>"},sImAudioMsgPlayerASRToggle:' <button onclick="return AudioMessagePlayer.toggleTranscript(this, event);" class="audio-msg-track--transcriptToggle _msg_asr_toggle" > <span class="audio-msg-track--transcriptToggleShow"><svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.89 12.11c.46 0 .73-.23.9-.8L3.22 10h3.05l.45 1.33c.15.55.42.78.92.78.51 0 .88-.34.88-.83 0-.18-.03-.33-.11-.56L6.1 4.42c-.25-.69-.66-1-1.36-1-.66 0-1.08.32-1.33 1.01l-2.3 6.29a1.82 1.82 0 0 0-.12.56c0 .5.34.83.9.83zM3.6 8.63l1.1-3.47h.04l1.12 3.46H3.61zm7.62 3.47c.78 0 1.57-.4 1.92-1.06h.03v.32c.04.5.36.76.82.76.49 0 .83-.29.83-.86V7.68c0-1.26-1.04-2.1-2.66-2.1-1.3 0-2.3.47-2.6 1.22a.9.9 0 0 0-.09.38c0 .39.3.66.72.66a.86.86 0 0 0 .68-.32c.38-.49.7-.66 1.22-.66.64 0 1.05.34 1.05.93v.41l-1.58.1c-1.57.1-2.45.75-2.45 1.9 0 1.13.91 1.9 2.1 1.9zm.56-1.24c-.58 0-.96-.29-.96-.76 0-.44.36-.73 1-.78l1.32-.08v.46c0 .68-.61 1.16-1.36 1.16z" fill="currentColor"/></svg></span> <span class="audio-msg-track--transcriptToggleHide"><svg width="16" height="12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.45 8.31a.9.9 0 0 1-1.1-1.42l4.1-3.2a.9.9 0 0 1 1.1 0l4.1 3.2a.9.9 0 1 1-1.1 1.42L8 5.54 4.45 8.31z" fill="currentColor"/></svg></span> </button>',sImCarousel:'<div class="Carousel _im_carousel" data-scroll-count="%scroll_count%"> <button class="Carousel__control Carousel__control--prev Carousel__control--hidden _im_carousel_control _im_carousel_control_left %controls_class%" data-direction="-1"><svg fill="none" height="16" viewBox="0 0 12 16" width="12" xmlns="http://www.w3.org/2000/svg"><path d="m4.77 8 3.37 3.36a.9.9 0 1 1-1.28 1.28l-4-4a.9.9 0 0 1 0-1.28l4-4a.9.9 0 1 1 1.28 1.28z" fill="currentColor"/></svg></button> <button class="Carousel__control Carousel__control--next _im_carousel_control _im_carousel_control_right %controls_class%" data-direction="1"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" fill="none" viewBox="0 0 12 16"><path fill="currentColor" d="M7.23 8 3.86 4.64a.9.9 0 0 1 1.28-1.28l4 4a.9.9 0 0 1 0 1.28l-4 4a.9.9 0 0 1-1.28-1.28L7.23 8Z"/></svg></button> <div class="Carousel__viewport _im_carousel_viewport"> <div class="Carousel__layer _im_carousel_layer"> %content% </div> </div> </div>',sImBotCarousel:'<div class="BotCarousel _im_bot_carousel _im_bot_carousel_%msg_id%"> %content%</div>',sImBotCarouselSlide:'<div class="BotCarousel__slide" data-index="%index%">%content%</div>',sImBotCarouselSlideTitle:'<div class="BotCarousel__slideTitle">%content%</div>',sImBotCarouselSlideDescription:'<div class="BotCarousel__slideDescription">%content%</div>',sImBotCarouselSlideContent:'<div class="BotCarousel__slideContent">%content%</div>',sImBotCarouselSlideLinkWrapper:'<a href="%url%" class="BotCarousel__slideLinkWrapper" target="_blank" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhotoLinkWrapper:'<a href="#" class="BotCarousel__slideLinkWrapper" onclick="return showPhoto(\'%photo_id%\', \'mail%msg_id%\', {}, event)" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhoto:"<img class=\"BotCarousel__slideImage\" src='%url%' alt='%alt%' />",sImBotCarouselSlideButtons:'<div class="BotCarousel__slideButtons">%content%</div>',sImBotCarouselSlideButton:' <%tag_name% class="BotCarousel__slideButton BotCarousel__slideButton--%modifier% Button Button--size-m Button--wide Button--overflow Button--%appearance% _im_mess_btn" %attributes% > <span class="BotCarousel__slideButtonLabel"> %label% </span> </%tag_name%>',sImConvoRecommendListUser:function(){return'<li class="ConvoRecommendList__item"> <a href="%link%" class="ConvoRecommendList__button _im_dialog _convoRecommendUser" data-peer="%id%" data-position="%position%" data-trackcode="%track_code%"> <div class="ConvoRecommendList__avatar"> %photo% <button class="ConvoRecommendList__removeItem _convoRecommendUserRemove" aria-label="'+getLang("mail_recommend_block_remove_item")+'"> <svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg> </button> </div> <span class="ConvoRecommendList__name">%name%</span> </a> </li>'},sImConvoRecommendListButton:'<li class="ConvoRecommendList__item"> <%tag_name% %attributes% class="ConvoRecommendList__button %classes%"> <span class="ConvoRecommendList__avatar ConvoRecommendList__icon" aria-hidden="true"> %icon% </span> <span class="ConvoRecommendList__name">%title%</span> </%tag_name%> </li>',sImConvoRecommendList:'<ul class="ConvoRecommendList" data-list-id="recommend_list"> %list_content%</ul>',sImEmptyDialogStub:' <div class="EmptyDialogStub %classes%"> <div class="EmptyDialogStub__main"> <div class="EmptyDialogStub__avatar">%avatar%</div> <div class="EmptyDialogStub__name">%name%</div> <div class="EmptyDialogStub__savedAs">%saved_as%</div> <div class="EmptyDialogStub__description">%stub_text%</div> </div> %secondary_block% </div> <div class="_im_stickers_panel_placeholder"></div>',sImEmptyDialogStubUserInfo:function(){return' <div class="EmptyDialogStub__secondary"> <div class="EmptyDialogStub__additional"> <div class="EmptyDialogStub__additionalIcon">%additional_icon%</div> %additional_info% </div> %mutual_friends% <div class="EmptyDialogStub__actions"> <a class="FlatButton FlatButton--secondary FlatButton--size-m" draggable="false" href="%profile_href%" > <span class="FlatButton__in"> <span class="FlatButton__content"> '+getLang("mail_view_profile")+"</span> </span> </a> %subscribe_button% </div> </div>"},sImEmptyDialogStubSubscribeButton:'<button class="FlatButton FlatButton--primary FlatButton--size-m _im_subscribe_button" type="button" >\n  <span class="FlatButton__in">\n    \n    <span class="FlatButton__content">\n  %button_text%\n</span>\n    \n  </span>\n</button>',sImEmptyDialogStubUnsubscribeButton:'<button class="FlatButton FlatButton--secondary FlatButton--size-m _im_subscribe_button" type="button" >\n  <span class="FlatButton__in">\n    \n    <span class="FlatButton__content">\n  %button_text%\n</span>\n    \n  </span>\n</button>',sImEmptyDialogStubMutualFriends:' <div class="EmptyDialogStub__mutualFriends"> <div class="EmptyDialogStub__mutualFriendsPhotos">%friends%</div> <div class="EmptyDialogStub__mutualFriendsCount">%text%</div> </div>',sImEmptyDialogStubMutualFriend:' <img src="%src%" class="EmptyDialogStub__mutualFriendPhoto" alt="%name%" />',sImEmptyDialogStickers:'<div class="EmptyDialogStickers"> %content%</div>',sImEmptyDialogSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> </a>',sImEmptyDialogAnimatedSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animation_url%"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> </a>',sImEmptyDialogLastMessage:function(){return'<span class="nim-dialog--preview nim-dialog--preview-empty-label">'+getLang("mail_empty_message")+"</span>"}}},6058:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(951201).makeIcon)("Icon12Chevron","chevron_12","0 0 12 12",'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12" id="chevron_12"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.22 2.47a.75.75 0 0 1 1.06 0l3 3a.75.75 0 0 1 0 1.06l-3 3a.75.75 0 0 1-1.06-1.06L6.69 6 4.22 3.53a.75.75 0 0 1 0-1.06z" fill="currentColor" /></symbol>',12,12)},447066:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(951201).makeIcon)("Icon12Dropdown","dropdown_12","0 0 12 8",'<symbol fill="none" viewBox="0 0 12 8" xmlns="http://www.w3.org/2000/svg" id="dropdown_12"><path clip-rule="evenodd" d="M2.156 2.295a.75.75 0 0 1 1.051-.137L6 4.306l2.793-2.148a.75.75 0 1 1 .914 1.189l-3.25 2.5a.75.75 0 0 1-.914 0l-3.25-2.5a.75.75 0 0 1-.137-1.052z" fill="currentColor" fill-rule="evenodd" /></symbol>',12,8)},446830:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(951201).makeIcon)("Icon16SearchOutline","search_outline_16","0 0 16 16",'<symbol fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" id="search_outline_16"><path d="M6.5 1a5.5 5.5 0 0 1 4.383 8.823l3.896 3.9a.75.75 0 0 1-1.061 1.06l-3.895-3.9A5.5 5.5 0 1 1 6.5 1zm0 1.5a4 4 0 1 0 0 8 4 4 0 0 0 0-8z" fill="currentColor" /></symbol>',16,16)},975761:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(951201).makeIcon)("Icon28ArchiveCircleFillGray","archive_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="archive_circle_fill_gray_28"><linearGradient id="archive_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#archive_circle_fill_gray_28_a)" /><g fill="#fff"><path d="M6.568 8.482c-.068.255-.068.565-.068 1.185 0 .31 0 .465.034.592a1 1 0 0 0 .707.707c.127.034.282.034.592.034h12.334c.31 0 .465 0 .592-.034a1 1 0 0 0 .707-.707c.034-.127.034-.282.034-.592 0-.62 0-.93-.068-1.185a2 2 0 0 0-1.414-1.414C19.763 7 19.453 7 18.833 7H9.167c-.62 0-.93 0-1.185.068a2 2 0 0 0-1.414 1.414z" /><path clip-rule="evenodd" d="M8 14.1c0-.56 0-.84.109-1.054a1 1 0 0 1 .437-.437C8.76 12.5 9.04 12.5 9.6 12.5h8.8c.56 0 .84 0 1.054.109a1 1 0 0 1 .437.437C20 13.26 20 13.54 20 14.1v2.1c0 1.68 0 2.52-.327 3.162a3 3 0 0 1-1.311 1.311C17.72 21 16.88 21 15.2 21h-2.4c-1.68 0-2.52 0-3.162-.327a3 3 0 0 1-1.311-1.311C8 18.72 8 17.88 8 16.2zm3.5.65a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 0 1.5h-3.5a.75.75 0 0 1-.75-.75z" fill-rule="evenodd" /></g></symbol>',28,28)},941192:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(951201).makeIcon)("Icon28MessageUnreadCircleFillGray","message_unread_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="message_unread_circle_fill_gray_28"><linearGradient id="message_unread_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#message_unread_circle_fill_gray_28_a)" /><g fill="#fff"><path d="M19.87 12.17a3 3 0 0 1-4.09-3.935A6.77 6.77 0 0 0 13.999 8c-3.314 0-6 2.359-6 5.269 0 1.406.628 2.684 1.653 3.63a11.487 11.487 0 0 1-.404 1.688c-.055.173-.13.376-.224.606a.578.578 0 0 0 .017.475.606.606 0 0 0 .801.273l.159-.076c.152-.075.286-.145.401-.21a12 12 0 0 0 1.895-1.333c.54.14 1.11.215 1.702.215 3.314 0 6-2.359 6-5.268 0-.377-.045-.745-.13-1.099z" /><path d="M20 9.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z" /></g></symbol>',28,28)},51441:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(951201).makeIcon)("Icon28NotificationCircleFillGray","notification_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="notification_circle_fill_gray_28"><linearGradient id="notification_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#notification_circle_fill_gray_28_a)" /><path d="M15.817 19.5a1.85 1.85 0 0 1-3.634 0zM9.5 18c-1 0-1.5-.333-1.5-1 0-1 1.5-1 1.5-2.5v-3a4.501 4.501 0 0 1 3.7-4.43V7a.8.8 0 0 1 1.6 0v.071a4.501 4.501 0 0 1 3.7 4.429v3C18.5 16 20 16 20 17c0 .667-.5 1-1.5 1z" fill="#fff" /></symbol>',28,28)},170322:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(951201).makeIcon)("Icon28SendCircleFillGray","send_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="send_circle_fill_gray_28"><linearGradient id="send_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#send_circle_fill_gray_28_a)" /><path d="M10.16 16.628c-.458 1.298-.745 2.21-.863 2.737-.368 1.653-.637 2.026.738 1.24 1.375-.786 8.031-4.679 9.516-5.544 1.936-1.128 1.962-1.04-.104-2.237-1.573-.912-8.15-4.703-9.412-5.447-1.26-.745-1.106-.414-.738 1.24.12.533.41 1.453.875 2.761.324.915 1.079 1.586 1.992 1.772l3.843.781a.07.07 0 0 1 .052.083.068.068 0 0 1-.052.055l-3.852.78c-.916.186-1.673.86-1.996 1.779z" fill="#fff" /></symbol>',28,28)},266106:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(951201).makeIcon)("Icon28TextCircleFillGray","text_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="text_circle_fill_gray_28"><path fill="url(#text_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14Z" /><path fill="#fff" d="M18.42 18.97c.996 0 2.09-.51 2.535-1.379H21v.419c.045.655.357.99.944.99.617 0 1.056-.38 1.056-1.12v-4.653c0-1.645-1.331-2.727-3.376-2.727-1.65 0-2.93.602-3.301 1.577a1.204 1.204 0 0 0-.112.502c0 .503.38.853.907.853.35 0 .625-.137.863-.41.483-.64.885-1.022 1.546-1.022.818 0 1.473.602 1.473 1.364v.54l-2.142.122c-1.993.122-3.108.989-3.108 2.474 0 1.47 1.153 2.47 2.67 2.47Zm.713-1.607c-.728 0-1.152-.381-1.152-.99 0-.58.394-.953 1.204-1.014L21 15.253v.594c0 .883-.915 1.516-1.867 1.516Z" /><path fill="#fff" fill-rule="evenodd" d="M6.189 19c.621 0 .971-.297 1.189-1.01l.59-1.67.095-.32h3.853l.1.32.59 1.693c.21.697.56.987 1.22.987.684 0 1.174-.438 1.174-1.054 0-.223-.039-.423-.148-.713l-3.077-7.971C11.441 8.386 10.897 8 9.981 8c-.886 0-1.438.4-1.764 1.27l-3.062 7.963c-.1.275-.155.527-.155.713C5 18.592 5.458 19 6.189 19Zm3.745-8.803h.054l1.456 4.303H8.51l1.425-4.303Z" clip-rule="evenodd" /><defs><linearGradient id="text_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop stop-color="#B1B6BD" /><stop offset="1" stop-color="#99A2AD" /></linearGradient></defs></symbol>',28,28)},263041:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(951201).makeIcon)("Icon28UsersCircleFillGray","users_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="users_circle_fill_gray_28"><linearGradient id="users_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#users_circle_fill_gray_28_a)" /><path d="M10.5 15c2.25 0 4.5.9 4.5 2.846v.134c0 .295-.04.447-.114.585a.773.773 0 0 1-.32.321c-.14.075-.29.114-.586.114H7.02c-.295 0-.447-.04-.585-.114a.773.773 0 0 1-.321-.32c-.075-.14-.114-.29-.114-.586v-.134C6 15.9 8.25 15 10.5 15zm7 0c2.25 0 4.5.9 4.5 2.846v.134c0 .295-.04.447-.114.585a.773.773 0 0 1-.32.321c-.14.075-.29.114-.586.114H16.6c.084-.248.13-.508.144-.797l.006-.223v-.134c0-1.069-.358-1.957-.971-2.659A7.74 7.74 0 0 1 17.5 15zm-7-6a2.25 2.25 0 1 1 0 4.5 2.25 2.25 0 0 1 0-4.5zm7 0a2.25 2.25 0 1 1 0 4.5 2.25 2.25 0 0 1 0-4.5z" fill="#fff" /></symbol>',28,28)},422152:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(951201).makeIcon)("Icon28VolumeCircleFillGray","volume_circle_fill_gray_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="volume_circle_fill_gray_28"><linearGradient id="volume_circle_fill_gray_28_a" gradientUnits="userSpaceOnUse" x1="-14" x2="14" y1="14" y2="42"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14z" fill="url(#volume_circle_fill_gray_28_a)" /><path clip-rule="evenodd" d="M6.923 11.5H9l3.293-3.293A1 1 0 0 1 14 8.914v10.172a1 1 0 0 1-1.707.707L9 16.5H6.923c-.669 0-.911-.07-1.156-.2-.244-.131-.436-.323-.567-.567s-.2-.487-.2-1.156v-1.154c0-.669.07-.911.2-1.156.131-.244.323-.436.567-.567.245-.13.487-.2 1.156-.2zm9.526-.788a.9.9 0 0 1 1.27.097A4.885 4.885 0 0 1 18.9 14c0 1.216-.444 2.33-1.177 3.186a.9.9 0 1 1-1.367-1.17A3.084 3.084 0 0 0 17.1 14c0-.772-.28-1.476-.747-2.018a.9.9 0 0 1 .096-1.27zm4.044-2.39a.9.9 0 1 0-1.251 1.294A6.08 6.08 0 0 1 21.1 14a6.08 6.08 0 0 1-1.859 4.384.9.9 0 0 0 1.252 1.294A7.88 7.88 0 0 0 22.9 14a7.88 7.88 0 0 0-2.407-5.677z" fill="#fff" fill-rule="evenodd" /></symbol>',28,28)},102523:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(379333).makeIcon)("Icon24List","list_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="list_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5Zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5Zm0 12a1.5 1.5 0 1 0-.001 2.999A1.5 1.5 0 0 0 4 16.5ZM21 18a1 1 0 0 0-1-1H8a1 1 0 0 0 0 2h12a1 1 0 0 0 1-1Zm0-6a1 1 0 0 0-1-1H8a1 1 0 0 0 0 2h12a1 1 0 0 0 1-1ZM8 7h12a1 1 0 0 0 0-2H8a1 1 0 1 0 0 2Z" fill="currentColor" /></g></symbol>',24,24)},340753:(e,t,a)=>{"use strict";function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M10.1 1.78c-.03-.09-.17-.09-.2 0-.2.54-.4.9-.55 1.17C9.15 3.33 9 3.6 9 4a1 1 0 0 0 2 0c0-.41-.14-.67-.35-1.05-.16-.28-.35-.63-.55-1.17z"/><path clip-rule="evenodd" d="M17.29 11.7c-.22.3-.49.53-.79.7v.68c0 .53 0 .98-.03 1.34-.03.38-.1.74-.27 1.08-.26.52-.68.94-1.2 1.2-.34.17-.7.24-1.08.27-.36.03-.8.03-1.34.03H7.42c-.53 0-.98 0-1.34-.03-.38-.03-.74-.1-1.08-.27a2.75 2.75 0 0 1-1.2-1.2 2.8 2.8 0 0 1-.27-1.08c-.03-.36-.03-.8-.03-1.34v-.69a2.5 2.5 0 0 1-.79-.69A4.45 4.45 0 0 1 2 9h.75H2v-.02a1.42 1.42 0 0 1 0-.12 2.44 2.44 0 0 1 .4-1.14C2.83 7.05 3.64 6.5 5 6.5h10c1.36 0 2.17.55 2.6 1.22a2.58 2.58 0 0 1 .4 1.26v.01c0 1.08-.2 2.02-.71 2.71zM3.5 9.01c0 .92.18 1.48.41 1.79.2.27.52.45 1.09.45.46 0 .78-.22 1.1-.53l.23-.25.02-.02.23-.25c.08-.08.2-.18.33-.27.13-.08.34-.18.59-.18s.46.1.6.18c.13.09.24.19.32.27l.23.25.02.02.24.25c.31.31.63.53 1.09.53.46 0 .78-.22 1.1-.53l.23-.25.02-.02.23-.25c.08-.08.2-.18.33-.27.13-.08.34-.18.59-.18s.46.1.6.18c.13.09.24.19.32.27l.23.25.02.02.24.25c.31.31.63.53 1.09.53.57 0 .88-.18 1.09-.45.23-.31.4-.87.41-1.79v-.02c0-.02 0-.06-.02-.1-.02-.1-.06-.24-.14-.36C16.2 8.33 15.89 8 15 8H5c-.9 0-1.2.33-1.34.53a1.08 1.08 0 0 0-.16.48zM17.25 9H18zm-4.4 2.78c.43.44 1.11.97 2.15.97v.3c0 .57 0 .96-.02 1.25-.03.29-.07.43-.12.52-.12.23-.3.42-.54.54-.1.05-.23.1-.52.12-.3.02-.68.02-1.25.02h-5.1c-.57 0-.96 0-1.25-.02a1.36 1.36 0 0 1-.52-.12 1.25 1.25 0 0 1-.54-.54c-.05-.1-.1-.23-.12-.52C5 14 5 13.62 5 13.05v-.3c1.04 0 1.72-.53 2.16-.97l.28-.3.06-.07.06.07.28.3c.44.44 1.12.97 2.16.97s1.72-.53 2.16-.97l.28-.3.06-.07.06.07.28.3z" fill-rule="evenodd"/><path d="M6.4 1.78c.03-.09.17-.09.2 0 .2.54.4.9.55 1.17.2.38.35.64.35 1.05a1 1 0 0 1-2 0c0-.41.14-.67.35-1.05.16-.28.35-.63.55-1.17zm7.2 0c-.03-.09-.17-.09-.2 0-.2.54-.4.9-.55 1.17-.2.38-.35.64-.35 1.05a1 1 0 1 0 2 0c0-.41-.14-.67-.35-1.05-.16-.28-.35-.63-.55-1.17z"/></g></svg>',name:"cake_outline_20"}}a.d(t,{getIcon20CakeOutline:()=>n})},310083:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="education_outline_20__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="education_outline_20__education_outline_20"><path id="education_outline_20__Bounds" d="M0 0h20v20H0z"/><path d="M17.5 9.06 16 9.9V13c0 2.8-2.72 5-6 5s-6-2.2-6-5V9.89l-2.35-1.3a1.25 1.25 0 0 1 0-2.19L9.4 2.15c.37-.2.83-.2 1.2 0l7.75 4.25c.42.24.66.68.65 1.13v5.22a.75.75 0 1 1-1.5 0V9.06Zm-3 1.65-3.9 2.14c-.37.2-.83.2-1.2 0L5.5 10.7V13c0 1.9 1.98 3.5 4.5 3.5s4.5-1.6 4.5-3.5v-2.3ZM10 3.54 2.77 7.5 10 11.46l7.23-3.96L10 3.54Z" id="education_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"education_outline_20"}}a.d(t,{getIcon20EducationOutline:()=>n})},826896:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="home_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="home_outline_20__Icons-20/home_outline_20"><g id="home_outline_20__home_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M3 11h-.04l-.18-.01A2.04 2.04 0 0 1 1.67 7.4L8.2 1.8a2.75 2.75 0 0 1 3.58 0l6.54 5.6A2.04 2.04 0 0 1 17 11v4.25c0 1.24-1 2.25-2.25 2.25h-2.8a.95.95 0 0 1-.95-.95V13.5a1 1 0 0 0-2 0v3.05c0 .52-.43.95-.95.95h-2.8c-1.24 0-2.25-1-2.25-2.25V11Zm11.75 5c.41 0 .75-.34.75-.75v-4.9c0-.47.38-.85.85-.85H17a.54.54 0 0 0 .35-.96l-6.54-5.6c-.46-.4-1.16-.4-1.62 0l-6.54 5.6a.54.54 0 0 0-.06.77c.09.1.21.17.31.18l.1.01h.65c.47 0 .85.38.85.85v4.9c0 .41.34.75.75.75H7.5v-2.5a2.5 2.5 0 1 1 5 0V16h2.25Z" id="home_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"home_outline_20"}}a.d(t,{getIcon20HomeOutline:()=>n})},404834:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="56" height="56" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g id="archive_outline_56__Icons-56/archive_outline_56" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="archive_outline_56__archive_outline_56"><path d="M0 0h56v56H0z"/><path d="M44.5 18c.83 0 1.5.67 1.5 1.5v21a7.5 7.5 0 0 1-7.5 7.5h-21a7.5 7.5 0 0 1-7.5-7.5v-21c0-.83.67-1.5 1.5-1.5h33ZM43 21H13v19.5a4.5 4.5 0 0 0 4.5 4.5h21a4.5 4.5 0 0 0 4.5-4.5V21Zm-21.5 9h13a1.5 1.5 0 0 0 0-3h-13a1.5 1.5 0 0 0 0 3Zm-9-22h31a6.5 6.5 0 0 1 6.5 6.5v4a2.5 2.5 0 0 1-2.5 2.5h-39A2.5 2.5 0 0 1 6 18.5v-4A6.5 6.5 0 0 1 12.5 8ZM47 18v-3.5a3.5 3.5 0 0 0-3.5-3.5h-31A3.5 3.5 0 0 0 9 14.5V18h38Z" id="archive_outline_56__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"archive_outline_56"}}a.d(t,{getIcon56ArchiveOutline:()=>n})},588379:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});var n=a(761508),i=a(961540),s=a(421295),r=browser.iphone||browser.ipad||browser.ipod;function o(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function l(e,t,a){(0,i.isMvk)()?window.addEvent(e,t,a,{passive:!0}):window.addEvent(e,t,a)}function c(e,t,a){(0,i.isMvk)()?window.removeEvent(e,t,a,{passive:!0}):window.removeEvent(e,t,a)}function d(){return document.visibilityState||document.webkitVisibilityState}function u(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(o.prototype,n.default.prototype),extend(o.prototype,{stop:function(){this.started=!1,c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),(0,i.isMvk)()&&this._isTopLevel()&&u()&&c(document,u(),this.onVisiblityChange),(0,i.isMvk)()&&r||(c(this.opts.focusElement,"focus",this.cbActiveB),c(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!(0,i.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),(0,i.isMvk)()&&this._isTopLevel()&&u()&&l(document,u(),this.onVisiblityChange),(0,i.isMvk)()&&r||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(s.screenWakeLocker.isLocked()||(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout)))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===d()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=d();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},188015:(e,t,a)=>{"use strict";a.d(t,{random:()=>i});a(781303);var n=a(40906);function i(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(((e,t)=>e+t)))}}catch(e){}return(0,n.intval)(rand(0,2147483647).toFixed(0))}},592842:(e,t,a)=>{"use strict";a.d(t,{screenfull:()=>n});var n=function(){var e=function(){for(var e,t,a=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,i=a.length,s={};n<i;n++)if((e=a[n])&&e[1]in document){for(n=0,t=e.length;n<t;n++)s[a[0][n]]=e[n];return s}return!1}(),t={request:function(t){var a=e.requestFullscreen;(t=t||document.documentElement)[a]()},exit:function(){document[e.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},raw:e};return!!e&&(Object.defineProperties(t,{isFullscreen:{get:function(){return Boolean(document[e.fullscreenElement])}},element:{enumerable:!0,get:function(){return document[e.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(document[e.fullscreenEnabled])}}}),t)}()},665446:(e,t,a)=>{"use strict";a.d(t,{initFailBack:()=>n});a(940851),a(296253);function n(){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.MediaDevices&&window.MediaDevices.getUserMedia;e&&!navigator.mediaDevices&&(navigator.mediaDevices=navigator.mediaDevices||{}),navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=function(t){return new Promise((function(a,n){e?e.call(navigator,t,a,n):n(new Error("NotSupported"))}))}),navigator.mediaDevices.enumerateDevices||(navigator.mediaDevices.enumerateDevices=function(){return new Promise((function(e,t){if(MediaStreamTrack&&MediaStreamTrack.getSources){var a={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(t){e(t.map((function(e){return{label:e.label,kind:a[e.kind],deviceId:e.id,groupId:""}})))}))}t(new Error("NotSupported"))}))})),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.AudioContext.prototype.createScriptProcessor=window.AudioContext.prototype.createScriptProcessor||window.AudioContext.prototype.createJavaScriptNode)}},140449:(e,t,a)=>{"use strict";a.d(t,{Stickers:()=>o});a(59357);var n=a(511417),i=a(70162),s={},r=(e,t,a,n)=>{delete s[t],1===n?Emoji.favorite.addFavoriteSticker(e,t,a):-1===n&&Emoji.favorite.deleteFavoriteSticker(e,t,a)};var o={toggleFavorite:function(e,t,a){if(t&&t.stopPropagation(),!e.classList.contains("on")&&Emoji.stickers[Emoji.TAB_FAVORITE_STICKERS].stickers.length>=Emoji.favoriteLimit&&!Emoji.favoriteLimitNoticed){var n=(0,i.langStr)(getLang("purchases_stickers_favorite_limit_notice"),"%s",Emoji.favoriteLimit);return setTimeout(window.showFastBox(getLang("global_error"),n).hide,3e3),ajax.post("stickers.php",{act:"favorite_limit_noticed",value:1}),Emoji.favoriteLimitNoticed=!0,!1}var o=e.getAttribute("data-sticker-id"),l=e.getAttribute("data-hash");return!(!o||!l)&&(!s[o]&&(s[o]=1,e.classList.toggle("on"),void ajax.post("/stickers.php",{act:"toggle_favorite",sticker_id:o,hash:l},{onDone:r.pbind(a,o,e)})))},getStickerUrl:function(e,t){var a=String(t);n.colorScheme.isDarkScheme()&&(a=a.replace(/b$/,"")+"b");var i={id:e,size:a};return window.isMVK?window.store.stickers&&rs(window.store.stickers.url_template,{id:e,size:a}):getTemplate("stickers_sticker_url",i)}}},863065:(e,t,a)=>{"use strict";a.d(t,{default:()=>p});a(175115),a(95767),a(991181),a(296253),a(751876),a(283946);var n=a(667294),i=a(288420),s=a(884137),r=a(654612),o=a(49535),l=(a(45697),a(266372)),c=a(459554),d=a(475234),u=a(961540);function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_.apply(this,arguments)}function g(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}class m extends n.Component{constructor(e){super(e),this.onLinkClick=e=>{var t=this.props.action.link;if(new RegExp(`^https:\\/\\/(.+\\.)?${u.VK_SITE_REGEX_SOURCE_UNSAFE}\\/gifts580392144\\?act=send&ref=[^&]+$`).test(t))return(0,r.showBox)("al_gifts.php",{act:"get_gift_box",mid:580392144,fr:0,ref:t.split("&ref=")[1]},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),(0,o.cancelEvent)(e)},this.onButtonClick=()=>{var e=this.props,t=e.action,a=e.sendMessage,n=e.appHash,i=e.keyboardAuthorId,s=e.store,r=(0,c.getCurrentTab)(s);if(r)return(0,l.handleButtonClick)(t,a,s,{keyboardAuthorId:i,appHash:n,peerId:r.peerId,onBeforeSend:this.onBeforeCallbackActionSend,onSendSuccess:e=>{this.onCallbackActionSendSuccess(s,r.peerId,e)},onSendFail:this.onCallbackActionSendFail})},this.onBeforeCallbackActionSend=()=>{this.setState({isLoading:!0})},this.onCallbackActionSendSuccess=(e,t,a)=>{var n=()=>{this.setState({callbackTimeout:void 0,isLoading:!1})},i=setTimeout(n,l.CALLBACK_TIMEOUT_MS),s={timeout:i,onCallback:n};e.set((e=>(0,d.setPressedCallbackButton)({peerId:t,eventId:a},s,e))),this.setState({isLoading:!0,callbackTimeout:i})},this.onCallbackActionSendFail=()=>{this.setState({isLoading:!1})},this.state={isLoading:!1,callbackTimeout:void 0}}componentWillUnmount(){this.state.callbackTimeout&&clearTimeout(this.state.callbackTimeout)}render(){var e=this.props,t=e.action,a=(e.sendMessage,e.appHash,e.keyboardAuthorId,g(e,["action","sendMessage","appHash","keyboardAuthorId"])),s=(0,l.getButtonAppearance)(this.props),r=(0,l.getButtonLabel)(this.props),o=t.type,c=n.createElement(i.default,_({wide:!0,overflow:!0},a,{type:t.type,appearance:s,className:`BotButton BotButton--${o} ${this.state.isLoading?"BotButton--isLoading":""}`,onClick:this.onButtonClick}),n.createElement("span",{className:"BotButtonLabel Button--overflow",dangerouslySetInnerHTML:{__html:r}}));return t.type===l.BUTTON_TYPE_OPEN_LINK?this.wrapLinkButton(c):c}wrapLinkButton(e){var t=this.props.action,a=(0,s.wrapAwayIfExternal)(t.link,!0);return n.createElement("a",{href:a,className:"Keyboard__buttonWrapper",target:"_blank",rel:"nofollow noopener",onClick:this.onLinkClick},e)}}m.defaultProps={color:l.BUTTON_COLOR_DEFAULT};const p=m},92946:(e,t,a)=>{"use strict";a.d(t,{default:()=>d});var n=a(667294),i=a(418793),s=a(863729),r=a(483295),o=a(104837),l=a(863065);class c extends n.Component{static getButtonWidth(e){return`calc(100% / ${e} - 10px)`}render(){var e=this.props.store,t=this.props.send,a=e.get(),s=(0,o.getCurrentKeyboard)(e),d=a.keyboard_app_hash;return s&&s.buttons?n.createElement("div",{className:(0,r.classNames)("Keyboard",{"Keyboard--hidden":s.hide})},n.createElement(i.Scroll,{className:"Keyboard__scroll-wrapper"},n.createElement("div",{className:"Keyboard__container"},s.buttons.map(((a,i)=>n.createElement("div",{key:`row-${i}`,className:"Keyboard__row"},a.map(((i,r)=>n.createElement("div",{className:"Keyboard__button",key:`cell-${r}`,style:{width:c.getButtonWidth(a.length)}},n.createElement(l.default,{sendMessage:t,appHash:d,keyboardAuthorId:s.author_id,action:i.action,type:i.action.type,color:i.color,store:e})))))))))):null}}const d=(0,s.connect)(c)},264493:(e,t,a)=>{"use strict";a.d(t,{default:()=>_});var n=a(667294),i=(a(45697),a(418793)),s=a(41650),r=a(863729),o=a(664891),l=a(483295),c=a(102523),d=s.default.getLang;class u extends n.Component{constructor(){super(...arguments),this.elementOnClick=(e,t)=>{t.preventDefault(),t.stopPropagation(),this.props.applyTemplate(e),this.toggleDropdown(!1)},this.toggleDropdown=e=>{this.setState({isShowDropDown:e})},this.state={isShowDropDown:!1}}render(){var e=this.props,t=e.getTemplates,a=e.showSettingsPopup,s=e.showCreatingTemplatePopup,r=e.isNeededRendering,u=this.state.isShowDropDown;if(!r())return null;var _=t();return n.createElement("div",{className:"TemplatesDropDown",onMouseOver:this.toggleDropdown.bind(this,!0),onMouseOut:this.toggleDropdown.bind(this,!1)},n.createElement("div",{className:(0,l.classNames)("TemplatesDropDown__wrapper",{"TemplatesDropDown__wrapper--show":u}),"aria-hidden":u},n.createElement("div",{className:"TemplatesDropDown__container"},n.createElement(i.Scroll,{className:"TemplatesDropDown__scroll-wrapper"},n.createElement("div",null," ",n.createElement("header",{className:"TemplatesDropDown__header"},n.createElement("h2",{className:"TemplatesDropDown__title"},d("mail_community_templates")),n.createElement("a",{role:"button",className:"TemplatesDropDown__setting-button",onClick:a},d("mail_settings_configure"))),_.length?n.createElement("ul",{className:"TemplatesDropDown__list"},_.map((e=>n.createElement("li",{key:e.id,className:"TemplatesDropDown__item",onMouseDown:this.elementOnClick.bind(null,e.id)},n.createElement("h3",{className:"TemplatesDropDown__item-name",dangerouslySetInnerHTML:{__html:e.name}}),n.createElement("div",{className:"TemplatesDropDown__item-content",dangerouslySetInnerHTML:{__html:e.text}}))))):n.createElement("div",{className:"TemplatesDropDown__not-found-container"},n.createElement("span",null,d("mail_community_templates_not_found")),n.createElement(o.default,{onClick:s},d("mail_add_community_template"))))))),n.createElement("button",{className:"TemplatesDropDown__icon"},n.createElement(c.default,null)))}}const _=(0,r.connect)(u)},369361:(e,t,a)=>{"use strict";a.r(t),a.d(t,{MAIN:()=>p,EDIT:()=>h,default:()=>f});a(59357),a(175115),a(940851),a(296253);var n=a(667294),i=(a(45697),a(41650)),s=a(268959),r=a(863729),o=a(288420),l=a(418793),c=a(664891),d=a(621963),u=a(242918),_=a(454593),g=a(495283),m=a(654612),p="main",h="edit";class v extends n.Component{constructor(){super(...arguments),this.setEditableMessage=e=>{var t=e.id,a=e.name,n=e.text;return new Promise((e=>this.setState({editableMessage:{id:t,name:a,text:n}},e)))},this.onChangeEditableMessage=(e,t)=>this.setEditableMessage(Object.assign({},this.state.editableMessage,{[e]:(0,g.escape)(t)})),this.deleteTemplate=e=>Promise.resolve().then((()=>this.state.section!==p?this.go(p):Promise.resolve())).then((()=>this.props.store.set(_.deleteTemplate.bind(null,e)))).catch((()=>{(0,m.showFastBox)((0,i.getLang)("mail_error"),(0,i.getLang)("mail_community_templates_delete_error"))})),this.saveTemplate=e=>{e.preventDefault();var t=this.state.editableMessage,a=t.name,n=t.text;a.length>200||a.length<2||a.length>2e3||n.length<5?(0,m.showFastBox)((0,i.getLang)("mail_error"),(0,i.getLang)("mail_form_is_filled_in_incorrectly")):this.props.saveTemplate(t).catch((()=>{(0,m.showFastBox)((0,i.getLang)("mail_error"),(0,i.getLang)("mail_community_templates_save_error"))})).then((()=>this.go(p)))},this.addHint=(e,t)=>{t.preventDefault();var a=this.state.editableMessage,n=a.id,i=void 0===n?null:n,s=a.name,r=a.text;return(0,d.setHTML)(this.textarea,`{${e.id}}`),this.setEditableMessage({id:i,name:s,text:`${r}{${e.id}} `})},this.getTextAreaRef=e=>{this.textarea=(e||{}).container},this.state={section:this.props.section,editableMessage:{id:null,name:"",text:""}}}go(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.id,n=void 0===a?null:a,i=t.name,s=void 0===i?"":i,r=t.text,o=void 0===r?"":r;return new Promise((t=>{this.state.section!==e?this.setState({section:e,editableMessage:{id:n,name:s,text:o}},(()=>{this.props.popup.updateBoxCoords(),t()})):t()}))}render(){var e=this.props,t=e.getTemplates,a=e.closePopup,r=this.state,_=r.section,g=r.editableMessage,m=t();return n.createElement("section",{className:"TemplatesSettings"},n.createElement(s.default,{title:n.createElement("span",{className:"TemplatesSettings__title"},_===p&&(0,i.getLang)("mail_community_templates"),_===h&&(0,i.getLang)("mail_add_community_template")),onCloseClick:a}),n.createElement("main",{className:"TemplatesSettings__content"},_===p&&(m.length?n.createElement(l.Scroll,{className:"TemplatesSettings__scroll-wrapper"},n.createElement("div",{className:"TemplatesSettings__list"},m.map((e=>n.createElement("section",{key:e.id,className:"TemplatesSettings__item"},n.createElement("h3",{className:"TemplatesSettings__item-name",dangerouslySetInnerHTML:{__html:e.name}}),n.createElement("div",{className:"TemplatesSettings__item-content",dangerouslySetInnerHTML:{__html:e.text}}),n.createElement("div",{className:"TemplatesSettings__buttons-row"},n.createElement(c.default,{onClick:()=>this.go(h,e),className:"TemplatesSettings__item-button"},(0,i.getLang)("mail_settings_edit")),n.createElement("span",{className:"TemplatesSettings__buttons-splitter","aria-hidden":"true"}," ","·"," "),n.createElement(c.default,{onClick:this.deleteTemplate.bind(null,e.id),className:"TemplatesSettings__item-button"},(0,i.getLang)("mail_delete")))))))):n.createElement("div",{className:"TemplatesSettings__not-found-container"},n.createElement("span",null,(0,i.getLang)("mail_community_templates_not_found")),n.createElement(c.default,{onClick:()=>this.go(h)},(0,i.getLang)("mail_add_community_template")))),_===h&&n.createElement("form",{className:"TemplatesSettings__form",id:"create_template_form",onSubmit:this.saveTemplate},n.createElement("div",{className:"TemplatesSettings__form-row"},n.createElement("label",{className:"TemplatesSettings__label",htmlFor:"name"},(0,i.getLang)("mail_name"),":"),n.createElement("div",{className:"TemplatesSettings__input-container"},n.createElement(d.default,{id:"name",type:"text",initialValue:g.name,className:"TemplatesSettings__input",onChange:this.onChangeEditableMessage.bind(null,"name")}),n.createElement("span",{className:"TemplatesSettings__notice"},(0,i.getLang)("mail_community_templates_input_size").replace("{min}",2).replace("{max}","200")))),n.createElement("div",{className:"TemplatesSettings__form-row"},n.createElement("label",{className:"TemplatesSettings__label",htmlFor:"text"},(0,i.getLang)("mail_text"),":"),n.createElement("div",{className:"TemplatesSettings__input-container"},n.createElement(d.WithEmoji,{title:(0,i.getLang)("global_emoji_hint")},n.createElement(d.default,{id:"text",name:"text",isMultiLine:!0,ref:this.getTextAreaRef,initialValue:g.text,className:"TemplatesSettings__textarea",onChange:this.onChangeEditableMessage.bind(null,"text")})),n.createElement("span",{className:"TemplatesSettings__notice"},(0,i.getLang)("mail_community_templates_input_size").replace("{min}",5).replace("{max}","2 000")))),n.createElement("div",{className:"TemplatesSettings__form-row"},n.createElement("label",{className:"TemplatesSettings__label"},(0,i.getLang)("mail_hints"),":"),n.createElement("div",{className:"TemplatesSettings__input-container"},(0,u.default)().map((e=>n.createElement(o.default,{type:"button",onMouseDown:this.addHint.bind(null,e),appearance:"secondary",className:"TemplatesSettings__hint",key:e.id},e.label))))))),n.createElement("footer",{className:"TemplatesSettings__footer"},_===p&&n.createElement(n.Fragment,null,n.createElement(c.default,{onClick:()=>this.go(h)},(0,i.getLang)("mail_add_community_template")),n.createElement(o.default,{onClick:a},(0,i.getLang)("mail_close"))),_===h&&n.createElement(n.Fragment,null,n.createElement("div",null,g.id&&n.createElement(c.default,{onClick:this.deleteTemplate.bind(null,g.id)},(0,i.getLang)("mail_delete_community_template"))),n.createElement("div",null,n.createElement(o.default,{appearance:"tertiary",onClick:()=>this.go(p)},(0,i.getLang)("mail_cancel")),n.createElement(o.default,{onClick:this.saveTemplate,form:"create_template_form",type:"submit"},(0,i.getLang)("mail_save"))))))}}v.defaultProps={section:p};const f=(0,r.connect)(v)},242918:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});a(59357);var n=a(549892),i=a(41650),s=a(993421),r=i.default.getLang;const o=()=>[{id:"user name",label:r("mail_community_templates_hint_name"),process:e=>(0,n.oCacheGet)(e,(0,s.getPeer)(e)).first_name},{id:"user surname",label:r("mail_community_templates_hint_last_name"),process(e){var t=(0,n.oCacheGet)(e,(0,s.getPeer)(e));return t.name.replace(t.first_name,"").trim()}},{id:"admin name",label:r("mail_community_templates_hint_your_name"),process:e=>(0,n.oCacheGet)(e,vk.id).first_name},{id:"admin surname",label:r("mail_community_templates_hint_your_last_name"),process(e){var t=(0,n.oCacheGet)(e,vk.id);return t.name.replace(t.first_name,"").trim()}},{id:"community",label:r("mail_community_templates_hint_community"),process:e=>(0,n.oCacheGet)(e,e.get().id).name},{id:"greeting",label:r("mail_community_templates_hint_greeting"),process(e){var t=(new Date).getHours();return r(t>=3&&t<12?"mail_greeting_good_morning":t>=12&&t<17?"mail_greeting_good_afternoon":t>=17&&t<=23?"mail_greeting_good_evening":"mail_greeting_good_night")}}]},727181:(e,t,a)=>{"use strict";a.d(t,{WIDGET_ACTIONS:()=>o,widgetDoAction:()=>l,widgetDoScroll:()=>c,updateWidgetScrollButtons:()=>d,onWidgetScrollButtonClick:()=>u});a(976142);var n=a(597903),i=a(315544),s=a(189798),r=a(850167),o="_im_widget_action",l=(e,t)=>{var a=t.originalEvent;a.stopPropagation(),a.stopImmediatePropagation();var i=a.target.closest(`.${o}`);if(!i)return null;var l,c,d,u,_=i.dataset;switch(_.type){case"callback":u=_.payload,(0,s.api)("widgetsKit.sendCallbackEvent ",{payload:u});break;case"call":!function(e,t){(0,n.startCallFromIm)(e,t,!1,[],n.CALL_ENTRY_POINT_WIDGET)}(e,_.peerId);break;case"grant_access":_.neededPermissions;break;case"open_mini_app":case"open_game":l=_.url,c=_.appId,d=new URL(l),(0,r.showWiki)({w:`app${c}${d.search}`});break;case"open_url":break;case"send_message":!function(e,t,a,n){(0,s.api)("messages.send",{peer_id:e,random_id:Math.round(2e9*Math.random()),payload:a,message:t}).then((()=>{n&&Notifier.showEvent({text:getLang("mail_send3")})}))}(_.peerId,_.messageText,_.messagePayload,_.messageShowConfirmation)}};var c=e=>{if(e.target&&e.target.dataset&&"scrolling-container"===e.target.dataset.type){var t=e.target,a=e.target.scrollLeft,n=a>0,i=a<t.scrollWidth-t.clientWidth,s=t.closest("[data-type=scroll-buttons-container]"),r=s.querySelector("[data-type=scroll-icon-left]"),o=s.querySelector("[data-type=scroll-icon-right]");r.style.display=n?"":"none",o.style.display=i?"":"none"}},d=()=>{document.querySelectorAll(".scrolling-wrapper-flexbox").forEach((e=>{e.dispatchEvent(new CustomEvent("scroll"))}))},u=e=>{e.originalEvent.stopPropagation();var t=(0,i.domClosest)("scroll-button--left",e.target),a=(0,i.domClosest)("scroll-button--right",e.target);if(t){var n=e.target.closest(".widget--container").querySelector("[data-type=scrolling-container]");n.scroll({left:n.scrollLeft-50,behavior:"smooth"})}else if(a){var s=e.target.closest(".widget--container").querySelector("[data-type=scrolling-container]");s.scroll({left:s.scrollLeft+50,behavior:"smooth"})}}},964876:(e,t,a)=>{"use strict";a.d(t,{handleEventChatUpdated:()=>_});a(991181),a(176774),a(940851),a(296253);var n=a(597903),i=a(104837),s=a(454593),r=a(28238),o=a(663825),l=a(407381),c=a(19331);function d(e,t){return-1===(e?e.indexOf(t):0)&&(e.push(t),!0)}function u(e,t){var a=e?e.indexOf(t):-1;return-1!==a&&(e.splice(a,1),!0)}function _(e,t,a,_,p,h){var v=(0,i.getTab)(e,t),f=_===vk.id;switch(a){case o.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case o.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:return a===o.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED?d(v.adminIds,_):u(v.adminIds,_),e.set((e=>(0,s.setCallAvailability)(t,e))).then((()=>{g(e,t,p),m(e,t,p,h)})),!0;case o.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:return v.data.flags=_,e.set((e=>(0,s.setCallAvailability)(t,e))).then((()=>{g(e,t,p),m(e,t,p,h)})),!0;case o.MAIL_CHAT_UPDATE_TYPE_PINNED:delete v.pinHideId,cur.imDb.update(r.PIN_HIDDEN_ID_OP,[v.peerId,void 0]);var b=v&&v.pinned&&(0,n.parserMessage)(v.pinned).messageId;return p.removeUnpinnedMessageEditable(e,b),!1;case o.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:return function(e,t,a){if((0,n.isTabLoaded)(a.get(),e)){var r=(0,i.getTab)(a,e);d(r.memberIds,t)&&r.membersCount++,-1===r.data.active.indexOf(t)&&r.data.active.push(t),t===vk.id&&(r.data.kicked=0,r.data.closed=0)}return a.set((a=>(0,s.loadChatMember)({[e]:[t]},a)))}(t,_,e).then((()=>{if(f&&e.get().peer===t)return e.set((e=>(0,s.getPinnedMessage)(t,e)))})).then((()=>m(e,t,p,h))).then((()=>{if(f&&e.get().peer===t)return Promise.all([e.set((e=>(0,s.getPeerActiveCallData)(t,e))),e.set((e=>(0,s.loadKeyboard)(t,e)))])})).then((()=>(e.get().peer===t&&v.callInProgress&&(p.updateBanner(e),p.updateHeader(e)),p.fixKeyboard()))).then((()=>{if((0,c.partConfigEnabled)("im_message_editable_sync")&&f)return e.set((e=>(0,s.syncMessagesEditableStatus)(e,t)))})),!0;case o.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case o.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:return function(e,t,a,r,o){if((0,n.isTabLoaded)(r.get(),e)){var l=(0,i.getTab)(r,e);u(l.memberIds,t)&&l.membersCount--,l.data.active=l.data.active.filter((e=>e!==t)),t===vk.id&&(a?l.data.kicked=1:l.data.closed=1,r.set((t=>(0,s.removePeerActiveCallData)(e,t))))}return t===vk.id&&r.get().peer===e?(o.cancelEditing(),r.set((t=>(0,s.unpinMessageOptimistic)(e,t)))):Promise.resolve()}(t,_,a===o.MAIL_CHAT_UPDATE_TYPE_USER_KICKED,e,p).then((()=>m(e,t,p,h))).then((()=>{if((0,c.partConfigEnabled)("im_message_editable_sync")&&f)return e.set((e=>(0,s.syncMessagesEditableStatus)(e,t)))})),e.get().id!==_&&((0,i.getKeyboard)(e,t)||{}).author_id!==_||e.set((e=>(0,s.deleteKeyboard)(t,e))).then((()=>p.fixKeyboard())),!0;case o.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:return e.set((e=>(0,s.loadBanner)(t,e))).then((()=>p.updateBanner(e))),!0;case o.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:case o.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:return!0;case o.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED:var y=_?e=>(0,s.getPeerActiveCallData)(t,e):e=>(0,s.removePeerActiveCallData)(t,e);return e.set(y).then((()=>{e.get().peer===t&&(p.updateBanner(e),p.updateHeader(e)),h.updateDialog(t,e)})),!0;case o.MAIL_CHAT_UPDATE_TYPE_IS_NEW_CHANGED:return e.set((e=>(0,l.setConvoIsNew)(t,_,e))),!0;default:return!1}}function g(e,t,a){e.get().peer===t&&((0,s.setActions)(e.get()),a.updateActions(e))}function m(e,t,a,n){e.get().peer===t&&((0,s.setActions)(e.get()),a.updateChat(e,t),n.updateDialog(t,e))}},348211:(e,t,a)=>{"use strict";a.d(t,{mount:()=>C});a(175115),a(530522),a(66108),a(579665),a(95767),a(940851),a(991181),a(296253),a(820075);var n=a(712439),i=a(786067),s=a(695724),r=a(315544),o=a(609720),l=a(597903),c=a(454593),d=a(498101),u=a(778755);function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_.apply(this,arguments)}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return m(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function p(e,t,a,n){var i=e instanceof Array?e:(0,r.geByClass)("_im_bar_date",e),o=t.contHeight();d.default.onNewMessagesChunk();var l=i.reduce(((e,t)=>(e[(0,r.domData)(t,"date")]=[t.offsetTop+10,o,t],e)),{}),c=!a&&n.barMap?n.barMap:{};return n.barMap=(0,s.extend)(c,l),n.barMapKeys=Object.keys(n.barMap).sort(),Promise.resolve(n)}function h(e,t){return t.barMapKeys.forEach((a=>{t.barMap[a][0]-=e})),Promise.resolve(t)}function v(e,t,a,n,i){var s=e.get().barMap[t],r=(0,l.isClassicInterface)(i)?68:20;return a-(s[0]+a-s[1])+n-r}function f(e,t,a,n){return n.barTransition=n.barMap[t][2],a>0?((0,r.addClass)(n.barMap[t][2],"im-page--date-bar-transition-inverse"),(0,r.addClass)(e,"im-page--date-bar-transition-inverse")):a<0&&((0,r.removeClass)(n.barMap[t][2],"im-page--date-bar-transition-inverse"),(0,r.removeClass)(e,"im-page--date-bar-transition-inverse")),(0,r.addClass)(n.barMap[t][2],"im-page--date-bar-transition"),(0,r.addClass)(e,"im-page--date-bar-transition"),Promise.resolve(n)}function b(e,t){return t.barTransition&&((0,r.removeClass)(t.barTransition,"im-page--date-bar-transition"),t.barTransition=null),(0,r.removeClass)(e,"im-page--date-bar-transition"),Promise.resolve(t)}function y(e,t,a,n,i){var s,o,l=e.get(),c=a-t;l.barMapKeys.forEach((t=>{var r=v(e,t,a,n,i);if(r>=c){var l=s?v(e,s,a,n,i):a;s=l>r?t:s}else if(r<c){var d=o?v(e,o,a,n,i):0;o=r>d?t:o}}));var d={};return[[o,"prev"],[s,"cur"]].forEach((t=>{var s=g(t,2),o=s[0],l=s[1];o&&(d[l+"Bar"]=function(e,t){var a=e.get().barMap[t][2];return{text:a.textContent,date:(0,r.domData)(a,"date")}}(e,o),d[l+"Left"]=v(e,o,a,n,i)-c)})),d}function w(e,t,a,n,o){var d=e.get(),_=(0,c.isEverythingLoaded)(d),g=t.get(),m=o.scrollTop(),p=g.lastTop?g.lastTop-m:0;g.lastTop=m;var h=(0,u.isPinnedMessageVisibleInTab)(d,d.peer)?(0,l.getPinnedMessageHeight)(e):0,v=(0,c.isSearchingInplace)(d.peer,d)&&d.tabs[d.peer]&&d.tabs[d.peer].top_banner?50:0,w=((0,l.isClassicInterface)(e)?68+h+v:0)-16,C=y(t,m,o.contHeight(),w,e),E=C.prevBar,S=C.curBar,T=C.prevLeft,I="translateY(0px)",L=!1,M=!1,k=!1;S||_||(S=function(e){var t=(0,r.geByClass1)("_im_mess",e),a=(0,r.domData)(t,"ts");return t&&a?{text:(0,i.getShortDate)((0,s.intval)(a),!1,!0,getLang("months_of","raw")),date:a}:null}(n)),S?L=S:M=!0,E&&S&&T>-32&&T<0&&(k=!0,M=!1,L=S,I=`translateY(${-32-T}px)`),L&&function(e,t){(0,r.domData)(e,"ts")!==t.date&&(e.innerHTML=t.text,(0,r.domData)(e,"ts",t.date),e.style.visibility="visible")}(a,L),k?t.set(f.bind(null,a,E.date,p)):t.set(b.bind(null,a)),I&&(a.style.transform=I),(0,r.toggleClass)(a,"im-page--top-date-bar_no-b",M)}function C(e,t){var a=(0,r.geByClass1)("_im_top_date_bar",t),i={lastTop:!1,barMap:{},barMapKeys:[],isDisabled:!1},s=(0,n.default)(i),l=null,c=null,d=null,u=(0,o.debounce)((e=>{var a=s.get();Object.keys(a).length&&!a.isDisabled&&s.set(p.bind(null,t,e,!1))}),500);return{reset(n){s.get().isDisabled||s.set(p.bind(null,t,n,!0)).then(w(e,s,a,t,n))},disable(){s.setState(_({},i,{isDisabled:!0}))},enable(){s.setState({isDisabled:!1})},heightIncreased(e,t){s.get().isDisabled||(u(t),s.set(h.bind(null,e)))},parseMore(n,i){s.get().isDisabled||s.set(p.bind(null,n,i,!1)).then((()=>{w(e,s,a,t,i)}))},toggle(e){s.get().isDisabled&&e||a.classList.toggle("im-page--top-date-bar--hidden",!e)},show(){s.get().isDisabled||(c=Date.now(),d||((0,r.addClass)(t,"im-page--top-date-bar_visible"),d=setInterval((function(){Date.now()-c>2e3&&((0,r.removeClass)(t,"im-page--top-date-bar_visible"),clearInterval(d),d=null)}),100)))},update(n){s.get().isDisabled||(l&&(clearTimeout(l),l=null),l=setTimeout((function(){w(e,s,a,t,n)}),300),w(e,s,a,t,n))},unmount(){l&&(clearTimeout(l),l=null),d&&(clearInterval(d),d=null),s.unmount()}}}},258973:(e,t,a)=>{"use strict";a.d(t,{mount:()=>oe});a(991181),a(940851),a(296253);var n=a(454593),i=a(159121),s=a(49535),r=a(695724),o=a(486125),l=a(315544),c=a(104837),d=a(667294),u=a(973935),_=a(367033),g=a(730365),m=a(268959),p=a(878888),h=a(597903),v=a(699750),f=a(610124),b=a(712439),y=a(645523),w=a(982452),C=a(654612),E=a(376852),S=a(41650),T=a(191040),I=a(179203),L=a(827749),M=a(124041),k="_im_dialogs_creation_name",P="_im_create_select",A="_im_create_avatar",D="_im_confirm_creation",B="_im_avatar_img",x=["im-creation--item_hovered"],O="olist_item_wrap_on",R=33554432,N=R;function F(e){!function(e){var t=e.querySelector("._im_creation_settings_modal_wrap"),a=U.bind(null,t);u.render(d.createElement(g.default,{onClose:a,className:"im-creation--modal-settings"},d.createElement(m.default,{title:(0,S.getLang)("mail_chat_creation_settings"),onCloseClick:a}),d.createElement(_.ChatSettingsOptions,{flags:N,back:a,isChatCreation:!0,onSave:H,afterSave:j.bind(null,t),onCancel:a})),t)}(e)}function U(e){e&&u.unmountComponentAtNode(e)}function H(e){return N=e,Promise.resolve()}function j(e){U(e)}function q(e){return(0,E.showTooltip)(e,{text:(0,S.getLang)("mail_chat_creation_settings_icon_tooltip"),black:1,center:!0,zIndex:1e3,shift:[0,10]})}function K(e,t,a,i,s,r){(0,n.toggleConversation)(!1),(0,l.removeClass)(t,"im-create_shown"),(0,l.removeClass)(t,"im-create_photo-attached"),setTimeout(G.bind(null,t,!1),100),Q(r).map((e=>(0,l.geByClass1)("_im_dialog"+e))).forEach((e=>{(0,l.removeClass)(e,O)})),a().createCanceled(e),s.resetSelection(),"add_member"===e.get().creationType&&e.set(n.setCreationType.bind(null,"chat",[])),e.set(n.presetAvatar.bind(null,!1));var o=(0,l.geByClass1)(B,t);V(e,r,t),uiSearch.reset((0,l.geByClass1)(k,t)),uiSearch.reset((0,l.geByClass1)(P,t)),o&&o.parentNode.removeChild(o),V(e,r,t),cancelStackFilter("im_search");var c=0===e.get().peer?"search":"default";e.get().longpoll.push([(0,y.transitionEvent)(c)]),(0,l.attr)(t,"aria-hidden","true")}function W(e,t,a){return t&&(a.current_create_peer_ids={},a.current_create_peers=[]),a.current_create_peer_ids||(a.current_create_peer_ids={}),a.current_create_peers||(a.current_create_peers=[]),e.forEach((e=>{e.then((e=>{e=e.filter((e=>!a.current_create_peer_ids[e.peerId])),a.current_create_peer_ids=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),a.current_create_peer_ids),a.current_create_peers=a.current_create_peers.concat(e)}))})),Promise.resolve(a)}function G(e,t){(0,l.toggleClass)(e,"im-create_material",t)}function V(e,t,a){var n=(0,l.geByClass1)(D,a),i=t.get().selection.length,s="add_member"===e.get().creationType,r=uiSearch.getFieldEl((0,l.geByClass1)(k,a)),o=i>0,c=(r?r.value.trim():"").length>0,d=!o&&(s||!c),u=s?1===i?(0,S.getLang)("mail_append_chat"):(0,S.getLang)("mail_im_create_chat_with"):c||i>1?(0,S.getLang)("mail_im_create_chat"):(0,S.getLang)("mail_im_go_to_dialog");M.FlatButton.setLabel(n,u),M.FlatButton.setDisabled(n,d)}function z(e,t,a,n,i,s,o){if(o){var c,d=(0,r.intval)((0,l.domData)(o,"list-id")),u=Q(s),_=(0,r.trim)(o.textContent),g=(0,l.geByClass1)(P,t),m=(0,l.getSize)(g)[1];inArray(d,u)?(c=n.removeSelection(d,_),(0,l.removeClass)(o,O)):(c=n.addSelection(d,_),(0,l.addClass)(o,O)),c.then((()=>{var e=m-(0,l.getSize)(g)[1],t=i.scrollTop();i.scrollTop(t-e)})),V(e,s,t);var p=(0,l.geByClass1)(P,t);uiSearch.reset(p)}}function Y(e,t){var a=Q(e),n=["_im_dialog","_im_dialog"+t.peerId,"im-creation--item"],i=[];return t.online&&i.push("online"),mobPlatforms[t.online]&&i.push("mobile"),inArray(t.peerId,a)&&n.push(O),getTemplate("im_owner_item",{owner_id:t.peerId,cls:" "+n.join(" "),photo:t.photo,name:t.name,link:t.href,img_cls:i.join(" ")})}function $(e){return(0,c.getSearchText)(e)||!1}function Q(e){return e.get().selection.map((e=>e.id))}function Z(e,t,a){return e.then((e=>e.filter((e=>e.is_friend&&!inArray(e.peerId,a.get().creationFilter)))))}function X(e,t,a,i,s){var r,o,c=(0,l.geByClass1)(P,e),d=(0,n.searchLocalHints)(i,t.get()),u=a.hoverFirstElement.bind(a,x,ie(t));t.get().creation_shown_all=!1,a.reset(),a.pipe(Z(d,0,t),i),a.toTop(),i?(o=(0,n.searchTopConv)(i,t.get()),r=(0,n.searchHintsIndex)(i,[],"friends",t.get()),a.pipe(Z(r,0,t),i).then(u),a.pipe(Z(o,0,t),i).then(u)):(r=Promise.resolve([]),o=Promise.resolve([])),t.set(W.bind(null,[d,o,r],!0)),uiSearch.showProgress(c),Promise.all([d,r,o]).then((()=>uiSearch.hideProgress(c)))}function J(e,t,a,i){var s=2e9+Math.round(rand(1e6,2e6));cur.recieveCropResult=a=>{cur.recieveCropResult=!1,(0,o.curBox)()&&(0,o.curBox)().hide(),e.set(n.presetAvatar.bind(null,a)),(0,n.getOwnerPhoto)(a,s).then((e=>{(0,l.geByClass1)(A,t).appendChild((0,l.ce)("img",{className:"im-chat-placeholder--img _im_avatar_img",src:e}))})),(0,l.addClass)(t,"im-create_photo-attached")},Page.ownerPhoto(s)}function ee(e,t){(0,l.geByClass1)(A,t).innerHTML="",e.set(n.presetAvatar.bind(null,!1)),(0,l.removeClass)(t,"im-create_photo-attached")}function te(e,t,a,n,i,s){Q(t).map((e=>(0,l.geByClass1)("_im_dialog"+e))).forEach((e=>(0,l.removeClass)(e,O))),t.reset(),X(a,e,n,!1,Q(t)),i.resetSelection(),K(e,a,s,0,i,t)}function ae(e,t,a,s,r,o,d){var u=Q(t),_=e.get(),g=(0,l.geByClass1)(D,a),m=uiSearch.getFieldEl((0,l.geByClass1)(k,a)).value,p="add_member"===e.get().creationType,h=!p&&(m.length||u.length>1),v=(0,l.geByClass1)("_im_creation_show_history_input",a).checked;if(p)return e.set(n.addNewMember.bind(null,_.peer,u,v)).catch((e=>(0,C.showFastBox)((0,S.getLang)("global_error"),e))),K(e,a,o,0,r,t);if(M.FlatButton.lock(g),!h)return f(u[0]);function f(n){N=R,te(e,t,a,s,r,o),function(e,t,a,n,i,s){K(e,t,a,0,i,s),e.get().longpoll.push([(0,y.changePeer)(n,!1,!1,!1,"create_conversation")])}(e,a,o,n,r,t),M.FlatButton.unlock(g),(0,c.isSearching)(e)?o().cancelSearch(e):o().restoreDialogs(e),(0,L.collectChatCreateStats)(n,"create_chat__create_new")}e.set((e=>(0,I.createChatAction)(e,_.next_chat_avatar,u,m,N))).then((()=>f(_.next_peer))).catch((e=>{M.FlatButton.unlock(g),(0,i.topMsg)((0,S.getLang)("global_unknown_error"),2,"#FFB4A3")}))}function ne(e,t){return(0,E.showTooltip)(e,{text:(0,S.getLang)("mail_cancel"),black:1,zIndex:1e3,shift:[3,-2],appendCls:"js-im-page"})}function ie(e,t){var a=t&&t.get().selection.length;return{top:-1,bottom:(0,h.isClassicInterface)(e)?a>0?69:0:-1}}function se(e,t,a){V(e,t,a)}function re(e,t,a,n,i,s,r,o){return{show(t){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.setState({shown:!0}),G(e,!0),cancelStackPush("im_create",r),(0,l.addClass)(e,"im-create_shown");var o=n.get().selection.reduce(((e,t)=>(e[t.id]=!0,e)),{});s&&s.forEach((t=>{if(!o[t[0]]){var a=e.querySelector(`._im_dialog${t[0]}`);i.addSelection(t[0],t[1]),a&&!a.classList.contains(O)&&a.classList.add(O)}})),function(e,t,a,n){(0,l.toggleClass)(e,"im-create_chat","chat"===n.get().creationType),(0,l.toggleClass)(e,"im-create_invite","add_member"===n.get().creationType);var i="chat"===n.get().creationType?(0,S.getLang)("mail_im_group_dialog"):(0,S.getLang)("mail_im_friends_tab"),s=(0,l.geByClass1)("_im_create_title",e);(0,l.val)(s,i),M.FlatButton.setLabel((0,l.geByClass1)(D,e),"add_member"===n.get().creationType?(0,S.getLang)("mail_im_create_chat_with"):(0,S.getLang)("mail_im_create_chat")),X(e,n,t,!1,a.get().selection.map((e=>e.id)))}(e,a,n,t),setTimeout((()=>{t.get().longpoll.push([(0,y.transitionEvent)("create")]),(0,l.attr)(e,"aria-hidden","false"),i.focus()}),1)},focusSearch(e){i.focus()},confirmCreate(e){o()},hide(a){a.get().shown=!1,K(a,e,t,0,i,n)},scroll(e){a.scrollPage(e,!0)},updateScroll(){a.updateScroll()},selectElement(t){z(t,e,0,i,a,n,a.getHoveredElement())},hoverPrevElement(e){a.hoverPrevElement(x,null,ie(e,n))},hoverNextElement(e){a.hoverNextElement(x,null,ie(e,n))},unmount(){(0,f.destroyModule)(s),a.unmount(),i.unmount(),cancelStackFilter("im_create"),cur.recieveCropResult=void 0}}}function oe(e,t,a){var i=(0,b.default)({selection:[]}),o=(0,l.geByClass1)("_im_create_list",e),c=(0,l.geByClass1)(P,e),d=(0,T.debouncedPromise)((function(a){return function(e,t,a,n){var i=n.get(),s=$(i);i.selection.map((e=>e.id)),a.unhoverElements(x),e.get().creationQuery=s,X(t,e,a,s)}(t,e,_,a)}),300),u=(0,v.mount)(c,i,(()=>({selectionDeleted(a,n){V(t,a,e),(0,l.removeClass)((0,l.geByClass1)("_im_dialog"+n),O)},onChange:e=>d(e).catch((e=>{if("debounce"!==e)throw e}))}))),_=(0,p.mount)(o,(0,b.default)({offset:0,limit:100,elements:[],elCls:"_im_dialog"}),(()=>({idFn:e=>(0,r.intval)(e.peerId),hoverableFn:e=>(0,l.hasClass)(e,"_im_dialog"),renderFn:Y.bind(null,i),more(e,a){var s;return t.get().shown?(t.get().creation_shown_all||!1!==$(i)?s=Promise.resolve([]):(t.get().creation_shown_all=!0,s=(0,n.searchTopConv)($(i),t.get())),t.set(W.bind(null,[s],!1)),Z(s,$(i),t)):Promise.resolve(!1)},onClick(a,n){(0,s.checkEvent)(a)||(z(t,e,0,u,_,i,n),(0,s.cancelEvent)(a))}})));t.get().creationQuery=!1,t.get().creationType="chat";var g=K.bind(null,t,e,a,"cross",u,i),m=J.bind(null,t,e),h=ee.bind(null,t,e),y=te.bind(null,t,i,e,_,u,a),C=ae.bind(null,t,i,e,_,u,a),E=se.bind(null,t,i,e),S=F.bind(null,e),I=(0,l.geByClass1)("_im_create_cancel",e),L=(0,l.geByClass1)(k,e),M=(0,l.geByClass1)("_im_creation_settings",e),B=L.querySelector(".ui_search_reset"),R=(0,f.createModule)({handlers:(t,a)=>{t(I,"click",g),t(I,"mouseover",ne.bind(null,I)),t((0,l.geByClass1)(A,e),"click",m),t((0,l.geByClass1)("_im_create_remove_avatar",e),"click",h),t((0,l.geByClass1)("_im_cancel_creation",e),"click",y),t(L,"change",E),t(L,"input",E),t(L,"paste",E),t(B,"click",E),t((0,l.geByClass1)(D,e),"click",C),t(M,"click",S),t(M,"mouseenter",q.bind(null,M)),t(e,"mouseover",(0,w.throttle)(_.unhoverElements.bind(_,x),100))}});return re(e,a,_,i,u,R,g,C)}},922136:(e,t,a)=>{"use strict";a.d(t,{mount:()=>at});a(175115),a(530522),a(579665),a(95767),a(798184),a(991181),a(820075),a(59357),a(176774),a(976142),a(66108),a(940851),a(296253);var n=a(454593),i=a(786067),s=a(486125),r=a(695724),o=a(49535),l=a(597903),c=a(104837),d=a(294940),u=a(499349),_=a(932699),g=a(254692),m=a(712439),p=a(982452),h=a(878888),v=a(663825),f=a(610124),b=a(612202),y=a(549892),w=a(459554),C=a(376852),E=a(375053),S=a(645523),T=a(826338),I=a(923876),L=a(726271),M=a(682886),k=a(993421),P=a(827749),A=a(407381),D=a(179288),B=a(914012),x=a(240367),O=a(99392),R=a(19331),N=a(404834),F=a(578843),U=a(475234),H=a(917791),j=a(754204),q=a(57757),K=a(315544),W=a(163612),G=a(495283);function V(){return V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},V.apply(this,arguments)}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Y(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var $="_im_dialog",Q="_im_peer_target",Z="_im_dialog_star",X="_im_dialog_actions",J="_im_dialog_close",ee="_im_dialog_actions_item",te="nim-dialog_inline-menu_visible",ae=["_im_dialog_selected","nim-dialog_selected"],ne=["_im_dialog_hovered","nim-dialog_hovered"],ie="_im_dialog_peer_tags",se="_convoRecommendUser",re="_convoRecommendUserRemove",oe="_convoRecommendAction",le="ConvoRecommendList--fadeIn",ce="ConvoRecommendList--fadeOut",de="_im_dialog_folder_button_hide",ue="im-page--dialogs-folder-button_hidden",_e="_im_dialog_folder_actions",ge="_im_dialog_folder_actions_item",me="_im_dialog_folder_back";function pe(e,t,a){(0,K.removeClass)(t.parentNode,"im-page--dialogs_with-mess");var n=a.getCurrentElements().filter((e=>e.message));a.toTop(),a.reset(),(0,b.statlogsProbValueEvent)(.01,"im_search_stat",1,"search_messages_only"),n.length>0?(n=[{type:"sep_messages"}].concat(n),e.setState({searchOnlyMessages:!0})):n=[Ue()],a.pipeReplace(Promise.resolve(n))}function he(e){return(0,K.hasClass)(e,"_im_search")}function ve(e){if((0,c.isSearching)(e)&&e.get().searchAllLoaded||(0,c.isRecentSearchesActive)(e))return Promise.resolve([]);if(e.get().dialog_search_going||(0,l.isClassicInterface)(e)&&0!==e.get().peer)return Promise.resolve(!1);if((0,c.isSearching)(e))return(0,n.searchMessages)((0,c.getSearchText)(e),e.get()).then((e=>{var t=z(e,2),a=t[0];return Fe(t[1],a)}));var t=e.get().active_tab,a=e.get().dialog_tabs_all;return![g.FOLDER_MESSAGE_REQUEST,g.FOLDER_PEER_TAGS,D.FOLDER_BUSINESS_NOTIFY,D.FOLDER_ARCHIVE].includes(t)&&a[g.FOLDER_ALL]&&!(0,l.isReversedDialogs)(e)||a[t]?Promise.resolve(et(e)):e.set(n.loadDialogs).then(et)}function fe(e,t,a,i,s,r){var d,u,_;if(!(null==s||null===(d=s.target)||void 0===d||null===(u=d.closest)||void 0===u?void 0:u.call(d,"._im_dialog_actions"))){var g=parseInt((0,K.domData)(r,"peer"),10),m=(0,c.getTab)(a,g),p=(0,K.hasClass)(r,"_im_sugg_"+g),h=r.classList.contains("ConvoRecommendList__button");if(m||p||h){var v=(0,K.gpeByClass)(Q,s.target)&&(0,o.checkEvent)(s),f=(0,l.isCommunityInterface)(a)&&(0,K.gpeByClass)(ie,s.target),b=!!(null===(_=s.target)||void 0===_?void 0:_.closest("._convoRecommendUserRemove"));if(!(v||f||b)){var y=a.get(),w=he(r),C=parseInt((0,K.domData)(r,"msgid"),10);if(m&&(0,c.tabIsMessageRequestToChat)(m))return e().showChatInvitationBox(a,g),(0,o.cancelEvent)(s);var E=`list_${y.active_tab}`;if((0,c.isSearching)(a)&&(E="conversations_search"),(0,c.isRecentSearchesActive)(a)&&(E="recent_searches"),p&&(E="popular_suggestions"),h&&(E="list_all_suggestions"),w&&(E="message_search"),m&&(0,o.checkEvent)(s))return window.open(function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=(0,l.getBaseLink)(e),s=()=>`${i}?sel=${(0,l.convertPeerToUrl)(t.peerId)}${n&&a?"&msgid="+a:""}`;if(n)return s();if((0,l.isUserPeer)(t.peerId)||(0,l.isCommunityPeer)(t.peerId))return(0,l.isClassicInterface)(e)?s():t.href;return s()}(a,m,C,w));if(i.saveScroll("list"),e().deselectAllMessages(a),w&&y.msgid!==C)y.longpoll.push([(0,S.changePeer)(g,C,!1,!1,E)]);else if(g!==y.peer){y.longpoll.push([(0,S.changePeer)(g,!1,!0,!0,E)]);var T=(0,c.isSearching)(a);T&&!(0,K.hasClass)(r,"_dont_add_recent")&&(0,n.saveRecentSearchPeer)(g,cur.imDb),T&&m&&!(0,l.isClassicInterface)(a)&&setTimeout((()=>{var e=m.message?m.message.messageId:m.peerId;i.scrollToElement(e.toString(),!0,0,"center")}),100)}else g===y.peer&&e().goToHistoryEnd();(0,o.cancelEvent)(s)}}}}function be(e,t,a,n){var i,s="string"==typeof a.photo&&""!==a.photo,r=(0,l.isContactPeer)(t),o=a.tab||a.name,d=r?(0,l.prepareContactName)(o):o;if((0,l.isChatPeer)(t)&&!s)i=(0,l.renderPhotosFromTab)(e,a,n);else{if(r&&!s){var u=(0,l.getUserInitials)(o),_=(0,c.isSearching)(e)&&!a.message?34:n?50:46;i=getTemplate("sImContactAvatar",{name:u,size:_,classes:"nim-peer--contact-avatar"})}else i=(0,I.isDialogWithYourself)(e.get().id,t)?`<img src="${D.FAVORITES_ICON_URL}" alt="">`:`<img src="${a.photo}" alt="">`;n&&(i=getTemplate("im_dialogs_link_img",{href:a.href||a.link,photo:i}))}return{photo:i,userLink:`<span class="_im_dialog_link">${d}</span>`}}function ye(e){return!(0,l.isPendingForward)(e)}function we(e,t,a,n){return a?"":n?getTemplate("im_img_prebody",{photo:t}):e+":"}function Ce(e,t,a,n,i,s,r,o,d,u){var _="",g=(0,c.isChannelPeer)((0,c.getTab)(e,a));return t&v.FLAG_OUTBOUND?_=we(getLang("mail_by_you"),u,g,d):!(0,w.isBusinessNotifyTab)((0,c.getTab)(e,a))&&(0,l.isChatPeer)(a)&&0!==n&&(_=we((0,y.oCacheGet)(e,n).first_name,(0,y.oCacheGet)(e,n).photo,g,d)),r=(0,l.renderShortText)(a,o,r,i,s),_?getTemplate("im_drow_prebody",{prebody:_,body:r}):r}function Ee(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=[];(0,l.isClassicInterface)(n)&&s.push("nim-dialog_classic"),(0,c.isRecentSearchesActive)(n)&&s.push("nim-dialog_recent"),s.push("nim-dialog_empty"),i.search&&s.push("_im_search");var r=getTemplate("im_drow_close_button",{peer_id:e.peerId});return getTemplate("im_drow",{peer:e.peerId,msg_id:"",photo:t,user_link:a,date:"",body:"",unread:"",more:s.join(" "),is_star:"",unread_message_string:"",is_online:(0,p.onlinePlatformClass)(e.online),is_unread:"",is_unread_out:"",is_selected:e.peerId==n.get().peer?"nim-dialog_selected _im_dialog_selected":"",actions:r})}function Se(e,t,a){if(!(a&v.FLAG_OUTBOUND))return!1;if((0,l.isSelfMessage)(t.peerId,e.get().gid))return!1;if((0,l.isChatPeer)(t.peerId)&&t.data&&t.data.closed)return!1;if(t.unread)return!1;if((0,R.partConfigEnabled)("me_web_read_by_cmid")){var n=De(t);return!!n.local||n.chat_local_id>t.out_up_to_cmid}return!!t.lastmsg&&t.lastmsg>t.out_up_to}function Te(e){var t=De(e);return!!(e.unread>0&&t)||!!(0,c.isTabMarkedUnread)(e)}function Ie(e){return(0,R.partConfigEnabled)("me_web_read_by_cmid")?!(!e.mention_cmids||!e.mention_cmids.length):!(!e.mentions||!e.mentions.length)}function Le(e){return function(e){return(0,R.partConfigEnabled)("me_web_read_by_cmid")?!(!e.expiring_cmids||!e.expiring_cmids.length):!(!e.expiring_messages||!e.expiring_messages.length)}(e)&&!Ie(e)}function Me(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=a||De(t),r=be(e,t.peerId,t,(0,l.isClassicInterface)(e)),o=r.photo,u=r.userLink;if(!s)return Ee(t,o,u,e,n);var _=s.flags,g=(0,l.isFvkcomgroup)(e,t.peerId),m=(0,w.tabIsMessageRequest)(t),h=(0,c.tabIsMessageRequestToChat)(t),f=(0,c.isCasperChat)(e,t.peerId),b=Ae(t,e,a),y=(0,c.isCommunityChat)(e,t.peerId),C=t.major_sort_id,E=[];n.search&&E.push("_im_search","nim-dialog_search"),inArray(t.peerId,e.get().mutedPeers)&&E.push("nim-dialog_muted"),t.verified&&E.push("nim-dialog_verified"),t.isDonutChat&&E.push("nim-dialog_donut"),f&&E.push("nim-dialog_casper"),(0,c.isRecentSearchesActive)(e)&&E.push("nim-dialog_recent"),(0,d.isMessageEmpty)(s)&&!f&&E.push("nim-dialog_empty"),(0,l.isClassicInterface)(e)&&E.push("nim-dialog_classic"),t.folders&v.FOLDER_IMPORTANT&&E.push("nim-dialog_starred"),!n.search&&(0,l.isUnrespond)(e,t.peerId,t)&&E.push("nim-dialog_unrespond"),(g||y)&&e.get().gid&&E.push("nim-dialog_deny-remove"),Ie(t)&&E.push("nim-dialog_unread-mentions"),Le(t)&&E.push("nim-dialog_unread-expiring"),t.callInProgress&&E.push("nim-dialog_active-call"),t.callInProgress&&t.callInProgress.participants.count<1&&E.push("nim-dialog_active-call-empty"),(0,T.isPinnedSortId)(C)&&E.push("nim-dialog_pinned");var S=(0,c.tabIsMessageRequestToChat)(t)?t.mr&&t.mr.request_date:s.date,I=e.get().timeshift,L=S?(0,i.getShortDateOrTime)(S,I,!0,getLang("months_sm_of","raw")):"",M=!Se(e,t,_)||h||(0,c.isSearching)(e)?"":"nim-dialog_unread-out",k=t.unread>0?getLang("mail_im_new_messages",t.unread):"",P=(0,l.isContactPeer)(t.peerId)?(0,l.prepareContactName)(t.tab):t.tab,A=getTemplate((0,l.isCommunityInterface)(e)||m||!(0,R.partConfigEnabled)("mail_dialog_list_menu")?"im_drow_close_button":"im_drow_actions_menu",{peer_id:t.peerId});return getTemplate("im_drow",{peer:t.peerId,msg_id:s.messageId||"",photo:o,user_link:u,date:L,body:b,unread_message_string:k,tab_name:stripHTML(P),unread:(0,l.simplifyCounter)(t.unread),more:E.join(" "),is_online:(0,p.onlinePlatformClass)(t.online),is_unread:Te(t)?"nim-dialog_unread":"",is_unread_out:M,is_selected:n.noselect||h||t.peerId!=e.get().peer?"":"nim-dialog_selected _im_dialog_selected",actions:A,title:(0,R.partConfigEnabled)("mail_dialog_preview_title")?b.replace(/\<[^>]*\>/g,""):""})}function ke(e,t,a,n,s){if(!t.deletedDialog)if((0,K.hasClass)(e,"nim-conversation-search-row"))Pe(e,t,a);else{var r=a.get(),o=De(t),u=o.flags,_=Ae(t,a),g=be(a,t.peerId,t,(0,l.isClassicInterface)(a)),m=g.photo,h=g.userLink,f=a.get().timeshift,b=o.date?(0,i.getShortDateOrTime)(o.date,f,!0,getLang("months_sm_of","raw")):"";qe(e,t),(0,R.partConfigEnabled)("mail_dialog_preview_title")&&(0,K.attr)((0,K.geByClass1)("_im_dialog_title",e),"title",(0,G.decodeHTMLEntities)(_.replace(/\<[^>]*\>/g,""))),(0,K.val)((0,K.geByClass1)("_dialog_body",e),_),(0,K.val)((0,K.geByClass1)("_im_dialog_date",e),b),(0,K.val)((0,K.geByClass1)("_im_dialog_unread_ct",e),(0,l.simplifyCounter)(t.unread));var y=(0,K.geByClass1)("_im_dialog_link",e);y&&(0,K.val)(y.parentNode,h);var w=(0,K.geByClass1)("_im_dialog_photo",e);w.innerHTML!==m&&(0,K.val)(w,m),r.is_peer_profile_enabled&&(r.peer||Ye(e,a));var C=(0,c.isCasperChat)(a,t.peerId);(0,K.toggleClass)(e,"nim-dialog_verified",!!t.verified),(0,K.toggleClass)(e,"nim-dialog_casper",C),(0,K.toggleClass)(e,"nim-dialog_muted",inArray(t.peerId,a.get().mutedPeers)),(0,K.toggleClass)(e,"nim-dialog_unrespond",(0,l.isUnrespond)(a,t.peerId,t)),(0,K.toggleClass)(e,"nim-dialog_classic",(0,l.isClassicInterface)(a)),(0,K.toggleClass)(e,"nim-dialog_unread",Te(t)),(0,K.toggleClass)(e,"nim-dialog_unread-mentions",Ie(t)),(0,K.toggleClass)(e,"nim-dialog_unread-expiring",Le(t)),(0,K.toggleClass)(e,"nim-dialog_active-call",!!t.callInProgress),(0,K.toggleClass)(e,"nim-dialog_active-call-empty",!!t.callInProgress&&t.callInProgress.participants.count<1),(0,K.toggleClass)(e,"nim-dialog_pinned",(0,T.isPinnedSortId)(t.major_sort_id)),(0,K.toggleClass)(e,"nim-dialog_deny-remove",a.get().gid>0&&((0,l.isFvkcomgroup)(a,t.peerId)||(0,c.isCommunityChat)(a,t.peerId))),(0,K.removeClass)(e,"nim-dialog_failed"),(0,K.removeClass)(e,"nim-dialog_deleted"),(0,K.addClass)(e,"_im_dialog"),(0,p.toggleOnline)((0,K.geByClass1)("_im_peer_online",e),t.online),(0,K.toggleClass)(e,"nim-dialog_recent",(0,c.isRecentSearchesActive)(a)),(0,K.toggleClass)(e,"nim-dialog_empty",(0,d.isMessageEmpty)(o)&&!C),(0,K.toggleClass)(e,"nim-dialog_unread-out",Se(a,t,u)&&!(0,c.isSearching)(a)),(0,K.toggleClass)(e,"nim-dialog_starred",t.folders&v.FOLDER_IMPORTANT),s&&setTimeout((function(){(0,K.addClass)((0,K.geByClass1)("_im_dialog_"+t.peerId,n),"nim-dialog_injected")}),100)}}function Pe(e,t,a){qe(e,t),(0,K.toggleClass)(e,"nim-dialog_recent",(0,c.isRecentSearchesActive)(a)),(0,K.val)((0,K.geByClass1)("_im_dialog_unread_ct",e),(0,l.simplifyCounter)(t.unread)),(0,K.toggleClass)(e,"nim-dialog_unread",Te(t)),(0,K.toggleClass)(e,"nim-dialog_unread-expiring",Le(t)),(0,K.toggleClass)(e,"nim-dialog_unread-mentions",Ie(t));var n=be(a,t.peerId,t,(0,l.isClassicInterface)(a)).photo,i=(0,K.geByClass1)("_im_dialog_photo",e);i.innerHTML!==n&&(0,K.val)(i,n),(0,p.toggleOnline)((0,K.geByClass1)("_im_peer_online",e),t.online)}function Ae(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=a||De(e),i=(0,c.tabIsMessageRequestToChat)(e),s=(0,c.isCasperChat)(t,e.peerId);if(i){var r=(0,l.isClassicInterface)(t),o=e.mr&&e.mr.inviter_id,u=(0,y.oCacheGet)(t,o),_=r?u.name:u.short_name,g=r?getTemplate("im_img_prebody",{photo:u.photo}):"",m=getLang("mail_mr_service_message").replace(/{user}/,_);return g+m}if((0,l.isPeerBlocked)(e.peerId,t)){var p=t.get().block_states[e.peerId].name,h=getLang("mail_community_answering").replace("{username}",p);return getTemplate("im_drow_prebody",{prebody:h,body:""})}return(0,d.isServiceMsg)(n)&&!i?(0,W.renderServiceMsg)(t,n,e.peerId,!1):s&&(0,d.isMessageEmpty)(n)?getLang("mail_empty_casper_message"):(0,d.isExpiredCasperMessage)(n)?getLang("mail_expired_message"):Ce(t,n.flags,e.peerId,n.userId,!0,n.attaches,n.text,n.subject,(0,l.isClassicInterface)(t),(0,y.oCacheGet)(t,t.get().id).photo)}function De(e){var t=e.lastmsg_meta;return Array.isArray(t)&&(t=(0,E.getMessageFromTuple)(t)),t||(0,E.getMessageFromTuple)([-1,0,e.peerId,0,"",{},{},-1,-1,0])}function Be(e,t,a){var i=(0,c.getTab)(e,t),s=(0,c.tabIsMessageRequestToChat)(i),r=(0,l.showLeaveDialog)(e,t,(i=>{a().updateMenu(e);var o=Promise.resolve();(0,l.isChatPeer)(t)&&(o=s?e.set((e=>(0,n.rejectMessageRequest)(t,!1,e))):e.set((e=>(0,n.leaveChat)(t,e)))),i&&o.then((()=>(0,l.cleanHistory)(e,r,a,n.flushHistory,t))),r.hide()}))}function xe(e,t,a,s,c,d){var u=(0,K.gpeByClass)("_im_dialog",d,a);if((0,o.cancelEvent)(c),!u)return!1;var _=(0,r.intval)((0,K.domData)(u,"peer")),g=t.get(),m=(0,l.isCommunityPeer)(_)||(0,l.isUserPeer)(_);if(g.recentSearch){var p=(0,n.removeFromRecentSearch)(_,cur.imDb);(0,K.re)(u),0===p.length&&ze(t,s,e)}else(0,l.isClassicInterface)(t)&&m?(0,n.deleteDialog)(_,g).then((a=>{var n=z(a,2),s=n[0],r=n[1];s?(!function(e,t,a,n,s){var r=(0,K.geByClass1)("_dialog_body",t);(0,K.addClass)(t,"nim-dialog_deleted"),(0,K.removeClass)(t,"_im_dialog"),(0,K.val)(r,getTemplate("im_delete_actions",{text:(0,i.langNumeric)(a,getLang("mail_im_X_message_deleted","raw")),peer:e,spam_id:n}))}(_,u,s,r),e().updateMenu(t)):Be(t,_,e)})):Be(t,_,e);return!1}function Oe(e,t,a){(0,l.toggleDialogsFolder)(e,(e=>{t().restoreDialogs(e,!0,!0),(0,m.unpackStore)(e).active_tab===g.FOLDER_ALL&&t().updateRecommendationList(e),t().updateDialogFilters(e,!0)}),n.changeDialogsTab,a)}function Re(e,t){switch(t.type){case"sep_btn_search_msg":return(0,l.renderBtnSearchOnlyMessages)(e);case"sep_messages":return(0,l.renderMessagesSep)();case"sep_conversations":return(0,l.renderConversationsSep)();case"sep_popular":return(0,l.renderPopularSuggSep)();case"popular_sugg":return(0,l.renderPopularSuggestions)(e);case"recommend_list":return(0,l.renderConvoRecommendList)(e);case"find_friends_stub":return(0,l.renderFindFriendsStub)(e);case"clear_recent":return(0,l.renderClearRecent)();case"empty_dialogs":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_list_empty"),icon:""});case"empty_business_notify":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_business_notify_empty"),icon:""});case"empty_archives":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_archives_empty"),icon:(0,N.getIcon56ArchiveOutline)().icon});case"empty_message_requests":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_mr_empty"),icon:""});case"empty":return getTemplate("im_dialogs_none",{msg:getLang("mail_im_search_empty"),icon:""});case"message_request_notice":return getTemplate("im_dialogs_message_requests_notice",{msg:getLang("mail_message_request_tab_notice")});case"message_request_button_go":return getTemplate("im_dialogs_message_requests_button",{msg:getLang("mail_tab_mr"),counter:(0,F.getFolderUnreadCount)(e,D.ConvoListFolder.MR)});case"business_notify_button_go":return getTemplate("im_dialogs_business_notify_button",{msg:getLang("mail_tab_business_notify"),class_name:t.hidden?ue:"",counter:(0,F.getFolderUnreadCount)(e,D.ConvoListFolder.BUSINESS_NOTIFY)});case"archive_button_go":return getTemplate("im_dialogs_archives_button",{msg:getLang("mail_tab_archives"),class_name:t.hidden?ue:"",counter:(0,F.getFolderUnreadCount)(e,D.ConvoListFolder.ARCHIVE),mentions:(0,F.getFolderMentionsCount)(e,D.ConvoListFolder.ARCHIVE)});case"archive_notice":var a=getTemplate("im_dialogs_archive_notice_button",{text:getLang("mail_archive_tab_notice_button")}),n=getLang("mail_archive_tab_notice_content").replace("{button}",a);return getTemplate("im_dialogs_archive_notice",{title:getLang("mail_archive_tab_notice_title"),text:n});case"all":var i=(0,m.unpackStore)(e).active_tab,s={[D.ConvoListFolder.MR]:getLang("mail_tab_mr"),[D.ConvoListFolder.BUSINESS_NOTIFY]:getLang("mail_tab_business_notify"),[D.ConvoListFolder.ARCHIVE]:getLang("mail_tab_archives")}[i],r=(0,F.getFolderInlineMenuActions)(e,i).length>0?getTemplate("im_dialogs_active_folder_button_actions",{folder:i}):"";return getTemplate("im_dialogs_active_folder_button",{msg:s,class_name:`_im_folder_${i}_header`,actions:r});case"new_ui_notice":return getTemplate("im_dialogs_new_ui_notice",{title:getLang("mail_new_ui_notice_title"),text:getLang("mail_new_ui_notice_text")});default:return t.message?Me(e,t,t.message,{noselect:!0,search:!0}):t.local_index||(0,c.isSearching)(e)?function(e,t){var a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=be(e,t.peerId,t,(0,l.isClassicInterface)(e)),s=i.photo,r=i.userLink,o=(0,l.isContactPeer)(t.peerId)?(0,l.prepareContactName)(t.tab):t.tab,d=ye(e),u=""===n?[]:[n],_=e.get();return(0,c.isRecentSearchesActive)(e)&&u.push("nim-dialog_recent"),(0,l.isClassicInterface)(e)&&u.push("nim-csr_classic"),inArray(t.peerId,e.get().mutedPeers)&&u.push("nim-dialog_muted"),(0,c.isCasperChatTab)(t)&&u.push("nim-dialog_casper"),Ie(t)&&u.push("nim-dialog_unread-mentions"),Le(t)&&u.push("nim-dialog_unread_expiring"),(null===(a=(0,c.getTab)(e,t.peerId))||void 0===a?void 0:a.isDonutChat)&&u.push("nim-dialog_donut"),getTemplate("im_conversation_search_row",{peer:t.peerId,msg_id:t.lastmsg||"",photo:s,user_link:r,unread:(0,l.simplifyCounter)(t.unread),tab_name:stripHTML(o),is_unread:Te(t)?"nim-dialog_unread":"",is_online:(0,p.onlinePlatformClass)(t.online),is_selected:t.peerId==_.peer&&d?"nim-dialog_selected _im_dialog_selected":"",more:u.join(" ")})}(e,t):Me(e,t)}}function Ne(e,t,a,i,s,c){var d=(0,r.intval)((0,K.domData)(c,"peer")),u=(0,K.domData)(c,"action"),_=(0,K.domData)(c,"sid"),g=(0,K.geByClass1)("_im_dialog_"+d,t),m=(0,r.intval)((0,K.domData)(c,"spam"));switch(u){case"restore":g&&e.set(n.restoreDialog.bind(null,d,_,m)).then((()=>{(0,K.addClass)(g,"_im_dialog"),(0,K.removeClass)(g,"nim-dialog_deleted"),ke(g,e.get().tabs[d],e,t,!1),i().updateMenu(e)}));break;case"spam":var p=`${getLang("mail_im_dialog_marked_spam")}\n        <button type="button" class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction"\n          data-action="restore"\n          data-spam="1"\n          data-sid="${_}" data-peer="${d}">\n            ${getLang("mail_restore")}\n        </button>`;if(g){var h=(0,K.geByClass1)("_dialog_body",g);(0,K.val)(h,p),(0,n.spamDialog)(d,_,e.get())}break;case"block":((0,l.isCommunityInterface)(e)?(0,l.showBlacklistBox)(d,e):(0,l.showBlacklistBoxUser)(d,e)).once("success",(function(){e.set(n.flushHistory.bind(null,d)).then((()=>{a().restoreDialogs(e)}))}))}(0,o.cancelEvent)(s)}function Fe(e,t){return e.map((e=>(0,E.getMessageFromTuple)(e))).map((e=>(0,r.extend)({},t[e.peerId],{message:e})))}function Ue(e){return{type:"empty",lang:e}}function He(e,t,a,i){var s=(0,K.gpeByClass)("_im_dialog",i,t),l=(0,r.intval)((0,K.domData)(s,"peer"));return e.set(n.toggleDialogImportant.bind(null,l)),setTimeout((function(){je(e,t,a,i)}),100),(0,o.cancelEvent)(a),!1}function je(e,t,a,n){(0,C.showTooltip)(n,{text:function(){var a=(0,K.gpeByClass)("_im_dialog",n,t),i=(0,K.domData)(a,"peer");return e.get().tabs[i].folders&v.FOLDER_IMPORTANT?getLang("mail_im_toggle_important_off"):getLang("mail_im_toggle_important")},black:1,zIndex:1,shift:[14,8],toup:tt(e,n.getBoundingClientRect().top)})}function qe(e,t){var a=t.unread>0?getLang("mail_im_new_messages",t.unread):"",n=(0,K.geByClass1)("_im_unread_blind_label",e);(0,K.val)(n,a)}function Ke(e,t,a,i,l){var d=(0,K.gpeByClass)("_im_dialog",l,t),u=(0,r.intval)((0,K.domData)(d,"peer"));return e.set(n.markDialogAnswered.bind(null,u)).then((()=>{ke(d,e.get().tabs[u],e,t),(0,c.isRecentSearchesActive)(e)||a().restoreDialogs(e)})),(0,s.showDoneBox)(getLang("mail_marked_as_answered"),{out:1e3}),(0,o.cancelEvent)(i),!1}function We(e){var t=(0,c.isSearching)(e),a=e.get().searchOnlyMessages;return(0,l.isClassicInterface)(e)?{top:t&&!a?96:60,bottom:(0,l.isCommunityInterface)(e)?42:87}:{top:t&&!a?36:0,bottom:0}}function Ge(e,t){e.hoverFirstElement(ne,We(t))}function Ve(e){e.unhoverElements(ne)}function ze(e,t,a){if((0,c.doPopularSuggExist)(e)){t.pipeReplace(Promise.resolve([{type:"sep_popular"},{type:"popular_sugg"}])),t.toTop()}else a().cancelSearch(e),cancelStackFilter("im_search")}function Ye(e,t){var a=t.get(),n=parseInt((0,K.domData)(e,"peer")),i=(0,c.getTab)(a,n);if(a.is_peer_profile_enabled&&(0,l.isCommunityInterface)(a)&&i&&!(0,c.isChannelPeer)(i)&&!(0,c.isCommunityChat)(a,n)&&!(0,c.isSearching)(t)){var s=(0,K.geByClass1)(ie,e);if(i.ad_id||a.peer_profile_tags&&i.peer_tags&&i.peer_tags.ids){var r=i.peerTagsMaxWidth||0;if(!r){var o=(0,K.geByClass1)("_im_dialog_name_w",e).offsetWidth;r=340-(o+6+(i.verified?16:0)),t.set((e=>(e.tabs[n].peerTagsMaxWidth=r,Promise.resolve(e))))}(0,u.renderPeerTags)(s,r,t,n)}else s.innerHTML&&(s.innerHTML="")}}function $e(e,t){if((0,l.isCommunityInterface)(e)){["empty_dialogs","empty_business_notify","empty_archives","empty"].includes((0,K.domData)(t,"list-id"))?(0,u.updateEmptyDialogsMargin)():(0,K.hasClass)(t,"_im_dialog")&&Ye(t,e)}}function Qe(e){(0,o.checkEvent)(e)||(0,o.cancelEvent)(e)}function Ze(){return window.FriendsSearch?Promise.resolve():window.stManager.add([window.jsc("web/friends_search.js")])}function Xe(e,t,a){var n={new_ui_notice:{selector:"._im_new_ui_notice",setting:"new_ui_notice_hidden"},archive:{selector:"._im_archive_notice",setting:"archives_folder_notice_hidden"}}[a],i=n.selector,s=n.setting;i&&s&&e.set((e=>(0,U.setLocalSettingsValue)(s,1,e))).then((()=>(t.querySelector(i).hidden=!0,(0,H.toggleHideFolderNoticeHandler)((0,m.unpackStore)(e),a,1))))}function Je(e,t,a,n,i,s){return{selectPeer(t,a){for(var n=(0,K.geByClass)("_im_dialog",e),i=a.get().peer,s=0;s<n.length;s++){var o=n[s],l=(0,r.intval)((0,K.domData)(o,"peer")),c=(0,r.intval)((0,K.domData)(o,"msgid"));l===i&&(!he(o)||t===c&&he(o))?((0,K.addClass)(o,"nim-dialog_selected"),(0,K.addClass)(o,"_im_dialog_selected")):(0,K.hasClass)(o,"_im_dialog_selected")&&((0,K.removeClass)(o,"nim-dialog_selected"),(0,K.removeClass)(o,"_im_dialog_selected"))}},appendFastDialogs(t,n,i){(0,K.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),a.saveScroll("list"),i?(a.reset(),(0,l.isPendingForward)(t)||(0,c.isRecentSearchesActive)(t)||!(0,_.doesSearchResultContainConversations)(n)?(0,c.isRecentSearchesActive)(t)&&((0,_.doesSearchResultContainConversations)(n)&&(n=[{type:"clear_recent"}].concat(n)),(0,c.doPopularSuggExist)(t)&&(n=[{type:"sep_popular"},{type:"popular_sugg"}].concat(n))):n=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(n),t.setState({searchOnlyMessages:!1}),a.pipeReplace(Promise.resolve(n)).then((()=>Ge(a,t)))):a.pipe(Promise.resolve(n)),(0,l.isClassicInterface)(t)&&!(0,l.isReservedPeer)(t.get().peer)||a.toTop()},deactivate(){a.deactivate()},activate(){a.activate()},hoverFirstDialog(e){Ge(a,e)},hoverNextDialog(e){a.hoverNextElement(ne,ae,We(e))},hoverPrevDialog(e){a.hoverPrevElement(ne,ae,We(e))},unhoverDialogs:Ve.bind(a),selectHoveredDialog(t){var i=(0,K.geByClass1)("_im_dialog_hovered",e);(0,R.partConfigEnabled)("mail_dialog_list_disable_enter_default")||i||(i=(0,K.geByClass1)("_im_dialog",e)),i&&fe(n,0,t,a,{},i)},appendSearch(t,n,i){var s=Fe(i,n);i.length>0?((0,K.addClass)(e.parentNode,"im-page--dialogs_with-mess"),a.pipe(Promise.resolve([{type:"sep_messages"}].concat(s))).then((()=>Ge(a,t)))):(0===a.getCurrentElements().length&&a.pipeReplace(Promise.resolve([Ue()])),(0,K.removeClass)(e.parentNode,"im-page--dialogs_with-mess"))},update(e){a.pipeReplace(Promise.resolve(et(e))).then(s.track)},updateDialog(t,a){var n=(0,K.geByClass1)("_im_dialog_"+t,e);n&&!he(n)&&ke(n,(0,c.getTab)(a,t),a,e)},focusOnSelected(t){var n=t.get().peer;if(n){var i=(0,K.geByClass1)(`_im_dialog_${n}`,e);i?a.scrollTop(i.offsetTop-i.offsetHeight):a.toTop()}},restoreScroll(e){a.restoreScroll("list")||a.toTop()},forceScrollReinit(){var e=a.getScroller();e&&(e.style.overflowY="hidden",setTimeout((()=>e.style.overflowY=""),0))},restoreDialogs:(t,i,r)=>((0,K.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),t.setState({searchOnlyMessages:!1}),(0,F.isEmptyFolder)(t)&&!a.isLoading()&&(i=!0),i&&a.reset(),r&&a.wipe(),(0,C.hideAllTooltips)(e),a.pipeReplace(Promise.resolve(et(t))).then((()=>{if(i&&(!(0,l.isClassicInterface)(t)||!t.get().peer)){var e=function(e,t,a){return(0,l.isClassicInterface)(a)||t().toggleSettingsLoader(a,!0),e.checkMore(!(0,l.isClassicInterface)(a)).then((()=>{(0,l.isClassicInterface)(a)||t().toggleSettingsLoader(a,!1)}))}(a,n,t);return a.toTop(),e}})).then((()=>Ve(a))).then(s.track)),appendDialogs(t,n){(0,K.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),n.forEach((a=>{var n=(0,K.geByClass1)("_im_dialog_"+a.peerId,e);n&&Pe(n,a,t)})),(0,l.isPendingForward)(t)||(0,c.isRecentSearchesActive)(t)||!(0,_.doesSearchResultContainConversations)(n)||(n=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(n)),t.setState({searchOnlyMessages:!1}),a.isEmpty()&&0===n.length&&(0,l.isPendingForward)(t)&&(n=[Ue(getLang("mail_im_search_empty_chats"))]),a.replacePreserveOrder(n)},updateCounter(t,a){var n=(0,K.geByClass1)("_im_dialog_"+a,e),i=(0,c.getTab)(t,a);if(n&&!he(n)&&(qe(n,i),(0,K.val)((0,K.geByClass1)("_im_dialog_unread_ct",n),(0,l.simplifyCounter)(i.unread)),(0,K.toggleClass)(n,"nim-dialog_unread",Te(i)),(0,K.toggleClass)(n,"nim-dialog_unread-out",Se(t,i,De(i).flags)),(0,K.toggleClass)(n,"nim-dialog_unread-mentions",Ie(i)),(0,K.toggleClass)(n,"nim-dialog_unread-expiring",Le(i))),(0,c.isRecentSearchesActive)(t)){var s=(0,K.geByClass1)("_im_sugg_"+a,e);s&&((0,K.val)((0,K.geByClass1)("_sugg_unread_ct",s),(0,l.simplifyCounter)(i.unread)),(0,K.toggleClass)(s,"sugg-is_unread",i.unread>0))}},removeDialog(e,t){a.remove(t)},updateOnline(t,a){var n=(0,K.geByClass1)("_im_dialog_"+t,e);if(n){var i=a.get().tabs[t],s=(0,K.geByClass1)("_im_peer_online",n);(0,p.toggleOnline)(s,i.online)}},updateRecommendedOnline(t,a){var n=(0,w.getRecommendedConvoList)(a),i=e.querySelector(`.ConvoRecommendList__button[data-peer="${t}"]`);if(i&&n){var s=n.item_data[t].online_info,r=i.querySelector("._online");r.classList.toggle("online",s.is_online||s.is_mobile),r.classList.toggle("mobile",s.is_mobile)}},updateRecommendationList(t){var a=(0,K.se)((0,l.renderConvoRecommendList)(t)),n=a.querySelector(`.${M.CAROUSEL_LAYER_CLASS}`);if(n){var i=e.querySelector(`.ConvoRecommendList .${M.CAROUSEL_VIEWPORT_CLASS}`);if(i){var r=i.querySelector(`.${M.CAROUSEL_LAYER_CLASS}:not(.ConvoRecommendList--fadeOut)`);r&&(r.classList.add(ce),r.addEventListener("animationend",(()=>{n.classList.remove(le),r.parentNode&&(r.remove(),s.track())}))),n.classList.add(le),i.appendChild(n)}}else{var o=e.querySelector(".ConvoRecommendList");o&&o.replaceChildren(...a.children)}},setRecommendationListVisibility(t){var a=e.querySelector(".ConvoRecommendList");return!!a&&(a.classList.toggle("ConvoRecommendList--hidden",!t),!0)},setDialogFailed(t,a,n){var i=(0,K.geByClass1)("_im_dialog_"+t,e);i&&(n.get().tabs[t].lastmsg===a&&((0,K.addClass)(i,"nim-dialog_failed"),(0,K.val)((0,K.geByClass1)("_im_dialog_unread_ct",i),"!")))},scrollUp(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.toTop(e,t),a.saveScroll("list",!0)},saveScroll(e){a.saveScroll("list",!0)},promoteDialog(n,i){var s=(0,K.geByClass1)("_im_dialog_"+i,e);s&&!he(s)||!(0,c.isSearching)(n)?(a.pipeReplace(Promise.resolve(et(n)),void 0,!0).then((t=>{!inArray(i,t)&&s&&ke(s,(0,c.getTab)(n,i),n,e)})),t().updateTyping(i,n)):a.unsetScroll("list")},removeSelection(t){var n=t.get().peer.toString(),i=`._im_dialog_${n}.${ae.join(".")}`,s=(0,K.domQuery)(i,e)[0];ae.forEach((e=>(0,K.removeClass)(s,e))),(0,l.isClassicInterface)(t)||a.hoverElement(n,ne,We(t))},updateScroll(){a.updateScroll()},updateTyping(t,a){var n=(0,K.geByClass1)(`_im_dialog_${t}`,e);if(n&&!he(n)&&!a.get().tabs[t].deletedDialog){var i=(0,K.geByClass1)("_im_dialog_typing",n),s=!(0,l.isClassicInterface)(a),r=(0,l.formatTyper)((0,c.getTab)(a,t).activity,t,!(0,l.isChatPeer)(t),a.get(),1,s);(0,K.val)(i,r),(0,K.toggleClass)(n,"nim-dialog_typing",r)}},renderPeerTags(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a?Ye((0,K.geByClass1)("_im_dialog_"+a,e),t):function(e,t){var a=t.get();a.is_peer_profile_enabled&&(0,l.isCommunityInterface)(a)&&(0,K.geByClass)("_im_dialog",e).forEach((e=>{Ye(e,t)}))}(e,t)},updateFolderCounters(t){var a=(0,m.unpackStore)(t),n={[D.ConvoListFolder.ARCHIVE]:l.TOGGLE_ARCHIVES_TAB,[D.ConvoListFolder.BUSINESS_NOTIFY]:l.TOGGLE_BUSINESS_NOTIFY_TAB};[D.ConvoListFolder.MR,D.ConvoListFolder.BUSINESS_NOTIFY,D.ConvoListFolder.ARCHIVE].forEach((t=>{var i=(0,F.getFolderUnreadCount)(a,t),s=e.querySelector(`[data-list-id=${t}_button_go] .im-page--dialogs-folder-button--counter`);s&&(s.innerHTML=i);var r,o,l=n[t];l&&(null==e||null===(r=e.querySelector(`.${l}`))||void 0===r||null===(o=r.classList)||void 0===o||o.toggle(ue,(0,F.isConvoListFolderHidden)(a,t)))}));var i=(0,F.getFolderMentionsCount)(a,D.ConvoListFolder.ARCHIVE),s=e.querySelector(`[data-list-id=${D.ConvoListFolder.ARCHIVE}_button_go] .im-page--dialogs-folder-button--mentions`);s&&(s.dataset.mentions=i)},toggleFolder:Oe,unmount(){a.unmount(),s.destroy(),(0,f.destroyModule)(i)}}}function et(e){var t,a,n=(0,m.unpackStore)(e),i=n.active_tab,s=null!==(t=null===(a=n.dialog_tabs)||void 0===a?void 0:a[i])&&void 0!==t?t:[],r=n.tabs,o=s.map((e=>r[e.toString()])).sort(I.sortFn.bind(null,e)),c=(0,l.isViewWithRecommendations)(e)&&o.length<2&&!n.hasContacts;if(i===g.FOLDER_MESSAGE_REQUEST&&o.unshift({type:"message_request_notice"}),i!==D.FOLDER_ARCHIVE||n.settings.archives_folder_notice_hidden||o.unshift({type:"archive_notice"}),!(0,l.isClassicInterface)(e))switch(i){case g.FOLDER_ALL:(0,F.getConvoListFolderCounterDisplayed)(e,D.ConvoListFolder.MR)>0&&o.unshift({type:"message_request_button_go"}),(0,k.isBusinessNotifyEnabled)(e)&&o.unshift({type:"business_notify_button_go",hidden:(0,F.isConvoListFolderHidden)(e,D.FOLDER_BUSINESS_NOTIFY)}),(0,R.partConfigEnabled)("im_archive_web")&&o.unshift({type:"archive_button_go",hidden:(0,F.isConvoListFolderHidden)(e,D.FOLDER_ARCHIVE)});break;case g.FOLDER_UNREAD:(0,R.partConfigEnabled)("im_archive_web")&&o.unshift({type:"archive_button_go",hidden:(0,F.isConvoListFolderHidden)(e,D.FOLDER_ARCHIVE)});break;case g.FOLDER_MESSAGE_REQUEST:case D.FOLDER_BUSINESS_NOTIFY:case D.FOLDER_ARCHIVE:o.unshift({type:"all"})}return(0,l.isViewWithRecommendations)(e)&&(n.hasContacts||s.length>1)&&o.unshift({type:"recommend_list"}),c?o.push({type:"find_friends_stub"}):(0,F.isEmptyFolder)(e)&&o.push(...(0,F.getEmptyFolderEls)(e)),(0,R.partConfigEnabled)("mail_new_ui_banner")&&i===g.FOLDER_ALL&&!(0,l.isCommunityInterface)(e)&&!(0,l.isClassicInterface)(e)&&!(0,k.getLocalSettingsValue)(e,"new_ui_notice_hidden")&&o.unshift({type:"new_ui_notice"}),o}function tt(e,t){var a=e.get().gid?220:150;return!((0,u.isPeerTagsFolder)(e)&&t<=a+46)&&(t>a||(0,c.isSearching)(e))}function at(e,t,a,i){var s=(0,f.createMutations)(Je),r=s.callMutations,d=s.bindMutations,_=bodyNode.appendChild(document.createElement("div"));_.classList.add("im-page--dialogs-inline-menu-container");var g,v,b,y,E=function(e,a){(0,C.showTooltip)(a,{text:()=>{if((0,c.isRecentSearchesActive)(t))return getLang("mail_hide_from_recent");var e=Number(a.getAttribute("data-peer")),n=(0,c.getTab)(t,e),i=(0,c.tabIsMessageRequestToChat)(n);return(0,l.isChatPeer)(e)&&!i?(0,w.doesChatTabHaveFlag)((0,c.getTab)(t,e),1024)?getLang("mail_unfollow_channel"):(0,c.isChatActive)(n)?getLang("mail_leave_chat"):getLang("mail_delete"):getLang("mail_delete")},black:1,[(0,l.isClassicInterface)(t)?"center":"needLeft"]:!0,shift:(0,l.isClassicInterface)(t)?[-4,10]:[0,10],toup:tt(t,a.getBoundingClientRect().top),zIndex:1})},S=function(a,n){var i=n.dataset.folder;if(i){var s=function(e,t,a,n,i){return a=>{var s,r=a.target.closest(`.${ge}`);if(r&&r.dataset.action===D.FolderAction.SHOW){var o={[D.ConvoListFolder.BUSINESS_NOTIFY]:"business_notify_folder_hidden",[D.ConvoListFolder.ARCHIVE]:"archives_folder_hidden"}[n];o&&t.set((e=>(0,U.setLocalSettingsValue)(o,null,e))).then((t=>{var a=e.querySelector(`.${_e}`);return a&&(a.hidden=!0),(0,H.toggleHideFolderHandler)((0,m.unpackStore)(t),n,!1,!0)})),null==i||null===(s=i.tt)||void 0===s||s.hide()}}}(e,t,0,i,n),r=(0,F.getFolderInlineMenuActions)(t,i).map((e=>getTemplate("im_page_inline_menu_item",V({},e,{class_name:ge})))).join(""),o=getTemplate("im_page_inline_menu",{actions:r});(0,C.showTooltip)(n,{text:o,onCreate:()=>{var e,t;return null===(e=n.tt)||void 0===e||null===(t=e.container)||void 0===t?void 0:t.addEventListener("click",s)},onHide:()=>{var e,t,a;null===(e=n.tt)||void 0===e||null===(t=e.container)||void 0===t||t.removeEventListener("click",s),null===(a=n.tt)||void 0===a||a.destroy()},black:0,dir:"top",shift:[-2,-6],zIndex:130,hasover:!0,appendEl:_,className:"im_page_inline_menu_tt im_page_folder_inline_menu_tt",slide:4,showdt:100,hidedt:100,forcetodown:1,needLeft:!0})}},T=function(n,i){var s=(0,c.getTab)(t,Number(i.dataset.peer));if(s){(0,C.hideAllTooltips)(e),(0,C.destroyAllTooltips)(e),g=null;var o=function(e,t,a,n,i){return s=>{var r,o=s.target.closest("._im_dialog_actions_item");if(o){var l=o.dataset.action;(0,q.handleUiActionForPeer)(e,t,a,l,n),null==i||null===(r=i.tt)||void 0===r||r.hide()}}}(t,a,r,s.peerId,i),l=(0,w.getConvoInlineMenuActions)(t,s).map((e=>getTemplate("im_page_inline_menu_item",V({},e,{class_name:ee})))).join(""),d=getTemplate("im_page_inline_menu",{actions:l});g=i.closest("._im_dialog"),(0,C.showTooltip)(i,{text:d,onCreate:()=>{var e,t;return null===(e=i.tt)||void 0===e||null===(t=e.container)||void 0===t?void 0:t.addEventListener("click",o)},onShowStart:()=>{var e,t;null===(e=g)||void 0===e||null===(t=e.classList)||void 0===t||t.add(te)},onHide:()=>{var e,t;null===(e=g)||void 0===e||null===(t=e.classList)||void 0===t||t.remove(te),g=null},black:0,dir:"left",shift:[-30,-11],zIndex:130,hasover:!0,className:"im_page_inline_menu_tt im_page_dialog_inline_menu_tt",appendEl:_,slideX:4,showdt:200,hidedt:100})}},I=function(e,a){(0,C.showTooltip)(a,{text:getLang("mail_end_conversation"),black:1,center:!0,zIndex:1,shift:[1,4],toup:tt(t,a.getBoundingClientRect().top)})},M=je.bind(null,t,e),k=He.bind(null,t,e),R=Ke.bind(null,t,e,r),N={idFn:e=>function(e,t){try{return t.message?t.message.messageId:(0,c.isSearching)(e)&&t.peerId?t.peerId+"cr":t.peerId||t.type}catch(s){if(t)throw s;var a=(0,m.unpackStore)(e),n=Object.keys(a.tabs).map(Number),i=a.dialog_tabs.all.filter((e=>!n.includes(e)));throw s.message=`Missing convo info for: ${i.join(", ")}`,s}}(t,e),hoverableFn:e=>(0,K.hasClass)(e,"_im_dialog"),renderFn:Re.bind(null,t),more:ve.bind(null,t,r),onScroll:()=>{(0,l.isClassicInterface)(t)&&((bodyNode.scrollTop||document.documentElement.scrollTop)<=0&&!layers.visible&&L.browser.safari?(0,K.addClass)(i,"im-page--header_static"):(0,K.removeClass)(i,"im-page--header_static"));(0,C.hideAllTooltips)(e)},onRenderFn:$e.bind(null,t)},W=(0,h.mount)(e,(0,m.default)({limit:40,offset:0,nativeScroll:!!(0,l.isClassicInterface)(t),height:64,elements:et(t)}),(()=>N)),G=(b=new Set,y=e=>{e.forEach((e=>{var t=e.target,a=e.isIntersecting,n=t.dataset,i=n.position,s=n.peer,r=n.trackcode;if(!b.has(s)&&a)b.add(s),(0,P.collectConversationSuggestionItemStats)(r,Number(i),"show");else if(b.has(s)&&!a){if(b.delete(s),!r)return;(0,P.collectConversationSuggestionItemStats)(r,Number(i),"hide")}}))},{track:()=>{v&&v.disconnect();var e=document.querySelector(".ConvoRecommendList");if(e){var t=e.querySelector("._im_carousel_viewport");v=new IntersectionObserver(y,{root:t}),e.querySelectorAll("._convoRecommendUser").forEach((e=>v.observe(e)))}},destroy:()=>{v&&v.disconnect()}});G.track(),L.browser.mozilla&&Ze();var Y=fe.bind(null,a,r,t,W),ae=e=>{var t,a;null===(t=g)||void 0===t||null===(a=t.classList)||void 0===a||a.remove(te)},ie=pe.bind(null,t,e,W),le=Ne.bind(null,t,e,r,a),ce=xe.bind(null,a,t,e,W),ue=[D.ConvoListFolder.MR,D.ConvoListFolder.BUSINESS_NOTIFY,D.ConvoListFolder.ARCHIVE,D.ConvoListFolder.ALL].map((e=>n=>{if(n.target.closest(`.${de}`)){var s=(0,m.unpackStore)(t).settings,r={[D.ConvoListFolder.BUSINESS_NOTIFY]:"number"!=typeof s.business_notify_folder_hidden,[D.ConvoListFolder.ARCHIVE]:"number"!=typeof s.archives_folder_hidden}[e],o={[D.ConvoListFolder.BUSINESS_NOTIFY]:"business_notify_folder_hidden",[D.ConvoListFolder.ARCHIVE]:"archive_folder_hidden"},l=Boolean(cur.imDb.selectByKey(o[e]));r&&!l&&(!function(e,t){var a,n,i=e.querySelector(`.${B.CONVO_MORE_CLASS}`);if(i){var s,r="feature_intro_tt feature_intro_blue_tt im-page--dialogs--folder_hide_hint";switch(t){case D.ConvoListFolder.BUSINESS_NOTIFY:s={width:206,content:getLang("mail_dialog_business_notify_more_hint"),cls:r+" im-page--dialogs--business-notify_hide_hint"};break;case D.ConvoListFolder.ARCHIVE:s={width:164,content:getLang("mail_dialog_archive_more_hint"),cls:r+" im-page--dialogs--archives_hide_hint"};break;default:return}null===(a=(0,K.data)(i,"ett"))||void 0===a||null===(n=a.destroy)||void 0===n||n.call(a);var o=new O.ElementTooltip(i,V({autoShow:!1,appendTo:bodyNode,forceSide:"bottom",offset:[15,8],align:"right",withCloseButton:!0,onHide:()=>{o.destroy()}},s));o.show()}}(i,e),cur.imDb.updateByKey(o[e],1)),a().hideFolderButton(t,e)}else Oe(t,a,e)})),he=z(ue,4),be=he[0],ye=he[1],we=he[2],Ce=he[3],Ee=a=>{Xe(t,e,"archive")},Se=a=>{Xe(t,e,"new_ui_notice")},Te=(0,f.createModule)({handlers:(i,s)=>{s(e,"click",J,ce),s(e,"click","_im_dialog_markre",R),s(e,"click",Z,k),s(e,"click",$,Y),s(e,"mouseover",$,ae),s(e,"click",l.MESSAGE_SEARCH_CLASS,ie),s(e,"mouseover",J,E),s(e,"mouseover",X,T),s(e,"mouseover",_e,S),s(e,"mouseover","_im_dialog_markre",I),s(e,"click",l.CLEAR_RECENT_CLASS,(()=>{(0,n.resetRecentSearch)(cur.imDb),ze(t,W,a)})),s(e,"click",l.TOGGLE_MR_TAB,be),s(e,"click",l.TOGGLE_BUSINESS_NOTIFY_TAB,ye),s(e,"click",l.TOGGLE_ARCHIVES_TAB,we),s(e,"click",l.TOGGLE_ALL_TAB,Ce),s(e,"mouseover",Z,M),s(e,"click","_im_dialog_daction",le),s(e,"click",Q,Qe),s(e,"click",re,(e=>function(e,t){(0,o.cancelEvent)(e);var a=e.target.closest("._convoRecommendUser"),n=a.parentNode,i=Number(a.dataset.position),s=Number(a.dataset.peer),r=a.dataset.trackcode;if(!r){var l=(0,m.unpackStore)(t),c={hasPeer:!!s,hasListData:!!l.recommendationList,hasPeerData:!!l.recommendationList.item_data[s]};throw n.remove(),t.set((e=>(0,A.removeStoredRecommendedListItem)(e,s))),new Error((0,j.getErrorText)(c,"Rec remove log"))}n.remove(),t.set((e=>(0,A.removeStoredRecommendedListItem)(e,s))),(0,x.hideSuggestedContact)({position:i,track_code:r}).catch((e=>{throw new Error((0,j.getErrorText)(e))}))}(e,t))),s(e,"click",se,(e=>function(e){if(!e.target.closest("._convoRecommendUserRemove")){var t=e.target.closest("._convoRecommendUser").dataset,a=t.position,n=t.trackcode;(0,P.collectConversationSuggestionItemStats)(n,Number(a),"click")}}(e))),s(e,"click",oe,(e=>function(e,t){"invite_by_phone_number"===e.target.closest("._convoRecommendAction").dataset.action&&Ze().then((()=>{window.FriendsSearch.inviteBox()}))}(e))),(0,l.isCommunityInterface)(t)&&t.get().is_peer_profile_enabled&&(s(e,"mouseover","_im_peer_tags_extra",(e=>(0,u.onPeerTagsExtraHover)(e,t))),s(e,"click","_im_dialog_peer_tag",(e=>(0,u.onDialogPeerTagClick)(e,t)))),i(e,"mouseover",(0,p.throttle)(W.unhoverElements.bind(W,ne),100)),s(e,"mouseover",de,((e,t)=>{(0,C.showTooltip)(t,{text:getLang("mail_dialog_folder_button_hide"),black:1,center:!0,shift:[1,6],appendEl:bodyNode})})),s(e,"click","_im_archive_notice_close",Ee),s(e,"click","_im_new_ui_notice_close",Se),s(e,"click","_im_archive_notice_settings",(e=>{a().applySearchAction(t,"settings",e)})),s(e,"mouseover",me,((e,t)=>{(0,C.showTooltip)(t,{text:getLang("mail_dialog_folder_button_back"),black:1,center:!0,shift:[-3,0],appendEl:bodyNode})})),s(e,"click",me,Ce)}});return d(e,r,W,a,Te,G)}},922163:(e,t,a)=>{"use strict";a.d(t,{mount:()=>h});a(530522),a(66108),a(296253),a(991181),a(579665),a(95767),a(176774);var n=a(454593),i=a(315544),s=a(932699),r=a(907319),o=a(597903),l=a(712439),c=a(610124),d=a(663825),u=a(419672);function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return g(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function m(e,t,a,s){if(!e.loading&&!e.all&&a.scrollTop+window.innerHeight-a.scrollHeight>-300){var r=(0,i.geByClass1)("_im_peer_history",t.bodyNode);e.loading=!0,(0,o.wrapLoading)(r)((0,n.loadImportant)(e.offset).then((t=>{var a=_(t,4),l=(a[0],a[1]),c=(a[2],a[3]);e.all=c.all,e.offset=c.offset,e.all?(0,i.addClass)(r,"im-important_all"):e.loading=!1,s.set((e=>(0,n.mergeTabs)(e,(0,o.tabFromIds)(c.msgs,c.hash),!0)));var d=(0,i.ce)("div");d.innerHTML=l,r.appendChild(d),(0,u.ensureDomHasActions)(r)})),"bottom")}}function p(e,t,a){for(var i=arguments.length,s=new Array(i>3?i-3:0),r=3;r<i;r++)s[r-3]=arguments[r];s.filter((e=>inArray(e.type,[d.SET_FLAGS,d.RESET_FLAGS,d.CHANGE_PEER]))).forEach((i=>{if(i.type!==d.CHANGE_PEER){if(i.flags===d.FLAG_IMPORTANT){var s=i.type===d.SET_FLAGS;e.set(n.updateFavMessage.bind(null,[i.messageId],0,s)).then((a=>{t.markImportant(i.messageId,s,e)}))}}else a.hide()}))}function h(e,t,a,n){var d=(0,i.ge)("box_layer_wrap"),_=t.get().longpoll,g=(0,l.default)({peer:0,longpoll:_,oCache:{},tabs:(0,o.tabFromIds)(n.msgs,n.hash)}),h=(0,r.mount)(e.bodyNode,g,(()=>({}))),v=(0,s.mount)(e.bodyNode,t,"fav_box");(0,u.ensureDomHasActions)(e.bodyNode);var f=p.bind(null,t,h,e);_.onData(f);var b=m.bind(null,{all:!1,loading:n.all,offset:n.offset},e,d,g),y=(0,c.createModule)({handlers:(e,t)=>{e(d,"scroll",b)}});return{unmount(){(0,c.destroyModule)(y),v.unmount(),h.unmount(),_.offData(f)}}}},773023:(e,t,a)=>{"use strict";a.d(t,{mount:()=>o});a(991181),a(296253);var n=a(597903),i=a(695724),s=a(454593);function r(e){var t=e.get().tabs,a=e.get().peer,r=Object.keys(t).filter((t=>(0,n.isFullyLoadedTab)(e,t)&&(0,i.intval)(t)!==a)).map((e=>t[e]));r.filter((e=>Date.now()-e.last_visited>54e6)).forEach((t=>e.set(s.cleanTab.bind(null,t.peerId)))),r.filter((t=>(0,n.isFullyLoadedTab)(e,t.peerId)&&"string"!=typeof t.history&&Date.now()-t.last_touched>72e5)).forEach((t=>e.set(s.stringifyTab.bind(null,t.peerId))))}function o(e){var t=setInterval(r.bind(null,e),5e3);return{unmount(){clearInterval(t)}}}},353702:(e,t,a)=>{"use strict";a.d(t,{AUDIO_MSG_AUTOSHOW_SETTING_HINT:()=>Oe,mount:()=>Kt});a(530522),a(66108),a(579665),a(95767),a(976142),a(751876),a(388416),a(820075),a(21466),a(991181),a(59357),a(940851),a(296253);var n=a(454593),i=a(479957),s=a(49535),r=a(850167),o=a(315544),l=a(412947),c=a(251976),d=a(993421),u=a(459554),_=a(597903),g=a(266372),m=a(104837),p=a(982452),h=a(294940),v=a(592842),f=a(823908),b=a(610124),y=a(31847),w=a(241385),C=a(844075),E=a(932699),S=a(907319),T=a(309013),I=a(668667),L=a(145470),M=a(778755),k=a(980309),P=a(348211),A=a(663825),D=a(645523),B=a(944825),x=a(498101),O=a(283303),R=a(28238),N=a(809971),F=a(329164),U=a(826338),H=a(180012),j=a(668040),q=a(483295),K=a(376852),W=a(695724),G=a(609720),V=a(376270),z=a(19331),Y=a(827749),$=a(727181),Q=a(606542),Z=a(654612),X=a(309756),J=a(386409),ee=a(376473),te=a(475234),ae=a(124041),ne=a(786067),ie=a(712860),se=a(314057),re=a(419672),oe=a(917791),le=a(163612),ce=a(240367),de=a(588870);function ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _e(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _e(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var ge=1e3,me=-30,pe="._im_to_end",he="._im_to_mention",ve="_im_error",fe="im-page--error--visible",be="im-audio-message_recorded",ye="im-audio-message_recording",we="_im_mess_srv",Ce="im_srv_mess_link",Ee="_im_mess",Se="_im_replied_message",Te="top",Ie="center",Le="_im-call-snippet",Me="_im_mess_callsnippet",ke="_im_call_snippet_join_btn",Pe="_im_mess_pinned",Ae="_im_subscribe_button",De="im-mess-stack--lnk",Be="_msg_asr_toggle",xe="im_msg_audiomsg--transcription-shown",Oe="_im_asr_setting_hint",Re=!1,Ne={};function Fe(e){return e.get().isMassMentionsMessageAllowed}function Ue(e){var t=(0,m.getTab)(e,e.get().peer);return!!(0,m.getPinnedMessage)(e)||!(!t||!t.top_banner)}function He(e,t){var a=(0,p.unpackStore)(e),n=(0,m.getTab)(a,t);return(0,_.isChatPeer)(t)&&(0,M.isPinnedMessageVisibleInTab)(a,t)||!!n.top_banner&&!(0,m.isSearchShown)(t,a)}function je(e){return(0,_.getPinnedMessageHeight)(e)}function qe(e,t,a){var n=a||(0,o.clientHeight)();return Math.min(n-15,Math.max(0,e,742+t.offsetTop))}function Ke(e,t){var a=(0,W.intval)((0,o.domData)(t.target,"msgid")),n=(0,o.gpeByClass)(`_im_mess_${a}`,t.target),i=(0,o.geByClass1)("_im_log_body",n),s=(0,o.geByClass1)("_im_mess_susp_cont",n);i.innerHTML=s.innerHTML}function We(e,t){return(0,o.geByClass1)("_im_mess_"+t,e)}function Ge(e){e().hideError()}function Ve(e,t,a,i,r){if((0,s.checkEvent)(i))return!0;var o=(0,j.fromQueryString)(r.getAttribute("href")),l=(0,W.intval)(o.msgid);l&&e.set(n.changePeer.bind(null,e.get().peer,l,!1)).then((()=>st(a,t,l,e))),(0,s.cancelEvent)(i)}function ze(e,t,a){var i=(0,m.getTab)(t,a),s=(0,n.strHistory)(i.history);(0,o.toggleClass)(e,"im-page--history_empty-hist",!s)}function Ye(e,t,a,n){if((0,o.hasClass)(a.target,"_im_mess_marker")){var i=a.target,s=(0,p.toArray)((0,o.geByClass)(_.FAILED_CLASS,t));window.tooltips&&s.map((e=>(0,o.geByClass1)("_im_mess_marker",e))).filter((e=>e!==i)).forEach((e=>tooltips.hide(e,{fasthide:!0})));var r=(0,o.domData)(n,"msgid");(0,K.showTooltip)(i,{content:getTemplate("im_failed_menu",{count:s.length,modifiers:(0,q.classNames)("im-settings_failed",{"im-settings_no_delete":r>0,"im-settings_single":1===s.length}),id:r}),className:"im-page--failed-tt",appendParentCls:"_chat_body_wrap",dir:"down",noZIndex:!0,shift:[12,8],hasover:!0,force:!0})}}function $e(e){return(0,o.geByClass1)("_im_peer_history",e)}function Qe(e,t){var a=t.contHeight(),n=e.scrollTop+(a-e.contHeight);t.scrollTop(n)}function Ze(e,t,a,i,s,r,l,c,d){var u=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],g=arguments.length>10&&void 0!==arguments[10]&&arguments[10],p=(t.get().tabs||{})[a];s().hideError(),r.renderPeer(t),c.renderPeer(t),d.render(t);var h=(0,m.isCasperChat)(t,a);if((0,o.toggleClass)(e,"im-page--history_casper",h),!t.get().tabHistoryNotChanged){r.reRenderTitle(t),ze(e,t,a);var v=(0,n.strHistory)(p.history);if(v){var f=(0,o.geByClass1)("_im_peer_history",e);(0,o.val)(f,v)}else s().showEmptyScreen();getAudioPlayer().isPlaying()&&getAudioPlayer().updateCurrentPlaying(),yt(t,i,e)}if((0,n.isSearchingInplace)(a,t.get())?s().showSearch(t):s().cancelSearch(t,!1),l.changePeer(a,t),t.get().msgid)st(i,e,t.get().msgid,t);else if(p.scrollBottom&&u){Qe(p,i);var b=(0,_.isMessagesVisible)(t,e,i),y=ue(b,1),w=y[0];p.skipped||setTimeout((()=>{p.unread&&!w&&(ct(t,e,!0),dt(t,e,!0)),et(t,i,e),tt(t,i,e)}),100)}else it(i,e,s,t,g)||i.scrollBottom(me);(0,$.updateWidgetScrollButtons)()}function Xe(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=a||t.scrollTop(),s=t.scrollBottom(),r=t.contHeight(),o=e.get().peer;e.set(n.saveHistoryScroll.bind(null,o,i,s,r))}function Je(){return v.screenfull.isFullscreen}function et(e,t,a){var n=(0,m.isGoToMentionVisible)(e),i=(0,m.isGoToEndVisible)(e),s=t.getScrollHeight()/4,r=t.scrollTop()>0;t.scrollBottom()>s&&(!i||n)&&r&&ct(e,a,!0,40)}function tt(e,t,a){if(Fe(e)){var n=t.getScrollHeight()/4,i=t.scrollTop()>0,s=(0,m.isGoToMentionVisible)(e);t.scrollBottom()>n&&!s&&i&&dt(e,a,!0,40)}}function at(e,t,a,i,s,r,l,c){var d=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if((e.get().history_init||(e.get().history_init=!0,!(c.scrollTop()>0)))&&!Je()){s.update(c),s.show();var u=e.get().peer;if(0!==u&&(0,_.isFullyLoadedTab)(e.get(),u)&&(x.default.onHistoryScroll(c.scrollTop()),!layers.visible)){var g=(0,m.getTab)(e,u);g&&!g.skipped&&c.scrollBottom()>40?(et(e,c,r),tt(e,c,r)):g.skipped||g.unread||(St(e,r),Tt(e,r));var p=(0,_.wrapLoading)(a);if(!(0,n.isSearchingInplace)(u,e.get())&&d&&i(c),!Re&&(l<0||0===c.scrollBottom())&&c.scrollBottom()<ge){if((0,n.isSearchingInplace)(u,e.get()))return;if(g.skipped>0&&!e.get().no_moving_down){var h=(0,o.gpeByClass)("_im_page_history",r),v=e.get();Re=!0;var b=e.set(n.loadLessHistory).then(t().loadHistory.bind(null,v.peer,{reversed:!0})).then((()=>{t().updateObserver(),Re=!1,ct(e,h),dt(e,h),g.skipped||e.set(n.changePeer.bind(null,e.get().peer,!1,!1))}));return vt(h,!0),void b.then(vt.bind(null,h,!1))}}if(!Re&&c.scrollTop()<ge){if((0,n.isSearchingInplace)(u,e.get())){Re=!0;var y=t().getSearchResulstModule();return y.isAll(e)?void(Re=!1):void p(y.loadMore(e).then((a=>{Re=!1,a&&(t().loadHistory(e.get().peer,{},e,a),i(c))})),"up")}var w=e.get();g.allShown||(Re=!0,p(e.set(n.loadMoreHistory.bind(null,0,0)).then(t().loadHistory.bind(null,w.peer,{})).then((()=>{Re=!1,i(c),(0,$.updateWidgetScrollButtons)()})),"up"))}l<0&&Dt(e,u,c.scrollBottom(),r,t),(0,f.videoAutoPlayHandler)()}}}function nt(e,t){return window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?Promise.resolve():e.set(n.readTillSpecificMessage.bind(null,t,e.get().peer))}function it(e,t,a,i,s){var r=(0,o.geByClass1)("_im_unread_bar_row",t);if(r){var l=i.get(),c=l.peer,d=r.getBoundingClientRect(),u=(0,o.geByClass1)("_im_chat_body_abs",t).getBoundingClientRect().top+20;(0,_.isClassicInterface)(i)&&(u+=47+(He(l,c)?je(i):0));var g=e.scrollTop()-u+d.top;return e.scrollTop(g),Xe(i,e,g),setTimeout((()=>{c===i.get().peer&&at(i,a,$e(t),(function(){}),s,t,0,e)}),80),(0,z.partConfigEnabled)("mail_history_unread_counter_observer")?a().updateObserver():function(e){var t=e.get().peer;if(!(window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle)&&t)e.set(n.readLastMessages.bind(null,t))}(i),!0}return!1}function st(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Te,s=We(t,a);if(s){var r=(0,_.isClassicInterface)(n),l=n.get().peer,c=r?(0,o.clientHeight)():(0,o.geByClass1)("_im_chat_body_abs",t).offsetHeight,d=s.offsetTop+(0,o.domPN)(s).offsetTop+(0,o.domPN)((0,o.domPN)(s)).offsetTop+(0,o.domPN)((0,o.domPN)((0,o.domPN)(s))).offsetTop;r&&He(n,l)&&(d-=je(n)),i===Te?e.scrollTop(d-e.getScrollHeight()/2+c/2):e.scrollTop(d-e.getScrollHeight()+c/4),(0,o.addClass)(s,"im-mess_light"),setTimeout((()=>{(0,o.removeClass)(s,"im-mess_light")}),2e3)}}function rt(e,t,a){a.updateLastSeen(e)}function ot(e,t,a,i,s,r){var c=(0,o.domData)(r,"action"),d=(0,o.domData)(r,"msgid"),u=(0,o.geByClass1)("_im_mess_marker",We(a,d)),_=Number(d)>0?"edit":"send",g=e.get().peer,m=$e(a);switch(c){case"resend":(0,l.statlogsSendingRetry)("retry",_),t(s,r);break;case"resend_all":(0,l.statlogsSendingRetry)("retry",_),i().resendPeer();break;case"delete":(0,l.statlogsSendingRetry)("delete",_),e.set((t=>(0,n.removeFailed)(e,m,g,d,t)));break;case"delete_all":(0,l.statlogsSendingRetry)("delete",_),e.set((t=>(0,n.removeFailed)(e,m,g,void 0,t)))}tooltips.hide(u,{fasthide:!0})}function lt(){var e=(0,Z.showBox)("al_im.php",{act:"a_business_notify_info_content"},{title:!1,onDone:()=>{var t=()=>e.hide();document.querySelectorAll("._im_business_notify_info_box_hide").forEach((e=>e.addEventListener("click",t))),e.setOptions({hideButtons:!0})}})}function ct(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=e.get(),r=s.peer;if(!(0,_.isReservedPeer)(r)){var l=e.get().tabs[r],c=(t||document).querySelector(pe),d=!1;(a||l.skipped>0||l.unread>0)&&!(0,n.isSearchingInplace)(r,e.get())?(d=!0,ut(t,e),(0,o.addClass)(c,"im-navigation_shown")):Et(c,!0),e.set(n.updateGoToEndVisibility.bind(null,[d,+i]))}}function dt(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!Fe(e))return!1;var s=e.get(),r=s.peer;if(!(0,_.isReservedPeer)(r)){var l=e.get().tabs[r],c=l.mentions,d=void 0===c?[]:c,u=l.mention_cmids,g=void 0===u?[]:u,m=(t||document).querySelector(he),p=(0,z.partConfigEnabled)("me_web_read_by_cmid")?g.length:d.length,h=!1;l.unread>0&&p>0&&!(0,n.isSearchingInplace)(r,e.get())?(h=!0,_t(t,e,p),(0,o.addClass)(m,"im-navigation_shown")):Et(m,!0),e.set(n.updateGoToMentionVisibility.bind(null,[h,+i]))}}function ut(e,t){var a=t.get().peer,n=(0,m.getTab)(t,a);(e||document).querySelector(pe).querySelector("._im_to_end_label").innerHTML=Number(n.unread)>0?(0,W.formatCount)(n.unread):""}function _t(e,t,a){(e||document).querySelector(he).querySelector("._im_to_mention_label").innerHTML=a>0?(0,W.formatCount)(a):""}function gt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0===e.scrollTop()&&0===e.scrollBottom())return!1;var a=e.scrollBottom();return a<(t?30+t:30)}function mt(e,t,a,n,i){var s=(0,o.domData)(i,"msgid"),r=e.get().peer,l=(0,m.getMessage)(e,r,s);l.type===A.EDIT_MESSAGE?(a().sendEditMessage(e,l),a().resendMessage(r,s)):e.get().imQueueResend(r,s).then((t=>{e.get().longpoll.push([(0,D.resendEvent)(r,t.mess)])}))}function pt(e,t,a,i,s,r){var l=(0,W.intval)((0,o.domData)(r,"peer")),c=(0,W.intval)((0,o.domData)((0,o.gpeByClass)("_im_mess",r),"msgid")),d=(0,m.getTab)(e,l);return e.set(n.restoreMessage.bind(null,c,l)).then(_.restoreMessage.bind(null,c,l,$e(t))).then((()=>yt(e,a,t))),(0,n.restoreMessageSend)(c,l,d.hash,e.get().gid).then((()=>{c>d.lastmsg&&(0,n.loadActualLastMessage)(e,l).then((()=>i().updateState(l,e)))})),!1}function ht(e,t){if(e){var a=e.querySelector(pe);(0,o.toggleClass)(a,"im-navigation_loading",t)}}function vt(e,t){if(e){var a=e.querySelector(pe);(0,o.toggleClass)(a,"im-navigation_loading",t)}}function ft(e,t,a,i){var s=t.get().peer,r=(0,m.getTab)(t,s);if((0,_.isFullyLoadedTab)(t,s)){var o=Object.keys(r.msgs).find((e=>{var t=r.msgs[e];return!Array.isArray(t)&&(0,h.isUnread)(r,t)}));if(!r.skipped)return o?st(i,a,o,t):i.scrollBottom(me),ct(t,a),dt(t,a),Dt(t,s,0,a,e),void(0,n.readTillSpecificMessage)(r.lastmsg,s,t.get());ht(a,!0),t.set((e=>(0,oe.loadPeer)(e,s,-1,!0,!1,"goToEnd"))).then((()=>{ht(a,!1),e().changePeer(t,!1,!1)}))}}function bt(e,t,a,n){var i,s=t.get().peer,r=(0,m.getTab)(t,s),o=r.mentions,l=void 0===o?[]:o,c=r.mention_cmids,d=void 0===c?[]:c,u=(0,z.partConfigEnabled)("me_web_read_by_cmid")?d[0]:l[0],_=(0,z.partConfigEnabled)("me_web_read_by_cmid")&&u?null===(i=(0,ee.getMessageByCmid)(t,s,u))||void 0===i?void 0:i.messageId:u;if(!r.skipped)return _&&st(n,a,_,t,Ie),ct(t,a,!0),dt(t,a),nt(t,_),void Dt(t,s,0,a,e);ht(a,!0),t.set((e=>(0,oe.loadPeer)(e,s,_,!0,!1,"goToMention"))).then((()=>{ht(a,!1),e().changePeer(t,!1,!1),s===t.get().peer&&(st(n,a,_,t,Ie),nt(t,_))}))}function yt(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if((0,_.isClassicInterface)(e)){var i=t.contHeight(),s=(0,o.geByClass1)("_im_chat_input_w",a),r=(0,o.geByClass1)("im-chat-input",a),l=(0,o.geByClass1)("_im_chat_resize",a),c=(0,o.geByClass1)("EmptyDialogStickers",a);if(!1!==(n=!1!==n?n:(0,_.getClassicChatHeight)())&&n>0){var d=(0,o.clientHeight)(),u=(0,o.geByClass1)("_im_chat_audio_input_parent",a),g=qe(n,a,d),m=(0,o.hasClass)(u,ye)||(0,o.hasClass)(u,be),p=m?u:(0,o.geByClass1)("_im_chat_input_parent",a),h=g-p.offsetHeight;l.style.height=d-g-15+"px",(0,o.setStyle)(s,{top:h+"px",bottom:"auto"})}else l.style.height="0px",(0,o.setStyle)(s,{top:"auto",bottom:"0px"});var v=(0,o.geByClass1)("_im_peer_history_w",a),f=r.offsetHeight-45,b=s.offsetHeight-16;return(0,o.setStyle)(v,{borderBottomWidth:c?f:b}),t.contHeight()-i}var y=t.getScrollHeight();t.update(!1,!0);var w=t.getScrollHeight();return y-w}function wt(e,t,a,n){var i=t.offsetHeight;n(),e.heightIncreased(t.offsetHeight-i,a)}function Ct(e,t){var a=t.getBoundingClientRect().top;(0,K.showTooltip)(t,{className:"im-page--admin-tt",text:(0,ne.getLang)("mail_only_admin_see"),appendParentCls:"_chat_body_wrap",shift:[20,5],dir:"auto",showdt:400,noZIndex:!0,toup:a>200})}function Et(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,o.hasClass)(e,"im-navigation_shown")&&(t&&(0,o.addClass)(e,"im-navigation_fast"),(0,o.removeClass)(e,"im-navigation_shown"),t&&(e.offsetHeight,(0,o.removeClass)(e,"im-navigation_fast")))}function St(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.querySelector(pe);e.set(n.updateGoToEndVisibility.bind(null,[!1,0])),Et(i,a)}function Tt(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.querySelector(he);e.set(n.updateGoToMentionVisibility.bind(null,[!1,0])),Et(i,a)}function It(e,t,a){v.screenfull.isFullscreen||0===t.get().peer||(0,_.isClassicInterface)(t)||e().restoreScroll(t,t.get().peer)}function Lt(e,t){var a=e.get(),i=a.peer,s=(0,o.domClosest)(we,t.target),r=(0,W.intval)((0,o.domData)(s,"msgid")),l=(0,m.getMessage)(e,i,r),c=l&&(0,h.isServiceMsg)(l)&&l.kludges.source_act;if(c===_.CHAT_PIN_MESSAGE||c===_.CHAT_UNPIN_MESSAGE){var d=s.querySelector(".im_srv_mess_link");if(d&&"A"!==d.tagName){var u=l.kludges.source_chat_local_id;if(!u||Ne[u])return;Ne[u]=(0,n.getMessageLocalId)(i,u,a).then((e=>{var t=ue(e,1)[0];if(t){var a=`/im?sel=${(0,_.convertPeerToUrl)(i)}&msgid=${t}`,n=d.innerHTML;(0,o.domReplaceEl)(d,(0,le.getServiceLinkTemplate)(a,n,!0,Ce)),delete Ne[u]}}))}}}function Mt(e,t,a){var n=e.get(),i=n.peer,r=a.target.href&&a.target.href.match(/msgid=([\d]+)/),o=r&&r[1];"A"!==a.target.tagName||!o||(0,_.isAlreadyDeleted)(e,i,o)||(0,s.checkEvent)(a)||((0,m.getMessage)(e,i,o)?(e.setState({msgid:o}),(0,O.updateLocation)({msgid:o}),t().focusOnMessage()):n.longpoll.push([(0,D.changePeer)(i,o,!1,!1,n.currentEntryPoint||"")]));(0,s.cancelEvent)(a)}function kt(e){var t=(0,u.getCurrentTab)(e);(0,_.isChatPeer)(t.peerId)&&(t.pinHideId=cur.imDb.select(R.PIN_HIDDEN_ID_OP,t.peerId))}function Pt(e,t,a,n,i){e.setState({isEditing:!1}),(0,o.removeClass)(n,"im-mess_is_editing"),(0,o.removeClass)((0,o.geByClass1)("_im_page_history"),"is_msg_editing"),cancelStackFilter("cancel_edit"),a.setDraft(e,(0,d.getPeer)(e)?(0,m.getTabDraft)((0,u.getCurrentTab)(e)):null),a.toggleStickers(e,!0),a.restoreKeyboard(),At(t)}function At(e){(0,p.toArray)((0,o.geByClass)("_im_history_tooltip",e)).forEach((e=>(0,o.hide)(e)))}function Dt(e,t,a,i,s){var r=(0,m.getTab)(e,t);if(!(Date.now()-(r.lastReset||0)<1e3)&&(r&&r.msgs&&r.history&&!Re&&r.offset>300&&0==r.skipped&&a<50&&a>=0&&0===(e.get().selectedMessages||[]).length)){var o=Object.keys(r.msgs).filter((e=>e>0)).sort(((e,t)=>e-t)).slice(0,-50),l=o.slice(-1)[0];e.mutate(n.resetTabAll.bind(null,t)),e.set(n.removeMessages.bind(null,o,t)).then((()=>s().removeStartingFromMessage(l,t,e)))}}function Bt(e,t,a,n){var i=n.target,s=(0,o.domClosest)(Se,i),r=Number(s.getAttribute("data-msgid")),l=(0,o.domClosest)("im-mess",i),c=Number(l.getAttribute("data-msgid")),d=e.get().peer;r&&!(0,_.isAlreadyDeleted)(e,d,r)?(e.setState({msgid:r}),(0,O.updateLocation)({msgid:r}),(0,_.focusOnMessage)(e,t().focusOnMessage,d,r)):c&&(0,_.showRepliedBox)(e,c,n)}function xt(e){(0,s.checkEvent)(e)||(0,s.cancelEvent)(e)}var Ot=new Map;function Rt(e,t){var a,n,i=t.closest(`.${_.AUDIO_MSG_CLASS}`),s=i.querySelector("._msg_asr_empty"),r=t.closest("._im_mess"),o=i.id.replace("audmsg",""),l=!!i.closest(".im-mess_fwd"),c=Boolean(i.dataset.asr_done),d=l?0:Number(null==r?void 0:r.dataset.msgid),u=!i.classList.contains(xe),g=Number(null==r?void 0:r.dataset.peer)||void 0,m=Number(null==r?void 0:r.dataset.msgid),p=g&&(0,ee.getMessage)(e,g,m),h=Number(null==r?void 0:r.dataset.cmid)||(null==p?void 0:p.chat_local_id),v="audio_message"+o;if(u){var f=(Ot.get(i.id)||0)+1;Ot.set(i.id,f),c||((0,ce.recogniseAudioMessage)(d,o),h&&g&&(0,Y.collectVoiceStat)("transcript_loading",g,h,v)),f%3==0&&s?s.innerHTML=(n=(0,ne.getLang)("me_voice_asr_status_empty_set").split("|"),null===(a=n[Math.floor(Math.random()*n.length)])||void 0===a?void 0:a.trim()):s&&(s.innerHTML=(0,ne.getLang)("me_voice_asr_status_empty"))}(u&&!l&&(0,de.markAudioMessageAsListened)(e,m,g).catch((()=>{})),h&&g&&(0,Y.collectVoiceStat)("transcript_toggle",g,h,v,u,"user"),i.classList.toggle(xe),window.tooltips&&tooltips.destroy(t,{fasthide:!0}),t.closest(".audio-msg-player"))&&i.querySelector(".audio-msg-track_player-attached .audio-msg-track--transcriptToggle").classList.toggle("audio-msg-track--transcript_on",t.classList.contains("audio-msg-track--transcript_on"))}function Nt(e,t){function a(t,a){var n=a.closest("._im_mess");if(n){var i=a.id.replace("audiomsgpl_","audio_message"),s=Number(n.dataset.peer),r=Number(n.dataset.msgid);if(s&&r){var o=(0,ee.getMessage)(e,s,r),l=Number(n.dataset.cmid)||(null==o?void 0:o.chat_local_id);switch(t){case"playing":(0,Y.collectVoiceStat)("play",s,l,i);break;case"paused":(0,Y.collectVoiceStat)("pause",s,l,i);break;case"finished":(0,Y.collectVoiceStat)("finish",s,l,i)}}}}window.AudioMessagePlayer.events.on("listened",(a=>function(e,t,a){var n=t.closest("._im_mess"),i=t.closest(".im_fwd_log_wrap");if(n&&!i){var s=Number(n.dataset.msgid),r=Number(n.dataset.peer);s&&r&&(0,de.markAudioMessageAsListened)((0,p.unpackStore)(e),s,r).then((()=>{a.markMessageAsListened(e,r,s)})).catch((()=>{}))}}(e,a,t()))),window.AudioMessagePlayer.events.on("transcription_toggle",(t=>Rt(e,t))),window.AudioMessagePlayer.events.on("playing",(e=>{a("playing",e)})),window.AudioMessagePlayer.events.on("paused",(e=>{a("paused",e)})),window.AudioMessagePlayer.events.on("finished",(e=>{a("finished",e)}))}function Ft(e){var t=e.target.closest("._msg_asr_toggle"),a=e.target.closest(`.${_.AUDIO_MSG_CLASS}`);(0,K.showTooltip)(t,{text:a.classList.contains(xe)?(0,ne.getLang)("me_voice_asr_toggle_close"):(0,ne.getLang)("me_voice_asr_toggle_open"),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[6,12],showdt:400,onHide(){window.tooltips&&tooltips.destroy(t,{fasthide:!0})}})}function Ut(e,t,a){var n=a.target.closest("."+_.MESSAGE_KEYBOARD_BUTTON_CLASS),i=a.target.closest("."+_.MESSAGE_STACK_CLASS);if(n){var s=e.sendMessageFromKeyboard.bind(null,(()=>e)),r=(0,g.getActionObjectFromElement)(n),o=i?i.dataset.peer:void 0,l=a.target.closest("._im_mess"),c=(0,u.getCurrentTab)(t);if(!l||!n||!c)return;var d=Number(l.dataset.msgid),p=(0,m.parserMessage)(d?c.msgs[d]:c.pinned);if(!p)return;return(0,g.handleButtonClick)(r,s,t,{keyboardAuthorId:o,peerId:p.peerId,message:p,onBeforeSend:()=>{(0,_.setCallbackButtonLoadingState)(n,!0)},onSendSuccess:e=>{var a={timeout:setTimeout((()=>{t.set((t=>(0,te.unsetPressedCallbackButton)({peerId:p.peerId,eventId:e},t))).then((()=>(0,_.setCallbackButtonLoadingState)(n,!1)))}),g.CALLBACK_TIMEOUT_MS),onCallback:()=>{var e,t=Number(n.dataset.index);document.contains(n)?e=n:isNaN(t)||(e=(0,_.getCallbackButton)(document,Number(p.messageId),t)),e&&(0,_.setCallbackButtonLoadingState)(e,!1)}};t.set((t=>(0,te.setPressedCallbackButton)({peerId:p.peerId,eventId:e},a,t)))},onSendFail:e=>{e.error_msg&&(0,g.handleShowSnackbar)({peerId:p.peerId,store:t,text:e.error_msg}),(0,_.setCallbackButtonLoadingState)(n,!1)}})}}function Ht(e,t){var a=t.target.closest("._im-call-snippet"),n=a.closest("."+Me),i=a.dataset.type,s=a.dataset.participants,r=s&&s.split(",").reduce(((t,a)=>(+a!==e.get().id&&(0,_.isUserPeer)(+a)&&t.push(+a),t)),[]),o=+n.dataset.peer;(0,_.isCallToPeerAvailable)(e,o)&&(0,_.startCallFromIm)(e,o,"video"===i,r,_.CALL_ENTRY_POINT_SNIPPET)}function jt(e,t,a){var n=a.target.closest("._im_mess_pinned");(0,_.updateMessageEditableStatus)(e,e.get().peer,t,n)}function qt(e,t,a,i,s,r,l,g,v,f,y,w,C,S,T,I,L,M,k){var P,A=(0,p.throttle)((function(){a.smoothScroll(...arguments)}),300);return{fixKeyboard(){s.fixKeyboard()},removeUnpinnedMessageEditable(e,a){var n=t.querySelector(`._im_mess_pinned:not(._im_mess_${a}`);n&&(n.classList.remove(Pe),(0,_.updateMessageEditableStatus)(e,e.get().peer,t,n))},changePeer(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],p=e.get().peer;if(revertLastInlineVideo(t),0===p)return T.disable(),s.setDraft(e,null),function(e){(0,o.addClass)(e,"im-page--history_empty"),$e(e).innerHTML=""}(t);if((0,_.isFullyLoadedTab)(e.get(),e.get().peer)){(0,o.removeClass)(t,"im-page--history_search"),i.deselectAll(e),i.changeActions(e),i.showActions(e);var h=e.get().prevPeer;(0,o.removeClass)(t,"im-page--history_loading"),(0,o.toggleClass)(t,"im-page--history_vkcomgroup",(0,_.isFvkcomgroup)(e,p)),n?s.setDraft(e,(0,m.getTabDraft)((0,u.getCurrentTab)(e))):s.updateState(e),ct(e,t),dt(e,t),r().updateTyping(p,e),rt(e,0,i),(0,_.isReservedPeer)(h)&&!(0,_.isReservedPeer)(p)?function(e,t,a,n,i,s,r,l,c,d,u){(0,o.removeClass)(e,"im-page--history_empty"),Ze(e,t,a,n,i,s,r,l,c,d,u)}(t,e,p,a,r,i,g,I,M,l,T):(0,_.isReservedPeer)(h)||(0,_.isReservedPeer)(p)||Ze(t,e,p,a,r,i,g,I,M,l,T),(0,m.isCasperChat)(e,p)||(T.enable(),T.toggle(!0),T.reset(a)),(0,_.isReservedPeer)(p)||setTimeout((()=>{at(e,r,$e(t),C,T,t,0,a)})),(0,re.ensureDomHasActions)(t),(0,d.getPeer)(e)===c.VK_OFFICIAL_PEER_ID&&(0,Y.collectOnboardingFindFriendsShowStats)(e.get().viewer_id),s.updateMediaSelectorOptions(e)}},preparePeer(e){var a=(0,d.getPeer)(e);kt(e),s.setDraft(e,(0,m.getTabDraft)((0,m.getTab)(e,a)),!1),r().updateTyping(a,e),r().hideError(),i.renderPeer(e),I.renderPeer(e),i.hideActions(e),g.changePeer(a,e),rt(e,0,i),T.toggle(!1),St(e,t,!0),Tt(e,t,!0)},saveScroll:e=>Xe(e,a),loadingPeer(e){(0,n.isAnythingLoading)(e.get())||((0,o.removeClass)(t,"im-page--history_empty"),(0,o.addClass)(t,"im-page--history_loading"))},stopLoading(e){(0,o.removeClass)(t,"im-page--history_loading")},deselectDialog(e){l().removeSelection(e)},replaceMessageAttrs(e,a){(0,_.replaceMessageAttrs)(a.get(),$e(t),e)},cleanSelection(e){f.cleanSelection(e)},updateDialogFilters(e,t){l().updateDialogFilters(e,t)},getSearchResulstModule:()=>P,showSearchResults(e){e?((0,o.removeClass)(t,"im-page--history_search-empty"),$e(t).innerHTML=e):((0,o.addClass)(t,"im-page--history_search-empty"),$e(t).innerHTML=(0,_.renderEmptySearch)())},insertSearch(e,n){P||(i.deselectAll(n),P=(0,E.mount)(t,n,"message_search")),(0,o.addClass)(t,"im-page--history_search"),r().showSearchResults(e),yt(n,a,t),a.scrollBottom(0),ct(n,t),dt(n,t),T.reset(a)},updateChatTopic(e,t){l().updateDialog(e,t),e===t.get().peer&&(i.renderPeer(t),i.renderActions(t),I.renderPeer(t))},updateActions(e){i.changeActions(e)},updateChatPhoto(e,n,s){if((0,_.isPeerActive)(e.peerId,s.get())){i.renderPeer(s),I.renderPeer(s);var r=gt(a);(0,_.addChatPhotoToUpdate)(e,n,s.get(),$e(t)),r&&a.scrollBottom(me)}},markImportant(e,a,n){We(t,e)&&(i.changedMessageSelection(n),v.markImportant(e,a,n))},isNewMessagesVisible:e=>function(e,t){return(0,m.getUnreadScrollBottom)(e)>=(0,W.intval)(t.scrollBottom())}(e,a),loadHistory(e,n,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=i.get();if((0,_.isPeerActive)(e,r)){var l=s||r.tabs[e].historyToAppend;if(!l)return;var c=(0,o.geByClass1)("_im_peer_history",t),d=(0,o.domFC)(c),u=a.scrollBottom(),g=n.reversed?e=>c.appendChild(e):e=>c.insertBefore(e,d),m=0;n.reversed&&(m=c.offsetHeight);var p=(0,o.sech)(l),h=document.createDocumentFragment();p.forEach((e=>h.appendChild(e))),g(h),n.reversed&&T.heightIncreased(c.offsetHeight-m,a),n.reversed||a.scrollBottomFixSave(u),a.update(!1,!0);var v=p.filter((e=>(0,o.hasClass)(e,"_im_bar_date")));T.parseMore(v,a),(0,re.ensureDomHasActions)(t)}},sendMessage(e){0!==e.get().peer&&s.sendMessage()},editMessage(e,n){if((0,_.isFullyLoadedTab)(e,n.peerId)&&(0,_.isPeerActive)(n.peerId,e.get())){if(!We(t,n.messageId))return;Xe(e,a),(0,_.editAndReplaceMessage)(e.get(),n,t),Qe((0,m.getTab)(e,n.peerId),a),i.reRenderPinned(e),T.reset(a)}},addMessage(e,i){if(!(0,n.isSearchingInplace)(i.peerId,e.get())&&(0,_.isFullyLoadedTab)(e,i.peerId)&&(0,_.isPeerActive)(i.peerId,e.get())){if(We(t,i.messageId))return;var s=$e(t);wt(T,s,a,(()=>{var n=gt(a),l=(0,o.geByClass1)("_im_unread_bar_row",t),c=ue((0,_.isMessagesVisible)(e,t,a),2),d=c[0],u=c[1];(0,re.appendMessageToHistory)(e.get(),i,s,!0,!d&&!l),(0,o.removeClass)(t,"im-page--history_empty-hist");var g=(0,m.getTab)(e,e.get().peer),p=(0,h.isServiceMsg)(i)&&i.userId===vk.id,v=i.kludges&&i.kludges.source_act,f=p&&v!==_.CHAT_PIN_MESSAGE&&v!==_.CHAT_UNPIN_MESSAGE;g.skipped||d||!(0,h.isUnread)(g,i)||(0,h.isOut)(i)||(ct(e,t,!0,u),dt(e,t,!0,u)),(i.local||n||f)&&a.scrollBottom(0),r().updateTyping(i.peerId,e),ut(t,e),At(t)}));var l=(0,o.domPS)((0,o.domLC)(s));if((0,o.hasClass)(l,"_im_bar_date")){var c=(0,o.ce)("div");c.innerHTML=l.outerHTML,T.parseMore(c,a)}r().hideError(),T.update(a),(0,n.updateMentions)(e.get()),Dt(e,i.peerId,a.scrollBottom(),0,r),this.updateObserver()}},setMessageErrored(e,a,n,i){n&&"string"==typeof n&&r().showError(n),(0,_.setMessageError)(e,a,t)},markMessagesAsRead(e,a){e.get().peer===a.peerId&&(0,_.markMessagesAsRead)(e.get(),a.peerId,t)},markMessageAsListened(e,a,n){(0,d.getPeer)(e)===a&&(0,_.updateListenedMark)(t,n)},compensateHistoryHeightChange(e){a.scrollTop(a.scrollTop()+e*je(w))},updateTyping(e,a){if(!(0,n.isSearchingInplace)(e,a.get())){var i=a.get();if(i.peer===e&&(0,_.isFullyLoadedTab)(i,e)){var s=(0,_.formatTyper)((0,m.getTab)(a,e).activity,e,!1,i),l=(0,o.geByClass1)(_.TYPING_CLASS,t);if(l||s){if(!l){var c=(0,o.geByClass1)("_im_typer_c",t);(0,o.val)(c,getTemplate("im_typing",{cls:(0,_.isClassicInterface)(a)?"im-activity_classic":""})),l=(0,o.geByClass1)(_.TYPING_CLASS,t)}(0,o.val)((0,o.geByClass1)("_im_typing_name",l),s);var d=(0,_.loadSummaryActivityType)((0,m.getTab)(a,e).activity||{})===n.ACTIVITY_TYPE_RECORDING_AUDIO;l.setAttribute("data-activity-type",d?"recording":"typing"),s?((0,o.addClass)(l,"im-page--typing_vis"),r().hideError()):(0,o.removeClass)(l,"im-page--typing_vis")}}}},scrollFix(e,t,n){T.heightIncreased(n,a),T.update(a),(0,_.isPeerActive)(t,e.get())&&gt(a,n)&&a.scrollBottom(me)},goToEnd(){ft((()=>this),w,t,a)},updateGoToEnd(e,n){var i=(0,m.getTab)(e,e.get().peer);i&&(i.skipped||i.unread)?ct(e,t):St(e,t,n),y(0,a,!1);var s=e.get().peer;setTimeout((()=>{e.get().peer===s&&Xe(e,a)}))},updateGoToMention(e,n){var i=(0,m.getTab)(e,e.get().peer),s=i||{},r=s.mentions,o=void 0===r?[]:r,l=s.mention_cmids,c=void 0===l?[]:l,d=(0,z.partConfigEnabled)("me_web_read_by_cmid")?c[0]:o[0];i&&d?dt(e,t):Tt(e,t,n),y(0,a,!1);var u=e.get().peer;setTimeout((()=>{e.get().peer===u&&Xe(e,a)}))},newMessage(e){l().newMessage(e),St(e,t,!0),Tt(e,t,!0)},scroll(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==e.get().peer){var s=n?a.getScrollHeight():40;!0===i&&(s=a.contHeight()),s="up"===t?-s:s,n||i?A(s,(()=>{y(s,a)})):(a.scrollTop(a.scrollTop()+s),y(s,a))}},showCreation(e,t){l().showCreation(e,t)},updateScroll:()=>yt(w,a,t),toggleBarDate(e){T.toggle(e)},changedMessageSelection(e){i.changedMessageSelection(e)},updateOnline(e,t){(0,_.isTabLoaded)(t.get(),e)&&e===t.get().peer&&i.renderPeer(t)},isEmpty:e=>s.isEmpty(e),replaceAttachmentPlaceholders(e,n){if((0,_.isPeerActive)(n.peerId,e.get()))wt(T,$e(t),a,(()=>{var s=gt(a);(0,_.replaceAttaches)(t,n,e.get()),(0,$.updateWidgetScrollButtons)();var r=(0,m.getTab)(e,n.peerId);if(r.mediacontent[n.messageId].length>=3&&r.mediacontent[n.messageId][2].pinned){var o=(0,m.parserMessage)(r.pinned);o&&o.messageId==n.messageId&&(r.pinned=r.mediacontent[n.messageId][2].pinned,i.reRenderPinned(e))}s&&a.scrollBottom(0)})),T.update(a);else if((0,h.isMoneyRequest)(n)){var s=(0,m.getTab)(e,n.peerId);if(s.mediacontent[n.messageId].length>=3&&s.mediacontent[n.messageId][2].pinned){var r=(0,m.parserMessage)(s.pinned);r&&r.messageId==n.messageId&&(s.pinned=s.mediacontent[n.messageId][2].pinned)}}},replaceBotCarouselPlaceholder(e,n){var i=e.get();(0,_.isPeerActive)(n.peerId,i)&&(wt(T,$e(t),a,(()=>{var e=gt(a);(0,_.replaceCarousel)(t,n,i),e&&a.scrollBottom(0)})),T.update(a))},removeMessages(e,n,s){s.get().peer===n&&((0,_.removeMessages)(e,$e(t)),(0,_.removeExpiredMessagesStub)(e,$e(t)),yt(s,a,t),i.changedMessageSelection(s),this.updateObserver())},removeStartingFromMessage(e,n,s){if(s.get().peer===n){var r=$e(t),l=(0,o.geByClass1)("_im_mess_"+e,r);(0,_.removeStartingFromMessage)(l,r),yt(s,a,t),i.changedMessageSelection(s)}},hideGoToEnd(e){St(w,t,e)},hideGoToMention(e){Tt(w,t,e)},removeMessagesRestore(e,a,n,i){i.get().peer===a&&(0,_.removeMessagesWithRestore)(e,a,n,$e(t))},removeExpiredFailedMessages(e){w.get().peer===e&&w.set(n.removeExpiredFailed.bind(null,$e(t),e))},handleMessageExpiration(e){(0,_.isFullyLoadedTab)(w.get(),e.peerId)&&((0,_.replaceExpiredMessageWithPlaceholder)(w,t,e),(0,_.replaceExpiredRepliedMessageWithPlaceholder)(t,e),s.detachMessages(e))},updateState(e,t){l().updateState(e,t)},updateBanner(e){I.renderPeer(e)},updateHeader(e){i.renderPeer(e)},updateChat(e,t){e.get().peer===t&&(i.changeActions(e),i.renderPeer(e),i.renderActions(e),I.renderPeer(e),s.updateState(e),(0,n.updateMentions)(e.get()))},updateConvoInList(e,t){l().updateConvoInList(e,t)},focustTxt(e){s.focusOn(e)},startSearch(e){e.get().peer&&(r().showSearch(e),g.changePeer(e.get().peer,e),g.search())},showSearch(e){(0,o.addClass)(t,"im-page--hisory_search-open"),e.setState({searchShown:!0}),Ue(e)&&this.updateChatTopic(e.get().peer,e),this.cancelEditing(),setTimeout((()=>g.focus(e)),10)},cancelSearch(e){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.get().searchShown&&((0,o.removeClass)(t,"im-page--hisory_search-open"),(0,o.removeClass)(t,"im-page--history_search"),(0,o.removeClass)(t,"im-page--history_search-empty"),e.setState({searchShown:!1}),Ue(e)&&this.updateChatTopic(e.get().peer,e),i.changedMessageSelection(e)),s&&!(0,_.isReservedPeer)(e.get().peer)&&P){var l=e.get().tabs[e.get().peer],c=(0,n.strHistory)(l.history);c?$e(t).innerHTML=c:r().showEmptyScreen(),yt(e,a,t),a.scrollBottom(0),e.get().msgid&&(st(a,t,e.get().msgid,e),ct(e,t),dt(e,t)),C(a),T.reset(a)}P&&(P.unmount(),P=!1,(0,re.ensureDomHasActions)(t))},showEmptyScreen(){var e=(0,o.geByClass1)("_im_peer_history",t);(0,o.addClass)(t,"im-page--history_empty-hist");var a=(0,se.renderHistoryStub)(w);(0,o.val)(e,a)},updateHistory(e){0!==w.get().peer&&e(t)},focusOnMessage(){st(a,t,w.get().msgid,w)},sendEditMessage(e,t){e.set(n.deliverEditedMessage.bind(null,(0,m.getTab)(e,t.peerId),t)).catch((a=>e.get().longpoll.push([(0,D.failedMessage)(t.peerId,t,a)])))},renderStickersPanel(e){var a=(0,d.getPeer)(e),i=(0,m.getTab)(e,a);if(i&&!(i.block_error&&i.block_error>0)){var s=(0,n.strHistory)(i.history||""),r=t.querySelector("._im_stickers_panel_placeholder");if(r&&!s){var l=(0,se.prepareEmptyDialogStickersTemplate)(e);(0,o.domReplaceEl)(r,l)}}},deselectAll(e){i.deselectAll(e)},unmount(){(0,b.destroyModule)(e),a.destroy(),clearInterval(S),s.unmount(),i.unmount(),v.unmount(),f.unmount(),g.unmount(),T.unmount(),cancelStackFilter("forward"),L.unmount(),null==k||k.unmount(),function(e,t){(0,B.removeDraggable)((0,o.geByClass1)(e,t))}("_im_chat_resize_track",t),M.destroy()},removePeer(e,t){l().removePeer(e,t)},restoreScroll(e,t){var n=e.get().tabs[t];n.scrollBottom?Qe(n,a):a.scrollBottom(me)},resendMessage(e,a){e===w.get().peer&&(0,_.startResendMessage)(e,a,t)},resendPeer(){s.resendPeer()},resendAll(){s.resendAll()},respond(e,t){s.attachMessages(e,t),s.focusOn(e);var n=(0,m.getTab)(e,t);n&&!n.skipped&&(a.scrollBottom(me),C(a))},restoreDialogs(e,t,a){l().restoreDialogs(e,t,a)},cancelRecording(){s.cancelRecording()},flushDraft(e){s.saveText(e)},hideError(){(0,o.geByClass1)(ve,t).classList.remove(fe)},showError(e){var n=(0,o.geByClass1)(ve,t);n.innerHTML=e,n.classList.add(fe),a.scrollBottom(me)},startEditing(e){if((0,n.isAnythingLoading)(w.get()))(0,_.showWaitUntilUploadedBox)();else{e=(0,m.parserMessage)(e);var a=(0,_.getNowEditingMessage)(w);if(!(s.isBlocked()||a&&a.messageId==e.messageId)){a&&this.cancelEditing(),At(t),w.get().searchShown&&this.cancelSearch(w);var r=We(t,e.messageId);r&&(this.cancelRecording(),function(e,t,a,n,i){e.setState({isEditing:!0}),a.saveText(e),(0,o.addClass)(n,"im-mess_is_editing"),(0,o.addClass)((0,o.geByClass1)("_im_page_history"),"is_msg_editing"),cancelStackPush("cancel_edit",(()=>Pt(e,t,a,n)));var s=new F.ImDraft;s.dData.txt=(0,N.convertEmojiHtmlToRegularText)(i.text),s.dData.attaches=(0,U.convertKludgesToAttaches)(i.kludges,i.messageId),a.toggleStickers(e,!1),a.setDraft(e,s),setTimeout((()=>a.focusOn(e)),0)}(w,t,s,r,e),s.hideKeyboard(),i.deselectAll(w))}}},cancelEditing(){var e=(0,_.getNowEditingMessage)(w);e&&Pt(w,t,s,We(t,e.messageId))},messageKeyboardButtonClick:e=>Ut(s,w,e),getEditingMessage:()=>(0,_.getNowEditingMessage)(w),focusEditingMessage(){var e=(0,_.getNowEditingMessage)(w);e&&st(a,t,e.messageId,w),s.focusOn(w)},setNetworkWaitingStatus(e,t){i.setNetworkWaitingStatus(e,t)},setNetworkReconnectingStatus(e){i.setNetworkReconnectingStatus(e)},clearNetworkStatus(){i.clearNetworkStatus()},updateCasperMessageStatus(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,_.isFullyLoadedTab)(w.get(),e.peerId)&&w.set(n.updateCasperMessageExpiringStatus.bind(null,e,a)).then((()=>{w.get().peer===e.peerId&&(0,_.setCasperMessageExpiringStatusDOM)(t,a,e.messageId)}))},updateObserver(){L.update(),null==k||k.update()},updateFolderCounters(e){l().updateFolderCounters(e)},renderPeerProfile(e){M.render(e)},destroyPeerProfile(){M.destroy()}}}function Kt(e,t,a,g,f){var E=(0,o.geByClass1)("_im_peer_history_w",e);(0,V.hasAccessibilityMode)()&&(0,o.addClass)(E,"history_a11y");var A,x,O,R=(0,b.createMutations)(qt),N=R.callMutations,F=R.bindMutations,U=(A=Xe.bind(null,t),x=(0,G.debounce)(A,100),O=(0,p.throttle)(A,100),e=>{x(e),O(e)}),j=(0,P.mount)(t,e),q=at.bind(null,t,N,E,U,j,e),ee=(0,k.createScroll)((0,o.geByClass1)("_im_chat_body_abs",e),{onScroll:function(){q(...arguments),(0,z.partConfigEnabled)("mail_history_mention_popover")&&window.reforgedME&&window.reforgedME.profileInfo&&window.reforgedME.profileInfo.mountProfileInfo(null)},nativeScroll:(0,_.isClassicInterface)(t),shadows:!1}),te=(0,_.isClassicInterface)(t)?void 0:ee.scroll.container,se=(0,I.mount)(t,te,(e=>function(e,t,a){var i=(0,u.getCurrentTab)(e);if(i){var s=a.reduce(((t,a)=>{if(a.isIntersecting){var n=+a.target.getAttribute("data-msgid")||+a.target.getAttribute("data-last-msgid"),s=(0,m.getMessage)(e,i.peerId,n);n&&s&&!(0,h.isOut)(s)&&t.push(n)}return t}),[]);if(s.length){var r=Math.max(...s);nt(e,r).then((()=>{r===i.lastmsg&&e.set((e=>(0,n.setActions)(e))).then((()=>t().updateActions(e)))}))}}}(t,N,e)),((e,t)=>(0,h.isUnread)(t,e))),de=(0,d.getLocalSettingsValue)(t,"transcript_auto_show")&&(0,p.unpackStore)(t).isASRSettingHintActive?(0,I.mount)(t,te,(e=>{var a,n,i,s,r,o,l,c=null!==(a=null===(n=cur)||void 0===n||null===(i=n.imDb)||void 0===i||null===(s=i.selectByKey)||void 0===s?void 0:s.call(i,"shown_asr_hints"))&&void 0!==a?a:[];e.forEach((e=>{if(e.isIntersecting){var a=Number(e.target.dataset.msgid||e.target.dataset.lastMsgid);c&&!c.includes(a)&&e.target.querySelector(`.${Oe}`)&&(c.length+1<3?c.push(a):(t.set((e=>(e.isASRSettingHintActive=!1,Promise.resolve(e)))),(0,ce.hideHelpHint)("im:transcript_autoshow_setting"),de.unmount(),c=void 0))}})),null===(r=cur)||void 0===r||null===(o=r.imDb)||void 0===o||null===(l=o.updateByKey)||void 0===l||l.call(o,"shown_asr_hints",c)}),h.isAudioMsg):void 0,ue=(0,y.mount)((0,o.geByClass1)("_im_dialog_actions",e),t,N);setTimeout((function(){var a=t.get().peer;if(a){if(kt(t),((0,u.getCurrentTab)(t).pinned||(0,u.getCurrentTab)(t).top_banner)&&(N().updateChatTopic(a,t),t.set(n.setActions),ue.changeActions(t)),(0,u.getCurrentTab)(t).callInProgress&&N().updateBanner(t),t.get().msgid)st(ee,e,t.get().msgid,t);else if(!it(ee,e,N,t,j)){ee.scrollBottom(me);var i=(0,u.getCurrentTab)(t);(0,_.isTabMarkedUnread)(i)&&t.set((e=>(0,n.markDialogRead)(i.peerId,e)))}t.get().history_init=!1,(0,m.isCasperChat)(t,a)?j.disable():j.reset(ee),ct(t,e),dt(t,e),at(t,N,E,U,j,e,0,ee),(0,re.ensureDomHasActions)(e),nav.objLoc.st&&(t.mutate(n.setInplaceSearch.bind(null,nav.objLoc.st,a)),N().startSearch(t)),window.nav.objLoc.open_settings&&(ue.showSettings(t),delete window.nav.objLoc.open_settings,window.nav.setLoc(window.nav.objLoc))}else j.disable()}),15);var _e=(0,w.mount)((0,o.geByClass1)("_im_text_input",e),t,(0,_.isClassicInterface)(t)?g.updateMenu:void 0,((e,t)=>{a.removeDialog(e,t),a.restoreDialogs(e,!0)}),N),ge=(0,C.mount)((0,o.geByClass1)("_im_dialog_actions",e),t,N),fe=(0,S.mount)(e,t,N),be=(0,T.mount)(e,t,(()=>({changedMessageSelection:ue.changedMessageSelection}))),ye=(0,L.mount)(E);(0,M.mount)(e,t,N);var Te=(0,H.mount)(e,t,(()=>({hidePinned(){(0,M.pinnedMessageHide)(t,t.get().peer,N,!1)},compensateHistoryHeightChange(e){N().compensateHistoryHeightChange(e)},showPinned(){(0,M.pinnedMessageUnHide)(t,t.get().peer,N,!1)},showMessageRequestRejectDialog(t){!function(e,t,a,i,s){var r=(0,ne.getLang)("mail_mr_reject_confirmation"),l=(0,Q.oCacheGet)(e,s),c=`<div class="checkbox _im_is_spam_checkbox" onclick="checkbox(this);" role="checkbox" aria-checked="false">${(0,ne.getLang)("mail_report_as_spam")}</div>`,d=l?l.first_name_gen:"",u=(0,Z.showFastBox)((0,ne.getLang)("mail_message_request_reject_request"),r.replace("{name}",d),(0,ne.getLang)("mail_message_request_reject"),(()=>{var r=(0,J.isChecked)((0,o.geByClass1)("_im_is_spam_checkbox"),t),l=r?(0,ne.getLang)("mail_message_request_rejected_and_spam"):(0,ne.getLang)("mail_message_request_rejected");e.set((e=>(0,n.rejectMessageRequest)(s,r,e))).then((e=>{(0,_.isClassicInterface)(e)&&i.updateMenu(e),a.removeDialog(e,s),a.restoreDialogs(e,!0),s===e.get().peer&&e.get().longpoll.push([(0,D.resetPeer)()]),(0,_.hideAllBoxes)(),(0,X.showNotification)({text:l})})).catch((e=>{(0,_.hideAllBoxes)(),(0,p.showErrorBox)(e)}))}));u.setControlsText(c)}(t,e,a,g,t.get().peer)},showBusinessNotifyDialog:lt})));(0,_.isReservedPeer)(t.get().peer)||t.set((e=>(0,oe.restoreHistoryQueue)(e,t.get().peer))).then((()=>{(0,oe.restoreQueuedMessagesInDom)(t.get(),t.get().peer,$e(e)),ze(e,t,t.get().peer)})),Nt(t,N),function(e,t,a){var n,i,s=(0,o.geByClass1)(e,t);(0,B.initDraggable)(s,{onStartDrag:(e,t)=>{(0,o.addClass)(bodyNode,"cursor_ns_resize"),n=t,i=t},onDrop:()=>{(0,o.removeClass)(bodyNode,"cursor_ns_resize")},onDrag:(e,s)=>{var r=qe(i-n+s,t);(0,_.setClassicChatHeight)(r),a().fixHeight()}})}("_im_chat_resize_track",e,f);var Ie=mt.bind(null,t,e,N),xe=pt.bind(null,t,e,ee,N),Re=e=>{(0,s.cancelEvent)(e),function(e,t){e().showCreation(t)}(f,t)},Ne=ft.bind(null,N,t,e,ee),Fe=bt.bind(null,N,t,e,ee),Ue=Ye.bind(null,t,e),He=_.showEditTimeTooltip.bind(null,t),je=_.showMessageInfoTooltip.bind(null,t),We=ot.bind(null,t,Ie,e,N),Qe=Ve.bind(null,t,e,ee),Ze=It.bind(null,N,t,ee),Je=Lt.bind(null,t),et=Mt.bind(null,t,N),tt=Bt.bind(null,t,N,e),ut=Ut.bind(null,_e,t),_t=Ge.bind(null,N),gt=_.showCasperExpiringTooltip.bind(null,t,e),ht=$.widgetDoAction.bind(null,t),vt=()=>(0,r.showWiki)({w:"expired_messages"}),yt=Ht.bind(null,t),wt=e=>function(e,t){var a=t.target.closest("."+ke),n=a.closest("."+Me),i=a.dataset.link,s=+n.dataset.peer;(0,_.isCallToPeerAvailable)(e,s)&&(0,_.joinCallFromIm)(e,s,i,!1,_.CALL_ENTRY_POINT_JOIN_SNIPPET)}(t,e),Et=jt.bind(null,t,e),St=e=>function(e,t){var a=t.target.closest("._im_subscribe_button"),n=(0,d.getPeer)(e);if(!ae.FlatButton.isLocked(a)&&n){var i=e.get().tabs[n].is_subscribed;ae.FlatButton.lock(a),e.set((e=>(0,ie.setPeerSubscribedStatus)(n,i,e))).then((e=>{var t=(0,p.unpackStore)(e).tabs[n].is_subscribed,i=t?(0,ne.getLang)("mail_friend_request_sent"):(0,ne.getLang)("mail_add_to_friends"),s=t?ae.FlatButtonAppearance.SECONDARY:ae.FlatButtonAppearance.PRIMARY;ae.FlatButton.unlock(a),ae.FlatButton.setAppearance(a,s),ae.FlatButton.setLabel(a,i)})).catch((()=>{ae.FlatButton.unlock(a)}))}}(t,e),Tt=e=>{var t=(0,o.domClosest)(De,e.target);if(t){var a=(0,o.domClosest)(_.MESSAGE_STACK_CLASS,t),n=parseInt((0,o.domData)(a,"peer"),10)||null;window.reforgedME&&window.reforgedME.profileInfo&&n&&window.reforgedME.profileInfo.mountProfileInfo({peerId:n,targetElement:t})}},Pt=(0,b.createModule)({handlers:(a,r)=>{r(e,"click",_.RESTORE_CLASS,xe),r(e,"mouseover click",_.FAILED_CLASS,Ue),r(e,"mouseover","_im_edit_time",He),r(e,"mouseover","_im_page_info",je),r(e,"click","_im_mess_susp",Ke.bind(null,e)),r(e,"click","_im_failed_action",We),r(e,"click","_im_mess_link",Qe),r(e,"mouseover","_im_admin_name",Ct),r(e,"mouseover",we,Je),r(e,"mouseover","im-mess-stack--bomb",gt),r(e,"mouseover","mem_pseudolink",(e=>function(e,t){var a=e.target.dataset.mention,n=null;switch(!0){case c.MASS_MENTION_ALIASES.all.includes(a):n=(0,ne.getLang)("mail_im_mention_all");break;case c.MASS_MENTION_ALIASES.online.includes(a):n=(0,ne.getLang)("mail_im_mention_online")}n&&(window.tooltips&&window.tooltips.destroy(e.target),(0,K.showTooltip)(e.target,{shift:[0,5],center:!0,black:1,className:"im-mass-mention-tt",reverseOffset:!0,toup:e.target.getBoundingClientRect().top>(0,_.getHistoryTopIndent)(t)+37,text:n,noZIndex:!0}))}(e,t))),r(e,"mouseover",Pe,Et),r(e,"mouseover",Be,Ft),r(e,"click",_.MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON,_.onASRCollapseToggleClick),r(e,"click",Oe,(()=>{f().openSettings()})),r(e,"click",Ce,et),r(e,"click",ve,_t),r(e,"click",Se,tt),r(e,"click","_im_replied_author_link",xt),r(e,"click","_chat_invitation",((e,a)=>{if((0,s.checkEvent)(e))return!0;if(!(0,o.gpeByClass)("wall_postlink_preview_btn",e.target)&&!(0,o.hasClass)(e.target,"wall_postlink_preview_btn"))return!0;var i=(0,o.geByClass1)("flat_button",a),r={invite_chat_id:(0,o.domData)(i,"inv-id"),invite_hash:(0,o.domData)(i,"hash")};(0,_.showInvitationBox)(t,r,n.leaveInvitation),(0,s.cancelEvent)(e)})),r(e,"click","_im_join_call_by_link",_.handleCallLinkClick),r(e,"click","_im_join_cancel",(()=>t.get().longpoll.push([(0,D.resetPeer)()]))),r(e,"click","_im_retry_media",(e=>function(e,t,a){var i=e.get(),s=(0,o.domClosest)(Ee,a.target),r=(0,o.domData)(s,"msgid"),c=(0,m.getMessage)(i,i.peer,r),d=e=>t().replaceAttachmentPlaceholders(e,c);c&&((0,l.statlogsSendingRetry)("retry_attach"),e.set(n.addAttachmentsToStoreData.bind(null,c,[(0,le.renderMessageMedia)(c)])).then(d),e.set(n.loadMedia.bind(null,c)).then(d))}(t,N,e))),r(e,"click",_.MESSAGE_KEYBOARD_BUTTON_CLASS,ut),r(e,"click",Le,yt),r(e,"click",ke,wt),a((0,o.geByClass1)("_im_peer_history_w",e),"mousemove",j.show),a((0,o.geByClass1)("_im_start_new",e),"click",Re),a(e.querySelector(pe),"click",Ne),a(e.querySelector(he),"click",Fe),r(e,"click",Ae,St),a((0,o.geByClass1)("_im_cancel_edit",e),"click",(()=>(N().cancelEditing(),!1))),a((0,o.geByClass1)("_im_edit_focus_cur",e),"click",(()=>(N().focusEditingMessage(),!1))),v.screenfull.raw&&a(document,v.screenfull.raw.fullscreenchange,Ze),a(window,"im_goToMessage",(e=>{var a=(0,W.intval)(e.msgid);if(a)return(0,i.statlogsValueEvent)("im_links_to_attachments",1,"to_message"),t.set(n.changePeer.bind(null,e.sel,a,!1)).then((()=>(0,_.focusOnMessage)(t,N().focusOnMessage,t.get().peer,a)))})),r(e,"click","im-expired-message--in",vt),r(e,"click",$.WIDGET_ACTIONS,ht),r(e,"click","scroll-buttons--container",$.onWidgetScrollButtonClick),r(e,"scroll","scrolling-wrapper-flexbox",$.widgetDoScroll,!0),(0,$.updateWidgetScrollButtons)(),(0,z.partConfigEnabled)("mail_history_mention_popover")&&r(e,"mouseover",De,Tt)}});curNotifier.recvClbks.pin_hide=[function(e){e.hide?(0,M.pinnedMessageHide)(t,e.peer,N,!1):(0,M.pinnedMessageUnHide)(t,e.peer,N,!1)}],window.showForwardBox=e=>function(e,t){(0,_.applyMessageHandlers)((0,Z.showBox)("al_im.php",t,{params:{width:638,bodyStyle:"padding: 0px",containerClass:"im-show-message-box"},dark:1},{}),e)}(t,e);var At=setInterval(rt.bind(null,t,e,ue),1e4);(0,d.getPeer)(t)===c.VK_OFFICIAL_PEER_ID&&(0,Y.collectOnboardingFindFriendsShowStats)(t.get().viewer_id);var Dt=(0,d.getPeer)(t),Ot=(0,m.getTab)(t,Dt);return Ot&&(0,u.tabIsMessageRequest)(Ot)&&(0,Y.collectOpenMessageRequestStats)(Dt),F(Pt,e,ee,ue,_e,N,f,ge,fe,be,q,t,U,At,j,Te,se,ye,de)}},844075:(e,t,a)=>{"use strict";a.d(t,{mount:()=>f});a(940851),a(296253);var n=a(610124),i=a(695724),s=a(315544),r=a(49535),o=a(609720),l=a(454593),c=a(533304),d="im_hist_search";function u(e,t,a,i,s,r){return{focus(e){uiSearch.focus(t),function(e,t,a,n){cancelStackPush(d,h.bind(null,e,t,a,n))}(e,t,a,i)},changePeer(e,a){uiSearch.getFieldEl(t).value=a.get().tabs[e].searchText||""},search(){r({})},unmount(){(0,n.destroyModule)(s),cancelStackFilter(d),i.then((e=>e.destroy()))}}}function _(e,t,a,n){e.set(l.setCurrentSearchDate.bind(null,e.get().peer,`${n.d}.${n.m}.${n.y}`)).then(m.bind(null,e,t,a))}function g(e,t){e.then((e=>{(0,r.triggerEvent)((0,s.geByClass1)("datepicker_control",t),"mousedown",!1,!0)}))}function m(e,t,a){var n=e.get().peer;uiSearch.showProgress(a),(0,l.searchMessagesInplace)(n,e.get()).then((n=>{uiSearch.hideProgress(a),t().insertSearch(n,e),(0,c.updateCounters)(location.href,document.referrer)})).catch((()=>{uiSearch.focus(a),uiSearch.hideProgress(a)}))}function p(e,t,a,n,s,r){if("keyup"!==r.type||13==r.which){var o=(0,i.clean)(uiSearch.getFieldEl(t).value);e.set(l.setCurrentSearch.bind(null,o,e.get().peer)).then(s.bind(null,e,n,t))}}function h(e,t,a,n){cancelStackFilter(d),n.then((e=>{e.hide()})),e.set(l.cancelSearch.bind(null,e.get().peer)).then((()=>{uiSearch.getFieldEl(t).value="",a().cancelSearch(e)}))}function v(e,t,a,n){a.then((e=>{e.hide()})),e.set(l.clearDate.bind(null,e.get().peer)).then(m.bind(null,e,t,n))}function f(e,t,a){var i=(0,s.geByClass1)("_im_search_date_input",e),r=(0,s.geByClass1)("_im_search_history_input",e),l=function(e,t,a,n){var i='<td class="cal_clear" colspan="7"><button type="button" class="im_cal_clear_lnk _im_clear_date">'+getLang("wall_clear_date_filter")+"</button></td>";return new Promise((e=>{window.stManager.add(["ui_controls.js",window.jsc("web/datepicker.js"),"datepicker.css"],(function(){var t=new Datepicker(a,{width:140,resfmt:"plain",addRows:'<tr id="im_day_clear">'+i+"</tr>",addRowsM:'<tr id="im_month_clear">'+i+"</tr>",onUpdate:n,pastActive:!0,noFuture:!0});e(t)}))}))}(0,0,i,_.bind(null,t,a,r)),c=g.bind(null,l,e),d=p.bind(null,t,r,i,a,(0,o.debounce)(m,300)),f=h.bind(null,t,r,a,l),b=v.bind(null,t,a,l,r),y=(0,n.createModule)({handlers:(t,a)=>{t((0,s.geByClass1)("_im_search_date",e),"click",c),t(uiSearch.getFieldEl(r),"keyup",d),t((0,s.geByClass1)("_im_start_inplace_search",e),"click",d),t((0,s.geByClass1)("_im_cancel_inplace_search",e),"click",f),a(e,"click","_im_clear_date",b)}});return u(0,r,a,l,y,d)}},907319:(e,t,a)=>{"use strict";a.d(t,{mount:()=>L});var n=a(454593),i=a(695724),s=a(315544),r=a(597903),o=a(294940),l=a(104837),c=a(610124),d=a(412947),u=a(376852),_=a(663825),g=a(983813),m="_im_mess_fav",p="_im_mess_reply",h="_im_mess_forward",v="_im_mess_edit";function f(e,t,a,n,i){var s=(0,r.getHistoryTopIndent)(e);(0,u.showTooltip)(t,{shift:[a,10],black:1,className:"_im_history_tooltip "+n,appendParentCls:"_im_mess_stack",toup:t.getBoundingClientRect().top>s+37,text:i})}function b(e,t,a){var r=(0,s.gpeByClass)("_im_mess",a),c=(0,i.intval)((0,s.domData)(r,"msgid")),d=e.get().peer,u=(0,l.getMessage)(e,d,c),g=!(0,o.isImportant)(u);return e.get().longpoll.push([{peerId:d,messageId:c,type:g?_.SET_FLAGS:_.RESET_FLAGS,flags:_.FLAG_IMPORTANT}]),e.set(n.favMessage.bind(null,[c],g,d)),y(e,-10,t,a,!0),!1}function y(e,t,a,n,i){var r=(0,s.domData)((0,s.gpeByClass)("_im_mess",n),"msgid"),c=(0,l.getMessage)(e,e.get().peer,r),d=getLang("mail_im_unmark_important"),u=getLang("mail_im_toggle_important"),_=(0,o.isImportant)(c)?d:u,g=_.length>16;i&&window.tooltips&&tooltips.destroy(n),f(e,n,g?84:34,g?"im-star-tt_long":"im-star-tt",c?_:"")}function w(e,t,a,i){var o=e.get().peer,l=+(0,s.domData)((0,s.domClosest)("im-mess",i.target),"msgid");if((0,r.canForwardMessages)(e,[l]))return(0,d.statlogsForwardFromChannel)(),(0,n.processFwd)([l],o,e).then((t=>e.set(n.prepareForward.bind(null,t)))).then((()=>{(0,g.mount)(a,e)})),!1}function C(e,t,a){var i=e.get().peer,r=+(0,s.domData)((0,s.domClosest)("im-mess",a.target),"msgid");return(0,n.processFwd)([r],i,e).then((t=>e.set(n.forwardMessages.bind(null,t,e.get().tfdraft,!0)))).then((()=>t().respond(e,i))),!1}function E(e,t,a,n){f(e,n,18,"im-reply-tt",getLang("mail_im_mark_forward"))}function S(e,t,a,n){f(e,n,18,"im-reply-tt",getLang("mail_im_reply"))}function T(e,t,a,n){var r=(0,i.intval)((0,s.domData)((0,s.gpeByClass)("_im_mess",n),"msgid")),o=(0,l.getMessage)(e,e.get().peer,r);return o&&t().startEditing(o),!1}function I(e,t,a){f(e,a,18,"im-edit-tt",getLang("mail_im_edit"))}function L(e,t,a){var n=y.bind(null,t,0),i=b.bind(null,t),s=E.bind(null,t,0),o=w.bind(null,t,e.querySelector("_im_dialog_actions"),a),l=S.bind(null,t,0),d=C.bind(null,t,a),u=I.bind(null,t),_=T.bind(null,t,a),g=(0,c.createModule)({handlers:(t,a)=>{a(e,"click",m,i),a(e,"mouseover",m,n),a(e,"click",h,o),a(e,"mouseover",h,s),a(e,"click",p,d),a(e,"mouseover",p,l),a(e,"click",v,_),a(e,"mouseover",v,u)}});return function(e,t){return{markImportant(t,a,n){(0,r.updateStar)(t,a,e)},unmount(){(0,c.destroyModule)(t)}}}(e,g)}},802334:(e,t,a)=>{"use strict";a.d(t,{mount:()=>m});var n=a(254692),i=a(49535),s=a(454593),r=a(597903),o=a(645523),l=a(712439),c=a(610124);function d(e){return e.which||e.keyCode}function u(e,t,a){!a||inArray(d(a),n.UNPRINTABLE_KEYS)||(0,s.isSearchingInplace)(e.get().peer,e.get())||(0,r.isEditableFocused)()||a.ctrlKey||browser.mac&&a.metaKey||a.key&&1!==a.key.length||t.signal("printable",a)}function _(e,t,a){d(a)===n.ENTER&&e.signal(d(a),a)}function g(e,t,a,s){var l=d(s);if(!layers.visible){if(l>=49&&l<=57&&(s.ctrlKey||s.metaKey&&browser.mac)&&(0,r.isClassicInterface)(t))return function(e,t){var a=e.get().tabbedPeers[t];a&&e.get().longpoll.push([(0,o.changePeer)(a.peer,!1,!0,!0,"right_menu")])}(t,l-49),(0,i.cancelEvent)(s);inArray(l,n.UP_DOWN_CONTROLS)&&e.signal(l,s)}}function m(e,t){var a=browser.mozilla?"keydown":"keypress",n=(0,l.default)({signalTimer:!1}),i=u.bind(null,e,t),s=g.bind(null,t,e,n),r=_.bind(null,t,n),o=(0,c.createModule)({handlers:e=>{e(document,"keydown",s),e(document,"keyup",r),e(document,a,i)}});return{unmount(){(0,c.destroyModule)(o)}}}},885441:(e,t,a)=>{"use strict";a.d(t,{mount:()=>u});a(940851),a(296253);var n=a(667294),i=a(973935),s=a(92946),r=a(863729),o=a(610124),l=a(454593);function c(){return document.getElementById("_im_keyboard_container")}function d(e,t,a){return{init(){return new Promise((e=>{this.isMounted=!0,function(e,t,a){var o=c();if(o){var l=n.createElement(r.default,{value:e},n.createElement(s.default,{send:t}));i.render(l,o,a)}}(t,a,e)}))},toggle:(e,a,n)=>t.set(l.toggleKeyboard.bind(null,e,a,n)),unmount(){var t=c();t&&this.isMounted&&i.unmountComponentAtNode(t),this.isMounted=!1,(0,o.destroyModule)(e)}}}function u(e,t,a,n,i){return(0,(0,o.createMutations)(d).bindMutations)((0,o.createModule)({handlers:(e,t)=>{}}),t,n)}},19294:(e,t,a)=>{"use strict";a.d(t,{mount:()=>Oe});a(579665),a(95767),a(530522),a(66108),a(796409),a(175115),a(940851),a(820075),a(59357),a(21466),a(798184),a(176774),a(991181),a(296253),a(388416);var n=a(922136),i=a(40906),s=a(49535),r=a(486125),o=a(695724),l=a(315544),c=a(353702),d=a(914012),u=a(176651),_=a(258973),g=a(682886),m=a(283303),p=a(980309),h=a(722088),v=a(967181),f=a(826338),b=a(610124),y=a(445637),w=a(13810),C=a(663825),E=a(507212),S=a(772274),T=a(493913),I=a(773023),L=a(28238),M=a(982452),k=a(104837),P=a(294940),A=a(454593),D=a(412947),B=a(597903),x=a(254692),O=a(922163),R=a(802334),N=a(549892),F=a(968958),U=a(964876),H=a(588379),j=a(582744),q=a(609720),K=a(19331),W=a(375053),G=a(645523),V=a(407381),z=a(499349),Y=a(459554),$=a(993421),Q=a(475234),Z=a(823908),X=a(352111),J=a(266372),ee=a(712860),te=a(954972),ae=a(730412),ne=a(179288),ie=a(917791),se=a(163612),re=a(412827),oe=a(376473),le=a(419672);function ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||de(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function de(e,t){if(e){if("string"==typeof e)return ue(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?ue(e,t):void 0}}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function _e(e,t,a,n,i){var s,r=new Map,o=new Map,c=new Map,d=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=de(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw i}}}}(i);try{for(d.s();!(s=d.n()).done;){var u=s.value;r.has(u.peerId)||r.set(u.peerId,new Set),r.get(u.peerId).add(u.messageId);var _=(0,k.getMessage)(e,u.peerId,u.messageId);_&&o.set(u.messageId,_.chat_local_id),c.set(u.messageId,u)}}catch(e){d.e(e)}finally{d.f()}r.forEach(((i,s)=>{var r=[...i],d=(0,k.getTab)(e,s),u=d&&!d.offset,_=d&&d.inplaceSearch&&!!d.searchOffset;e.set(A.removeMessages.bind(null,r,s)).then((()=>e.set(A.removeMessagesMarkDeleted.bind(null,r,s)))).then((()=>{if(e.get().peer===+s&&(0,B.isFullyLoadedTab)(e.get(),s)){var a=(0,k.getTab)(e,s);t.removeMessages(r,+s,e);var n=a.inplaceSearch;if(!a.offset&&!u&&((0,A.setActions)(e.get()),t.updateActions(e),n||t.showEmptyScreen()),n&&_&&!a.searchOffset&&(t.showSearchResults(),browser.safari)){var i=(0,l.geByClass1)("_im_peer_history_w");i.style.display="none",setTimeout((()=>i.style.display=""),0)}}})).then((()=>{var i=(0,k.getTab)(e,s);if(i){var l=r.some((e=>e>=i.lastmsg)),d=(0,K.partConfigEnabled)("me_web_read_by_cmid")?r.filter((e=>{var t=o.get(e);return t&&t>i.in_up_to_cmid&&!(c.get(e).flags&C.FLAG_OUTBOUND)})):r.filter((e=>e>i.in_up_to&&!(c.get(e).flags&C.FLAG_OUTBOUND)));l?(0,A.loadActualLastMessage)(e,+s).then((()=>{a.promoteDialog(e,s),n&&n.updateCounter(e,s),s===(0,$.getPeer)(e)&&(t.updateGoToEnd(e,!0),t.updateGoToMention(e,!0))})):d&&(0,V.removeDeletedUnreadMsgsFromTab)(s,d,e.get()).then((()=>a.updateDialog(s,e)))}}))}))}function ge(e,t){"spam"===t?(0,B.showSpamLayer)(e,S.mount,{}):"fav"===t&&(0,B.showFavvedBox)(e,{},O.mount,{})}function me(e,t,a,n,i){e.forEach((e=>{switch(e.kludges.source_act){case B.CHAT_PHOTO_REMOVE:case B.CHAT_PHOTO_UPDATE:!function(e,t,a,n){t.set(A.updateChatPhoto.bind(null,e)).then((()=>{var i=e.kludges.source_act;a.updateDialog(e.peerId,t),n.updateChatPhoto(e,i,t)}))}(e,t,a,n)}}))}function pe(e,t){var a=e.get().longpoll.push.bind(null,[(0,G.resetPeer)()]),n=()=>{var i=e.get().selectedMessages;i&&i.length?(e.setState({selectedMessages:[]}).then((()=>{t.changedMessageSelection(e),t.cleanSelection(i)})),setTimeout((()=>cancelStackPush("im_peer",n)),0)):a()};cancelStackPush("im_peer",n)}function he(e){var t=e.attaches.filter((e=>"sticker"!==e.type&&"call"!==e.type));return(0,P.isServiceMsg)(e)||0===t.length}function ve(e,t,a){(0,l.addClass)(a,"im-page_history-show"),t.loadingPeer(e)}function fe(e,t){var a=(0,B.getRightMenuMaxItems)(e,t.offsetHeight);if(e.get().tabbedPeers.length>a){var n=e.get().tabbedPeers.filter((t=>{var a=t.peer;return(0,o.intval)(a)!==e.get().peer})).map((t=>{var a=t.peer;return e.get().tabs[a]})).sort(((e,t)=>t.last_touched-e.last_touched)),i=[];0!==e.get().peer&&i.push(e.get().tabs[e.get().peer]);var s=i.concat(n).slice(a).map((e=>e.peerId)),r=e.get().tabbedPeers.filter((e=>!inArray(e.peer,s)));return e.set(A.updateTabbedPeers.bind(null,r,!0))}return Promise.resolve(e)}function be(){for(var e=(0,r.curBox)();e;)e.hide(),e=(0,r.curBox)()}function ye(e,t,a,n,i,s,r,o,l){e.get().audio_msg.isRecording&&e.set(A.cancelRecording).then((()=>{n.cancelRecording()})),AudioMessagePlayer.detachPlayer(),(0,k.isAnyMessageBeingEdited)(e)&&n.cancelEditing(),(0,k.isSearching)(e)&&t.cancelSearch&&(i.clearSearch(e),a.restoreDialogs(e),l().toggleSettingsButton(e,!1)),we(e,o,l),ve(e,n,s);var c=e.get().peer;(0,A.updateMentions)(e.get()),(0,B.isFullyLoadedTab)(e,t.peerId)&&(t.msgid&&!(0,k.getMessage)(e,t.peerId,t.msgid)||!t.msgid&&!(0,k.getMessage)(e,t.peerId,(0,k.getTab)(e,t.peerId).lastmsg)||(0,k.getTab)(e,t.peerId).skipped)&&e.mutate((e=>(0,k.makeTabNotFullyLoaded)(e,t.peerId)));var d=e.set(A.changePeer.bind(null,t.peerId,t.msgid,t.entryPoint)).then((e=>{var a=e.get();return a.tabs[t.peerId]?Promise.resolve(a):e.set((()=>(0,ie.loadPeer)(a,t.peerId,t.msgid,!0,!1,"applyPeer")))})).then((()=>{if(a.selectPeer(t.msgid,e),function(e,t){(0,B.isPendingForward)(e)&&(cancelStackFilter("forward"),e.set(A.forwardMessages.bind(null,e.get().pendingForward,(0,k.getTabDraft)((0,k.getTab)(e,t)),!1)))}(e,e.get().peer),window.tooltips&&tooltips.hideAll(),be(),n.preparePeer(e),pe(e,n),(0,B.isClassicInterface)(e)?(a.deactivate(),fe(e,s).then((()=>r.updateMenu(e))),(0,ae.updateFolderCounters)(e)):a.updateFolderCounters(e),!(0,B.isClassicInterface)(e)&&(0,Y.isRecommendedConvo)(e,t.peerId)&&(0,f.isUserPeer)(t.peerId)&&!(0,f.isContactPeer)(t.peerId)){var i=((0,k.getTab)(e,t.peerId)||{}).online||0,o=(0,B.convertLegacyOnlineToAPIFlags)(i),l=o.is_online,c=o.is_mobile;e.set((e=>(0,V.updateRecommendedListItemOnline)(e,t.peerId,l,c))).then((e=>{a.updateRecommendedOnline(t.peerId,e)}))}}));return(d=t.msgid?d.then((()=>e.set(A.selectPeerOnMessage.bind(null,t.peerId===c,c)))):d.then((()=>e.set((e=>(0,A.selectPeer)(!0,e)))))).then((()=>e.set(A.prepareCasperMessagesFromMessages.bind(null,t.peerId)))).then((()=>{if(e.get().peer===t.peerId){if(t.forward){var a=e.get().tabs[e.get().peer];if(!a.scrollBottom&&a.unread)((0,K.partConfigEnabled)("mail_history_unread_counter_observer")?Promise.resolve():e.set(A.readLastMessages.bind(null,e.get().peer))).then((()=>e.set(A.setActions))).then((()=>n.updateActions(e)));else!a.unread&&(0,k.isTabMarkedUnread)(a)&&e.set((e=>(0,A.markDialogRead)(t.peerId,e)))}(0,B.isClassicInterface)(e)&&r.updateMenu(e),n.changePeer(e,!1),n.updateTyping(t.peerId,e),n.removeExpiredFailedMessages(t.peerId),(0,K.partConfigEnabled)("mail_history_unread_counter_observer")&&n.updateObserver(),(0,A.updateMentions)(e.get())}})).catch((e=>(0,F.imWeirdCatch)("applyNewPeer",e)))}function we(e,t,a){t&&e.get().shown&&(t.hide(e),a().createCanceled(e))}function Ce(e,t,a){(0,k.isSearching)(e)&&(t.clearSearch(e),a.restoreDialogs(e))}function Ee(e,t,a,n,i,s,r){e.setState({isCreating:!0}),(0,B.isClassicInterface)(e)&&(i.saveScroll(e),s.saveScroll(e)),n.showCancelControl(),(0,l.addClass)(r,"im-page_creating"),a&&a.show(e,t),(0,B.isClassicInterface)(e)&&((0,l.setStyle)(r,{height:Ae(r,e).page}),setTimeout((function(){(0,l.addClass)(r,"im-page_cropped")}),200)),(0,A.toggleConversation)(!0)}function Se(e,t,a,n){(0,B.isTabLoaded)(e.get(),n)&&(t.updateTyping(n,e),a.updateTyping(n,e))}function Te(e,t,a,n,i){n.activityType||(n.activityType=i);var s=e=>Se(e,t,a,n.peerId);(0,B.isSelfMessage)(n.peerId,e.get().gid)||(e.set(A.setActivity.bind(null,n,i)).then(s),e.set(A.waitActivity.bind(null,n,i)).then(s))}function Ie(e,t,a){var n=(0,k.getTab)(a,(0,Y.getCurrentTab)(a));if(n&&!(0,Y.isBusinessNotifyTab)(n)){var i="im-page_reconnecting";t?e.classList.add(i):e.classList.remove(i)}}function Le(e,t,a,n,i){(0,k.isMessageRequestChangedEvent)(t)?function(e,t,a,n){var i=(0,Y.getCurrentTab)(e);switch(t.updateType){case C.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED:i&&i.peerId===t.updateArg&&e.get().longpoll.push([(0,G.changePeer)(t.peerId,!1,!1,!1,e.get().currentEntryPoint)]),e.set((e=>(0,A.deletedDialog)(t.updateArg,Promise.resolve([]),e))).then((()=>{a().removePeer(e,t.updateArg),a().updateDialogFilters(e)}));break;case C.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:var s=(0,k.getTab)(e,t.peerId);(!(0,K.partConfigEnabled)("simplified_start_conversation")||s&&(0,Y.tabIsNotImportantMessageRequest)(s)?e.set((e=>(0,A.updateMessageRequestsCounter)(t,e))):e.set((e=>Promise.resolve(e)))).then((()=>{s&&t.updateArg===C.MESSAGE_REQUEST_STATUS_REJECTED&&(0,V.updateListedConvos)(e.get(),s,!0,(e=>e.filter((e=>e!==Number(t.peerId)))))})).then((()=>{(0,B.isClassicInterface)(e)?(0,ae.updateFolderCounters)(e):n.updateFolderCounters(e),(0,B.checkMessageRequestsTab)(e,n.update),C.MESSAGE_REQUEST_STATUS_ACCEPTED===t.updateArg&&(0,B.isClassicInterface)(e)&&a().updateMenu(e),C.MESSAGE_REQUEST_STATUS_REJECTED===t.updateArg&&0===e.get().dialog_tabs[x.FOLDER_MESSAGE_REQUEST].length&&(0,k.isMessageRequestFolder)(e)&&e.get().longpoll.push([(0,G.changeTab)(x.FOLDER_ALL)])}))}}(e,t,a,i):(0,k.isBusinessNotifyChangedEvent)(t)?function(e,t,a,n){var i=e.set((e=>(0,V.resetFolderList)(e,ne.ConvoListFolder.BUSINESS_NOTIFY)));e.get().active_tab===ne.ConvoListFolder.BUSINESS_NOTIFY&&i.then((()=>e.set(A.loadDialogs))).then((()=>a().restoreDialogs(e,!0,!0)))}(e,0,a):(0,B.isTabLoaded)(e.get(),t.peerId)&&((0,U.handleEventChatUpdated)(e,t.peerId,t.updateType,t.updateArg,n,i)||!(0,B.isChatPeer)(t.peerId)||e.set((e=>(0,A.loadChatInfo)(t.peerId,e).then((e=>e.peer===t.peerId?(0,A.setActions)(e):Promise.resolve(e))))).then((()=>{a().updateChatInfo(t.peerId)})))}function Me(e,t,a){var n=null;if(a.kludges.keyboard&&!a.kludges.keyboard.inline){var i=Object.assign(a.kludges.keyboard,{author_id:a.userId});n=e.set(A.setKeyboard.bind(null,a.peerId,i))}else{var s=(0,k.getKeyboard)(e,a.peerId);s&&s.one_time&&s.author_id!==(0,P.getAuthorId)(e,a)&&(n=e.set(A.deleteKeyboard.bind(null,a.peerId)))}a.peerId===(0,$.getPeer)(e)&&n&&n.then(t.fixKeyboard)}function ke(e,t,a,n,s,c,d,u,_,g,m,p,f,y,w,E,S,T,I,L,O,R,F){var U=!1;return{changePeer(e,a){t.selectPeer(e,a)},cancelSearch(e){Ce(e,n,t)},loadingPeer(e){ve(e,a,s)},restoreDialogs(e,a,n){t.restoreDialogs(e,a,n)},showChatInvitationBox(e,a){(0,B.showChatInvitationBox)(e,a,_,t)},toggleSettingsButton(e,t){null==m||m.toggleButton(e,t)},focusSearch(e){n.focusInput()},appendSearch(e,a,n,i){t.appendSearch(e,a,n,i)},appendDialogs(e,a){t.appendDialogs(e,a)},showCreation(e,i){Ee(e,i,g,n,t,a,s)},updateState(e,n){t.updateDialog(e,n),n.get().peer===e&&a.updateChat(n,e)},updateConvoInList(e,a){t.promoteDialog(a,e)},appendFastDialogs(e,a){t.appendFastDialogs(e,a,!0)},createCanceled(e){n.hideCancelControl(),(0,B.isClassicInterface)(e)?((0,l.setStyle)(s,{height:"auto"}),(0,l.removeClass)(s,"im-page_cropped"),setTimeout((()=>n.focusInput()),0),0===e.get().peer?t.restoreScroll(e):a.restoreScroll(e,e.get().peer)):setTimeout((()=>{0===e.get().peer?n.focusInput():a.focustTxt(e)}),0),(0,l.removeClass)(s,"im-page_creating"),e.setState({isCreating:!1})},updateMenu(e){E&&E.updateMenu(e)},goToHistoryEnd(){a.goToEnd()},updateDialog(e,a){t.updateDialog(e,a)},updateRecommendationList(e){e.set(ee.updateConvoRecommendationList).then((e=>{(0,$.isRecommendationListRerenderNeeded)(e)&&t.updateRecommendationList(e)}))},setRecommendationListVisibility:e=>t.setRecommendationListVisibility(e),focusTxt(e){a.focustTxt(e)},resync(e){(0,k.isSearching)(e)&&n.clearSearch(e),t.restoreDialogs(e,!0,!0).then((()=>{(0,B.isClassicInterface)(e)||t.focusOnSelected(e)})),g&&g.hide(e),(0,B.isCommunityInterface)(e)&&e.get().tabbedPeers.forEach((t=>{var a=t.peer;E.updateCounter(e,a)})),(0,B.isClassicInterface)(e)?(e.get().tabbedPeers.forEach((t=>{var a=t.peer;E.updateCounter(e,a),E.updateName(a,e)})),(0,ae.updateFolderCounters)(e)):t.updateFolderCounters(e),a.cleanSelection(e.get().selectedMessages||[]),a.cancelSearch(e,!0),(0,B.isReservedPeer)(e.get().peer)||a.changePeer(e,!1),(0,X.updateUnreadCounter)(e)},toggleSettingsLoader(e,t){m.toggleLoader(e,t)},onUserActions(e,t){if(!(0,A.isSearchingInplace)(e.get().peer,e.get())){var n,i=e.get(),s=i.peer;if((0,B.isFullyLoadedTab)(i,s))if(!c.is_idle)if((0,k.countUnread)(e.get().peer,e.get())>0)if(!i.tabs[s].skipped&&a.isNewMessagesVisible(e))a.hideGoToEnd(!0),a.hideGoToMention(!0),(0,K.partConfigEnabled)("mail_history_unread_counter_observer")?(a.updateObserver(),n=Promise.resolve()):n=e.set(A.readLastMessages.bind(null,s)),n.then((()=>e.set(A.setActions))).then((()=>a.updateActions(e)))}},removeSelection(e){t.removeSelection(e),n.focusInput()},openSettings(){n.openSettings()},route(e,i,o,l){if(void 0!==e[0])return!0;e.box&&(e={box:e.box});var c=!1;return!!(e.mr||e.invite_chat_id&&o.invite_hash)||(l&&l.params&&"left_nav"===l.params._ref&&void 0===e.sel&&t.scrollUp(!0,!0),Object.keys(e).sort().forEach((e=>{switch(e){case"sel":o.q||(c=!0);var d=o.sel?(0,B.unUrlPeer)(o.sel):0,u=l.back;if(0===d)p.get().longpoll.push([(0,G.resetPeer)(!1,u)]);else if(d!==p.get().peer){var m="";l&&l.params&&l.params.entrypoint&&(m=l.params.entrypoint),p.get().longpoll.push([(0,G.changePeer)(d,o.msgid||!1,!1,!1,m)])}break;case"invite_chat_id":case"invite_hash":!function(e){e.set(A.leaveInvitation).then((()=>{e.get().longpoll.push([(0,G.resetPeer)(!1,!1)])}))}(p);break;case"tab":we(p,g,_),c=!0;var h=o.tab||x.FOLDER_ALL;p.get().longpoll.push([(0,G.changeTab)(h)]);break;case"act":o.act&&"create"===o.act?Ee(p,[],g,n,t,a,s):function(e,t,a,n){a&&a.hide(e,t)}(p,[],g);break;case"st":o.st&&o.sel?((0,r.curBox)()&&(0,r.curBox)().hide(),p.mutate(A.setInplaceSearch.bind(null,unescape(o.st),o.sel)),a.startSearch(p)):(p.mutate(A.cancelSearch.bind(null,i.sel)),a.cancelSearch(p,!0));break;case"q":o.q?((0,r.curBox)()&&(0,r.curBox)().hide(),n.setSearch(p,o.q,!0)):n.clearSearch(p);break;case"box":ge(p,o.box)}})),o.msgid&&(p.get().msgid=o.msgid,a.focusOnMessage()),(0,B.isClassicInterface)(p)&&void 0===e.sel&&E.updateMenu(p),c&&Ce(p,n,t),!1)},updateDialogFilters(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,k.isSearching)(e)||a||t.restoreDialogs(e),null==m||m.updateFilter(e)},removePeer(e,a){t.removeDialog(e,a),t.saveScroll(e),e.get().peer===a&&e.get().longpoll.push([(0,G.resetPeer)()]),(0,B.isClassicInterface)(e)&&E.updateMenu(e)},newMessage(e){(0,B.isClassicInterface)(e)||t.scrollUp(!0)},onQueueEvent(e,n){if(n.entity_type===v.EntityType.Online)e.set((e=>(0,A.updateOnline)(n.data.user_id,!!n.data.online&&n.data.platform,n.data.last_seen,e))).then((e=>{(0,B.isTabLoaded)(e.get(),n.data.user_id)&&(t.updateOnline(n.data.user_id,e),a.updateOnline(n.data.user_id,e)),(0,Y.isRecommendedConvo)(e,n.data.user_id)&&t.updateRecommendedOnline(n.data.user_id,e)}))},onEvents(e,r){var p=(0,G.compactCounterEvents)(r),v=r.filter(P.isServiceMsg),b=r.filter((e=>e.type===C.ADD_MESSAGE)),y=(0,A.checkNewPeople)(v,b,e),w=Promise.resolve();y.shouldLoad&&(w=e.set(A.loadNewPeople.bind(null,y,d))),w.then((()=>{me(v,e,t,a),p.forEach((r=>{switch(r.type){case C.ADD_MESSAGE:var d=r.peerId,p=(0,k.getTab)(e,d),v=!p||!p.msgs||0===p.msgs.length,b=(0,B.getMessageStoreStatus)(r,e.get()),y=(0,k.isCommunityBlocked)(e,r.peerId),w=p&&!p.lastmsg,S=p&&(0,Y.isChatConvo)(p)&&p.data.closed;switch(Me(e,a,r),(0,P.isCasperMessage)(r)&&j.casperMessagesStore.add(r),b){case B.MSG_NEW:e.set(A.addMessage.bind(null,r)),fe(e,s),function(e,t){var a=(0,M.unpackStore)(e),n=a.tabs[t.peerId],i=a.active_tab;return!(!n||!i)&&(!(i!==x.FOLDER_ALL||(0,Y.tabIsArchived)(n)||(0,Y.isBusinessNotifyTab)(n)||(0,k.tabIsMessageRequestToChat)(n))||(i===x.FOLDER_PEER_TAGS?(0,z.applyPeerTagsFilterToTab)(a,n):(0,A.filterFromTab)(i)(n)))}(e,r)&&((0,k.tabIsMessageRequest)(p)||(r.flags&C.FLAG_OUTBOUND||e.set(A.updateFavAndTitle.bind(null,r.peerId,!0)),function(e,t){var a=t.flags&C.FLAG_OUTBOUND,n=inArray(t.peerId,e.get().mutedPeers),s=t.flags&C.FLAG_DELETED,r=e.get().gid;if(!a&&!n&&!s){var l,c,d=function(e,t){return t<2e9&&e&&!e.match(/^\s*(Re(\(\d*\))?\:)?\s*\.\.\.\s*$/)}(t.subject,t.peerId)||"",u=(d?d+" ":"")+t.text||"",_=t.userId,g=t.peerId,m=e.get().tabs[g];if(t.kludges&&t.kludges.source_act&&(u=stripHTML((0,se.renderServiceMsg)(e,t,m.peerId,!1))),(!e.get().notify_msg&&!(0,B.isChatPeer)(g)||r&&!e.get().mute)&&window.Notifier&&Notifier.playSound({author_id:g}),!(0,B.isChatPeer)(g))return;u=(0,o.trim)((0,i.replaceEntities)(stripHTML(u.replace(/<br>/g,"\n").replace(/<\*>.*$/,"")))),u=(0,h.replaceMentions)(u,((e,t,a,n,i)=>i)),(0,B.isChatPeer)(g)?(l=(0,N.oCacheGet)(e,_).name,m.tab&&(l+=" » "+m.tab),c=(0,N.oCacheGet)(e,_).photo):(l=m.tab,c=m.photo);var p=t.attaches[0];if(p&&"mail"===p.type)u+="\n["+getLang("mail_added_msgs")+"]";else if(p){var v="doc"===p.type&&"graffiti"===p.kind?"graffiti":p.type;u+="\n["+getLang("mail_added_"+v)+"]"}l=(0,o.trim)((0,i.replaceEntities)(stripHTML((l||"").replace("&nbsp;"," ")))),window.Notifier&&Notifier.proxyIm({id:t.messageId,text:u,author_id:g,title:l,author_photo:c})}}(e,r)),t.updateTyping(r.peerId,e),(0,k.isSearching)(e)?t.updateDialog(r.peerId,e):t.promoteDialog(e,r.peerId));var T=(0,k.isCommunityBlocked)(e,r.peerId),I=p&&!p.offset,O=p&&(0,Y.isChatConvo)(p)&&!p.data.closed&&S;(y&&!T||w&&!I||O)&&(O&&(0,A.setActions)((0,M.unpackStore)(e)),a.updateActions(e)),(0,B.isClassicInterface)(e)?(E.updateCounter(e,r.peerId),E.updateMenu(e)):null==m||m.updateFilter(e),e.set(A.updateActivity.bind(null,r)).then(Se.bind(null,e,a,t,r.peerId)),a.addMessage(e,r),he(r)||!(0,B.isFullyLoadedTab)(e,r.peerId)||r.local||e.set(A.loadMedia.bind(null,r)).then((e=>{a.replaceAttachmentPlaceholders(e,r),(0,Z.videoAutoPlayHandler)()})),r.kludges.has_template&&e.set((e=>(0,A.addCarouselTemplateToStore)(r,e))).then((e=>{a.replaceBotCarouselPlaceholder(e,r)})),(0,D.statlogsSendingTimeStart)(e,r,"send","opt_to_lp");break;case B.MSG_LOCAL_DUPLICATE:he(r)||e.set(A.loadMedia.bind(null,r)).then((e=>{a.replaceAttachmentPlaceholders(e,r)})),e.set(A.replaceMessage.bind(null,r)),a.replaceMessageAttrs(r,e),t.updateDialog(r.peerId,e),e.get().active_tab===x.FOLDER_ALL&&(0,Y.isRecommendedConvo)(e,r.peerId)&&this.updateRecommendationList(e),r.randomId&&(0,D.statlogsSendingTimeEnd)(e,r,"send","opt_to_lp");break;case B.MSG_DUPLICATE:(0,k.isSearching)(e)||t.promoteDialog(e,r.peerId)}(0,k.tabIsMessageRequest)(p)&&(0,B.checkMessageRequestsTab)(e,t.update);var R=b===B.MSG_LOCAL_DUPLICATE&&1===p.offset||b===B.MSG_NEW&&w&&!r.local;(0,K.partConfigEnabled)("messenger_empty_pinned_support")&&R&&e.set((t=>(0,ie.loadPeer)(t,d,0,!1,!1,"emptyPinnedCrutch").then((t=>((0,V.updateListedConvos)(t,(0,k.getTab)(t,d),!1,(e=>(0,A.addDialog)(d,e,t)),((e,a,n)=>(0,A.shouldIncludeDialog)(t,e,a,n))),d===e.get().peer?(0,A.setActions)(t):t))))).then((e=>t.promoteDialog(e,d))),p&&v&&p.peerId===(0,$.getPeer)(e)&&L();break;case C.EDIT_MESSAGE:case C.REPLACE_MESSAGE:e.set(A.editMessage.bind(null,r)).then((e=>{if(Me(e,a,r),r.kludges.is_expired)return(0,B.removeExpiredMessageIfNeed)(r,a.handleMessageExpiration),void t.updateDialog(r.peerId,e);t.updateDialog(r.peerId,e),a.updateTyping(r.peerId,e),a.editMessage(e,r),he(r)||!(0,B.isFullyLoadedTab)(e,r.peerId)||r.local||e.set(A.loadMedia.bind(null,r)).then((e=>a.replaceAttachmentPlaceholders(e,r))),r.kludges.has_template&&e.set((e=>(0,A.addCarouselTemplateToStore)(r,e))).then((e=>{a.replaceBotCarouselPlaceholder(e,r)}))}));break;case C.INVALIDATE_MESSAGE:(0,A.reloadMessage)(r.messageId,e.get()).then((t=>{var a=(0,W.getMessageFromTuple)(t);return e.set((e=>(0,A.editMessage)(a,e))).then((()=>a))})).then((n=>{a.editMessage(e,n),t.updateDialog(n.peerId,e),!he(n)&&(0,B.isFullyLoadedTab)(e,n.peerId)&&e.set((e=>(0,A.loadMedia)(n,e))).then((e=>a.replaceAttachmentPlaceholders(e,n)))}));break;case C.READ_INBOUND:case C.READ_INBOUND_BY_CMID:e.set((e=>(0,A.markInboundMessagesAsRead)(r,e))).then((e=>{t.updateCounter(e,r.peerId),r.peerId===(0,$.getPeer)(e)&&(a.updateGoToEnd(e,!0),a.updateGoToMention(e,!0),a.updateObserver()),(0,B.isClassicInterface)(e)&&E.updateCounter(e,r.peerId),(0,k.isSearching)(e)||t.restoreDialogs(e),null==m||m.updateFilter(e)}));break;case C.READ_OUTBOUND:case C.READ_OUTBOUND_BY_CMID:e.set(A.markOutboundMessagesAsRead.bind(null,r)).then((e=>{t.updateCounter(e,r.peerId),a.markMessagesAsRead(e,r)}));break;case C.UNREAD_COUNT:var F;if(!(0,B.isCommunityInterface)(e))null===(F=window.TopMessenger)||void 0===F||F.setIsCounterOn(!(0,$.isTopCounterMuted)(e));e.set((e=>(0,Q.setUnreadCounters)(r,e))).then((()=>{null==m||m.updateFilter(e);var a=r.showOnlyNotMuted;a!==(0,$.getLocalSettingsValue)(e,"show_only_not_muted_messages")&&e.set((e=>(0,Q.setLocalSettingsValue)("show_only_not_muted_messages",a,e))),(0,K.partConfigEnabled)("mail_longpoll_unread_counter")||(0,X.updateUnreadCounter)(e);var n=Promise.resolve();r.businessNotifyUnread>0&&1===e.get().settings.business_notify_folder_hidden&&(n=e.set((e=>(0,Q.setLocalSettingsValue)("business_notify_folder_hidden",0,e))),(0,ie.toggleHideFolderHandler)((0,M.unpackStore)(e),ne.ConvoListFolder.BUSINESS_NOTIFY,!1)),n.then((a=>{(0,B.isClassicInterface)(e)?((0,ae.updateFolderCounters)(e),e.get().tabbedPeers.forEach((t=>{var a=t.peer;E.updateCounter(e,a)}))):t.updateFolderCounters(e)}))}));break;case C.SET_FLAGS:case C.REPLACE_FLAGS:case C.RESET_FLAGS:switch(!0){case Boolean(r.flags&C.FLAG_DELETED):case Boolean(r.flags&C.FLAG_SPAM):r.type!==C.SET_FLAGS||(0,B.isAlreadyDeleted)(e,r.peerId,r.messageId)||e.get().blockedFlagUpdates[r.peerId]||u(r);break;case r.flags===C.FLAG_IMPORTANT:var H=r.type===C.SET_FLAGS;e.set((e=>(0,A.updateImportant)(H?1:-1,r.messageId,e))),e.set((e=>(0,A.updateFavMessage)([r.messageId],r.peerId,H,e))).then((()=>{a.markImportant(r.messageId,H,e)}));break;case Boolean(r.flags&C.FLAG_AUDIO_MESSAGE_LISTENED):e.set((e=>(0,te.setMessageFlag)(e,r.peerId,r.messageId,C.FLAG_AUDIO_MESSAGE_LISTENED,!0))).then((e=>{var t=r.peerId,n=r.messageId,i=(0,k.getTab)(e,t);if((0,$.getPeer)(e)===t&&a.markMessageAsListened(e,t,n),i&&(0,B.isFullyLoadedTab)(e,t)){var s=(0,le.unpackHistory)(i.history);i.history=(0,B.updateListenedMark)(s,n)}}))}break;case C.RECORDING_AUDIO:Te(e,a,t,r,A.ACTIVITY_TYPE_RECORDING_AUDIO);break;case C.TYPING:Te(e,a,t,r,A.ACTIVITY_TYPE_TYPING);break;case C.NOTIFY_SETTINGS_CHANGED:!function(e,t,a,n){e.set(A.setMutedPeer.bind(null,a,n)).then(t().updateState.bind(null,a))}(e,_,r.peerId,!r.sound);break;case C.CONVO_MAJOR_ID_CHANGED:e.set((e=>{var t=r.peerId,a=r.majorId,n=(0,k.getTab)(e,t);return(a&&n?Promise.resolve(e):(0,ie.loadPeer)(e,t,0,!1,!1,"sortingChange")).then((e=>{var n=(0,k.getTab)(e,t);return n.major_sort_id=a,(0,V.updateListedConvos)(e,n,!1,(a=>(0,A.addDialog)(t,a,e)),((t,a,n)=>(0,A.shouldIncludeDialog)(e,t,a,n))),(0,A.setActions)(e),Promise.resolve(e)}))})).then((e=>{var n=r.peerId;(0,k.getTab)(e,n)&&!(0,k.isSearching)(e)&&t.promoteDialog(e,n),n===e.get().peer&&a.updateActions(e)}));break;case C.CONVO_MINOR_ID_CHANGED:e.set((e=>{var t=r.peerId,a=r.minorId,n=(0,k.getTab)(e,t);return n?(n.minor_sort_id=a,Promise.resolve(e)):Promise.resolve(e)})).then((e=>{var a=r.peerId;(0,k.getTab)(e,a)&&!(0,k.isSearching)(e)&&t.promoteDialog(e,a)}));break;case C.RESYNC:e.get().longpoll.pause(),e.set(A.resync).then(_().resync).then((()=>e.get().longpoll.resume()));break;case C.TRANSITION:f.transition(r.state);break;case C.RESET_PEER:if(r.removeActivePeer){var q=e.get().tabbedPeers.filter((t=>{var a=t.peer,n=t.type;return a!==e.get().peer&&"perm"===n}));e.setState({tabbedPeers:q})}!function(e,t,a,n){e.set(A.cancelRecording).then((()=>{a.cancelRecording()})),AudioMessagePlayer.detachPlayer(),t.removeSelection(e),(0,l.removeClass)(n,"im-page_history-show"),a.flushDraft(e),a.stopLoading(),a.destroyPeerProfile(),(0,k.isAnyMessageBeingEdited)(e)&&a.cancelEditing();var i=e.get().peer;e.set(A.changePeer.bind(null,0,!1,"")).then((()=>{window.tooltips&&window.tooltips.hideAll(),be(),(0,B.isClassicInterface)(e)&&t.activate(),a.changePeer(e),(0,B.isClassicInterface)(e)&&t.restoreScroll(e),setTimeout((()=>{e.get().longpoll.push([(0,G.transitionEvent)("search")])}),13),(0,B.isLocksAvailable)(e)&&(0,B.isPeerBlockedByMe)(i,e)&&e.set(A.releaseBlock.bind(null,i))}))}(e,t,a,s),r.cancelSearch&&Ce(e,n,t),(0,B.isClassicInterface)(e)&&E.updateMenu(e),(0,B.isClassicInterface)(e)&&e.get().active_tab===x.FOLDER_ALL&&this.updateRecommendationList(e),n.focusInput(),(0,B.isCommunityInterface)(e)&&(n.initPeerTagsFilter(e),t.renderPeerTags(e));break;case C.CHANGE_TAB:(0,k.isSearching)(e)&&n.clearSearch(e);var ee=e.get().active_tab;(0,B.changeTab)(r.tab,e,_,A.changeDialogsTab).then((e=>{null==m||m.updateFilter(e),r.tab===x.FOLDER_PEER_TAGS&&ee!==r.tab&&n.initPeerTagsFilter(e),r.tab===x.FOLDER_ALL&&this.updateRecommendationList(e)}));break;case C.RESET_DIRECTORIES:case C.SET_DIRECTORIES:case C.REPLACE_DIRECTORIES:var ce=r.type,de=r.peerId,ue=r.mask;if(ue===C.FOLDER_HAS_BANNER)break;var _e=ue===C.FOLDER_AD_TAG;e.set((e=>(0,A.updateFolderState)(de,ue,ce,r.local,_e,e))).then((e=>{(0,k.isSearching)(e)||ce===C.RESET_DIRECTORIES&&ue===x.FOLDER_MASKS[x.FOLDER_IMPORTANT]||ce===C.RESET_DIRECTORIES&&ue===x.FOLDER_MASKS[x.FOLDER_MESSAGE_REQUEST]||ce===C.SET_DIRECTORIES&&ue===x.FOLDER_MASKS[x.FOLDER_MESSAGE_REQUEST_REJECTED]||ce===C.REPLACE_DIRECTORIES||t.restoreDialogs(e),t.updateDialog(de,e),(0,B.isClassicInterface)(e)&&E.updateCounter(e,de),e.get().peer===de&&a.changedMessageSelection(e)}));break;case C.DELETE_DIALOG:e.set(A.deletedDialog.bind(null,r.peerId,Promise.resolve([]))).then((()=>{_().removePeer(e,r.peerId),_().updateDialogFilters(e)}));break;case C.CHANGE_PEER:ye(e,r,t,a,n,s,E,g,_);break;case C.MUTEX:var ge={[r.peerId]:r},me=(0,B.isPeerBlocked)(r.peerId,e);e.set(A.updateBlockStates.bind(null,ge)).then((()=>{t.updateDialog(r.peerId,e);var n=(0,B.isPeerBlocked)(r.peerId,e);(0,B.isFullyLoadedTab)(e.get(),r.peerId)&&me!==n&&a.updateChat(e,r.peerId)}));break;case C.FAILED_MESSAGE:e.set(A.setMessageErrored.bind(null,r.peerId,r.message)).then((()=>{a.setMessageErrored(r.peerId,r.message,r.error,e),t.setDialogFailed(r.peerId,r.message.messageId,e)}));break;case C.RESEND:var pe=r.message.messageId;e.set(A.resendMessage.bind(null,r.peerId,pe,r.message)).then((()=>{a.resendMessage(r.peerId,pe),t.promoteDialog(e,r.peerId)}));break;case C.PEER_TAGS_CHANGED_EVENT:(0,z.onPeerTagsChangeEvent)(e,t,r);break;case C.PEER_PROFILE_TAGS_CHANGED_EVENT:(0,z.onPeerProfileTagsChangedEvent)(e,t);break;case C.CONVERSATION_UPDATED:Le(e,r,_,a,t);break;case C.WAITING_FOR_RECONNECT:setTimeout((()=>{Ie(s,!0,e),a.setNetworkWaitingStatus(r.timeout-1,e)}),1e3);break;case C.RECONNECTING:Ie(s,!0,e),a.setNetworkReconnectingStatus(e);break;case C.RECONNECTED:Ie(s,!1,e),setTimeout(a.clearNetworkStatus,0),browser.chrome&&!(0,B.isClassicInterface)(e)&&e.get().peer&&(c.is_idle?U||(c.once("unidle",(()=>{U=!1,t.forceScrollReinit()})),U=!0):t.forceScrollReinit());break;case C.KEYBOARD_CALLBACK_RECEIVED:var ve=(0,$.getPressedButtonState)(r.event_id,e);ve&&e.set((e=>(0,Q.unsetPressedCallbackButton)({peerId:r.peer_id,eventId:r.event_id},e))),ve.onCallback(),(0,J.handleCallbackAction)(r,e);break;case G.CHANGE_VOICE_UI:var we=(0,$.getPeer)(e);if(!we)return;var Ee=(0,k.getTab)(e,we),ke=null==Ee?void 0:Ee.msgs;if(!Ee||!ke)return;for(var Pe=Object.values(ke),Ae=function(t){var n=(0,re.parseMessage)(Pe[t]);if((0,B.isAlreadyDeleted)(e,Ee.peerId,n.messageId)||!(0,P.isAudioMsg)(n)&&!(0,oe.hasForwards)(n))return"continue";a.editMessage(e,n),e.set((e=>(0,A.loadMedia)(n,e))).then((e=>a.replaceAttachmentPlaceholders(e,n)))},De=Pe.length-1;De>=0;De--)Ae(De)}}))}))},updateHistory:e=>a.updateHistory(e),updateChatInfo(e){a.updateChatTopic(e,p),(0,B.isClassicInterface)(p)&&E.updateName(e,p),p.get().peer===e&&a.updateActions(p)},cancelRecording:()=>p.set(A.cancelRecording).then((()=>a.cancelRecording())),fixHeight(){L()},toggleFolder(e,a){t.toggleFolder(e,(()=>this),a)},updateFolderCounters(e){t.updateFolderCounters(e)},hideFolderButton(e,a){var n=(0,M.unpackStore)(e);e.set((e=>{switch(a){case ne.ConvoListFolder.BUSINESS_NOTIFY:return(0,Q.setLocalSettingsValue)("business_notify_folder_hidden",1,e);case ne.ConvoListFolder.ARCHIVE:return(0,Q.setLocalSettingsValue)("archives_folder_hidden",1,e);default:return Promise.resolve(e)}})).then((e=>((0,B.isClassicInterface)(e)||t.updateFolderCounters(e),(0,ie.toggleHideFolderHandler)(n,a,!0))))},applySearchAction(e,t,a){n.applySearchAction(e,t,a)},deselectAllMessages(e){a.deselectAll(e)},unmount(){var i;(0,b.destroyModule)(e),clearInterval(p.get().update_title_to),c.stop(),O(),R(),j.casperMessagesStore.destroy(),t.unmount();var s=window.devicePixelRatio>=2?"_2x":"";setFavIcon("/images/icons/favicons/fav_logo"+s+".ico"),a.unmount(),n.unmount(),cancelStackFilter("im_peer"),null==m||m.unmount(),g&&g.unmount(),E&&E.unmount(),S&&S(),y&&y(),(0,B.isLocksAvailable)(p)&&p.get().peer&&p.set(A.releaseBlock.bind(null,p.get().peer)),T.unmount(),F.unmount(),E&&E.unmount(),I.unmount(),clearInterval(w),cur.imDb.unmount(),cur.imDb=!1,null===(i=window.TopMessenger)||void 0===i||i.setIsCounterOn(!0)}}}function Pe(e,t,a,n){var i=t.get();(0,B.isReservedPeer)(i.peer)||e().onUserActions(t,n),i.update_old_title&&t.set(A.updateFavAndTitle.bind(null,!1,!1))}function Ae(e,t){var a=(0,l.ge)("page_header"),n=(0,l.geByClass1)("_im_page_history",e),i=(0,l.clientHeight)()-a.offsetHeight-30-2,s=(0,B.isClassicInterface)(t)?250:400,r={page:Math.max(i,s)};if((0,B.isClassicInterface)(t)){var o=(0,B.getClassicChatHeight)();o=o>0?Math.min(o-a.offsetHeight-30-2,i):i;var c=(0,l.hasClass)(n,"im-page--history_empty-hist")?o:i;r.history=Math.max(o,s),r.chat=Math.max(c,s)}return r}function De(e,t,a,n,i){var s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!(0,M.isFullScreen)()){var o=Ae(e,t);if((0,l.setStyle)(e,{minHeight:o.page}),(0,B.isClassicInterface)(t)&&(void 0===t.get().chatResizeInitialized&&t.set(A.initializeChatResize),(0,l.setStyle)(e,{height:t.get().isCreating?o.page:"auto"}),(0,l.setStyle)((0,l.geByClass1)("_im_page_dialogs",e),{minHeight:o.page}),(0,l.setStyle)((0,l.geByClass1)("_im_page_history",e),{minHeight:o.history,position:"relative",top:0}),(0,l.setStyle)((0,l.geByClass1)("_im_chat_body_abs",e),{minHeight:o.chat,height:o.chat,position:"relative",top:0})),browser.safari&&r&&"function"==typeof r&&r(),n&&n.updateScroll(),i&&i.updateScroll&&i.updateScroll(),a){var c=a.updateScroll();a.scrollFix(t,t.get().peer,c)}s&&setTimeout((()=>De(e,t,a,n,i,!1)),100)}}function Be(e,t){e.get().resendAllOnOnline&&t()}function xe(){var e=document.querySelector(".im_page");!function(e){var t="safari-repaint";e.forEach((function(e){(0,l.hasClass)(e,t)&&(0,l.removeClass)(e,t),(0,l.addClass)(e,t)})),setTimeout((function(){e.forEach((function(e){(0,l.removeClass)(e,t)}))}),100)}([(0,l.geByClass1)("_im_dialog_actions",e),(0,l.geByClass1)("_im_chat_input_w",e),(0,l.ge)("side_bar"),(0,l.geByClass1)("_im_right_menu",e),(0,l.geByClass1)("_im_dialogs_footer",e),(0,l.geByClass1)("_im_dialogs_search",e)])}function Oe(e,t){var a;(0,K.partConfigEnabled)("im_chasiky_debug")&&(window.meBufferLog={});var i,r=t.get(),o=window.devicePixelRatio>=2?"_2x":"";setFavIcon("/images/icons/favicons/fav_im"+o+".ico"),De(e,t,!1,!1,!1,!0);var h=(0,b.createMutations)(ke),v=h.callMutations,f=h.bindMutations,S=r.useFcLongpoll&&vk.lpConfig.enabled&&Notifier.getLpInstance&&Notifier.getLpInstance(),P=S?Notifier.getLpInstance():t.get().gid?(0,w.startLongPollForGroup)(r.lpConfig):(0,w.startLongPoll)(r);P.onData(O);var D=Notifier.getEventQueueInstance&&Notifier.getEventQueueInstance(),x=D?D.subscribe((e=>v().onQueueEvent(t,e))):()=>{};function O(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];v().onEvents(t,a)}S&&(0,F.imWeirdLog)("im_use_fc_longpoll",{},!1),window.TopMessenger&&!(0,B.isCommunityInterface)(t)&&(0,$.isTopCounterMuted)(t)&&(window.TopMessenger.resetCounter(),window.TopMessenger.setIsCounterOn(!1));var N=(0,l.geByClass1)("_im_dialogs_search",e),U=(0,l.geByClass1)("_im_dialogs_footer",e),W=(0,n.mount)((0,l.geByClass1)("_im_page_dcontent",e),t,v,N);W.renderPeerTags(t);var G,V,z=(0,d.mount)(N,t,v),Y=U?(0,u.mount)(U,t,v):null,Q=(0,I.mount)(t),Z=(0,g.mount)(t,document.body);if(cur.imDb=(0,L.mount)(t.get().gid?-t.get().gid:vk.id),t.set(A.preloadSearchIndex.bind(null,cur.imDb)),(0,B.isClassicInterface)(t)){var X=(0,l.geByClass1)("_im_ui_peers_list",e.parentNode);G=(0,T.mount)(X,t,v),V=function(e,t,a,n){if(browser.mobile)return!1;var i=[t,a,(0,l.geByClass1)("_im_chat_input_w",n),(0,l.geByClass1)("_im_dialog_actions",n)],r=null,o=(0,l.hasClass)(e,"im-page--header_static"),c=(0,l.ge)("im-group-online-disabled-notice");function d(){var t=(0,p.getNativeOption)("scrollLeft"),a=(0,l.hasClass)(e,"im-page--header_static"),n=[];r!==t?n=i.slice().concat([e]):a!==o&&(n=[e]),r=t,o=a,n.length>0&&n.forEach((n=>{var i=e===n&&a?0:-t;(0,l.setStyle)(n,{[cssTransformProp]:0===i?"unset":"translateX("+i+"px)"})}))}return c&&i.push(c),i=i.concat((0,l.geByClass)("_im_aside_notice"),(0,l.geByClass)("_im_aside_promo_block")),(0,s.addEvent)(window,"scroll",d),d(),()=>{(0,s.removeEvent)(window,"scroll",d)}}(N,U,(0,l.geByClass1)("_im_right_menu",e.parentNode),e)}(0,B.isClassicInterface)(t)&&r.peer&&W.deactivate(),r.gid||(i=(0,_.mount)((0,l.geByClass1)("_im_dialogs_creation",e),t,v));var J=(0,c.mount)((0,l.geByClass1)("_im_page_history",e),t,W,G,v),ee=r.isCreating,te=ee?"create":0===r.peer?"search":"default";ee&&i.show(t,[]);var ae=(0,y.create)(t,te,W,J,z,i),ne=(0,R.mount)(t,ae);J.renderPeerProfile(t),J.updateScroll();var se=Pe.bind(null,v,t,ae);r.peer&&t.set(A.prepareCasperMessagesFromMessages.bind(null,r.peer)),(0,B.isReservedPeer)(r.peer)||setTimeout((()=>pe(t,J)),10);var re=new H.default({id:"im",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress"}),oe=(0,q.debounce)(xe,300),le=De.bind(null,e,t,J,W,i,!1,oe),de=Be.bind(null,t,J.resendAll);t.setState({longpoll:P}),t.set(A.setExecStack.bind(null,[])),re.on("unidle",(function(){P.abortWaiting(),se()})),re.start(),nav.objLoc.box&&(ge(t,nav.objLoc.box),(0,m.updateLocation)({box:null})),nav.objLoc.mr&&(0,B.isChatPeer)(Number(nav.objLoc.mr))&&(0,B.showChatInvitationBox)(t,nav.objLoc.mr,v,W),(null===(a=window.nav.objLoc)||void 0===a?void 0:a.openSettings)&&(z.openSettings(),(0,m.updateLocation)({openSettings:null}));var ue,me=function(e){var t=e.get();return(0,B.isLocksAvailable)(e)?(0,E.createWorker)(t.mutex_key,(function(e){t.longpoll.push([C.mutexEvent(e)])}),(function(e,a){return(0,A.getMutexQueue)(t.gid).then((e=>ce(e,1)[0]))})).stop:null}(t);if((0,B.isLocksAvailable)(t)&&(ue=setInterval(B.blockLatencyCompensation.bind(null,t,r.longpoll),2e3)),t.get().invitation&&(0,B.showInvitationBox)(t,t.get().invitation,A.leaveInvitation),(0,B.isClassicInterface)(t)&&(0,k.existsIncomingMessageRequest)(t)){var he=document.getElementById("ui_rmenu_mr");he&&he.classList.remove("unshown")}var ve=(0,M.throttleAccumulate)(_e.bind(null,t,J,W,G),200),fe=B.hideTopNotice.bind(null,t),be=B.hideAsideNotice.bind(null,t);j.casperMessagesStore.subscribe((e=>function(e,t,a,n,i){var s=i.type,r=i.message;switch(s){case j.EXPIRING:return t.updateCasperMessageStatus(r);case j.EXPIRING_SOON:return t.updateCasperMessageStatus(r,!0);case j.EXPIRED:(0,k.isCasperChat)(e,r.peerId)?n(r):(t.handleMessageExpiration(r),a.updateDialog(r.peerId,e))}}(t,J,W,ve,e))),j.casperMessagesStore.setTimeshift(r.timeshift);var ye=e=>{var a=e.target.closest("._im_new_ui_banner");a&&(a.hidden=!0,(0,ie.toggleHideFolderNoticeHandler)(t.get(),"new_ui_banner",1))};return f((0,b.createModule)({handlers:(a,n)=>{a(document,"mousemove mousedown keypress",se),a(window,"resize",le),a(window,"online",de),n(e,"click",B.HIDE_TOP_NOTICE_CLASS,fe),n((0,l.gpeByClass)("_im-page-wrap",e),"click",B.HIDE_ASIDE_NOTICE_CLASS,be),n((0,l.gpeByClass)("_im-page-wrap",e),"click",B.HIDE_ASIDE_PROMO_BLOCK_CLASS,B.hideAsidePromoBlock),n((0,l.gpeByClass)("_im-page-wrap",e),"click",B.INSTALL_VKADMIN_LINK,B.installVKAdminApp),(0,B.isClassicInterface)(t)&&(0,K.partConfigEnabled)("mail_new_ui_banner")&&!(0,B.isCommunityInterface)(t)&&n((0,l.gpeByClass)("_im-page-wrap",e),"click","_im_new_ui_banner_close",ye),browser.safari&&a(document,"visibilitychange",xe)}}),W,J,z,e,re,P,ve,v,i,Y,t,ae,me,ue,G,V,Q,ne,le,(function(){S?P.offData(O):P.stop()}),x,Z)}},430229:(e,t,a)=>{"use strict";a.d(t,{mount:()=>$});a(940851),a(296253);var n,i,s,r,o,l,c,d,u,_,g,m,p,h,v,f=a(610124),b=a(386409),y=a(376567),w=a(49535),C=a(315544),E=a(695724),S=a(454593),T=a(665446),I=a(597903),L=a(654612),M=browser.msie&&(0,E.intval)(browser.version)<10?window.XDomainRequest:window.XMLHttpRequest;function k(e){var t=e%60;return parseInt(e/60)+":"+(t<10?"0":"")+t}var P=!1,A=!1,D=100;function B(e){var t=e.get().peer;(0,I.isFullyLoadedTab)(e,t)&&!(0,I.isAnyMessageBeingEdited)(e)&&Date.now()-((0,I.getTab)(e,t).lastTyping||0)>1e3*S.ACTIVITY_PERIOD&&e.set(S.sendRecordingAudio.bind(null,t))}function x(e){if(!A){A=!0,(0,I.lockButton)(l);var t={peer:u.get().peer,from_place:cur.docsChooseFrom,imhash:cur.docsChooseImHash,blockPersonal:cur.docsChooseBlockPersonal,mail_add:cur.docsChooseMailAdd};(function(e){return new Promise(((t,a)=>{var n=e.getFormData(),i=new M;i.onload=i.onerror=function(e){var n=e.currentTarget.response;200==this.status&&n.length>0&&"{"==n[0]?(n=JSON.parse(n),t(n)):a()},i.open("POST",v.upload_url,!0),i.send(n)}))})(e).then((e=>e.file?new Promise(((a,n)=>{ajax.post("/docs.php",(0,E.extend)({act:"a_save_doc",from:"choose",from_place:t.from_place,imhash:t.imhash,blockPersonal:t.blockPersonal,mail_add:t.mail_add},e),{onDone:(e,n)=>{U(),m([["doc",e+"_"+n,"audiomsg"]],{},t.peer),G(),a()},onFail:function(e){n(e)},progress:null})})):Promise.reject())).then((()=>{(0,I.unlockButton)(l),A=!1})).catch((()=>{A=!1,(0,I.unlockButton)(l),(0,L.showFastBox)(getLang("global_error"),getLang("mail_audio_message_upload_error"))}))}}function O(){h(),i.innerHTML=k(P.duration),P.duration>=600&&W()}function R(e){e.set(S.cancelRecording).then(q)}function N(){h(),window.stManager.add(["voice_message_player.js","speech.js"],(function(){P||(P=Speech.newRecorder(),(0,w.addEvent)(P,"progress",O)),AudioMessagePlayer.detachPlayer(),AudioMessagePlayer.pauseGlobalMedia(),P.record().then((()=>{var e;e=u,v.isRecording=!0,cancelStackPush("audio_message_cancel",R.bind(null,e)),(0,b.hideProgress)((0,C.geByClass1)("im-audio-message-send-wrapper",n)),i.innerHTML="0:00",(0,C.addClass)(n,"im-audio-message_recording"),(0,C.removeClass)(n,"im-audio-message_recorded"),function(){n&&n.classList&&n.classList.remove("im-audio-message-input--hidden");(0,C.geByClass1)("_im_chat_input_parent",d).classList.add("im-chat-input--hidden")}(),(g=Speech.createVisualization("wave",P.source,s,{color:getComputedStyle(document.body).getPropertyValue("--white")})).start();var t=s.getBoundingClientRect();D=(t.right-t.left)/3})).catch((e=>{AudioMessagePlayer.resumeGlobalMedia();var t=e.name;switch(e.name){case"DevicesNotFoundError":case"NotFoundError":case"NotAllowedError":t="mail_audio_message_device_error";break;case"PermissionDeniedError":case"PermissionDismissedError":t="mail_audio_message_permission_error";break;case"Unsupported":t="mail_audio_message_unsupported_error"}(0,L.showFastBox)(getLang("global_error"),getLang(t)),console.error(e)}))}))}function F(){P&&P.stop(),g&&(g.destroy(),g=null)}function U(){v.isRecording=!1,cancelStackFilter("audio_message_cancel")}function H(){j(),x(P)}function j(){var e;AudioMessagePlayer.loaded&&AudioMessagePlayer.resumeGlobalMedia(),(0,w.removeEvent)(P,"finish",j),(0,w.removeEvent)(P,"finish",H),e=URL.createObjectURL(P.buffer),(0,C.domData)(_,"duration",P.duration),(0,C.domData)(_,"ogg",e),(0,C.domData)(_,"mp3",e),(0,C.geByClass1)("audio-msg-track--duration",_).innerHTML=k(P.duration),(0,C.geByClass1)("audio-msg-track--wave-wrapper",_).innerHTML=AudioMessagePlayer.getWave(P.wave,D),(0,C.removeClass)(n,"im-audio-message_recording"),(0,C.addClass)(n,"im-audio-message_recorded")}function q(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];U(),AudioMessagePlayer.loaded&&(AudioMessagePlayer.resumeGlobalMedia(),AudioMessagePlayer.detachPlayer()),(0,w.removeEvent)(P,"finish",j),(0,w.removeEvent)(P,"finish",H),F(),G(),e&&p()}function K(){P.isRecording?((0,w.addEvent)(P,"finish",H),(0,w.removeEvent)(P,"finish",j),F()):x(P)}function W(){(0,w.addEvent)(P,"finish",j),(0,w.removeEvent)(P,"finish",H),F()}function G(){(0,C.removeClass)(n,"im-audio-message_recorded"),(0,C.removeClass)(n,"im-audio-message_recording"),n&&n.classList&&n.classList.add("im-audio-message-input--hidden"),(0,C.geByClass1)("_im_chat_input_parent",d).classList.remove("im-chat-input--hidden")}function V(){(0,C.ge)("audiomsg_record"),_=(0,C.ge)("audiomsg_player"),d=(0,C.geByClass1)("_im_chat_input_w"),n=(0,C.geByClass1)("im-audio-message-input",d),i=(0,C.geByClass1)("audio-msg-track--duration",n),s=(0,C.geByClass1)("audio-msg-track--wave",n),o=(0,C.geByClass1)("im-audio-message--cancel-btn",n),l=(0,C.geByClass1)("_im_audio_send",n),c=(0,C.geByClass1)("audio-msg-track--btn",n),(0,C.geByClass1)("im-chat-input--text",d);var e=(0,C.geByClass1)("im-chat-input--textarea",d);(0,C.addClass)(e,"_voice_field_wrap"),(0,w.addEvent)(r,"click",N),(0,w.addEvent)(o,"click",q),(0,w.addEvent)(l,"click",K),(0,w.addEvent)(c,"click",W)}function z(){!function(){P&&(0,w.removeEvent)(P,"progress",O);(0,w.removeEvent)(r,"click",N),(0,w.removeEvent)(o,"click",q),(0,w.removeEvent)(l,"click",K),(0,w.removeEvent)(c,"click",W)}(),_=n=i=s=r=o=l=c=null}function Y(e,t,a){return{cancelRecording:q,start:function(){N()},unmount(){q(!1),z()}}}function $(e,t,a,n,i){return u=t,v=t.get().audio_msg,h=B.bind(null,t),m=a,p=i,(0,T.initFailBack)(),(0,I.getAvailableMicrophones)().then((e=>{var a=e.length>0;a?(V(),n()):(0,y.setCookie)("remixvoice","0",7),t.set(S.setVoiceMessageAvail.bind(null,a))})).catch((e=>{throw(0,y.setCookie)("remixvoice","0",7),e})),(0,(0,f.createMutations)(Y).bindMutations)(e,t,a)}},498101:(e,t,a)=>{"use strict";a.d(t,{default:()=>i});var n=a(315544);const i={onNewMessagesChunk:function(e){var t=(0,n.geByClass)("post");LongView.clearElemsCache&&LongView.clearElemsCache(),t.forEach((e=>LongView.register(e,"im")))},onHistoryScroll:function(e){LongView.onScroll(e,window.innerHeight)}}},493913:(e,t,a)=>{"use strict";a.d(t,{mount:()=>I});a(751876),a(940851),a(991181),a(296253),a(796409);var n=a(878888),i=a(695724),s=a(315544),r=a(49535),o=a(712439),l=a(597903),c=a(454593),d=a(645523),u=a(610124),_=a(179288),g=a(668040),m=a(982452),p=a(376852),h=a(786067),v=Object.values(_.ConvoListFolder);function f(e){var t=e.get().tabbedPeers.map((t=>e.get().tabs[t.peer]||e.get().mapped_index&&e.get().mapped_index[t.peer])).filter((e=>e)).filter((e=>!e.deletedDialog)).map((e=>({type:"peer",peer:e.peerId})));return t.length>0&&(t=[{type:"sep"}].concat(t)),t}function b(e,t){if("sep"===t.type)return getTemplate("im_right_menu_sep",{});var a=`${(0,l.getBaseLink)(e)}?sel=${t.peer}&tab=${e.get().active_tab}`,n=(0,l.getBareTab)(t.peer,e),i=(0,l.isContactPeer)(t.peer)?(0,l.prepareContactName)(n.tab):n.tab,s="";switch(!0){case n.unread>0:s=n.unread;break;case(0,l.isTabMarkedUnread)(n):s=1}return i=getTemplate("im_right_menu_ct",{name:i,count:s}),getTemplate("im_right_menu_tpl",{href:a,label:i,peer:t.peer,attrs:`title="${stripHTML(n.tab)}"`,cls:n.unread>0?"im-right-menu--unread":""})}function y(e,t,a,n){var o=(0,s.gpeByClass)("_im_peer_tab",n),l=(0,i.intval)((0,s.domData)(o,"list-id")),u=e.get().tabbedPeers.filter((e=>e.peer!==l));return e.set(c.updateTabbedPeers.bind(null,u,!0)).then((()=>{if(w(t,e),l===e.get().peer)e.get().longpoll.push([(0,d.resetPeer)()]);else if(0!==e.get().peer){var a=(0,s.gpeByClass)("_im_right_menu",n);uiRightMenu.hideSliding(a)}})),(0,r.cancelEvent)(a),!1}function w(e,t){return e.pipeReplace(Promise.resolve(f(t)))}function C(e,t,a,n){return{updateMenu(t){!function(e,t){(0,s.geByClass)("_im_peer_tab",e).forEach((e=>{var a=(0,g.fromQueryString)((0,s.attr)(e,"href").split("?")[1]);a.tab!==t.get().active_tab&&(0,s.attr)(e,"href",`${(0,l.getBaseLink)(t)}?sel=${a.sel}&tab=${t.get().active_tab}`)}))}(e,t);var n=(0,s.gpeByClass)("_im_right_menu",e);w(a,t).then((()=>{var e;(e=t.get().peer?(0,s.ge)("ui_rmenu_peer_"+t.get().peer):(0,s.ge)("ui_rmenu_"+t.get().active_tab))&&uiRightMenu.switchMenu(e,!0),uiRightMenu.hideProgress(n)}))},updateName(e,t){var a=(0,s.ge)("ui_rmenu_peer_"+e);if(a){var n=(0,s.geByClass1)("_im_r_tx",a),i=t.get().tabs[e].tab;(0,s.val)(n,i)}},updateCounter(e,t){var a=(0,s.ge)("ui_rmenu_peer_"+t);if(a){var n=(0,s.geByClass1)("_im_r_ct",a),i=(0,l.getTab)(e,t),r="";switch(!0){case i.unread>0:r=i.unread;break;case(0,l.isTabMarkedUnread)(i):r=1}(0,s.val)(n,r),a.classList.toggle("im-right-menu--unread",i.unread>0||(0,l.isTabMarkedUnread)(i))}},unmount(){(0,u.destroyModule)(n),a.unmount()}}}function E(e,t,a){1===a.which&&(e.get().peer&&e.get().longpoll.push([(0,d.resetPeer)()]),e.get().longpoll.push([(0,d.changeTab)(t)]),(0,r.cancelEvent)(a))}function S(e){(0,p.showTooltip)(e.currentTarget,{text:(0,h.getLang)("mail_admin_av_time"),dir:"bottom",needLeft:!0,typeClass:"tt_default_right RightMenuBlockInfo__averageTimeTooltip",width:210,shift:[-14,8],slide:15})}function T(e,t,a){e.set((e=>(0,c.toggleCommunityMute)(!t,e))).then((()=>a.classList.toggle("RightMenuBlockInfo__mute--muted",e.get().mute)))}function I(e,t,a){var c=(0,n.mount)(e,(0,o.default)({limit:50,offset:0,noScroll:!0,elements:f(t)}),(()=>({idFn:e=>e.peer||"000",renderFn:b.bind(null,t)}))),_=y.bind(null,t,c),g=(0,s.geByClass1)("RightMenuBlockInfo"),p=(0,s.geByClass1)("RightMenuBlockInfo__averageTimeHint",g),h=(0,s.geByClass1)("RightMenuBlockInfo__mute",g),w=(0,u.createModule)({handlers:(a,n)=>{n(e,"click","_im_r_cl",_),n(e,"click","_im_peer_tab",((e,a)=>{if(!(0,r.checkEvent)(e)){var n=(0,i.intval)((0,s.domData)(a,"list-id"));(0,m.unpackStore)(t).longpoll.push([(0,d.changePeer)(n,!1,!0,!0,"right_menu")]),(0,r.cancelEvent)(e)}})),v.forEach((n=>{a((0,s.geByClass1)(`_ui_item_${n}`,e.parentNode),"mousedown",E.bind(null,t,n))})),p&&a(p,"mouseover",S),(0,l.isCommunityInterface)(t)&&h&&a(h,"click",(e=>T(t,!1,e.currentTarget)))}});return(0,l.isCommunityInterface)(t)&&h&&(T(t,!0,h),h.classList.remove("RightMenuBlockInfo__mute--hidden")),C(e,0,c,w)}},914012:(e,t,a)=>{"use strict";a.d(t,{CONVO_MORE_CLASS:()=>k,mount:()=>K});a(175115),a(530522),a(66108),a(579665),a(95767),a(991181),a(940851),a(296253);var n=a(454593),i=a(695724),s=a(104837),r=a(597903),o=a(594476),l=a(610124),c=a(772274),d=a(37426),u=a(612202),_=a(460615),g=a(609720),m=a(191040),p=a(645523),h=a(28238),v=a(376852),f=a(786067),b=a(499349),y=a(179288),w=a(315544),C=a(993421),E=a(293498),S=a(974309);function T(){return T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},T.apply(this,arguments)}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return L(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return L(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var M=(0,g.debounce)(u.statlogsProbValueEvent,1e3),k="_im_search_more",P="im-dialog-select_rotated",A="im-dialog-select_hidden",D="im-page--dialogs-header-controls_hidden",B="_im_create_convo",x="_im_create_call";function O(e,t,a,r,o,l,c){var d=(0,i.trim)(l);if((0,s.isSearchingValue)(e,d)){var u=()=>c.clearSearch(e,t);d?(e.setState({recentSearch:!1}),o.stop()):o.replaceOrAdd(u),cancelStackPush("im_search",u),d&&e.set((e=>(0,n.setCurrentSearch)(d,!1,e))).then(t),r.classList.add("im-page--dialogs-search_fill","_im_d_search"),(0,C.isCommunityInterface)(e)||c.showCancelControl()}else d||(o.stop(),e.set((e=>(0,n.setCurrentSearch)("",!1,e))).then(t),r.classList.remove("im-page--dialogs-search_fill","_im_d_search"),(0,C.isCommunityInterface)(e)||c.hideCancelControl())}function R(e,t,a){return function(){var n=(0,s.getSearchText)(t);n===e&&a(...arguments)}}function N(e,t,a){var i=(0,s.getSearchText)(a);return M(.01,"im_search_stat",1,"search_start"),(0,n.updateSearchQuery)(i),a.setState({recentSearch:!1}),e().toggleSettingsButton(a,!!i),i?(a.get().dialog_search_going=!0,function(e,t,a){var i=R(e,a,(e=>t().appendFastDialogs(a,e)));return(0,n.searchTopConv)(e,a.get()).then((e=>{var t=e.filter((e=>"/images/deactivated_50.png"!==e.photo||"DELETED"!==e.tab));return i(t),t}))}(i,e,a).then((n=>{var s=n.map((e=>e.peerId));return t(i,e,s,a)})).then((()=>{a.get().dialog_search_going=!1})).catch((()=>{}))):(e().restoreDialogs(a,!1,!0),(0,_.removeSearchPositionTracker)("messages"),Promise.resolve(!1))}function F(e,t,a,i){var s=i.get(),o=R(e,i,(e=>t().appendDialogs(i,e))),l=R(e,i,t().appendSearch);return(0,r.isPendingForward)(i)?(0,n.searchHints)(e,a,"all",{},s).then(o):Promise.all([(0,n.searchHints)(e,a,"all",{},s).then(o),(0,n.searchMessages)(e,s)]).then((e=>{var t=I(e,2),a=I(t[1],2),n=a[0],s=a[1];l(i,n,s,!0)}))}function U(e,t,a){var i=a.target;e.set((e=>(0,n.toggleCommunityMute)(t,e))).then((()=>{i.classList.toggle("im-page--gim-mute_muted",e.get().mute),t&&H(e,{target:i})}))}function H(e,t){var a=t.target;return(0,v.showTooltip)(a,{text:()=>e.get().mute?(0,f.getLang)("mail_im_sound_off"):(0,f.getLang)("mail_im_sound_on"),black:1,shift:[13,9],appendCls:"js-im-page"})}function j(e,t,a,n,i,o){switch(i){case"contacts":n.show();break;case"favorites":nav.go("/im?box=fav");break;case"spam":(0,r.showSpamLayer)(t,c.mount,o);break;case"settings":a.show();break;case y.ConvoAction.CALL_AUDIO:case y.ConvoAction.CALL_VIDEO:case y.ConvoAction.CALL_APP:(0,r.startCallFromIm)(t,null,i===y.ConvoAction.CALL_VIDEO,[],r.CALL_ENTRY_POINT_LIST,i===y.ConvoAction.CALL_APP);break;case y.ConvoAction.CALL_BY_NAME:(0,r.startCallFromIm)(t,null,!1,null,r.CALL_ENTRY_POINT_LIST,!1,!0);break;case y.ConvoAction.BUSINESS_NOTIFY:case y.ConvoAction.ARCHIVE:if(t.get().active_tab===i)break;if(e().toggleFolder(t,i),(0,s.isClassicInterface)(t)){var l=document.getElementById(`ui_rmenu_${i}`);l?E.default.switchMenu(l):E.default.unselectAll(document.querySelector("._im_right_menu"))}var d=o.target.closest("._ui_menu_wrap");d&&uiActionsMenu.hide(d)}}function q(e,t,a,n,i,s,r,o,c,d,u,_){return{focusInput(){uiSearch.focus(n.parentNode)},hideCancelControl(){a.classList.remove(D),t.classList.add(A),t.classList.remove(P)},showCancelControl(){a.classList.add(D),t.classList.add(P),t.classList.remove(A)},setSearch(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?d:()=>{};n.value=t,O(e,a,0,n,s,t,c())},clearSearch(e,t){cancelStackFilter("im_search"),(0,C.isCommunityInterface)(e)||c().hideCancelControl(),uiSearch.reset(n),e.setState({recentSearch:!1}),O(e,t||(()=>{}),0,n,s,n.value,c())},initPeerTagsFilter(e){(0,b.initPeerTagsFilter)(e)},applySearchAction(e,t,a){j(r,e,u,_,t,a)},openSettings(){u.show()},unmount(){s.stop(),u.hide(),(0,l.destroyModule)(o),uiSearch.destroy(i),cancelStackFilter("im_search")}}}function K(e,t,a){var i=(0,l.createMutations)(q),c=i.callMutations,u=i.bindMutations,_=new d.Settings(t,a),g=new S.ContactList(t,a),y=(0,w.geByClass1)("_im_dialogs_header_controls",e),E=(0,w.geByClass1)(B,e),I=(0,w.geByClass1)(x,e),L=(0,w.geByClass1)("_im_search_cancel",e),M=(0,w.ge)("im_dialogs_search",e),P=(0,w.geByClass1)("_im_gim_mute",e),A=(0,w.geByClass1)("_im_av_time",e),D=(0,w.geByClass1)("_im_peer_tags_filter_control",e),R=(0,w.geByClass1)(k,e),K=(0,o.default)("im_search",[k,B,x,"_im_page_dcontent","_im_d_search","_im_dialog"]),W=(0,m.debouncedPromise)(F,300),G=e=>N(a,W,e),V=e=>O(t,G,0,M,K,e,c()),z=()=>c().clearSearch(t,G),Y=(0,w.geByClass1)("_im_dialogs_search_input",e);uiSearch.init(Y,{onChange:V}),M.value&&setTimeout((()=>V(M.value)),0);var $=e=>{(0,v.showTooltip)(e.target,{text:(0,f.getLang)("mail_admin_av_time"),dir:(0,w.geByClass1)("_im_top_notice")||(0,w.geByClass1)("im-page--dialogs--group-status")?"down":"up",shift:[0,8]})},Q=()=>{var e;e=0===t.get().peer||(0,r.isPendingForward)(t)?"search":"default",(0,s.isSearching)(t)||a().toggleSettingsButton(t,!1),t.get().longpoll.push([(0,p.transitionEvent)(e)])},Z=()=>{(0,s.isSearching)(t)&&a().toggleSettingsButton(t,!0),function(e,t,a,i,o,l){if(!(0,s.isSearching)(e)){var c=cur.imDb.select(h.RECENT_SEARCH_OP);if(0!==c.length||(0,s.doPopularSuggExist)(e)){e.setState({recentSearch:!0}),O(e,(()=>{(0,s.isSearching)(e)||(i.stop(),o().toggleSettingsButton(e,!1),o().restoreDialogs(e,!1,!0))}),0,a,i,"",l);var d=c.filter((t=>!(0,r.isTabLoadedWithMessage)(e.get(),t))),u=c.filter((t=>(0,r.isTabLoadedWithMessage)(e.get(),t))).reduce(((t,a)=>(t[a]=(0,s.getTab)(e,a),t)),{});e.get().topConvTree.then((t=>{var a=t.list.filter((e=>d.includes(e[0]))).reduce(((e,t)=>(e[t[0]]=(0,n.localIndexToDialog)(t),e)),{}),i=T({},a,{},u);return o().appendFastDialogs(e,c.map((e=>i[e]))),a})).then((t=>(0,n.searchHints)("",Object.keys(t),!1,{},e.get()))).then((t=>{o().appendDialogs(e,t)}))}}}(t,0,M,K,a,c())},X=(e,n)=>{var i=n.dataset.action;j(a,t,_,g,i,e)},J=(0,l.createModule)({handlers:(n,i)=>{n(L,"click",z),n(L,"mouseover",(()=>function(e,t){return(0,v.showTooltip)(t,{appendEl:bodyNode,text:(0,f.getLang)("mail_cancel"),black:1,shift:[3,-1],appendCls:"js-im-page"})}(0,L))),n(E,"click",(()=>a().showCreation(t))),(0,w.domData)(I,"disable-click")||n(I,"click",(()=>{(0,r.startCallFromIm)(t,null,!1,null,r.CALL_ENTRY_POINT_LIST)})),i(e,"click","_im_search_more_action",X),A&&n(A,"mouseover",$),(0,C.isCommunityInterface)(t)&&P&&(n(P,"click",(e=>U(t,!0,e))),n(P,"mouseover",(e=>H(t,e)))),n(M,"click",Z),n(M,"blur",Q),n(M,"focus",(()=>{t.get().longpoll.push([(0,p.transitionEvent)("search")])})),n(R,"mouseenter",(e=>{var a,n,i=R.parentNode;null===(a=i.querySelector("._is_active"))||void 0===a||a.classList.remove("_is_active"),null===(n=i.querySelector(`[data-action='${t.get().active_tab}']`))||void 0===n||n.classList.add("_is_active")})),(0,C.isCommunityInterface)(t)&&D&&(i(e,"change","_im_peer_tags_filter_checkbox",(e=>(0,b.onPeerTagsFilterCheckboxChange)(e,t))),i(e,"click","_im_peer_tags_filter_pane_item",(e=>(0,b.onPeerTagsFilterPaneItemClick)(e,t))))}});return(0,C.isCommunityInterface)(t)&&(D?(0,b.initPeerTagsFilter)(t):P&&U(t,!1,{target:P})),u(e,L,y,M,Y,K,a,J,c,G,_,g)}},932699:(e,t,a)=>{"use strict";a.d(t,{doesSearchResultContainConversations:()=>_,mount:()=>g});a(940851),a(296253);var n=a(982452),i=a(315544),s=a(695724),r=a(610124),o=a(454593),l=a(597903),c=a(645523);function d(e,t,a,r){var d=(0,s.intval)((0,i.domData)(r,"msgid"));if(!(0,n.getSelectionText)()&&!(0,l.checkSelectClick)(a)){var u=(0,s.intval)((0,i.domData)(r,"peer"));return e.set(o.cancelSearch.bind(null,u)),e.get().longpoll.push([(0,c.changePeer)(u,d,!1,!1,t)]),!1}}function u(e,t){return{isAll:e=>(0,o.isSearchAllLoaded)(e.get().peer,e.get()),loadMore:e=>function(e){return(0,o.isSearchAllLoaded)(e.get().peer,e.get())?Promise.resolve(""):(0,o.searchMessagesInplace)(e.get().peer,e.get())}(e),unmount(){(0,r.destroyModule)(t)}}}function _(e){return e.findIndex((e=>"number"==typeof e.peerId&&e.href))>-1}function g(e,t,a){var n=d.bind(null,t,a);return u(0,(0,r.createModule)({handlers:(t,a)=>{a(e,"click","_im_mess",n)}}))}},309013:(e,t,a)=>{"use strict";a.d(t,{mount:()=>_});var n=a(610124),i=a(695724),s=a(315544),r=a(597903),o=a(454593),l=a(104837),c=a(727181),d=a(353702);function u(e,t,a,n,u){if(!(0,o.isSearchingInplace)(e.get().peer,e.get())&&!((0,s.hasClass)(u,r.FAILED_CLASS)||(0,s.hasClass)(u,r.SENDING_CLASS)||(0,s.hasClass)(u,"_im_mess_srv")||(0,r.checkSelectClick)(n,u)||(0,l.isAnyMessageBeingEdited)(e)||"A"===n.target.tagName||(0,s.domClosest)("_im_replied_message",n.target)||n.target.classList.contains("_im_retry_media")||n.target.closest("."+r.MESSAGE_KEYBOARD_BUTTON_CLASS)||n.target.closest("."+r.BOT_CAROUSEL_CLASS)||n.target.closest("."+c.WIDGET_ACTIONS)||n.target.closest("."+r.MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON)||n.target.classList.contains(d.AUDIO_MSG_AUTOSHOW_SETTING_HINT)||(0,s.domClosest)("scroll-button--right",n.target)||(0,s.domClosest)("scroll-button--left",n.target))){var _,g,m=(0,i.intval)((0,s.domData)(u,"msgid")),p=e.get().peer;if(!(0,r.isAlreadyDeleted)(e,p,m))_=n.shiftKey?(0,l.getMessageRangeFromSelection)(e,p,m):[m],e.set(o.addSelection.bind(null,_)).then((()=>{var n=(0,l.getSelectedMessages)(e),i=!1;_.forEach((e=>{var t=(0,s.geByClass1)("_im_mess_"+e,a);if(t){var r=inArray(e,n);i|=r,(0,s.toggleClass)(t,"im-mess_selected",r);var o=r?getLang("mail_deselect_message"):getLang("mail_select_message"),l=(0,s.geByClass1)("_im_mess_blind_label_select",t);(0,s.attr)(l,"aria-label",o)}})),i&&(window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()),t().changedMessageSelection(e)})).then((()=>{1!==e.get().selectedMessages.length||g?g&&g.hide():g=function(e){var t=e.get();if(t.pinnedMessagesPromo&&(0,r.isChatPeer)(t.peer)){var a=(0,s.geByClass1)("_mess-action-promo"),n=new ElementTooltip(a,{autoShow:!1,appendTo:a,content:getTemplate("im_pinned_messages_promo",{content:getLang("mail_pinned_messages_promo_tooltip")}),forceSide:"bottom",cls:"feature_intro_tt",width:260,onHide:function(){e.setState({pinnedMessagesPromo:!1}),(0,o.hidePromoTooltip)()}});return n.show(),n}}(e)}))}}function _(e,t,a){var i=u.bind(null,t,a,e),r=(0,n.createModule)({handlers:(t,a)=>{a(e,"click","_im_mess",i)}});return function(e,t){return{cleanSelection(t){t&&Array.isArray(t)&&t.length&&t.map((t=>(0,s.geByClass1)("_im_mess_"+t,e))).filter((e=>e)).forEach((e=>(0,s.removeClass)(e,"im-mess_selected")))},unmount(){(0,n.destroyModule)(t)}}}(e,r)}},41911:(e,t,a)=>{"use strict";a.d(t,{mount:()=>_});a(59357);var n,i,s=a(610124),r=a(315544),o=a(597903);function l(e){var t=(0,r.ge)("page_header"),a=(0,r.clientHeight)()-t.offsetHeight-30-2;(0,r.setStyle)(e,{height:Math.max(a,400)})}function c(e){var t=(0,o.formatTimespan)(Math.floor(Math.max(e,0)/1e3),!0);return t?getLang("mail_sick_timer").replace(/{timer}/gi,t):""}function d(){nav.reload({force:!0})}function u(e){return{unmount(){clearInterval(i),clearTimeout(n),(0,s.destroyModule)(e)}}}function _(e,t,a){l(e);var r,o,_=(0,(0,s.createMutations)(u).bindMutations)((0,s.createModule)({handlers:(t,a)=>{t(e.querySelector("._im_sick_reload"),"click",d),t(window,"resize",l.bind(null,e))}})),g=(r=localStorage.getItem("im_sick_timer"),o=r?Math.min(2*parseInt(r),6e5):5e3,localStorage.setItem("im_sick_timer",o),o),m=e.querySelector("._im_sick_timer"),p=+new Date;return m.innerHTML=c(g),i=setInterval((()=>{m.innerHTML=c(p+g-new Date)}),500),n=setTimeout(d,g),_}},772274:(e,t,a)=>{"use strict";a.d(t,{mount:()=>P});a(530522),a(66108),a(296253),a(991181),a(579665),a(95767),a(59357);var n=a(49535),i=a(486125),s=a(695724),r=a(315544),o=a(654612),l=a(454593),c=a(597903),d=a(610124),u=a(309013),_=a(712439),g=a(645523),m=a(419672),p=a(124041),h=a(467253);function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var b="_im_spam_not_spam",y="_im_spam_spam";function w(e,t,a,n){if(!e.loading&&!e.all&&a.scrollTop+window.innerHeight-a.scrollHeight>-300){var i=(0,r.geByClass1)("_im_peer_history",t.bodyNode);e.loading=!0,(0,c.wrapLoading)(i)((0,l.loadSpam)(e.offset,n.get().gid).then((t=>{var a=v(t,4),s=(a[0],a[1]),o=(a[2],a[3]);e.all=o.all,e.offset=o.offset,e.all?(0,r.addClass)(i,"im-important_all"):e.loading=!1,n.set((e=>(0,l.mergeTabs)(e,(0,c.tabFromIds)(o.msgs,o.hash))));var d=(0,r.ce)("div");d.innerHTML=s,i.appendChild(d),(0,m.ensureDomHasActions)(i)})),"bottom")}}function C(e,t){var a,n=t.get().selectedMessages,i=(0,r.geByClass1)("_im_spam_box",e.bodyNode),s=(0,r.geByClass1)("ui_tab_sel",e.bodyNode);if(n.length>0){var o=getLang("mail_selected",n.length);o=o.replace("{count}",n.length),(0,r.val)(s,o+(a=(0,h.getIcon16Cancel)().icon,`<button aria-label="${getLang("mail_deselect_all")}" type="button" class="im-deselect ${c.DESELECT_ALL_CLASS}">${a}</button>`))}else(0,r.val)(s,getLang("mail_spam"));if(0===n.length)(0,r.removeClass)(i,"im-important-box_with-sel");else{(0,r.addClass)(i,"im-important-box_with-sel");var l=document.querySelector("._im_spam_spam"),d=document.querySelector(`.${b}`);l&&d&&(p.FlatButton.setLabel(l,getLang("mail_im_mark_delspam",n.length)),p.FlatButton.setLabel(d,getLang("mail_im_mark_notspam",n.length)))}}function E(e,t,a){var n=e.get().selectedMessages;e.set(l.cleanSelected).then(a.cleanSelection.bind(null,n)).then((a=>C(t,e)))}function S(e,t,a,n){var i=(0,r.gpeByClass)("_im_mess",n,t);if(i){var o=(0,s.intval)((0,r.domData)(i,"msgid"));i&&((0,l.removeMessageSend)([o],0,e.get().tabs[0].hash,"undel",e.get()),(0,c.restoreMessage)(o,0,t))}}function T(e,t,a){var n=e.get().selectedMessages;(0,l.removeMessageSend)(n,0,e.get().tabs[0].hash,"delete",e.get()),(0,c.removeMessagesWithRestore)(n,0,"delete",t),E(e,t,a)}function I(e,t,a){var n=e.get().selectedMessages;(0,l.removeMessageSend)(n,0,e.get().tabs[0].hash,"nospam",e.get()),n.map((e=>(0,r.geByClass1)("_im_mess_"+e))).filter((e=>e)).forEach((e=>{var t=(0,s.intval)((0,r.domData)(e,"peer")),a=(0,s.intval)((0,r.domData)(e,"msgid"));(0,r.val)(e,(0,c.renderGoTo)(t,a)),(0,r.addClass)(e,"im-mess_light")})),E(e,t,a)}function L(e,t,a,i,o){var l=(0,r.gpeByClass)("_im_mess",o,t.bodyNode),c=(0,s.intval)((0,r.domData)(l,"peer")),d=(0,s.intval)((0,r.domData)(l,"msgid"));return t.hide(),a().unmount(),e.get().longpoll.push([(0,g.changePeer)(c,d,!1,!1,"spam_box")]),(0,n.stopEvent)(i),(0,n.cancelEvent)(i),!1}function M(e,t,a,n){var s=(0,o.showFastBox)({title:getLang("mail_deleteall1"),dark:1,bodyStyle:"padding: 20px; line-height: 160%;"},getLang("mail_delete_all_spam"),getLang("mail_delete"),(()=>{(0,l.flushSpam)(e,n).then((e=>{var t=v(e,2),a=(t[0],t[1]);(0,i.showDoneBox)(a)})),s.hide(),t.hide(),a().unmount()}),getLang("mail_close"),(()=>s.hide()))}function k(e,t){return{unmount(){t.unmount(),(0,d.destroyModule)(e)}}}function P(e,t,a){var n=(0,r.ge)("box_layer_wrap"),i=(0,d.createMutations)(k),s=i.callMutations,o=i.bindMutations,l=(0,_.default)({peer:0,oCache:{},tabs:(0,c.tabFromIds)(a.msgs,a.hash),gid:t.get().gid}),g=w.bind(null,{all:a.all,loading:!1,offset:a.offset},e,n,l),p=S.bind(null,l,e.bodyNode),h=L.bind(null,t,e,s),v=M.bind(null,a.hash,e,s,t.get().gid),f=(0,u.mount)(e.bodyNode,l,(t=>({changedMessageSelection:C.bind(null,e)}))),P=T.bind(null,l,e.bodyNode,f),A=I.bind(null,l,e.bodyNode,f),D=E.bind(null,l,e,f);return(0,m.ensureDomHasActions)(e.bodyNode),o((0,d.createModule)({handlers:(t,a)=>{t(n,"scroll",g),t(e.bodyNode.querySelector("."+y),"click",P),t(e.bodyNode.querySelector("."+b),"click",A),t(e.bodyNode.querySelector("._im_spam_flush"),"click",v),a(e.bodyNode,"click","_im_mess_restore",p),a(e.bodyNode,"click","_im_go_to",h),a(e.bodyNode,"click",c.DESELECT_ALL_CLASS,D)}}),f)}},241385:(e,t,a)=>{"use strict";a.d(t,{mount:()=>qe});a(530522),a(66108),a(579665),a(95767),a(21466),a(751876),a(83276),a(991181),a(59357),a(940851),a(296253);var n=a(663825),i=a(49535),s=a(315544),r=a(695724),o=a(430229),l=a(885441),c=a(241103),d=a(454593),u=a(597903),_=a(612202),g=a(104837),m=a(376473),p=a(360573),h=a(188015),v=a(982452),f=a(610124),b=a(495283),y=a(654612),w=a(376852),C=a(786067),E=a(376270),S=a(609720),T=a(475656),I=a(809971),L=a(329164),M=a(826338),k=a(549892),P=a(621963),A=a(251976),D=a(645523),B=a(459554),x=a(993421),O=a(850167),R=a(19331),N=a(240367),F=a(475234),U=a(917791);function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return j(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var q=2e3,K="_mr_button_accept",W="_mr_button_reject",G="_im_submit_btn",V="_im_media_preview",z="MassMentionWarning",Y="MassMentionWarning--hidden";function $(e,t){if(!e)return!1;window.tooltips&&tooltips.hide(e,t)}function Q(e){return e.map((e=>({id:e[1],type:e[0],kind:e[2]||null})))}function Z(e,t,a,i,s,o){var l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(Pe(t,i))return Promise.resolve(!1);var c=se(i),d=(0,g.getTab)(i,t);c.getBoundAttach(a.message)&&(a.message=""),a.share_url=c.getShareUrl(),a.cancelled_shares=c.getCancelledShares();var _=(0,h.random)(),m={peerId:t,messageId:"rid"+_,flags:n.FLAG_OUTBOUND,date:(0,r.intval)(Date.now()/1e3)-i.get().timeshift,subject:"",text:(0,u.replaceSpecialSymbols)((0,r.clean)(a.message)).replace(/\n/gi,"<br>"),local:!0,kludges:{emoji:!0,from_admin:i.get().gid?vk.id:null},type:n.ADD_MESSAGE,attaches:Q(a.attaches),minorSortId:d.minor_sort_id};return(0,R.partConfigEnabled)("im_chasiky_debug")&&(window.meBufferLog[_]=[{text:m.text,timestamp:Date.now(),ts:window.lpConnect.options.ts}]),a.rid=_,a.mess=m,e(t,a),i.get().longpoll.push([m]),l&&o().clearText(t,i),s().newMessage(i),Promise.resolve(!0)}function X(e,t,a,n,i,s,o){var l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];l||(l=e.get().peer);var c=se(e),d=J(c,o),u=d?c.dData.attaches.map((e=>[e.type,e.id])):[],_={message:"",attaches:[].concat(u,s)};o&&(0,r.extend)(_,o),ee(e,t,!1).then((()=>Z(a,l,_,e,t,n,!1).then((a=>(d&&he(e,i,t),Promise.resolve(a)))))).catch((t=>{debugLog(t),ie(e,i)}))}function J(e,t){var a=e.dData,n=t&&t.sticker_referrer,i=n&&0===n.indexOf("suggestion"),s=t&&t.is_hintach_item;return(!a.txt.trim()||i||s)&&0===a.attaches.filter((e=>"reply"!==e.type)).length}function ee(e,t,a){return e.get().tabs[e.get().peer].skipped>0?(t().loadingPeer(e),e.setState({no_moving_down:!0}),e.set(d.changePeer.bind(null,e.get().peer,!1,!1)).then((()=>e.set((t=>(0,U.loadPeer)(t,e.get().peer,-1,!0,!1,"toEnd"))))).then((()=>(t().changePeer(e,!1),e.setState({no_moving_down:!1}),a)))):Promise.resolve(a)}function te(e,t,a){var n=!!(0,r.intval)((0,s.domData)(a,"val"));n!==cur.ctrl_submit&&(cur.ctrl_submit=n,(0,N.setInfo)("messages_multiline_input",String(Number(n))).then((()=>{})),e.set((e=>(0,F.setLocalSettingsValue)("ctrl_submit",Number(n),e))))}function ae(e,t,a,n){return!e.get().delayed_ts&&setTimeout((()=>{e.set(d.setDelayedMessage.bind(null,!1,!1)).then((()=>{a(...n)}))}),t)}function ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,C.getLang)("mail_send_error"),t=(0,C.getLang)("global_error");(0,y.showFastBox)({title:t},e,(0,C.getLang)("mail_ok"),(()=>{nav.reload({force:!0})}))}function ie(e,t){document.activeElement&&document.activeElement.blur(),ne();var a=(0,s.geByClass1)("_im_send",t);return e.set(d.toggleSendingAbility.bind(null,!0)).then((()=>{(0,u.lockButton)(a)}))}function se(e){return e.get().tfdraft||new L.ImDraft}function re(e,t,a,n,i,r){var o=(0,x.getPeer)(e),l=(0,g.getCurrentKeyboard)(e)||{},c=l.one_time,m=void 0!==c&&c,p=(0,s.geByClass1)("_im_send",n);return Promise.resolve().then((()=>{if((0,g.isSendingAvailable)(e)){if((0,d.isAnythingLoading)(e.get())||!(0,u.isFullyLoadedTab)(e,e.get().peer)){var n=ae(e,q,re,(0,v.toArray)(arguments));return e.set(d.setDelayedMessage.bind(null,!0,n)).then((()=>{(0,u.lockButton)(p)}))}return clearTimeout(e.get().delayed_ts),e.set(d.setDelayedMessage.bind(null,!1,!1)).then((()=>(0,u.unlockButton)(p))).then(ee.bind(null,e,t)).then((()=>{var n=r.keyboardAuthorId,s=r.action||{},l=s.attaches||[],c=(0,b.decodeHTMLEntities)(s.payload||""),d=(0,b.decodeHTMLEntities)(s.label||"");(0,u.isChatPeer)(o)&&(d=`@${(0,k.oCacheGet)(e,n).link.slice(1)} ${d}`);return(0,_.statlogsValueEvent)("message_send_from_keyboard",0,e.get().id,o,n),Z(a,o,{message:d,attaches:l,payload:c},e,t,i,!1)})).then((()=>m?e.set(d.deleteKeyboard.bind(null,o)):Promise.resolve())).then((()=>i().fixKeyboard()))}})).catch((t=>{debugLog(t),ie(e,n)}))}function oe(e,t,a,n,i,r){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];return Promise.resolve().then((()=>{var l=(0,s.geByClass1)("_im_send",n);if(!(0,g.isSendingAvailable)(e))return!1;if((0,d.isAnythingLoading)(e.get())||!(0,u.isFullyLoadedTab)(e,e.get().peer)){var c=ae(e,q,oe,(0,v.toArray)(arguments));return e.set(d.setDelayedMessage.bind(null,!0,c)).then((()=>{(0,u.lockButton)(l)}))}clearTimeout(e.get().delayed_ts),i().saveText(e);var _=!1,m=se(e),p=m.dData.attaches.map((e=>{var t;if("poll"==e.type){var a=r.pollData();return a||(_=!0),[e.type,e.id,a]}return"share"==e.type&&(null===(t=e.object)||void 0===t?void 0:t.extpage_raw)?[e.type,e.object.extpage_raw]:[e.type,e.id]})).concat(o);if(_)return!1;var h=e.set(d.setDelayedMessage.bind(null,!1,!1)).then((()=>{(0,u.unlockButton)(l)})),f=(0,x.getPeer)(e);return h.then((()=>{var s=m.dData.txt,r=t().getEditingMessage();if(r||s||p.length){if(r)return s||p.length&&!m.hasOnlyReplies(r)?(0,u.isMessageTooLong)(s)?void(0,y.showFastBox)((0,C.getLang)("global_error"),(0,C.getLang)("mail_err_edit_too_long")):(t().cancelEditing(),void((0,I.wasMessageReallyModified)(e,r,m)&&((0,I.replaceMsgAfterEdit)(e,r,s,p,m.getShareUrl(),m.getCancelledShares()),t().sendEditMessage(e,r),e.get().longpoll.push([(0,D.editMessageLocallyEvent)(r)])))):void le(e,t,n,r.messageId);var o=(0,u.splitMessageToParts)(s,p).map((n=>Z(a,f,{message:n.msgText||"",attaches:n.attaches||[]},e,t,i)));return Promise.all(o)}})).then(ee.bind(null,e,t))})).catch((t=>{debugLog(t),ie(e,n)}))}function le(e,t,a,n){var i=e.get(),r=i.peer,o=(0,y.showFastBox)({title:(0,C.getLang)("mail_dialog_msg_delete_title"),dark:1},(0,C.getLang)("mail_dialog_msg_delete_for_all"),(0,C.getLang)("mail_delete"),(function(e){(0,d.removeMessageSend)([n],r,null,"deleteforall",i),o.hide(),t().cancelEditing()}),(0,C.getLang)("global_cancel"),(function(){o.hide(),ge((0,s.geByClass1)("_im_text",a))}))}function ce(e,t,a){return e.set(d.deliverMessage.bind(null,t,a,{}))}function de(e,t,a,n){e.get().longpoll.push([(0,D.failedMessage)(t,a.mess,n)])}function ue(e,t,a,n,i,r,o,l,c){var _,m=(0,S.debounce)(Ae.bind(null,e,a),500);var p=Emoji.init((0,s.geByClass1)("_im_text",t),{ttDiff:93,rPointer:!0,ref:"im",onSend:()=>Fe(e,t).then((e=>e&&n([]))),controlsCont:t,forceTxt:!e.get().editable,checkEditable:function(a,n){var i=e.get().peer,s=Emoji.val(n);(0,u.isReservedPeer)(i)||Pe(i,e)||se(e).dData.txt==s||!s||function(e){var t=e.get().peer;(0,u.isFullyLoadedTab)(e,t)&&!(0,g.isAnyMessageBeingEdited)(e)&&Date.now()-((0,g.getTab)(e,t).lastTyping||0)>1e3*d.ACTIVITY_PERIOD&&e.set(d.sendTyping.bind(null,t))}(e),Ue(e,t,s),je(e,t,s),m(n);var r=t.offsetHeight;if(_&&_!==r){var o=l().updateScroll();l().scrollFix(e,e.get().peer,o)}_=r},onStickerSend:(e,t,a)=>i([["sticker",e,a]],{sticker_referrer:t}),onHintachSend:(e,t)=>r([[e,t]],{is_hintach_item:!0}),uploadActions:o,suggestionsConfig:e.get().suggestionsConfig,clearText:function(){c().clearText(e.get().peer,e)}});return Emoji.emojiLoadMore(p,{},(()=>l().renderStickersPanel(e))),e.setState({emojiOptId:p}),p}function _e(e,t,a){var n=Emoji.val((0,s.geByClass1)("_im_text",t));(0,g.isAnyMessageBeingEdited)(e)&&""!==n||Fe(e,t).then((t=>{var i=(0,r.intval)((0,s.domData)(a.target,"tttype"));(2===i&&!0!==t||1===i&&!0===t||3!==i&&""===n)&&window.tooltips&&tooltips.destroy(a.target,{fasthide:!0});var o=se(e).dData.attaches.length>0;if((0,g.isAnyMessageBeingEdited)(e)&&""===n&&!o)return(0,s.domData)(a.target,"tttype",3),(0,w.showTooltip)(a.target,{text:(0,C.getLang)("mail_delete_for_all"),black:!0,force:3!==i,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});if(!0!==t)return(0,s.domData)(a.target,"tttype",1),(0,w.showTooltip)(a.target,{text:(0,u.isCommunityInterface)(e)?(0,C.getLang)("mail_send2"):(0,C.getLang)("mail_added_audiomsg"),black:!0,force:1!==i,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});(0,s.domData)(a.target,"tttype",2);return(0,w.showTooltip)(a.target,{text:(()=>{var t=e.get().settings.ctrl_submit?1:0;return getTemplate("ctrl_submit_hint",{enter_on:t?"":"on",ctrl_on:t?"on":""})})(),dir:"down",shift:[-28,-5],needLeft:!0,className:"im-chat-input--tt",hasover:!0,force:2!==i,showdt:700,zIndex:200,hidedt:700,appendParentCls:"_im_chat_input_parent",onCreate(){radioBtns.im_submit={els:(0,v.toArray)((0,s.geByClass)(G)),val:e.get().settings.ctrl_submit?1:0}},onHide(){window.tooltips&&tooltips.destroy(a.target,{fasthide:!0})}})}))}function ge(e){Emoji.focus(e,!0),setTimeout(Emoji.correctCaret.pbind(e),10)}function me(e,t,a,n){var i=e.getFwdRaw(),s=t.querySelector("._im_media_fwd"),r=t.parentNode.querySelector("._im_replied_content");if(!((0,g.getCurrentKeyboard)(n)||{}).hide&&i&&a.toggleKeyboard(!0),s.innerHTML="",r.innerHTML="",i){var o=function(e,t){if(e.get().isEditing){var a=(0,u.getNowEditingMessage)(e);return a&&(0,m.hasReply)(a)}return"reply"===t.type}(n,i),l=o?r:s,c=i.object;l.innerHTML=o?pe(c):function(e,t,a,n){if(a.object&&a.object.authorName){var i=(0,u.renderShortText)(0,"",n.text,!0,(0,M.convertKludgesToAttaches)(n.kludges,0));return getTemplate("im_attach_mess",{messages:i,text:n.authorName,date:(0,C.getSmDate)(n.date,e.get().timeshift),modifier:"im-fwd_msg"})}return getTemplate("im_attach_mess",{messages:(0,C.getLang)("mail_title_X_msgs",t.getFwdCount()),text:(0,C.getLang)("mail_im_fwd_msgs_title"),date:"",modifier:""})}(n,e,i,c)}}function pe(e){var t=(0,u.renderShortText)(0,"",e.text,!0,(0,M.convertKludgesToAttaches)(e.kludges,0));return getTemplate("im_replied_message",{authorName:e.authorName,text:t})}function he(e,t,a){return e.set(d.forwardMessages.bind(null,null,se(e),!1)).then((()=>{var n=t.querySelector("._im_media_fwd"),i=t.parentNode.querySelector("._im_replied_content"),s=document.querySelector("._im_chat_audio_input_parent ._im_replied_content");i&&i.children.length&&(i.innerHTML="",be(e,a)),s&&s.children.length&&(s.innerHTML="",be(e,a)),n&&n.children.length&&(n.innerHTML="",be(e,a)),Ue(e,t)}))}function ve(e,t,a){var n=(0,x.getPeer)(e);e.set(d.acceptMessageRequest.bind(null,n)).then((()=>{Ne(e,n,t),a()})).catch((()=>ne()))}function fe(e,t,a){var n=(0,x.getPeer)(e);e.set((e=>(0,d.rejectMessageRequest)(n,!1,e))).then((()=>{(0,u.isClassicInterface)(e)&&t(e),a(e,n),n===e.get().peer&&e.get().longpoll.push([(0,D.resetPeer)()])})).catch((()=>ne()))}function be(e,t){var a=t().updateScroll();t().scrollFix(e,e.get().peer,a)}function ye(e,t,a,n){var s=e.get().peer,r=inArray(s,e.get().mutedPeers);e.set(d.toggleMutePeer.bind(null,s,!r,-1)).then(a().updateState.bind(null,s)),(0,i.cancelEvent)(n)}function we(e,t,a,n){var s=e.get().peer;e.set(d.returnToChat.bind(null,s)).then((e=>e.set(d.getPinnedMessage.bind(null,s)))).then(a().updateChatTopic.bind(null,s)),(0,i.cancelEvent)(n)}var Ce="close",Ee="open",Se="hide";function Te(e,t,a,n,i,r,o,l){if(o!==Ce&&o!==Ee&&o!==Se)throw new Error(`Action "${o}" not found`);var c=e.get(),d=(0,g.getCurrentKeyboard)(e);((0,u.isCommunityInterface)(e)||!d||c.isEditing)&&(o=Se);var _=o===Ce||o===Se,m=Promise.resolve();_||a.isMounted||(m=a.init());var p=!d&&o!==Ee;return m.then((()=>((0,s.toggleClass)(t,"im-chat-input_open-keyboard",!_),(0,s.toggleClass)(t,"im-chat-input_close-keyboard",_&&o!==Se),(0,s.toggleClass)(n,"im_chat-input--keyboard-button_hidden",o===Se),a.toggle(c.peer,_,r)))).then((()=>{if(!p||l){var t=i().updateScroll();return i().scrollFix(e,c.peer,t)}}))}function Ie(e,t){if((0,g.isAnyMessageBeingEdited)(e))return!1;var a=e.get();if((0,u.isCommunityInterface)(e))return!1;if(!(0,B.getCurrentTab)(e).moneyTransferAvail)return!1;if((0,u.isCommunityPeer)(t))return a.moneyTransferCommAvail;if((0,u.isUserPeer)(t)){var n=inArray(t,a.moneyTransferExcept);return t!=vk.id&&!n&&!(0,u.isContactPeer)(t)}return!1}function Le(e,t){return!(0,g.isAnyMessageBeingEdited)(e)&&(!!e.get().moneyRequestAvail&&(!!(0,B.getCurrentTab)(e).moneyRequestAvail&&(!(!(0,u.isCommunityPeer)(t)&&!(0,u.isChatPeer)(t))||!!(0,u.isUserPeer)(t)&&(t!=vk.id&&!(0,u.isContactPeer)(t)))))}function Me(e,t,a,n,i,o,l,c,d,_,m,p,h,v,b,y){return{restoreKeyboard(){this.toggleKeyboard(!!(ls.get("is_keyboards_hide")||{})[(0,x.getPeer)(e)])},toggleKeyboard(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!(0,g.getCurrentKeyboard)(e).hide;return Te(e,n,p,m,o,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t?Ce:Ee)},initKeyboard(){if(!e.get().peer||!(0,g.getCurrentKeyboard)(e))return Promise.resolve();var t=!!(ls.get("is_keyboards_hide")||{})[(0,x.getPeer)(e)];return Te(e,n,p,m,o,!0,t?Ce:Ee)},fixKeyboard(){var t,a=(0,g.getCurrentKeyboard)(e);return t=a?a.hide?Ce:Ee:Se,Te(e,n,p,m,o,!0,t,!0)},hideKeyboard:()=>Te(e,n,p,m,o,!1,Se),updateMediaSelectorOptions(e){var t=e.get().peer,a={gift:(0,u.isGiftOptionAvailableForPeer)(e,t)&&!(0,g.isAnyMessageBeingEdited)(e),money:(0,u.isMoneyOptionAvailableForPeer)(e,t)&&!(0,g.isAnyMessageBeingEdited)(e),poll:(0,u.isChatPeer)(t)},i=(0,s.geByClass1)("ms_items_more",n);Object.entries(a).forEach((e=>{var t=H(e,2),a=t[0],n=t[1],r=(0,s.geByClass1)("ms_item_"+a,i);(0,s.toggleClass)(r,"ms_item--hidden",!n),n?(0,s.show)(r):(0,s.hide)(r)}))},restoreDraft(e,i,s){t.chosenMedias.length>0&&(e.setState({removingMedias:!0}),t.unchooseMedia(),t.chosenMedias=[],e.setState({removingMedias:!1})),this.updateMediaSelectorOptions(e);var l=e.get().peer,c={im:!0,fromId:-(0,g.getGroupId)(e)||vk.id,peer:l,moneyTransfer:{request:Le(e,l),send:Ie(e,l)}},d=(0,x.getEmojiOptId)(e);if(void 0===d?e.setState({suggestionsConfig:c}):Emoji.setSuggestionsConfig(d,c),(0,u.isReservedPeer)(l))return Promise.resolve();var _=se(e);return Emoji.val(a)!==_.dData.txt?(!function(e,t){Emoji.val(e,(0,r.clean)(t)),ge(e)}(a,_.dData.txt),je(e,n,_.dData.txt)):ge(a),_.prepareObjects(e.get().gid,i&&i.messageId).then((()=>{if(!Ne(e,l,a)&&l==e.get().peer){for(var i=_.dData.attaches,r=0;r<i.length;r++)t.chooseMedia(i[r].type,i[r].id,i[r].object||{});if(me(_,n,this,e),s){var c=o().updateScroll();o().scrollFix(e,l,c)}Ue(e,n,_.dData.txt)}}))},sendMessage(){i([])},sendMessageFromKeyboard(){for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return re.call(null,e,o,v,n,...a)},choose(e,a,n){t.chooseMedia(e,a,n)},updateChosenMedia(e,a,n){t.updateChosenMedia(e,a,n)},canAddMedia:()=>!t.hasRestrictingAttach()&&!Pe(e.get().peer,e),isEmpty:e=>!(0,r.trim)(Emoji.val(a))&&!se(e).hasAttaches(),unchoose(e){t.unchooseMedia(e)},attachCount:()=>t.attachCount(),progress(e,a,n){t.showMediaProgress(e,a,n)},updateState(e){this.restoreKeyboard(),Ne(e,e.get().peer,a)},focusOn(e){Emoji.editableFocus(a,!1,!0)},setDraft(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=(0,g.getTab)(e,e.get().peer);(0,B.doesChatTabHaveFlag)(n,1024)&&!e.get().gid||(h&&h.update(),e.setState({tfdraft:t}),t&&this.restoreDraft(e,o().getEditingMessage(),a))},clearText(e,i){se(i).clear(),t.cancelCheckUrl(),t.unchooseMedia(),t.chosenMedias=[],Emoji.val(a,""),he(i,n,o);var s=o().updateScroll();o().scrollFix(i,i.get().peer,s)},attachMessages(e,t){if(e.get().peer===t){me(se(e),n,this,e);var a=o().updateScroll();o().scrollFix(e,t,a),Ue(e,n)}},detachMessages(t){var a=se(e).getFwdRaw();if(a&&!!a.id.split(";").find((e=>Math.abs(e)===t.messageId)))return he(e,n,o).then((()=>{var t=o().updateScroll();o().scrollFix(e,e.get().peer,t)}));return Promise.resolve()},cancelRecording(){null==_||_.cancelRecording()},reHeight(e){var t=o().updateScroll();o().scrollFix(e,e.get().peer,t)},isBlocked:()=>Pe(e.get().peer,e),toggleStickers(e,t){Emoji.toggleStickers((0,x.getEmojiOptId)(e),!t)},saveText(e){se(e).setText(Emoji.val((0,s.geByClass1)("_im_text",n)))},resendAll(){b()},resendPeer(){y(e.get().peer)},unmount(){(0,f.destroyModule)(d),t.destroy(),c.unmount(),p.unmount(),h&&h.unmount(),Emoji.destroy((0,x.getEmojiOptId)(e)),null==_||_.unmount()}}}function ke(e,t){return!!(0,u.isChatPeer)(e)&&t.get().tabs[e].data.kicked}function Pe(e,t){return ke(e,t)||(0,g.getTab)(t,e)&&(0,g.getTab)(t,e).block_error>0||(0,u.isLocksAvailable)(t)&&(0,u.isPeerBlocked)(e,t)}function Ae(e,t,a){var n=e.get().peer,i=Emoji.val(a);(0,u.isReservedPeer)(n)||se(e).dData.txt==i||Pe(n,e)||(t.checkMessageURLs(i,!0,q),se(e).setText(i))}function De(e){var t=se(e).getFwdRaw();t&&window.showForwardBox({act:"a_show_forward_box",will_fwd:t.id,gid:e.get().gid})}function Be(e,t){e.disabled=!0,e.contentEditable="false",(0,s.addClass)(e,"im-chat-input--text_disabled"),(0,s.addClass)(t,"im-chat-input_error"),(0,s.addClass)((0,s.geByClass1)("_im_page_history"),"is_tf_blocked")}function xe(e,t){e.disabled=!1,e.contentEditable="true",(0,s.removeClass)(e,"im-chat-input--text_disabled"),(0,s.removeClass)(t,"im-chat-input_error"),(0,s.removeClass)((0,s.geByClass1)("_im_page_history"),"is_tf_blocked")}var Oe="renewSubscriptionButton",Re="im-chat-input--donut";function Ne(e,t,a){var n,i=(0,s.gpeByClass)("_im_chat_input_parent",a),r=(0,s.geByClass1)("_im_chat_input_error",i),o=(0,s.geByClass1)("im-chat-input--error",i),l=(0,g.getTab)(e,t),c=Pe(t,e);if(c){Be(a,i);var d=function(e,t,a){switch(a.block_error){case 7:case 5:return(0,C.getLang)("mail_peer_deleted");case 14:return(0,C.getLang)("mail_community_deleted");case 11:return(0,C.getLang)("mail_group_banned_messages");case 28:return(0,C.getLang)("mail_cant_send_messages_by_time");case 29:return(0,C.getLang)("mail_cant_send_messages_by_web_bot");case 4:case 6:case 9:case 19:case 20:case 13:return(0,u.isCommunityPeer)(t)?(0,C.getLang)("mail_send_privacy_community_error"):(0,C.getLang)("mail_send_privacy_error");case 23:var n=(0,k.oCacheGet)(e,t);return(0,C.langSex)(n.sex,(0,C.getLang)("mail_blacklist_user","raw")).replace("{user}",n.kick_name);case 12:return(0,C.getLang)("mail_cant_send_messages_to_community");case 16:return(0,C.getLang)("mail_chat_youre_kicked");case 26:return(0,C.getLang)("mail_chats_is_disabled");case 0:if(ke(t,e))return(0,C.getLang)("mail_chat_youre_kicked");var i=e.get().block_states[t].name;return(0,C.getLang)("mail_community_answering").replace("{username}",i);case 62:return(0,C.getLang)("mail_chats_user_not_don_error");default:return(0,C.getLang)("mail_send_privacy_error")}}(e,t,l),_=function(e,t){var a;return 62===(null===(a=(0,g.getTab)(t,e))||void 0===a?void 0:a.block_error)}(t,e),m=o.querySelector('[data-type="renewSubscriptionButton"]');if(_&&(null==o||o.classList.add(Re),!m)){var p=document.createElement("button");p.textContent=(0,C.getLang)("mail_renew_subscription"),p.classList.add("flat_button"),p.dataset.type=Oe,p.onclick=()=>(0,O.showDonutSubscribePopup)(null,null,l.ownerId,"im",{type:"subscribe",params:{act:"subscribe_popup"}}),o.append(p)}if(m&&!_&&(null==o||o.classList.remove(Re),m.remove()),(0,g.isChannelPeer)(l)&&(0,s.addClass)((0,s.geByClass1)("_im_page_history"),"is_channel"),(0,B.isBusinessNotifyTab)(l)&&(null==o||o.classList.add("im-chat-input--business-notify")),(0,u.isFvkcomgroup)(e,t)&&!e.get().gid){(0,s.addClass)(i,"is-f-vkcomgroup");var h=inArray(t,e.get().mutedPeers);d=(0,g.isChatActive)(l)?getTemplate("sImPeerMuteUnmute",{text:h?(0,C.getLang)("mail_im_unmute"):(0,C.getLang)("mail_im_mute"),type:h?"unmute":"mute"}):getTemplate("sImPeerReturnToChat",{text:(0,C.getLang)("mail_return_to_vkcomgroup")})}else(0,s.removeClass)(i,"is-f-vkcomgroup");return val(r,d),!0}!c&&(null==o?void 0:o.classList.contains(Re))&&(null==o||o.classList.remove(Re),null==o||null===(n=o.querySelector('[data-type="renewSubscriptionButton"]'))||void 0===n||n.remove());return l&&(0,u.tabIsMessageRequest)(l)&&!(0,u.tabIsRejectedMessageRequest)(l)&&!(0,R.partConfigEnabled)("simplified_start_conversation")?(Be(a,i),(0,s.addClass)(i,"is-message_request"),val(r,getTemplate("sImPeerAcceptOrRejectMessageRequest",{cls_accept:K,cls_reject:W})),!0):(i.classList.contains("is-message_request")&&(xe(a,i),(0,s.removeClass)(i,"is-message_request"),val(r,"")),a.disabled&&((0,s.removeClass)(i,"is-f-vkcomgroup"),(0,s.removeClass)((0,s.geByClass1)("_im_page_history"),"is_channel"),xe(a,i),(0,s.removeClass)(i,"is-message_request"),val(r,"")),!1)}function Fe(e,t,a){return Promise.resolve().then((()=>{var n=null!=a?a:Emoji.val((0,s.geByClass1)("_im_text",t));if((0,r.trim)(n))return!(0,g.isAnyMessageBeingEdited)(e)||!(0,u.isMessageTooLong)(n);var i=se(e),o=(0,u.getNowEditingMessage)(e);return i.hasAttaches()&&!i.hasOnlyReplies(o)}))}function Ue(e,t,a){var n=(0,s.geByClass1)("_im_send",t.parentNode);$(n,{fasthide:!0}),Promise.all([Fe(e,t,a),(0,u.isVoiceMessageAvailable)(e)]).then((t=>{var a=H(t,2),i=a[0],r=a[1];if((0,g.isAnyMessageBeingEdited)(e))(0,s.toggleClass)(n,"is_input_empty",!i),(0,s.attr)(n,"aria-label",(0,C.getLang)("mail_im_edit"));else{(0,s.toggleClass)(n,"im-send-btn_audio",!i&&r),(0,s.toggleClass)(n,"im-send-btn_send",i),i&&(0,s.removeClass)(n,"im-send-btn_saudio");var o=i?(0,C.getLang)("mail_send2"):(0,C.getLang)("mail_added_audiomsg");(0,s.attr)(n,"aria-label",o)}}))}function He(e){var t=(0,s.geByClass1)(z,e);t.classList.contains(Y)||t.classList.add(Y)}function je(e,t,a){var n=(0,B.getCurrentTab)(e);if(n){if(!(0,u.isChatPeer)(n.peerId)||(0,g.isChannelPeer)(n))return He(t);var i=(a.match(A.MASS_MENTION_REGEXP)||[]).map((e=>e.slice(1)));if(0===i.length)return He(t),void e.set((e=>(n.dontReopenWarningForCurrentMassMention=!1,Promise.resolve(e))));var r=(0,s.geByClass1)(z,t),o=(0,s.geByClass1)("MassMentionWarning__title",r),l=(0,s.geByClass1)("MassMentionWarning__text",r),c=(e,t)=>{n.dontReopenWarningForCurrentMassMention||(o.innerHTML!==e&&(o.innerHTML=e),l.innerHTML!==t&&(l.innerHTML=t),r.classList.remove(Y))},d=A.MASS_MENTION_ALIASES.all.some((e=>i.includes(e))),_=A.MASS_MENTION_ALIASES.online.some((e=>i.includes(e)));switch(!0){case d&&n.membersCount>=11:return c((0,C.getLang)("mail_im_mass_mention_warning_title"),(0,C.getLang)("mail_im_mass_mention_warning_many_people_mentioned_text",n.membersCount-1));case _&&n.membersCount>=30:return c((0,C.getLang)("mail_im_mass_mention_warning_title"),(0,C.getLang)("mail_im_mass_mention_warning_maybe_many_people_mentioned_text"));default:return He(t)}}}function qe(e,t,a,n,i){cur.share_timehash=t.get().share_timehash;var _=(0,f.createMutations)(Me),m=_.callMutations,h=_.bindMutations,v=(0,T.mount)(e,t,m),b=ce.bind(null,t);ls.remove("im_send_queue_2"+vk.id),ls.remove("im_send_queue_1"+vk.id);var y=(0,p.initQueue)(b,de.bind(null,t),{store:!0,key:"im_send_queue_"+vk.id,waitCommit:!0}),S=y.pushMessage,L=y.inspectQueue,M=y.resend,k=y.resendAll,A=y.resendPeer,O=y.setErrored,R=y.complete,N=X.bind(null,t,i,S,m,e),F=X.bind(null,t,i,S,m,e),U=De.bind(null,t);(0,s.hide)((0,s.geByClass1)("ms_items_more_helper",e));var H,j=t.get().mediaTypes||[["photo",(0,C.getLang)("mail_added_photo")],["video",(0,C.getLang)("profile_wall_video")],["audio",(0,C.getLang)("profile_wall_audio")],["doc",(0,C.getLang)("profile_wall_doc")],["map",(0,C.getLang)("profile_wall_map")],["gift",(0,C.getLang)("profile_wall_gift")]];(t.get().moneyTransferAvail||t.get().moneyRequestAvail)&&j.push(["money",(0,C.getLang)("profile_wall_money")]);var q=new MediaSelector((0,s.geByClass1)("_im_media_selector",e),V,j,{from:"message",maxShown:0,vectorIcon:!0,ignoreMobile:!0,onAddMediaChange:function(a,n,s,r){return a&&m().toggleKeyboard(!0),function(e,t,a,n,i,s,r,o,l){if(!t.get().removingMedias){if("album"===i||"page"===i||"mail"===i||"reply"===i)return!1;if("share"===i&&!r.title)return!1;var c,u;s&&"string"==typeof i?(o&&se(t).addBindUrl(o,i,s),se(t).addAttach(i,s,r)):(se(t).syncWithSelector(l),"number"==typeof s&&l.chosenMedias[s]&&(c=l.chosenMedias[s],u=se(t),("string"==typeof c[0]&&"string"==typeof c[1]&&c[1]||"string"==typeof c[0]&&"group"===c[0])&&u.dData.cancelled.push(`${c[0]},${c[1]}`)));var _=e().updateScroll();if(e().scrollFix(t,t.get().peer,_),t.get().delayed_message&&!(0,d.isAnythingLoading)(t.get()))return a([]),!1;Ue(t,n)}}(i,t,H,e,a,n,s,r,q)},onMediaChange:function(){return function(e,t,a,n,i){if(!t.get().removingMedias){var s=i.getMedias().find((e=>"poll"===e[0]));s&&se(t).addAttach(s[0],s[1],i.pollData(!0,!0)),Ue(t,n)}}(0,t,0,e,q)},editable:1,onChangedSize:function(){var a,n,r=i().updateScroll();i().scrollFix(t,t.get().peer,r),a=e,n=(0,s.ge)(V).offsetHeight,(0,s.toggleClass)(a,"im-chat-input--overflowed",n>400)},sortable:1,teWidth:150,mail:1,teHeight:100,toId:t.get().gid?-t.get().gid:void 0,blockPersonal:t.get().gid?1:0,docParams:t.get().gid?{imhash:t.get().upload_doc_opts.opts.imhash,from:"from_gim"}:{}});H=oe.bind(null,t,i,S,e,m,q);var z=_e.bind(null,t,e),Y=(0,s.geByClass1)("_im_send",e),Q=(0,u.isCommunityInterface)(t)?null:(0,o.mount)(e,t,X.bind(null,t,i,S,m,e),(()=>{(0,s.addClass)(Y,"im-send-btn_audio"),(0,s.removeClass)(Y,"im-send-btn_static")}),(()=>{m().restoreKeyboard()}));!function(e,t){var a=(0,s.geByClass1)("_im_text",e);(window.Wall?Promise.resolve():window.stManager.add(["page.js"])).then((function(){Wall.initComposer(a,{lang:{introText:(0,C.getLang)("profile_mention_start_typing"),noResult:(0,C.getLang)("profile_mention_not_found")},toup:!0,getValue:()=>t.get().peer>2e9?(window.Emoji&&Emoji.editableVal||val)(a):"",onShow:()=>{(0,s.addClass)(e,"im_mention_shown");var t=data(a,"composer");if(t&&t.wdd&&t.wdd.shown){var n=0,i=!1,o=function(){t.ignoredTerm=t.curTerm,t.curTerm=!1,val(t.wddInput,""),Composer.toggleSelectList(t)};(0,r.each)(t.wdd.shown,(function(){this[0]&&(n++,"@"+t.curTerm==this[2]&&(i=!0))})),!n||i&&1==n?o():cancelStackPush("im_mention",o)}},onHide:()=>{(0,s.removeClass)(e,"im_mention_shown"),cancelStackFilter("im_mention")},searchKeys:[1,7,9],wddOpts:{}})}))}(e,t),t.get().textMediaSelector=q,t.set(d.initTextStore.bind(null,L,M,O,R));var Z=(0,s.geByClass1)("_im_text",e);setTimeout((()=>{(0,x.getPeer)(t)&&m().setDraft(t,(0,g.getTabDraft)((0,B.getCurrentTab)(t))),ue(t,e,q,H,N,F,v,i,m),m().updateMediaSelectorOptions(t)}),0);var ee=he.bind(null,t,e,i),ae=ve.bind(null,t,Z,(()=>{var e=i().updateScroll();i().scrollFix(t,(0,x.getPeer)(t),e)})),ne=fe.bind(null,t,a,n),ie=ye.bind(null,t,e,i),le=we.bind(null,t,e,i),me=te.bind(null,t);Ne(t,t.get().peer,Z);var be=e.querySelector("._im_keyboard_button"),Ce=(0,l.mount)(null,t,e,re.bind(null,t,i,S,e,m),m),Ee=(0,u.isCommunityInterface)(t)?(0,c.mount)(t,e.querySelector("._message_templates_container"),(e=>(0,P.setHTML)(Z,e)),(t=>(0,s.toggleClass)(e,"im-chat-input--textarea_show-templates",t))):null,Se=(0,f.createModule)({handlers:(a,n)=>{a(Y,"click",(()=>{He(e),Promise.resolve().then((()=>Fe(t,e))).then((e=>{e||(0,g.isAnyMessageBeingEdited)(t)?H([]):(0,u.isVoiceMessageAvailable)(t).then((e=>{if(e){var a=se(t);J(a)&&function(e){var t=document.querySelector("._im_chat_audio_input_parent ._im_replied_content"),a=e.getFwdRaw();if(a){var n=a.object;t&&(t.innerHTML=pe(n))}else t.innerHTML=""}(a),$(Y,{fasthide:!0}),null==Q||Q.start(),setTimeout((()=>(0,s.removeClass)(Y,"im-send-btn_saudio")),300)}}))}))})),a(Y,"mouseover",z),a(Z,"focus",(()=>{t.get().longpoll.push([(0,D.transitionEvent)("message")]),cur.focused=t.get().peer})),a(Z,"blur",(()=>{var e=0===t.get().peer?"search":"default";t.get().longpoll.push([(0,D.transitionEvent)(e)]),cur.focused=!1})),a(be,"click",(()=>m().toggleKeyboard(void 0))),a(be,"mouseover",(()=>{(0,w.showTooltip)(be,{text(){var e=(0,g.getCurrentKeyboard)(t);return!e||e.hide?(0,C.getLang)("mail_show_keyboard"):(0,C.getLang)("mail_hide_keyboard")},black:!0,shift:[4,5]})})),a((0,s.geByClass1)("MassMentionWarning__close"),"click",(()=>{!function(e,t){He(t),e.set((e=>((0,B.getCurrentTab)(e).dontReopenWarningForCurrentMassMention=!0,Promise.resolve(e))))}(t,e),ge(Z)})),n(e.parentNode,"click","_im_peer_mute_unmute",ie),n(e.parentNode,"click","_im_peer_return_to_chat",le),n(e.parentNode,"click","_im_remove_replied",ee),n(e.parentNode,"click",K,ae),n(e.parentNode,"click",W,ne),n(e,"click","_im_fwd_close",ee),n(e,"click","_im_will_fwd",U),n(e,"keydown","_im_text",(e=>function(e,t,a,n){if(38===n.which&&a().isEmpty(e)&&!t().getEditingMessage()&&!Emoji.shown&&!(0,E.hasAccessibilityMode)()&&!(0,d.isAnythingLoading)(e.get())){var i=(0,I.findLastMessageToEdit)(e,(0,B.getCurrentTab)(e));i&&t().startEditing((0,g.getMessage)(e,e.get().peer,i))}}(t,i,m,e))),n(bodyNode,"click",G,me)}}),Te=h(t,q,Z,e,H,i,L,v,Se,Q,be,Ce,Ee,S,k,A);return Te.initKeyboard(),Te}},180012:(e,t,a)=>{"use strict";a.d(t,{mount:()=>L});a(175115);var n=a(610124),i=a(786067),s=a(654612),r=a(315544),o=a(454593),l=a(104837),c=a(597903),d=a(722088),u=a(695724),_=a(376852),g=a(612202),m=a(163612);function p(){return p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},p.apply(this,arguments)}var h="_im_top_banner_hide",v="_im_top_banner_reject_mr",f="_im_top_banner_business_notify",b="_im_top_banner_friend_add",y="_im_top_banner_button_gifts",w="hiddenCallBanners";function C(e){return!e.children.length}function E(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=(0,r.geByClass1)("_im_dialog_actions",e);(0,r.toggleClass)(n,"im-page--chat-header_top-banner",t),(0,r.toggleClass)(n,"im-page--chat-header_top-banner--mr",!!a.messageRequest),(0,r.toggleClass)(n,"im-page--chat-header_top-banner--business-notify",!!a.businessNotify),(0,r.toggleClass)(n,"im-page--chat-header_top-banner--spam",!!a.spam)}function S(e,t){var a=(0,r.geByClass1)(h,e);a&&window.tooltips&&tooltips.hide(a),E(e,!1),t.innerHTML=""}function T(e,t,a){var n=t.participants,s=n.count>0?(0,i.langNumeric)(n.count,getLang("mail_im_n_chat_members","raw")):"";return(0,u.getTemplate)("sImCallBannerContent",{user_list:(0,m.renderCallUserList)(e,n.list),title:getLang("calls_group_call_banner_title"),desc:s,cls:a?"CallBanner--classic":""})}function I(e){var t=e.peerId;if((0,c.isChatPeer)(e.peerId)&&!(0,l.isChatActive)(e))return!1;var a=e.callInProgress,n=cur.imDb.selectByKey(w);return n?!(!a||n[t]&&n[t]===a.join_link):!!a}function L(e,t,a){var i=(0,r.geByClass1)("_im_top_banner",e),m=(0,n.createModule)({handlers:(n,d)=>{var u=(0,r.geByClass1)("_im_dialog_actions",e);d(e,"click",h,(()=>{var n=t.get().peer,s=(0,l.getTab)(t,n);I(s)?function(e){var t=e.peerId,a=e.callInProgress,n=cur.imDb.selectByKey(w)||{};cur.imDb.updateByKey(w,p({},n,{[t]:a.join_link}))}(s):t.set((e=>(0,o.hideTopBannerAction)(n,e))),S(e,i);var r=!!(0,c.renderPinnedMessage)(t);(0,c.compensateHistoryHeightChange)(t,r,!0,a)})),d(e,"click","_im_top_banner_button",(n=>{var r=function(e,t,a,n,i){var r=e.target,l=t.get().peer;if(r.classList.contains("_im_call_banner_join_btn")){var d=r.dataset.link;return(0,c.joinCallFromIm)(t,l,d,!1,c.CALL_ENTRY_POINT_JOIN_BANNER),!1}var u=r.dataset.payload;return u?(t.set((e=>(0,o.callbackTopBannerAction)(l,u,e))),S(a,n),!0):(r.classList.contains(v)&&(i().showMessageRequestRejectDialog(t),e.originalEvent.preventDefault()),r.classList.contains(b),r.classList.contains(f)&&(i().showBusinessNotifyDialog(),e.originalEvent.preventDefault()),r.classList.contains(y)&&((0,s.showBox)("al_gifts.php",{act:"get_gift_box",mid:l,ref:"im_birthday_banner"},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),(0,g.statlogsValueEvent)("gifts_im_birthday_banner","click",l),e.originalEvent.preventDefault()),!1)}(n,t,e,i,a),l=!r,d=!!(0,c.renderPinnedMessage)(t)||!r;(0,c.compensateHistoryHeightChange)(t,d,l,a)})),d(u,"mouseover",h,((e,t)=>{(0,_.showTooltip)(t,{text:getLang("mail_top_banner_hide"),black:1,shift:[8,4],appendEl:bodyNode})}))}});return{renderPeer(t){var n=(0,l.getTab)(t,t.get().peer);if(n){var s=n.top_banner,r=n.callInProgress,o=!C(i),_=I(n);!_&&!s||(0,l.isSearchShown)(t)?o&&S(e,i):(E(e,!0,{messageRequest:s&&"message_request_banner"===s.name,businessNotify:s&&"business_notify_banner"===s.name,spam:s&&"spam_dialog"===s.name}),i.innerHTML=_?function(e,t){return(0,u.getTemplate)("im_top_banner",{text:T(e,t,(0,l.isClassicInterface)(e)),icon:"",buttons:[(0,u.getTemplate)("sImCallBannerButton",{call_link:t.join_link}),(0,u.getTemplate)("im_top_banner_hide_btn",{})].join(""),classes:"im-top-banner_call"})}(t,r):function(e){var t=e.icon?(0,u.getTemplate)("im_top_banner_icon",{icon:e.icon}):"",a=e.text;"employees_banner"===e.name&&(a=(0,d.replaceHyperLinks)(a,(e=>(0,d.linksReplacer)(!1,e))),a=(0,d.replaceMentions)(a));var n=(e.buttons||[]).map((e=>{var t="";switch(e.layout){case"tertiary":t="im-top-banner--button-tertiary";break;case"secondary":t="secondary";break;default:t="blue_button"}switch(e.type){case"link":return(0,u.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"reject_mr":return t+=" _im_top_banner_reject_mr",(0,u.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"business_notify":return t+=" _im_top_banner_business_notify",(0,u.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"spam":return t+=" _im_top_banner_spam",(0,u.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"gifts_link":return t+=` ${y}`,(0,u.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"friend_add":return t+=" _im_top_banner_friend_add",(0,u.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t});default:return(0,u.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t})}}));return!1!==e.can_hide&&(n=n.concat([(0,u.getTemplate)("im_top_banner_hide_btn",{})])),(0,u.getTemplate)("im_top_banner",{text:a,icon:t,buttons:n.join(""),classes:{message_request_banner:"im-top-banner--mr",business_notify_banner:"im-top-banner--business-notify",spam_dialog:"im-top-banner--spam"}[e.name]})}(s),s&&"birthday"===s.name&&(0,g.statlogsValueEvent)("gifts_im_birthday_banner","view",t.get().peer));var m=!C(i);(0,c.compensateHistoryHeightChange)(t,m,o,a)}},unmount(){(0,n.destroyModule)(m)}}}},475656:(e,t,a)=>{"use strict";a.d(t,{mount:()=>L});a(530522),a(283946),a(59357),a(751876);var n=a(654612),i=a(159121),s=a(479957),r=a(520820),o=a(49535),l=a(695724),c=a(315544),d=a(786067),u=a(610124),_=a(352475),g=a(454593),m="_im_upload_dropbox",p="jpg jpeg png gif heic heif".split(" "),h=["application/vnd.rn-realmedia-vbr","application/vnd.rn-realmedia"];function v(e){var t=p.slice(0,p.length);if("types"===e){for(var a=t.length,n=0;n<a;++n)t.push(t[n].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+p.join(",."):"mask"===e?p.join("|"):""}function f(e,t,a){var s=void 0!==t.ind?t.ind:t,r=t.fileName?s+"_"+t.fileName:t;if((0,c.re)("upload"+r+"_progress_wrap"),e().unchoose(r),!(0,c.geByClass1)("popup_box_container")){var o=(0,d.getLang)("mail_add_doc_error");"wrong_music_file"===a?o=(0,d.getLang)("mail_upload_music_fail"):"wrong_arch_file"===a||"wrong_arch_mp3_file"===a?o=(0,d.getLang)("mail_upload_arch_fail"):"photo"===Upload.options[s].file_name?o=(0,d.getLang)("mail_add_photo_error"):"video_file"===Upload.options[s].file_name?o=(0,d.getLang)("video_upload_error"):"wrong_mp3_file"===a&&(o=(0,d.getLang)("docs_upload_mp3_fail")),setTimeout((0,n.showFastBox)({title:(0,d.getLang)("global_error")},o).hide,2e3)}(0,i.topError)("Upload failed",{dt:-1,type:102,url:((0,c.ge)("file_uploader_form"+s)||{}).action}),Upload.embed(s)}function b(e){var t=void 0!==e.ind?e.ind:e,a=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),n=a?t+"_"+a:e,i=(0,c.ge)("upload"+n+"_progress_wrap");return i&&(0,c.hide)((0,c.geByClass1)("progress_x",i)),n}function y(e,t){if(!e().canAddMedia())return"none";if(!t.items||!t.items.length)return"media";var a="^("+v("mask")+")";return[].slice.call(t.items).every((e=>{var t=e.type.split("/");return new RegExp(a,"i").test(t[1])}))?"photo":[].slice.call(t.items).every((e=>"video"===e.type.split("/")[0]||~h.indexOf(e.type)))?"video":"doc"}function w(e){var t=(0,c.geByClass1)(m),a=(0,c.geByClass1)("im-page--chat-header").getBoundingClientRect(),n=(0,c.geByClass1)("im-chat-input").getBoundingClientRect();(a.width<10||n.bottom-a.bottom<10)&&(e="none"),t.style.top=a.bottom+"px",t.style.left=a.left+1+"px",t.style.width=a.width-2+"px",t.style.height=n.bottom-a.bottom+"px",t.setAttribute("data-mode",e),"none"!==e&&t.classList.add("im-dropbox--visible")}function C(){(0,c.geByClass1)(m).classList.remove("im-dropbox--visible")}function E(e,t,a){return{loaded:t,total:a,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}function S(e,t,a,n){"string"==typeof t&&t.indexOf("TERMINATED")>-1||(t=JSON.parse(t),Upload.onUploadError(e,t.error)),n().reHeight(a)}function T(e,t,a,n,i){var o=t.get().upload_opts,d=(0,c.geByClass1)("_im_upload_photo",i),u=(0,c.geByClass1)("_im_drop_photo",i);return Upload.init(d,o.url,o.params,{accept:v("accept"),file_name:"photo",file_size_limit:26214400,file_types:v("types"),file_match:o.opts.ext_re,lang:o.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:o.opts.server,error:o.opts.default_error,error_hash:o.opts.error_hash,dropbox:u,dragEl:bodyNode,onNoFilteredCallback(e){Upload.onFileApiSend(n,e)},onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,n){var i=(0,r.parseJSON)(n);i.photos?function(e,t,a,n){var i=b(e);ajax.post("al_photos.php",(0,l.extend)({act:"choose_uploaded"},t),{onDone:function(e,t){n().choose("photo",e,(0,l.extend)(t,{upload_ind:i}))},onFail:f.bind(null,n,e)})}(e,i,0,a):S(e,n,t,a)},onUploadProgress(e,t,n){var i=void 0!==e.ind?e.ind:e;a().progress("photo",i,E(e,t,n))},onUploadError(e,t){(0,s.statlogsValueEvent)("upload_photo_fails",1,o.opts.server,t),f(a,e,t)},onDragEnter(e){var t=(0,c.geByClass1)("im-audio-message_recording");e.dataTransfer&&!t&&w(y(a,e.dataTransfer))},onDragOut(){C()},onDrop(){C()}})}function I(e,t,a,n){var i=t.get().upload_doc_opts,o=(0,c.geByClass1)("_im_upload_doc",n),d=(0,c.geByClass1)("_im_drop_doc",n);return Upload.init(o,i.url,i.params,{file_name:"file",file_size_limit:1024*(parseInt(i.file_size_limit_in_MB)||2048)*1024,file_types:"*.*;",lang:i.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"doc",max_attempts:3,server:i.opts.server,error:i.opts.default_error,error_hash:i.opts.error_hash,dropbox:d,dragEl:bodyNode,onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,n){var s=(0,r.parseJSON)(n);s.file?function(e,t,a,n){var i=b(e),s={act:"a_save_doc",blockPersonal:1,from:"choose",mail_add:1};a.opts.imhash&&(s=(0,l.extend)(s,{from_place:"from_gim",imhash:a.opts.imhash})),ajax.post("docs.php",(0,l.extend)(s,t),{onDone:function(e,t,a){n().choose("doc",e+"_"+t,(0,l.extend)(a,{upload_ind:i}))},onFail:f.bind(null,n,e)})}(e,s,i,a):S(e,n,t,a)},onUploadProgress(e,t,n){var i=void 0!==e.ind?e.ind:e;a().progress("doc",i,E(e,t,n))},onUploadError(e,t){(0,s.statlogsValueEvent)("upload_doc_fails",1,i.opts.server,t),f(a,e,t)}})}function L(e,t,a){(0,o.removeEvent)(bodyNode,"dragover dragenter");var i=(0,c.geByClass1)(m),l=I(0,t,a,i),p=function(e,t,a,n,i){var o=t.get().upload_video_params;if(o){var l=(0,c.geByClass1)("_im_upload_video",i),d=(0,c.geByClass1)("_im_drop_video",i);return o.options.visible_dropbox=!1,(0,_.getUploadModule)(l,d,o,null,{onUploadStart:function(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete:function(e,n){var i=(0,r.parseJSON)(n);i.video_id?(0,_.onVideoUploaded)(e,i,t.get().textMediaSelector,((e,a)=>{var n=document.querySelector('[data-video="'+a+'"]'),i=e.editable.sizes.x[0]||e.thumb;if(n&&i){n.style.backgroundImage=`url(${i})`;var s=(0,c.gpeByClass)("_im_mess",n);"im"===cur.module&&s&&(0,g.updateVideoThumb)(t,s)}})):S(e,n,t,a)},onUploadProgress:function(e,t,n){var i=void 0!==e.ind?e.ind:e;a().progress("video",i,E(e,t,n))},onUploadError:function(e,t){(0,s.statlogsValueEvent)("upload_video_fails",1,o.options.server,t),f(a,e,t)},onNoFilteredCallback:function(e){Upload.onFileApiSend(n,e)},onDragEnter:function(e){var t=(0,c.geByClass1)("im-audio-message_recording");e.dataTransfer&&!t&&w(y(a,e.dataTransfer))},onDragOut:function(){C()},onDrop:function(){C()}})}}(0,t,a,l,i),h=T(0,t,a,p,i);cur.lang.attachments_limit=t.get().upload_opts.opts.lang.max_files_warning;var b=(0,u.createModule)({handlers:e=>{var t=(0,c.ge)("im_full_upload");e(t,"change",(function i(s){if(window.Upload&&s.target.files){if(a().canAddMedia()){var r=Array.from(s.target.files),o=r.filter((e=>Upload.checkFileType(e.name,v("types")))),l=r.filter((e=>Upload.checkFileType(e.name,(0,_.getUploadVideoExtMasks)("types"))));Upload.onFileApiSend(h,o),Upload.onFileApiSend(p,l)}else(0,n.showFastBox)((0,d.getLang)("global_error"),(0,d.getLang)("global_error"));(0,u.destroyModule)(b);var c=t.cloneNode();c.value="",t.parentNode.replaceChild(c,t),e(t=c,"change",i)}}))}});return{paste(e){Upload.onFileApiSend(h,e)},unmount(){(0,u.destroyModule)(b),Upload.deinit(h),Upload.deinit(p),Upload.deinit(l)}}}},699750:(e,t,a)=>{"use strict";a.d(t,{mount:()=>f});a(940851),a(296253);var n=a(376852),i=a(40906),s=a(695724),r=a(315544),o=a(786067),l=a(454593),c=a(610124),d="_ui_multiselect_cancel";function u(e,t){return t.selection||(t.selection=[]),t.selection.push(e),Promise.resolve(t)}function _(e){return e.selection=[],Promise.resolve(e)}function g(e,t){return t.selection=t.selection.filter((t=>t.id!==e)),Promise.resolve(t)}function m(e,t,a,n,i,o,l){var c=(0,s.intval)((0,r.domData)(l,"peer"));tooltips.hide(l),t.set(g.bind(null,c)).then((s=>{h(e,n,t,i),a().selectionDeleted(t,c)}))}function p(e,t,a,n){e.set(l.setCurrentSearch.bind(null,a,!1)).then(t().onChange)}function h(e,t,a,n){var s=a.get().selection,l=uiSearch.getFieldEl(e);uiSearch.focus(e),s.length>0?(0,r.attr)(l,"placeholder",""):(0,r.attr)(l,"placeholder",(0,i.unclean)((0,o.getLang)("mail_search_creation"))),t.innerHTML=s.map((e=>`<div class="token">\n      <div class="token_title">${e.name}</div>\n      <div data-peer="${e.id}" class="token_del ${d}"></div>\n    </div>`)).join(""),(0,r.toggleClass)(e,"ui_multiselect_has_selection",s.length>0),(0,r.domFC)(e).scrollTop+=50,n()}function v(e,t){return(0,n.showTooltip)(t,{text:(0,o.getLang)("mail_create_chat_remove_user"),black:1,shift:[15,8],appendParentCls:"_wrap"})}function f(e,t,a){uiSearch.init(e,{onChange:p.bind(null,t,a)});var n=uiSearch.getFieldEl(e),i=(0,r.ce)("div",{className:"_ui_multiselection ui_multiselect_cnt"});n&&n.parentNode.insertBefore(i,n);var s,o,l=(s=n,o=0,function(){var e=s.offsetWidth;(0,r.setStyle)(s,{width:1});var t=s.offsetLeft;o!==t?(o=t,e=s.parentNode.offsetWidth,(0,r.setStyle)(s,{width:Math.max(30,e-t-20)})):(0,r.setStyle)(s,{width:e})});t.set(_);var f=m.bind(null,e,t,a,i,l),b=t=>{document.activeElement!==n&&uiSearch.focus(e)},y=(0,c.createModule)({handlers:(t,a)=>{a(e,"click",d,f),a(e,"mouseover",d,v),t(e,"click",b)}});return{addSelection:(a,n)=>t.set(u.bind(null,{id:a,name:n})).then(h.bind(null,e,i,t,l)),removeSelection:a=>t.set(g.bind(null,a)).then(h.bind(null,e,i,t,l)),resetSelection(){!function(e,t,a,n){e.set(_).then(h.bind(null,t,a,e,n))}(t,e,i,l)},focus(){uiSearch.focus(e)},save(){t.stash(),h(e,i,t,l)},restore(){t.pop(),h(e,i,t,l)},unmount(){uiSearch.destroy(e),(0,c.destroyModule)(y)}}}},878888:(e,t,a)=>{"use strict";a.d(t,{mount:()=>L});a(66108),a(991181),a(820075),a(940851),a(296253);var n=a(597903),i=a(695724),s=a(315544),r=a(982452),o=a(980309),l=a(610124);function c(e,t){return(0,r.toArray)(e).find((e=>(0,s.domData)(e,"list-id")===t))}function d(e,t){return(0,r.toArray)(e).findIndex((e=>(0,s.domData)(e,"list-id")===t))}function u(e,t,a,n){if(a){_(e,t,n);var i=(0,s.domData)(a,"list-id"),r=i&&c(t.children,i);r&&n.forEach((e=>(0,s.addClass)(r,e))),e.setState({hoveredListItemId:i})}}function _(e,t,a){var n=(0,s.domQuery)("."+a.join("."),t);n&&(0,r.toArray)(n).forEach((e=>{a.forEach((t=>(0,s.removeClass)(e,t)))})),e.setState({hoveredListItemId:null})}function g(e,t){var a=t&&(0,s.domQuery)("."+t.join("."),e)[0];return a?(0,s.domData)(a,"list-id"):null}function m(e,t,a){return e.map(t).reduce(((e,t)=>(e[t]=!0,e)),a)}function p(e,t,a){return{ids:m(a.get().elements,e,{}),scrolls:t,activated:!0}}function h(e,t,a){return a.elements=a.elements.filter((a=>t(a)!==e)),delete a.ids[e],Promise.resolve(a)}function v(e,t,a){var n=[];a.elements=a.elements.map((a=>{var i=t(a),s=e.filter((e=>t(e)===i))[0];return n.push(i),s||a}));var i=e.filter((e=>!inArray(t(e),n)));return a.elements=a.elements.concat(i),Promise.resolve(a)}function f(e){var t={};return e.forEach((e=>{"r"===e[0]&&t[`a,${e[1]}`]?delete t[`a,${e[1]}`]:t[`${e[0]},${e[1]}`]=e})),Object.keys(t).map((e=>t[e]))}function b(e,t,a,n,i,r,o){for(var l=0;l<n;l++)e=(0,s.domNS)(e);var c=(0,s.se)(i(t));return(0,s.domData)(c,"list-id",a),e?r.insertBefore(c,e):r.appendChild(c),o&&o(c),e}function y(e,t,a,n,i){var o=n.get(),l=o.limit,c=o.offset,d=function(e,t){var a=t.get();return!a._sortedEls&&e&&t.setState({elements:a.elements.sort(e),_sortedEls:!0}),t.get().elements}(a().sortFn,n).slice(0,c+l),u=(0,r.toArray)(e.children).map((e=>(0,s.domData)(e,"list-id"))).filter((e=>!!e)),_=d.map((e=>a().idFn(e).toString())),g=function(e,t){for(var a=[],n=Math.max(e.length,t.length),i=0;i<n;i++){var s=e[i],r=t[i];!s&&r?a.push(["a",r,i]):s&&!r?a.push(["r",s,i]):s!==r&&(a.push(["r",s,i]),a.push(["a",r,i]))}var o=f(a),l=f(a.reverse());return o.length>l.length?l:o}(u,_);if(function(e,t,a,n,i){if(0!==t.length){var r=(t=t.sort(((e,t)=>e[2]-t[2]))).filter((e=>"a"===e[0])),o=t.filter((e=>"r"===e[0]));if(o.map((t=>e.children[t[2]])).forEach((e=>(0,s.re)(e))),0!==r.length)for(var l=r.shift(),c=l[2],d=(b(e.children[c],a[l[2]],l[1],0,n,e,i),0);d<r.length;d++)l=r[d],b(e.children[c],a[l[2]],l[1],l[2]-c,n,e,i),c=l[2]}}(e,g,d,a().renderFn,a().onRenderFn),function(e,t){e.get().loading?t.update(!1,!0):(e.get().loading=!0,t.update(!1,!0),e.get().loading=!1)}(n,t),i)return g.filter((e=>"a"==e[0])).map((e=>parseInt(e[1])))}function w(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=e.get(),l=t.getContainer().children,c=d(l,n||o.hoveredListItemId);c<0||(o.limit+o.offset<c?e.setState({offset:c-o.limit+1}).then(y.bind(null,t.getContainer(),t,a)):Promise.resolve()).then((()=>{var e=l[c],a=t.scrollTop(),n=t.getScrollHeight(),o=e.offsetHeight;s="center"===s?-.5*n:s,r="center"===r?n/2:r;var d=i?function(e){t.smoothScroll(e-t.scrollTop())}:t.scrollTop.bind(t),u=a+s>e.offsetTop,_=o+e.offsetTop>a+n-r;u?d(e.offsetTop-s):_&&d(e.offsetTop-n+o+r)}))}function C(e,t){if(e.get().loading||e.get().stop||!e.get().activated)return Promise.resolve([]);e.get().loading=!0;for(var a=arguments.length,n=new Array(a>2?a-2:0),i=2;i<a;i++)n[i-2]=arguments[i];return t(...n).then((()=>{e.get().loading=!1}))}function E(e,t,a){return a.scrolls||(a.scrolls={}),a.scrolls[e]&&!t||(a.scrolls[e]={scrolled:a.scrolled||0,scrollItem:a.scrollItem}),Promise.resolve(a)}function S(e,t,a,i){var s=e.get(),r=s.elements,o=i.getContainer(),l=e.setState({offset:s.offset+s.limit}).then((()=>{var a,n=s.offset,l=s.limit;return l+n>r.length?a=t().more(n,l).then((t=>!1===t?[]:(0===t.length&&e.setState({stop:!0}),t))).then(I.bind(null,e,o,i,t,s.pipeId)):(a=Promise.resolve(),y(o,i,t,e)),a}));if(!a){var c=r.length>0?"im-preloader_fixed-bottom":"im-preloader_fixed-center";(0,n.wrapLoading)(o)(l,"bottom",c)}return l}function T(e,t){var a=e.get().pipeId;return!(void 0!==a&&void 0!==t&&a!==t)}function I(e,t,a,n,i,s){return!!T(e,i)&&e.setState(function(e,t,a){var n=e.filter((e=>!a.ids[t(e)]));return{_sortedEls:!1,els:n,ids:m(n,t,a.ids),elements:a.elements.concat(n)}}(s,n().idFn,e.get())).then(y.bind(null,t,a,n))}function L(e,t,a){var n=C.bind(null,t,S.bind(null,t,a)),s=(e,n)=>{(t.get().activated||e)&&(void 0!==n&&t.get().elements.length>0&&t.setState({scrolled:n}),a().onScroll&&a().onScroll())},f=(0,o.createScroll)(e,{noScroll:t.get().noScroll,nativeScroll:t.get().nativeScroll,scrollChange:s.bind(null,!1),more:!!a().more&&n.bind(null,!1)}),b=(0,l.createModule)({handlers:(n,i)=>{i(e,"click",t.get().elCls,a().onClick)}});return t.setState(p(a().idFn,{},t)),{pipe:(e,n)=>(t.setState({pipeId:n}),e.then(I.bind(null,t,f.getContainer(),f,a,n))),replacePreserveOrder:e=>t.set(v.bind(null,e,a().idFn)).then(y.bind(null,f.getContainer(),f,a)),pipeReplace(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.setState({pipeId:n,stop:!1}),e.then((e=>{if(T(t,n))return t.setState({elements:e,_sortedEls:!1,ids:m(e,a().idFn,{})}).then(y.bind(null,f.getContainer(),f,a,t,i))}))},wipe(){f.getContainer().innerHTML=""},deactivate(){t.setState({activated:!1})},activate(){t.setState({activated:!0})},saveScroll:(e,a)=>t.set(E.bind(null,e,a)),updateScroll(){f.update(!1,!0)},toTop(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?f.smoothScroll(-f.scrollTop()):f.scrollTop(0),e&&s(e,0)},scrollTop:e=>f.scrollTop(e),restoreScroll(e){var a=t.get().scrolls,n=a[e];return n&&(t.setState({scrolls:(0,i.extend)({},a,{[e]:null})}),f.scrollTop(n.scrolled)),!!n},unsetScroll(e){t.setState({scrolls:(0,i.extend)({},t.get().scrolls,{[e]:null})})},scrollPage(e,t){var a=f.scroll.scroller,n=f.scrollTop(),i=n+("up"===e?-1:1)*a.clientHeight;t?f.smoothScroll(i-n):f.scrollTop(i)},scrollToElement(e,n,i,s){w(t,f,a,e,n,i,s)},getScroller:()=>f.getScroller(),checkMore:e=>t.get().elements.length<t.get().limit?n(e,f):Promise.resolve([]),add:(e,n)=>I(t,f.getContainer(),f,a,n,e),hoverNextElement(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=f.getContainer(),o=s.children,l=d(o,t.get().hoveredListItemId||g(s,n)),c=(0,r.toArray)(o).slice(l+1).find(a().hoverableFn);u(t,s,c,e),w(t,f,a,null,!1,i.top,i.bottom)},hoverPrevElement(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=f.getContainer(),o=s.children,l=d(o,t.get().hoveredListItemId||g(s,n)),c=l>=0&&(0,r.toArray)(o).slice(0,l).reverse().find(a().hoverableFn);u(t,s,c,e),w(t,f,a,null,!1,i.top,i.bottom)},hoverFirstElement(e,n){var i=f.getContainer(),s=i.children,o=(0,r.toArray)(s).findIndex(a().hoverableFn),l=s[o];!t.get().hoveredListItemId&&l&&(u(t,i,l,e),w(t,f,a,o,!1,n.top,n.bottom))},hoverElement(e,n,i){var s=f.getContainer(),r=s.children,o=d(r,e),l=r[o];l&&(u(t,s,l,n),w(t,f,a,o,!1,i.top,i.bottom))},unhoverElements(e){_(t,f.getContainer(),e)},reset(){var e=t.get().scrolls;t.reset(),t.setState(p(a().idFn,e,t))},getHoveredElement:()=>c(f.getContainer().children,t.get().hoveredListItemId),getCurrentElements:()=>t.get().elements,isLoading:()=>t.get().loading,isEmpty:()=>0===t.get().elements.length,remove(e){t.set(h.bind(null,e,a().idFn)).then(y.bind(null,f.getContainer(),f,a))},unmount(){(0,l.destroyModule)(b),f.destroy()}}}},293498:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(175115),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(726271),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(695724),_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(315544),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(49535),_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(386409),_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(635676),_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(635429),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(787481);function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_extends.apply(this,arguments)}var DATA_ATTR_SUBMENU_NAVIGABLE="data-uirmenu-submenu-navigable",uiRightMenu={initMenu:function(e,t){if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(e,"ui_rmenu_sliding")){var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item",e),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item_sel",e),i=n||a,s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(i)[1],r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(i)[1]-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(e)[1],o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("_ui_rmenu_slider",e);if(!t){var l={height:s,top:n?r:0};(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.setStyle)(o,l),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.addClass)(e,"ui_rmenu_sliding")}}},go:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.checkEvent)(t))return!0;var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e),s=n.navOptions,r=n.ignoreSelected,o=void 0!==r&&r,l=n.switchMenuOptions;if(!o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item_sel",i)==e)return!1;if(uiRightMenu.switchMenu(e,void 0,l),uiRightMenu.showProgress(e),!1===a)return!1;var c={onDone:function(){for(var t,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];null==s||null===(t=s.onDone)||void 0===t||t.call(s,...n),uiRightMenu.hideProgress(e)}},d=_extends({},s||void 0,{},c);return nav.go(a||e,t,d)},switchMenu:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item_sel",n),s=a.preventSubmenuExpand,r=void 0!==s&&s;if(e==i&&!t)return!1;uiRightMenu.initMenu(n);var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(e)[1],l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(e)[1]-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(n)[1],c=[],d=[];if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(n,"_ui_rmenu_auto_expand")){var u=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass)("_ui_rmenu_sublist",n),_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(e,"_ui_rmenu_subitem")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("_ui_rmenu_sublist",e):!!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domNS)(e),"_ui_rmenu_sublist")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domNS)(e);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(u,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.isVisible)(this)&&this!==_&&(c.push(this),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hide)(this))})),r||!_||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.isVisible)(_)||(d.push(_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.show)(_)),l=e.offsetTop,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(c,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.show)(this)})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(d,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hide)(this)}))}var g=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("_ui_rmenu_slider",n),m=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)(g.style.top),p={height:o};return _shared_lib_browser__WEBPACK_IMPORTED_MODULE_1__.browser.msie_edge?p.marginTop=l-m+"px":p[cssTransformProp]="translateY("+(l-m)+"px)",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.setStyle)(g,p),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(i,"ui_rmenu_item_sel"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.addClass)(e,"ui_rmenu_item_sel"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(n,"_ui_rmenu_auto_expand")?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(c.concat(d),(function(){uiRightMenu.toggleSubmenu(this)})):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(e,"_ui_rmenu_subitem")&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.isVisible)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domPN)(e))&&uiRightMenu.toggleSubmenu((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domPN)(e)),!1},fixScroller:function(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e);if(t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.isVisible)(e)){var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(t,"ui_rmenu_sliding"),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(e)[1];a&&uiRightMenu.hideSliding(t);var i=e.offsetTop,s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("_ui_rmenu_slider",t),r=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)(s.style.top),o={height:n};_shared_lib_browser__WEBPACK_IMPORTED_MODULE_1__.browser.msie_edge?o.marginTop=i-r+"px":o[cssTransformProp]="translateY("+(i-r)+"px)",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.setStyle)(s,o),e.offsetLeft,a&&uiRightMenu.showSliding(t)}},unselectAll:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(e,"ui_rmenu_sliding"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item_sel",e),"ui_rmenu_item_sel")},hideSliding:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(e,"ui_rmenu_sliding")},showSliding:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.addClass)(e,"ui_rmenu_sliding")},showProgress:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(e,"ui_rmenu")||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e));var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_loading_item",e);t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(t,"ui_rmenu_loading_item");var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_item_sel",e);(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.hideProgress)(e),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.showProgress)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domFC)(a).parentNode,"","",!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.addClass)(e,"ui_rmenu_loading"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.addClass)(a,"ui_rmenu_loading_item")},hideProgress:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.hasClass)(e,"ui_rmenu")||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e)),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.hideProgress)(e);var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",e);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(e,"ui_rmenu_loading"),uiRightMenu.hideSliding(t);var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("ui_rmenu_loading_item",t);a&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.removeClass)(a,"ui_rmenu_loading_item")},toggleSubmenu:function toggleSubmenu(name,ref,event){if(!event||!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.checkEvent)(event)){var isSubmenuNavigatedResult=toggleSubmenuNavigable(ref);if(isSubmenuNavigatedResult.navigated)return isSubmenuNavigatedResult.navGoResult;var menu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.gpeByClass)("ui_rmenu",ref),el,submenu;if("string"==typeof name?submenu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("_ui_rmenu_"+name+"_list",menu):(submenu=name,name=submenu.getAttribute("data-sublist-id")),el=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.geByClass1)("_ui_rmenu_"+name+"_toggle",menu),!submenu)return!1;void 0!==ref&&uiRightMenu.hideSliding(menu),el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.toggleClass)(el,"ui_rmenu_item_expanded",!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.isVisible)(submenu)),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_6__.slideToggle)(submenu,submenu&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(submenu)[1]?100:0),setTimeout(_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_7__.updateNarrow,100);var onToggle=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domData)(el,"on-toggle");return onToggle&&setTimeout((function(){try{eval(onToggle)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,onToggle)}}),150),!1}}};function isItemSubmenuNavigable(e){var t;return null==e||null===(t=e.hasAttribute)||void 0===t?void 0:t.call(e,DATA_ATTR_SUBMENU_NAVIGABLE)}function toggleSubmenuNavigable(e){if(isItemSubmenuNavigable(e)&&!e.classList.contains("ui_rmenu_item_sel"))return{navigated:!0,navGoResult:uiRightMenu.go(e,void 0,void 0,{switchMenuOptions:{preventSubmenuExpand:!0}})};return{navigated:!1}}const __WEBPACK_DEFAULT_EXPORT__=uiRightMenu},944825:(e,t,a)=>{"use strict";a.d(t,{initDraggable:()=>i,removeDraggable:()=>s});var n=a(49535);function i(e,t){var a,i,s=function(n){a=void 0!==n.clientX?n.clientX:n.touches[0].clientX,i=void 0!==n.clientY?n.clientY:n.touches[0].clientY,t.onDrag&&t.onDrag.call(e,a,i)},r=function r(o){t.onDrop&&t.onDrop.call(e,a,i),(0,n.removeEvent)(document,"mouseup touchend mouseleave",r),(0,n.removeEvent)(document,"mousemove touchmove",s)},o=function(o){(1===o.which||o.touches&&o.touches[0])&&((0,n.addEvent)(document,"mouseup touchend mouseleave",r),(0,n.addEvent)(document,"mousemove touchmove",s),a=void 0!==o.clientX?o.clientX:o.touches[0].clientX,i=void 0!==o.clientY?o.clientY:o.touches[0].clientY,t.onStartDrag&&t.onStartDrag.call(e,a,i),t.onDrag&&t.onDrag.call(e,a,i),(0,n.cancelEvent)(o))};e.beginDragHandler=o,(0,n.addEvent)(e,"mousedown touchstart",o)}function s(e){(0,n.removeEvent)(e,"mousedown touchstart",e.beginDragHandler)}},594476:(e,t,a)=>{"use strict";a.d(t,{default:()=>m});a(530522),a(66108),a(296253),a(991181),a(579665),a(95767);var n=a(315544);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var r=[],o=0,l=!1;function c(e){r=r.reduce(((t,a)=>{var n=i(a,2),s=n[0],r=n[1];return r(e)?t:t.concat([[s,r]])}),[])}function d(e,t){!1===l&&(l=!0,document.body.addEventListener("click",c,!0)),r=r.concat([[e,t]])}function u(e){r=r.filter((t=>i(t,1)[0]!==e)),0===o&&(document.body.removeEventListener("click",c,!0),l=!1)}function _(e,t){r=r.map((a=>{var n=i(a,2),s=n[0],r=n[1];return s===e?[e,t]:[s,r]}))}function g(e,t){return 0===t.length?t=>(e(t),!0):a=>{var i=t.reduce(((e,t)=>e&&!(0,n.domClosest)(t,a.target)),!0);return i&&e(a),i}}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return o++,{stop(){o--,u(e)},replaceOrAdd(a){var n=r.filter((t=>{var a=i(t,1)[0];return e===a})),s=g(a,t);n.length>0?_(e,s):d(e,s)}}}},445637:(e,t,a)=>{"use strict";a.d(t,{create:()=>d});a(940851),a(296253);var n=a(712439),i=a(315544),s=a(49535),r=a(597903),o=a(254692);function l(e,t){return t.state=e,Promise.resolve(t)}function c(e,t,a,n,i){switch(t){case o.ARROW_UP:(0,r.isEditableFocused)()||(n.scroll(i,"up"),(0,s.cancelEvent)(a));break;case o.ARROW_DOWN:(0,r.isEditableFocused)()||(n.scroll(i,"down"),(0,s.cancelEvent)(a));break;case o.PAGE_UP:a.ctrlKey||(0,r.isClassicInterface)(i)||(n.scroll(i,"up",!0),(0,s.cancelEvent)(a));break;case o.PAGE_DOWN:a.ctrlKey||(0,r.isClassicInterface)(i)||(n.scroll(i,"down",!0),(0,s.cancelEvent)(a));break;case o.HOME:(0,r.isEditableFocused)()||(n.scroll(i,"up",!1,!0),(0,s.cancelEvent)(a));break;case o.END_KEY:(0,r.isEditableFocused)()||(n.scroll(i,"down",!1,!0),(0,s.cancelEvent)(a));break;case o.PRINTABLE:n.focustTxt(e)}}function d(e,t,a,d,u,_){var g=(0,n.default)({state:t||"default"});return{signal(t,n){if(!(cur.storyLayer||cur.articleEditorLayer||window.isArticleLayerOpen()))switch(g.get().state){case"default":return c(g,t,n,d,e);case"fwd":case"search":return function(e,t,a,n,l,c){switch(t){case o.ARROW_DOWN:n&&n.hoverNextDialog(c),(0,s.cancelEvent)(a);break;case o.ARROW_UP:n&&n.hoverPrevDialog(c),(0,s.cancelEvent)(a);break;case o.ENTER:(0,r.isEditableFocused)()&&!(0,i.gpeByClass)("_im_dialogs_search_input",document.activeElement)||n&&n.selectHoveredDialog(c);break;case o.PRINTABLE:l.focusInput()}}(0,t,n,a,u,e);case"create":return function(e,t,a,n,l){switch(t){case o.PAGE_UP:!a.ctrlKey&&(0,r.isClassicInterface)(l)&&(n.scroll("up"),(0,s.cancelEvent)(a));break;case o.PAGE_DOWN:!a.ctrlKey&&(0,r.isClassicInterface)(l)&&(n.scroll("down"),(0,s.cancelEvent)(a));break;case o.ARROW_DOWN:n.hoverNextElement(l);break;case o.ARROW_UP:n.hoverPrevElement(l);break;case o.ENTER:(0,i.gpeByClass)("_im_dialogs_creation_name",document.activeElement)?n.confirmCreate(l):(0,i.gpeByClass)("im-create--search",document.activeElement)&&n.selectElement(l);break;case o.PRINTABLE:n.focusSearch(l)}}(0,t,n,_,e);case"message":return function(e,t,a,n,i){switch(t){case o.HOME:case o.END_KEY:n.isEmpty(i)&&c(e,t,a,n,i);break;case o.PAGE_UP:case o.PAGE_DOWN:c(e,t,a,n,i)}}(g,t,n,d,e);default:throw new Error("Unknown state: "+g.get().state)}},transition:e=>g.set(l.bind(null,e))}}},13810:(e,t,a)=>{"use strict";a.d(t,{startLongPollForGroup:()=>k,startLongPoll:()=>P});a(530522),a(66108),a(579665),a(95767),a(940851),a(991181),a(296253);var n=a(454593),i=a(479957),s=a(695724),r=a(712439),o=a(887294),l=a(663825),c=a(191040),d=a(360573),u=a(982452),_=a(988058),g=a(384099),m=a(968958);function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var v={},f=Date.now();function b(e,t){var a=Math.floor(t.status/100);t.status&&e.stat&&(t.status>=500&&t.status<600&&(0,i.statlogsValueEvent)("im_longpoll",1,a+"0x",t.getResponseHeader("x-frontend")),v[a]=v[a]?v[a]+1:1,Date.now()-f>=3e4&&(Object.keys(v).forEach((e=>{(0,i.statlogsValueEvent)("im_longpoll",v[e],e+"0x",t.getResponseHeader("x-frontend"))})),v={},f=Date.now()))}function y(e,t){return Promise.resolve((0,s.extend)({},t,{timeout:e<64?2*e:e}))}function w(e,t){return Promise.resolve((0,s.extend)({},t,{imTs:e}))}function C(e){e.set((e=>Promise.resolve((0,s.extend)({},e,{stopped:!0})))).then((()=>{e.get().cancelToken()}))}function E(e,t){return t.cancelToken=e,Promise.resolve(t)}function S(e,t){return t.pauses||(t.pauses=[]),t.pauses.push(e),Promise.resolve(t)}function T(e){return e.pauses||(e.pauses=[]),(0,u.lplog)("Aborting all pauses","error"),e.pauses.forEach((e=>e())),e.pauses=[],Promise.resolve(e)}function I(e,t,a,i){var s=i.failed?(0,c.abortablePause)(4,e):{},r=s.abort,o=s.pause;switch(i.failed){case 1:return(0,u.lplog)("Old timestamp, init resync","error"),e.set(S.bind(null,r)),a([l.resyncEvent()]),e.set(n.loadLongPollTs).then(o).then(L.bind(null,e,t,a));case 2:return(0,u.lplog)("Key is incorrect","error"),e.set(S.bind(null,r)),e.set(n.loadLongPollKey).then(o).then(L.bind(null,e,t,a));case 3:throw(0,m.imWeirdLog)("im_longpoll_force_reload",i,!1),nav.reload({force:!0}),new Error("ts is very wrong");default:return e.set(w.bind(null,i.ts)).then((()=>i))}}function L(e,t,a){if(e.get().stopped)return Promise.resolve({updates:[]});if(t())return Promise.reject(new Error("pause"));var n=e.get(),i=`${n.imUrl}/${n.imPart}`,s=(0,o.plaingetCancelable)(i,{act:"a_check",key:n.imKey,version:14,ts:n.imTs,wait:25,mode:n.mode}),r=s.request,l=s.cancel;return e.set(E.bind(null,l)).then((()=>r)).then((t=>{var a=p(t,2),i=a[0],s=a[1];return s&&b(n,s),e.set(y.bind(null,1)),JSON.parse(i)})).catch((e=>{var t=p(e,2),a=(t[0],t[1]);return a&&b(n,a),Promise.reject(new Error(""))})).then(I.bind(null,e,t,a))}function M(e,t,a){e.get().stopped||((0,u.lplog)("New request"),L(e,a,t).then((e=>e.map(l.constructEvent))).then((e=>((0,u.lplog)("Request success","success"),e))).then(t).catch((t=>{if(!e.get().stopped)return(0,u.lplog)("Error, waiting: "+(t.message||"no message (probably browser reset)"),"error"),e.set(y.bind(null,a()?2:e.get().timeout)).then((()=>{var t=(0,c.abortablePause)(e.get().timeout,e),a=t.abort,n=t.pause;return e.set(S.bind(null,a)).then(n)}));(0,u.lplog)("Stopped longpoll")})).then(M.bind(null,e,t,a)))}function k(e){(0,m.imWeirdLog)("im_start_longpoll_group",{},!1);var t=new window.EventEmitter,a=(0,g.createLongpollEventsQueue)(e.ts,(e=>{t.trigger("data",e)})),n=(0,_.createLongpoll)(e,a.onLp);return{onData:e=>t.on("data",e),offData:e=>t.off("data",e),push:e=>t.trigger("data",e),pause:a.pause.bind(a),resume:a.resume.bind(a),abortWaiting:n.abortWaiting.bind(n),onLp:a.onLp.bind(a),stop:n.stopConnection.bind(n),isEnabled:()=>!(!n||n.isStopped())}}function P(e){var t=e.id,a=e.gid,n=e.key,i=e.ts,s=e.url,o=e.lhost,l=e.lpstat,c="main",u=new EventEmitter,_=window.vk.lpConfig&&window.vk.lpConfig.enabled&&window.longpollTesting_onImEvents,g=(0,d.initQueue)((function(e,t){return _&&window.longpollTesting_onImEvents(t),u.trigger("data",t),Promise.resolve({})})),m=g.pause,p=g.resume,h=g.pushMessage,v=g.isPaused,f=g.reset,b=(0,r.default)({id:t,gid:a,mode:202,timeout:1,imKey:n,imTs:i,imPart:s,imUrl:o,pause:!1,stat:l});return M(b,h.bind(null,c),v.bind(null,c)),{onData:e=>u.on("data",e),offData:e=>u.off("data",e),abortWaiting:()=>b.set(T),stop:C.bind(null,b),pause:m.bind(null,c),resume:p.bind(null,c),reset:f.bind(null,c),push:e=>u.trigger("data",e),isEnabled:()=>!b.get().pause&&!b.get().stopped}}},360573:(e,t,a)=>{"use strict";a.d(t,{initQueue:()=>f});a(820075),a(991181),a(940851),a(296253);var n=a(712439),i=a(695724),s=a(191040),r=a(19331);function o(e,t){return t.queues[e].currEv=!1,Promise.resolve(t)}function l(e,t){var a=t.queues[e].currEv;return a?(t.queues[e].errored.push(a),o(e,t)):Promise.resolve(t)}function c(e,t,a){return a.queues[e]?(a.queues[e].errored=t?[]:a.queues[e].errored.concat(a.queues[e].evs),a.queues[e].evs=[],o(e,a)):Promise.resolve(a)}function d(e,t,a,n){var i=n.get().queues[e];if(i&&!i.currEv&&i.evs.length>0&&!i.pause){var s=d.bind(null,e,t,a,n),r=i.evs.shift();i.currEv=r,t(e,r).then((()=>{n.get().opts.waitCommit||n.set(o.bind(null,e))})).then(s).catch((t=>n.set(l.bind(null,e)).then((()=>{a(e,function(e,t){var a=m(e,t.get()).errored;return a.length>0&&a[a.length-1]}(e,n),t)})).then(s)))}}function u(e,t,a){var n=a.queues[e];return n.errored.filter((e=>e.mess.messageId===t)).forEach((e=>{e.failed=!1,n.evs.push(e)})),n.errored=n.errored.filter((e=>e.mess.messageId!==t)),Promise.resolve(a)}function _(e){var t=Date.now();return Object.keys(e.queues).forEach((a=>g(a,e,t,18e5))),Promise.resolve(e)}function g(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t.queues[e],s=[];return i.errored.forEach((e=>{e.ts>=a-n?(e.failed=!1,i.evs.push(e)):s.push(e)})),i.errored=s,Promise.resolve(t)}function m(e,t){return t.queues[e]||(t.queues[e]={evs:[],pause:!1,errored:[],currEv:!1}),t.queues[e]}function p(e,t,a){return m(e,a).pause=t,Promise.resolve(a)}function h(e,t,a){return t.ts=Date.now(),m(e,a).evs.push(t),Promise.resolve(a)}function v(e){Object.keys(e.get().queues).forEach((t=>{e.set(l.bind(null,t)),e.set(c.bind(null,t,!1))}))}function f(e,t,a){var l=(0,n.default)({queues:{},debug:a&&a.debug,opts:(0,i.extend)({},a)},a);return a&&a.store?(l.setState(function(e){for(var t={},a=Object.keys(e.queues),n=a.length,i=0;i<n;i++){var s=a[i],r=e.queues[s];(r.currEv||r.evs.length||r.errored.length)&&(t[s]=r)}return{queues:t,opts:e.opts}}(l.get())),v(l)):v(l),{pushMessage:(a,n)=>l.set(h.bind(null,a,n)).then((i=>{(0,r.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog[n.rid].push("queue push message"),d(a,e,t,i)})),resend(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return l.set(u.bind(null,a,n)).then((()=>{var i=l.get().queues[a].evs.filter((e=>e.mess.messageId===n))[0];return d(a,e,t,l),i}))},resendAll:()=>l.set(_).then((()=>{Object.keys(l.get().queues).forEach((a=>{d(a,e,t,l)}))})),resendPeer:a=>l.set(g.bind(null,a)).then((()=>{d(a,e,t,l)})),reset:a=>l.set(c.bind(null,a,!0)).then((n=>{d(a,e,t,n)})),setErrored:(e,t)=>l.set((a=>(m(e,a).errored=t,Promise.resolve(a)))),pause(e){l.set(p.bind(null,e,!0))},isPaused:e=>!!m(e,l.get()).pause,complete(a,n){var i=l.get();i.queues[a].currEv&&i.queues[a].currEv.rid===n&&l.set(o.bind(null,a)).then((()=>{d(a,e,t,l)}))},resume(a){l.set(p.bind(null,a,!1)).then((0,s.pause)(.1)).then((()=>{d(a,e,t,l)}))},inspectQueue(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!l.get().queues[e])return[];var a=l.get().queues[e];return(t&&a.currEv?[a.currEv]:[]).concat(a.evs.slice()).concat(a.errored.slice().map((e=>(0,i.extend)({},e,{failed:!0})))).sort(((e,t)=>e.ts-t.ts))}}}},507212:(e,t,a)=>{"use strict";a.d(t,{createWorker:()=>v});a(579665),a(95767),a(530522),a(66108),a(751876),a(175115),a(991181),a(296253),a(388416);var n=a(191040),i=a(695724);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return a}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return o(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},l.apply(this,arguments)}var c=new Map,d=!1;function u(e){return e.queue||e.key}function _(){c.forEach(((e,t)=>{var a=e.onData,n=e.onUpdateKey,i=e.ts;if(function(e){var t;return!!(null===(t=window.curNotifier)||void 0===t?void 0:t.addQueues)&&!curNotifier.addQueues[u(e)]}(t)){var s=l({},t,{ts:i});Notifier.addKey(s,h.bind(null,a,n,s))}}))}function g(){d||(d=setInterval(_,3e3))}function m(e){!function(e){var t;if(!(null===(t=window.curNotifier)||void 0===t?void 0:t.addQueues))return!1;delete curNotifier.addQueues[u(e)]}(e),c.delete(e),0===c.size&&(clearInterval(d),d=!1)}function p(e,t){var a,n=void 0,i=null==e?void 0:e.queue;if(i){var o,l=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=r(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}(c);try{for(l.s();!(o=l.n()).done;){var d=s(o.value,1)[0];if((null==d?void 0:d.queue)===i){n=d;break}}}catch(e){l.e(e)}finally{l.f()}}var u=null!==(a=n)&&void 0!==a?a:e;c.set(u,t)}function h(e,t,a,s,r){if(r.failed)return m(a),void function(e,t,a,i){var s;switch(e){case 1:case 2:case 3:case 5:s=i(t,e);break;case 4:s=(0,n.pause)(1).then((()=>t));break;default:throw new Error("Unkonwn error from queue: "+e)}(0,n.pause)(3).then((()=>s)).then((e=>{c.set(e,{onUpdateKey:i,onData:a,ts:e.ts}),_(),g()}))}(r.err,a,e,t);var o=(0,i.intval)(r.ts);Object.assign(a,{ts:o}),p(a,{onData:e,onUpdateKey:t,ts:o}),r.events.map((e=>"string"==typeof e?e.split("<!>"):e)).forEach(e)}function v(e,t,a){return Notifier.addKey(e,h.bind(null,t,a,e)),c.set(e,{onData:t,onUpdateKey:a,ts:e.ts}),g(),{stop:m.bind(null,e)}}},352475:(e,t,a)=>{"use strict";a.d(t,{default:()=>g,getUploadVideoExtMasks:()=>m,getUploadModule:()=>h,onVideoUploaded:()=>v});a(175115),a(59357);var n=a(654612),i=a(159121),s=a(479957),r=a(520820),o=a(695724),l=a(486125),c=a(49535),d=a(803834),u=a(315544),_=a(306908);const g={getUploadModule:(e,t,a,n,i)=>h(e,t,a,n,i),initModalVideoUploader(e){var t=cur.videoUploadParams,a=(0,u.ge)("choose_video_upload");if(!a)return!1;this.initDragEvents();var n={};return"article"===e&&(n.onUploadProgress=()=>{},n.onUploadStartDone=()=>{var e,t;null===(e=(t=cur).onMediaUploadStarted)||void 0===e||e.call(t)},n.onUploadError=()=>{var e,t;null===(e=(t=cur).onMediaUploadFail)||void 0===e||e.call(t)}),h(a,boxLayerWrap,t,null,n)},initDragEvents(){var e,t=e=>{cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);var t=(0,u.ge)("video_choose_upload_area_wrap");if(!(0,u.hasClass)(t,"video_choose_upload_area_enter")){(0,u.addClass)(t,"video_choose_upload_area_enter");var a=(0,u.ge)("video_choose_wrap"),n=(0,u.getXY)(a)[1],i=(0,u.getSize)(t)[1];return(0,u.hide)("video_choose_wrap"),(0,u.setStyle)(t,"height",(0,d.scrollGetY)()+(0,u.clientHeight)()-n+i),(0,c.cancelEvent)(e)}},a=e=>(0,c.cancelEvent)(e),n=e=>{if(a(),e.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,e.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,e.dataTransfer.files),(0,c.cancelEvent)(e)},i=()=>{(0,c.addEvent)(boxLayerWrap,"dragenter dragover",t),(0,c.addEvent)(boxLayerWrap,"dragleave",a),(0,c.addEvent)(boxLayerWrap,"drop",n)};i();var s=null===(e=(0,l.curBox)().getOptions())||void 0===e?void 0:e.onHide;setTimeout((0,l.curBox)().setOptions.pbind({onHide:()=>{if((0,c.removeEvent)(boxLayerWrap,"dragenter dragover",t),(0,c.removeEvent)(boxLayerWrap,"dragleave",a),(0,c.removeEvent)(boxLayerWrap,"drop",n),"function"==typeof s)return s()},onShow:()=>{Video.initChooseBox(),i()}}),0)}};function m(e){var t=_.VIDEO_UPLOAD_EXTS.slice(0,_.VIDEO_UPLOAD_EXTS.length);if("types"===e){for(var a=t.length,n=0;n<a;++n)t.push(t[n].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+_.VIDEO_UPLOAD_EXTS.join(",."):""}function p(e){if(!cur.leaving){var t=getLang("video_upload_changed"),a=!1;if((0,o.each)(window.cur.videoUploaders,((e,t)=>{Upload.isSomethingUploading(t)&&(a=!0)})),1===e){if(!a)return!0;var i=(0,n.showFastBox)({title:getLang("global_warning"),dark:!0},t,getLang("global_continue"),(function(){cur.leaving=!0,i.hide(),cur.onContinueCb&&cur.onContinueCb()}),getLang("global_cancel"),(function(){i.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return a?winToUtf(t.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}}function h(e,t,a,l,c){if(a){l=l||cur,(c=c||{}).onUploadStart||(c.onUploadStart=e=>{boxQueue.hideLast(),cur.nav.push((function(e,t,a){if(!1===p(1))return cur.onContinueCb=nav.go.pbind(a),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=p,c.onUploadProgress(e,0,0),Wall.showEditPost&&Wall.showEditPost(),c.onUploadStartDone&&c.onUploadStartDone()}),c.onUploadComplete||(c.onUploadComplete=(e,t)=>{var a=(0,r.parseJSON)(t);a.video_id?v(e,a,l):"string"==typeof t&&t.indexOf("TERMINATED")>-1||Upload.onUploadError(e);c.onUploadCompleteDone&&c.onUploadCompleteDone(),setTimeout((()=>{c.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&c.onUploadAllCompleteDone()}))}),c.onUploadProgress||(c.onUploadProgress=(e,t,a)=>{var n=void 0!==e.ind?e.ind:e;(0,u.show)("_im_media_preview"),l.showMediaProgress&&l.showMediaProgress("video",n,function(e,t,a){return{loaded:t,total:a,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,t,a))}),c.onUploadError||(c.onUploadError=(e,t)=>{(0,s.statlogsValueEvent)("upload_video_fails",1,a.options.server,t),function(e){var t=void 0!==e.ind?e.ind:e,a=e.fileName?t+"_"+e.fileName:e;if((0,u.re)("upload"+a+"_progress_wrap"),!(0,u.geByClass1)("popup_box_container")){var s=getLang("video_upload_error");setTimeout((0,n.showFastBox)({title:getLang("global_error")},s).hide,2e3)}(0,i.topError)("Upload failed",{dt:-1,type:102,url:((0,u.ge)("file_uploader_form"+t)||{}).action}),Upload.embed(t)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;var d=cur.maxFiles-(cur.savedVideos||[]).length,g=browser.safari?"":"video/*,"+m("accept");a.lang&&(cur.lang=(0,o.extend)(cur.lang||{},a.lang));var h={accept:g,file_input:null,file_name:"video_file",file_size_limit:1024*(a.options.file_size_limit_in_GB||_.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:m("types"),chooseBox:1,chunked:1,chunkSize:_.VIDEO_UPLOAD_CHUNK_SIZE,clear:1,dragEl:t===boxLayerWrap?boxLayerWrap:bodyNode,dropbox:t,from:a.vars.from,lang:a.lang,max_attempts:3,max_files:d,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!a.options.hasOwnProperty("visible_dropbox")||a.options.visible_dropbox},f=Upload.init(e,"",{},Object.assign(h,c));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(f),f}}function v(e,t,a,i){a=a||cur;var s=void 0!==e.ind?e.ind:e,r=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),l=r?s+"_"+r:e,c=t.owner_id+"_"+t.video_id,d=cur.isSnippetVideoSelection&&cur.chooseSnippetVideo,_=(0,u.ge)("upload"+l+"_progress_wrap");_&&(0,u.hide)((0,u.geByClass1)("progress_x",_)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:c},{onDone:e=>{d||a.chooseMedia("video",c,(0,o.extend)(e[c],{upload_ind:l,upload_new:!0}));var s=t.owner_id,r=t.video_id,_=t.video_hash,g=0,m=()=>{ajax.post("al_video.php?act=encode_progress",{oid:s,vid:r,hash:_,need_thumb:1},{onDone:t=>{var _,g=!0;if(t){if(t.error)return _=getLang("video_upload_encode_error"),void setTimeout((0,n.showFastBox)({title:getLang("global_error")},_).hide,2e3);t.thumb&&100===parseInt(t.percents,10)&&(g=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:s,vid:r},{onDone:t=>{if(cur.isSnippetVideoSelection&&cur.chooseSnippetVideo)return cur.chooseSnippetVideo(c,t),void(0,u.re)("upload"+l+"_progress_wrap");a.hasChosenMedia("video",c)?a.updateChosenMedia("video",c,(0,o.extend)(t,{upload_ind:l,upload_new:!0})):i&&i(e,c)}}))}g&&(d||a.hasChosenMedia("video",c))&&setTimeout(m,1e3)},onFail:()=>{++g<3&&setTimeout(m,2e3*g)}})};m()}})}},306908:(e,t,a)=>{"use strict";a.d(t,{VIDEO_UPLOAD_EXTS:()=>n,VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>i,VIDEO_UPLOAD_CHUNK_SIZE:()=>s});a(751876);var n="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf torrent".split(" "),i=5,s=4194304},621963:(e,t,a)=>{"use strict";a.d(t,{setHTML:()=>l,WithEmoji:()=>c,default:()=>u});a(175115),a(95767),a(991181),a(296253);var n=a(667294),i=(a(45697),a(659397)),s=a(147650);function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},r.apply(this,arguments)}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function l(e,t){var a=!!window.getSelection&&window.getSelection(),n=!1;if(a&&a.rangeCount){var i=a.getRangeAt(0);n=i.commonAncestorContainer?i.commonAncestorContainer:i.parentElement?i.parentElement():i.item(0)}for(var s=n;s&&s!==e;)s=s.parentNode;window.Emoji&&(s||window.Emoji.editableFocus(e,!1,!0),window.Emoji.insertHTML(t))}var c=n.memo((e=>{var t=e.title,a=e.children,r=n.useRef(),o=n.useRef({}),l=n.useMemo((()=>{var e=n.Children.only(a);return n.cloneElement(e,{ref:t=>{e.ref&&e.ref(t),o.current=t||{}},className:(0,i.classNames)(e.props.className,"WithEmoji__textbox")})}),[a]);return n.useEffect((()=>{window.Emoji&&window.Emoji.init(o.current.container,{noStickers:!0,onSend:()=>{},ctrlSend:()=>!0,noLineBreaks:!l.props.isMultiLine})}),[]),n.createElement("div",{className:"WithEmoji__field _emoji_field_wrap"},l,n.createElement("div",{className:"WithEmoji__smile emoji_smile_wrap _emoji_wrap"},n.createElement("div",{className:"emoji_smile _emoji_btn",ref:r,title:t,onMouseOver:e=>{e.persist(),window.Emoji&&window.Emoji.show(r.current,e)},onMouseOut:e=>{e.persist(),window.Emoji&&window.Emoji.hide(r.current,e)}},n.createElement(s.default,null))))}));class d extends n.Component{constructor(){super(...arguments),this.onChange=()=>{this.props.onChange&&window.Emoji&&this.props.onChange(window.Emoji.val(this.container))},this.containerRef=n.createRef(),this.state={value:this.props.initialValue}}componentDidMount(){if(this.container=this.containerRef.current,this.container&&!this.isMount){this.isMount=!0;var e=this.props.initialValue;window.Emoji&&window.Emoji.val(this.container,window.Emoji.emojiToHTML(e))}}componentWillUnmount(){this.container&&this.isMount&&(this.isMount=!1)}render(){var e=this.props,t=e.tabIndex,a=e.isMultiLine,i=(e.initialValue,o(e,["tabIndex","isMultiLine","initialValue"]));return n.createElement("div",r({role:"textbox",ref:this.containerRef,tabIndex:t,contentEditable:!0,"aria-multiline":a,onInput:this.onChange},i))}}d.defaultProps={isMultiLine:!1,tabIndex:0,initialValue:""};const u=d},891047:(e,t,a)=>{"use strict";function n(e){return new Promise(((t,a)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>a(e.error)}))}function i(e,t){const a=indexedDB.open(e);a.onupgradeneeded=()=>a.result.createObjectStore(t);const i=n(a);return(e,a)=>i.then((n=>a(n.transaction(t,e).objectStore(t))))}let s;function r(){return s||(s=i("keyval-store","keyval")),s}function o(e,t=r()){return t("readonly",(t=>n(t.get(e))))}function l(e,t,a=r()){return a("readwrite",(a=>(a.put(t,e),n(a.transaction))))}function c(e,t=r()){return t("readwrite",(t=>(t.delete(e),n(t.transaction))))}a.d(t,{createStore:()=>i,del:()=>c,get:()=>o,set:()=>l})},22457:()=>{},803065:()=>{},720310:()=>{},263812:()=>{},168474:(e,t,a)=>{"use strict";a.d(t,{ContactList:()=>g});var n=a(621094),i=a(975066),s=(a(22457),a(667294)),r=a(606729),o=a(446830),l=a(784970),c=a(838851),d=a(233600),u=a(611728),_=a(274061),g=function(e){var t=e.contacts,a=e.onSelect,g=(0,l.useDispatch)(),m=(0,l.useBrowserEnv)().lang,p=(0,s.useRef)(null),h=(0,s.useRef)(null),v=(0,s.useState)("loading"),f=(0,i.default)(v,2),b=f[0],y=f[1],w=(0,s.useState)(""),C=(0,i.default)(w,2),E=C[0],S=C[1],T=(0,s.useState)([]),I=(0,i.default)(T,2),L=I[0],M=I[1],k=(0,s.useMemo)((function(){return d.add(d.create(),(0,n.default)(t.values()),(function(e){return{id:e.userId||e.id,strings:d.peerWords(e)}}))}),[t]);(0,s.useEffect)((function(){0!==t.size?y("results"):g({type:"LoadContactList",offset:0})}),[t.size,g]),(0,s.useEffect)((function(){if(E){var e=(0,n.default)(d.search(k,E).values());return M(e),void y(e.length?"results":"empty")}M((0,n.default)(t.keys()))}),[E,M,t,k]),(0,s.useEffect)((function(){var e;null===(e=h.current)||void 0===e||e.focus()}),[]);var P=(0,s.useCallback)((function(e){var n=e.index,i=e.style,o=L[n];if(!o)return null;var l=t.get(o);return l?s.createElement("li",{className:"ContactList__item",key:o,style:i,onClick:function(){return a(o)}},s.createElement("div",{className:"ContactList__avatar"},s.createElement(r.Avatar,{peer:l,size:32})),s.createElement("div",{className:"ContactList__name"},l.name)):null}),[t,L,a]);return s.createElement("div",{className:"ContactList"},s.createElement("div",{className:"ContactList__search"},s.createElement("div",{className:"ContactList__searchIcon"},s.createElement(o.default,null)),s.createElement("input",{type:"text",className:"ContactList__searchInput",placeholder:m.use("me_convo_list_search_placeholder"),onChange:function(e){return S(e.target.value)},value:E,ref:h})),s.createElement("div",{className:"ContactList__contacts"},function(){switch(b){case"loading":return s.createElement(c.OptimizedSpinner,{className:"ContactList__loader"});case"empty":return s.createElement("div",{className:"ContactList__noResults"},m.use("me_search_empty_contacts"));default:return s.createElement(u.default,null,(function(e){return s.createElement(_.FixedSizeList,{ref:p,className:"ContactList__virtual",height:e.height,width:e.width,overscanCount:10,itemCount:L.length,itemSize:56,innerElementType:"ul"},P)}))}}()))}},204929:(e,t,a)=>{"use strict";a.d(t,{ContactListApp:()=>d});var n=a(975066),i=a(667294),s=a(635544),r=a(168474),o=a(314432),l=a(86894),c=a(367075),d=function(e){var t=e.store,a=e.env,d=e.onSelect,u=(0,i.useState)(t.getState()),_=(0,n.default)(u,2),g=_[0],m=_[1];(0,i.useEffect)((function(){return t.subscribe(m)}),[t]);var p=o.safeGet(g.peers,g.viewerId),h=g.contactList;return i.createElement(c.ErrorBoundary,{fallbackRender:function(){return null},onError:function(e){return a.logger.error("[ContactListApp] Error",e)}},i.createElement("div",{className:"ContactListApp MEConfig vkui__root"},i.createElement(s.Provider,{env:a,state:g,dispatch:t.dispatch,featureFlags:t.featureFlags,viewer:p},i.createElement(l.ConfigProvider,{platform:l.Platform.VKCOM,scheme:"inherit"},i.createElement(l.AdaptivityProvider,null,i.createElement(r.ContactList,{contacts:h,onSelect:d}))))))}},146482:(e,t,a)=>{"use strict";a.d(t,{Settings:()=>b});var n=a(975066),i=(a(803065),a(667294)),s=a(323301),r=a(170322),o=a(422152),l=a(263041),c=a(941192),d=a(975761),u=a(51441),_=a(266106),g=a(447066),m=a(6058),p=a(86894),h=a(311323),v=a(784970),f=a(838851),b=function(e){var t=e.isLoading,a=(0,v.useBrowserEnv)(),n=a.lang,g=a.browserNotifications,m=(0,v.useUserSettings)(),h=(0,v.useDispatch)(),b=(0,v.useFeatureFlags)();return i.createElement("ul",{className:"Settings"},t&&i.createElement(f.OptimizedSpinner,{className:"Settings__loader"}),i.createElement(s.SettingsListItem,{icon:i.createElement(r.default,null),title:n.use("me_settings_message_submit"),control:i.createElement(y,{isCtrSubmitSelected:m.ctrSubmit,onChange:function(e){return h({type:"UserChangedSetting",setting:"ctrSubmit",value:e})}})}),i.createElement(s.SettingsListItem,{icon:i.createElement(o.default,null),title:n.use("me_settings_sound_notifications"),control:i.createElement(p.Switch,{className:"Settings__switch",checked:m.soundNotifications,onChange:function(e){return h({type:"UserChangedSetting",setting:"soundNotifications",value:Boolean(e.target.checked)})}})}),i.createElement(s.SettingsListItem,{icon:i.createElement(l.default,null),title:n.use("me_settings_show_recommendations"),control:i.createElement(p.Switch,{className:"Settings__switch",checked:m.showRecommendations,onChange:function(e){return h({type:"UserChangedSetting",setting:"showRecommendations",value:Boolean(e.target.checked)})}})}),i.createElement(s.SettingsListItem,{icon:i.createElement(c.default,null),title:n.use("me_settings_count_not_muted"),description:n.use("me_settings_count_not_muted_note"),control:i.createElement(p.Switch,{className:"Settings__switch",checked:!m.countOnlyNotMuted,onChange:function(e){return h({type:"UserChangedSetting",setting:"countOnlyNotMuted",value:!Boolean(e.target.checked)})}})}),b.me_fc_archive&&i.createElement(s.SettingsListItem,{icon:i.createElement(d.default,null),title:n.use("me_settings_auto_unarchive"),description:n.use("me_settings_auto_unarchive_note"),control:i.createElement(p.Switch,{className:"Settings__switch",checked:m.autoUnarchive,onChange:function(e){return h({type:"UserChangedSetting",setting:"autoUnarchive",value:Boolean(e.target.checked)})}})}),g&&i.createElement(s.SettingsListItem,{icon:i.createElement(u.default,null),title:n.use("me_settings_browser_notifications"),control:i.createElement(w,{browserNotifications:g})}),b.me_voice_asr&&i.createElement(s.SettingsListItem,{icon:i.createElement(_.default,null),title:n.use("me_settings_auto_transcript"),control:i.createElement(p.Switch,{className:"Settings__switch",checked:m.transcriptAutoShow,onChange:function(e){return h({type:"UserChangedSetting",setting:"transcriptAutoShow",value:Boolean(e.target.checked)})}})}))},y=function(e){var t=e.isCtrSubmitSelected,a=e.onChange,s=(0,v.useBrowserEnv)().lang,r=(0,i.useRef)(null),o=(0,i.useState)(!1),l=(0,n.default)(o,2),c=l[0],d=l[1],u=(0,i.useCallback)((function(e){if(e.target instanceof HTMLInputElement){var t=Boolean(Number(e.target.value));a(t)}}),[a]),_=t?s.use("me_settings_message_submit_option_ctr"):s.use("me_settings_message_submit_option_default");return i.createElement("div",{className:"Settings__select"},i.createElement(h.PopoutRoot,{popout:c?i.createElement(p.ActionSheet,{onClose:function(){return d(!1)},toggleRef:r,popupDirection:"bottom"},i.createElement(p.ActionSheetItem,{autoclose:!0,subtitle:s.use("me_settings_message_submit_option_default_note"),selectable:!0,checked:!t,value:"0",onChange:u},s.use("me_settings_message_submit_option_default")),i.createElement(p.ActionSheetItem,{autoclose:!0,subtitle:s.use("me_settings_message_submit_option_ctr_note"),selectable:!0,checked:t,value:"1",onChange:u},s.use("me_settings_message_submit_option_ctr"))):null},i.createElement("button",{className:"Settings__button",ref:r,onClick:function(){return d(!0)}},_,i.createElement("span",{className:"Settings__buttonChevron"},i.createElement(g.default,null)))))},w=function(e){var t=e.browserNotifications,a=(0,i.useState)(t.getState()),s=(0,n.default)(a,2),r=s[0],o=s[1],l=(0,v.useBrowserEnv)().lang;return"external"===r?i.createElement("button",{className:"Settings__button",onClick:t.onExternal},l.use("me_settings_browser_notifications_external"),i.createElement("span",{className:"Settings__buttonChevron"},i.createElement(m.default,null))):i.createElement(p.Switch,{className:"Settings__switch",checked:r,onChange:function(e){return t.onChange(Boolean(e.target.checked)).then((function(e){return o(e)}))}})}},844996:(e,t,a)=>{"use strict";a.d(t,{SettingsApp:()=>d});var n=a(975066),i=(a(371124),a(692491),a(720310),a(667294)),s=a(146482),r=a(86894),o=a(635544),l=a(314432),c=a(367075),d=function(e){var t=e.store,a=e.env,d=(0,i.useState)(t.getState()),u=(0,n.default)(d,2),_=u[0],g=u[1];(0,i.useEffect)((function(){return t.subscribe(g)}),[t]);var m=0===_.pts,p=l.safeGet(_.peers,_.viewerId);return i.createElement(c.ErrorBoundary,{fallbackRender:function(){return null},onError:function(e){return a.logger.error("[SettingsApp] Error",e)}},i.createElement("div",{className:"SettingsApp vkui__root"},i.createElement(o.Provider,{env:a,state:_,dispatch:t.dispatch,featureFlags:t.featureFlags,viewer:p},i.createElement(r.ConfigProvider,{platform:r.Platform.VKCOM,scheme:"inherit"},i.createElement(r.AdaptivityProvider,null,i.createElement(s.Settings,{isLoading:m}))))))}},323301:(e,t,a)=>{"use strict";a.d(t,{SettingsListItem:()=>i});a(263812);var n=a(667294),i=function(e){var t=e.icon,a=e.title,i=e.description,s=e.control;return n.createElement("li",{className:"SettingsListItem"},n.createElement("div",{className:"SettingsListItem__icon"},t),n.createElement("div",{className:"SettingsListItem__info"},n.createElement("div",{className:"SettingsListItem__title"},a),i&&n.createElement("div",{className:"SettingsListItem__description"},i)),n.createElement("div",{className:"SettingsListItem__control"},s))}},967181:(e,t,a)=>{"use strict";a.d(t,{EntityType:()=>n,EventQueue:()=>s});var n,i=a(570655);!function(e){e.Online="online"}(n||(n={}));var s=function(e){var t=this,a=e.getQueue,n=e.registerQueue;this.QUEUE_KEY_TTL=3e3,this.MAX_RETRIES=5,this.listeners=[],this.retriesLeft=this.MAX_RETRIES,this.restart=function(){t.intervalId&&clearInterval(t.intervalId),0!==t.retriesLeft&&(t.retriesLeft--,t.getQueue().then((function(e){t.retriesLeft=t.MAX_RETRIES;var a=(0,i.__assign)({},e);t.intervalId=window.setInterval((function(){t.registerQueue(a,(function(e,n){var s,r,o,l;if(function(e){return void 0!==e.err}(n))t.restart();else{a.ts=n.ts;try{for(var c=(0,i.__values)(n.events),d=c.next();!d.done;d=c.next()){var u=d.value;try{for(var _=(o=void 0,(0,i.__values)(t.listeners)),g=_.next();!g.done;g=_.next())(0,g.value)(u)}catch(e){o={error:e}}finally{try{g&&!g.done&&(l=_.return)&&l.call(_)}finally{if(o)throw o.error}}}}catch(e){s={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(s)throw s.error}}}}))}),t.QUEUE_KEY_TTL)})).catch((function(e){console.error(e),setTimeout(t.restart,t.QUEUE_KEY_TTL)})))},this.subscribe=function(e){return t.listeners.push(e),1===t.listeners.length&&t.restart(),function(){t.listeners=t.listeners.filter((function(t){return t!==e})),0===t.listeners.length&&(t.retriesLeft=t.MAX_RETRIES,t.intervalId&&clearInterval(t.intervalId))}},this.registerQueue=n,this.getQueue=a}},49267:(e,t,a)=>{"use strict";a.d(t,{createLongpollConnect:()=>g});var n=a(570655),i=a(191040),s=a(887294),r=a(663825),o=a(19331),l=(0,o.partConfigEnabled)("me_web_read_by_cmid")?15:14;function c(e,t){e.waitAbortFns.push(t)}function d(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=(0,s.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),a=t.request,r=t.cancel;return e.stopFn=r,a.then((function(t){var a=(0,n.__read)(t,2),i=a[0],s=a[1];return e.onData(e,s),e.waitTimeout=2,JSON.parse(i)})).catch((function(t){var a=(0,n.__read)(t,2)[1];return e.onData(e,a),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var a=t.failed?(0,i.abortablePause)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},s=a.abort,r=a.pause;switch(t.failed){case 1:return c(e,s),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(r).then((function(){return d(e)}));case 2:return c(e,s),e.onKeyExpired(e,t).then((function(t){var a=(0,n.__read)(t,4),i=a[0],s=a[1],r=a[2],o=a[3];return e.onResult({ts:+o,updates:[[-2,i,s+"/"+r],[-1]]})})).then(r).then((function(){return d(e)}));case 3:return e.onLpBroken(e,t);default:return t.updates.some((function(e){switch(e[0]){case 4:return 4===e.length;case 5:case 18:return 3===e.length;default:return!1}}))?e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(r).then((function(){return d(e)})):Promise.resolve(t)}}(e,t)}))}function u(e){e.isStoppedFn()||d(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&_(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),_(e,-3);var a=(0,i.abortablePause)(e.waitTimeout,null),n=a.abort,s=a.pause;return c(e,n),s().then((function(){return _(e,-4)}))}(e,t)})).then((function(){return u(e)}))}function _(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function g(e,t){var a=!!e.stopped,n={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||l,mode:1226,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return a},onResult:function(e){e.ts&&s(n.ts,e.ts,e.updates.map(r.constructEvent))},onData:m(t.onData),onRequestError:m(t.onRequestError),onHistoryLost:p(t.onHistoryLost),onKeyExpired:p(t.onKeyExpired),onLpBroken:p(t.onHistoryLost)},i=t.onEvents;function s(e,t,a){n.ts=t;for(var s=0;s<a.length;++s)a[s].type===r.REFRESH_LP_KEY&&(n.key=a[s].key||"",n.url=a[s].url||"");i(e,t,a)}var o={options:n,isStopped:function(){return a},stopConnection:function(){a=!0,n.stopFn&&n.stopFn(),n.stopFn=void 0,document.removeEventListener("resume",c),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",c),_(n,-4),a=!1,u(n)},abortWaiting:function(){n.waitAbortFns.forEach((function(e){return e()})),n.waitAbortFns=[],n.waitTimeout=2},onLp:s};function c(){o.abortWaiting()}return document.addEventListener("resume",c),u(n),o}function m(e){return e||function(){}}function p(e){return e?function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return Promise.resolve(e.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(t))))}:function(){return Promise.reject()}}},384099:(e,t,a)=>{"use strict";a.d(t,{createLongpollEventsQueue:()=>i});var n=a(570655);function i(e,t,a){var i=0,s=e,r=[],o=!1;function l(){!r.length||i>0||o||(t(r),r=[])}return{pause:function(){i++},resume:function(){i>0&&(i--,l())},onLp:function(e,t,i){o||(s>=e?(s=t,r.push.apply(r,(0,n.__spreadArray)([],(0,n.__read)(i))),l()):a&&(o=!0,a(s).then((function(e){var t=(0,n.__read)(e,3),a=t[1],i=t[2];s=a,o=!1,r.push.apply(r,(0,n.__spreadArray)([],(0,n.__read)(i))),l()}))))}}}},421295:(e,t,a)=>{"use strict";a.d(t,{screenWakeLocker:()=>n});var n=new(function(){function e(){this.onVisibilityChange=this._onVisibilityChange.bind(this)}return e.prototype._onVisibilityChange=function(){this.wakeLockSentinel&&"visible"===document.visibilityState&&this.lock().then((function(){})).catch(console.error)},e.prototype.requestWakeLock=function(){var e=this;return navigator.wakeLock?this.wakeLockSentinel?Promise.resolve():navigator.wakeLock.request("screen").then((function(t){e.wakeLockSentinel=t})):Promise.reject()},e.prototype.isLocked=function(){return!!this.wakeLockSentinel&&!this.wakeLockSentinel.released},e.prototype.lock=function(){var e=this;return this.requestWakeLock().then((function(){e.wakeLockSentinel&&document.addEventListener("visibilitychange",e.onVisibilityChange)})).catch((function(){}))},e.prototype.unlock=function(){var e=this;return this.wakeLockSentinel?(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.wakeLockSentinel.release().finally((function(){e.wakeLockSentinel=null}))):Promise.resolve()},e}())},95642:(e,t,a)=>{"use strict";a.d(t,{settingsChangesStatCollector:()=>i});var n=a(214547),i=new(function(){function e(){this.productStatCollector=new n.ProductionStatCollector,this.actionStatCollector=new n.ActionStatCollector(this.productStatCollector)}return e.prototype.logEvent=function(e){var t={type:"type_settings_changes_item",type_settings_changes_item:e};this.actionStatCollector.logEvent(t)},e}())},682886:(e,t,a)=>{"use strict";a.d(t,{CAROUSEL_VIEWPORT_CLASS:()=>o,CAROUSEL_LAYER_CLASS:()=>l,mount:()=>f});var n=a(610124),i=a(315544),s=a(609720),r="_im_carousel",o="_im_carousel_viewport",l="_im_carousel_layer",c="_im_carousel_control",d="Carousel__control--hidden";function u(e){return(0,i.domClosest)(r,e.target)}function _(e,t){var a=t.querySelector("._im_carousel_control_left"),n=t.querySelector("._im_carousel_control_right"),i=t.querySelector("."+o),s=t.querySelector("."+l);if(n&&a&&i instanceof HTMLElement&&s instanceof HTMLElement){var r=i.offsetWidth,c=s.offsetWidth,u=r<c;a.classList.toggle(d,!u||e<=0),n.classList.toggle(d,!u||e+r>=c)}}function g(e){var t=u(e),a=(0,i.domClosest)(c,e.target),n=Number(a.dataset.direction);if(t){var s=t.querySelector("."+o),r=t.querySelector("."+l);if(s&&r&&n){var d=Number(t.dataset.scrollCount)||1,g=Math.floor(r.offsetWidth/r.childElementCount),m=(Math.floor(s.scrollLeft/g)+n*d)*g;_(m,t),s.scrollTo({left:m,behavior:"smooth"})}}}var m=(0,s.debounce)((function(e){var t=u(e),a=t&&t.querySelector("."+o);a&&_(a.scrollLeft,t)}),20);function p(e){var t=u(e);(t&&t.querySelector("."+o)).addEventListener("scroll",m)}function h(e){var t=u(e);(t&&t.querySelector("."+o)).removeEventListener("scroll",m)}function v(e){return{unmount:function(){(0,n.destroyModule)(e)}}}function f(e,t){return(0,(0,n.createMutations)(v).bindMutations)((0,n.createModule)({handlers:function(e,a){a(t,"click",c,g),a(t,"mouseover",r,p),a(t,"mouseout",r,h)}}),e)}},176651:(e,t,a)=>{"use strict";a.d(t,{mount:()=>_});var n=a(610124),i=a(454593),s=a(597903),r=a(104837),o=a(179288),l=a(993421),c=a(786067),d=a(695724),u="_im_to_unread";function _(e,t,a){var _=function(e,n){(0,s.showUnreadOnly)(t,a,i.changeDialogsTab).then((function(e){var i=t.get().active_tab;if(e){var s=i===o.ConvoListFolder.UNREAD;n.innerHTML=(0,d.getTemplate)("im_filter",{filter:s?(0,c.getLang)("mail_to_all_dialogs"):(0,c.getLang)("mail_to_unread")}),i===o.ConvoListFolder.ALL&&a().updateRecommendationList(t)}}))},g=(0,n.createModule)({handlers:function(t,a){a(e,"click",u,_)}});return function(e,t){return{updateFilter:function(t){var a,n=t.get().active_tab,i=n===o.ConvoListFolder.UNREAD,s=[];((0,r.isSearching)(t)||[o.ConvoListFolder.BUSINESS_NOTIFY,o.ConvoListFolder.ARCHIVE,o.ConvoListFolder.MR].includes(n))&&s.push("im-page--dialogs-filter_hidden"),(0,l.getUnreadCountWithMuted)(t)>0?a=i?(0,c.getLang)("mail_to_all_dialogs"):(0,c.getLang)("mail_to_unread"):(a=(0,c.getLang)("mail_all_dialogs"),s.push("im-page--dialogs-filter_disabled"));var u=e.querySelector("._im_to_unread");u&&(u.innerHTML=(0,d.getTemplate)("im_filter",{filter:a,cls:s.join(" ")}))},toggleButton:function(t,a){var n=e.querySelector(".im-page--dialogs-filter");n&&n.classList.toggle("im-page--dialogs-filter_hidden",a)},toggleLoader:function(t,a){var n=e.querySelector("._im_dialogs_cog_settings");n&&n.classList.toggle("im-page--dialogs-settings_loading",a)},unmount:function(){(0,n.destroyModule)(t)}}}(e,g)}},668667:(e,t,a)=>{"use strict";a.d(t,{mount:()=>c});var n=a(610124),i=a(712439),s=a(993421),r=a(459554),o=a(412827);function l(e,t,a,n){var i=a.get(),l=i.observer;i.targets.forEach((function(e){return l.unobserve(e)}));var c=function(e,t,a){var n=(0,s.getPeer)(e);if(!(0,r.isFullyLoadedTab)(e,n))return[];var i=(0,r.getTab)(e,n);return i&&i.msgs?Object.keys(i.msgs).reduce((function(e,n){if(!i.msgs)return e;var s=(0,o.parseMessage)(i.msgs[n]);if(!t(s,i))return e;var r=a||document,l=r.querySelector("._im_mess_"+n)||r.querySelector("._im_expired_message_"+n);return l&&e.push(l),e}),[]):[]}(e,n,t);a.setState({targets:c}),c.forEach((function(e){return l.observe(e)}))}function c(e,t,a,s){var r=(0,i.default)({observer:new IntersectionObserver(a,{root:t}),targets:[]});l(e,t,r,s);var o=(0,n.createModule)({handlers:function(){}}),c=!1;return{update:function(){c||l(e,t,r,s)},unmount:function(){r.get().observer.disconnect(),(0,n.destroyModule)(o),c=!0}}}},241103:(e,t,a)=>{"use strict";a.d(t,{mount:()=>E});var n=a(570655),i=a(785893),s=a(973935),r=a(863729),o=a(610124),l=a(454593),c=a(104837),d=a(459554),u=a(412947),_=a(242918),g=a(495283),m=a(654612),p=a(993421),h=a(264493).default,v=a(369361).default,f=a(369361),b=f.MAIN,y=f.EDIT;function w(e,t){return(0,_.default)().reduce((function(t,a){return t.replace(new RegExp("({"+a.id+"})","gi"),a.process(e))}),t).replace(/&lt;br&gt;/gi,"<br>")}function C(e,t,a,o,_){var h;return{closeSettingsPopup:function(){h&&h.hide()},showSettingsPopup:function(e){var a=this,o="TemplatesSettings",l={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow:function(){var l=document.getElementById(o);l&&s.render((0,i.jsx)(r.default,(0,n.__assign)({value:t},{children:(0,i.jsx)(v,{popup:h,section:e,getTemplates:function(){return(0,c.getTemplates)(t)},saveTemplate:a.saveTemplate.bind(a),deleteTemplate:a.deleteTemplate.bind(a),closePopup:a.closeSettingsPopup.bind(a)},void 0)}),void 0),l),requestAnimationFrame((function(){return h.updateBoxCoords()}))}};(h=new m.MessageBox(l).content('<div id="'+o+'"></div>')).show()},applyTemplate:function(e){var a=(0,c.getTemplates)(t).find((function(t){return t.id===e}));(0,u.statlogsCommunityTemplatesClickEvent)(),o(w(t,(0,g.prepareToWriting)(a.text)))},getPreparedTemplates:function(){return(0,c.getTemplates)(t).map((function(e){return Object.assign({},e,{name:e.name,text:w(t,e.text)})}))},saveTemplate:function(e){var a=(0,g.decodeHTMLEntities)(e.name),n=(0,g.decodeHTMLEntities)(e.text);return t.set(e.id?l.updateTemplate.bind(null,e.id,a,n):l.createTemplate.bind(null,a,n))},deleteTemplate:function(e){return t.set(l.deleteTemplate.bind(null,e))},isNeedRenderTemplates:function(){var e=(0,p.getPeer)(t);if(!e)return!1;if(!(0,c.isCommunityInterface)(t))return!1;var a=(0,d.getCurrentTab)(t);return(!a||!(0,c.isChannelPeer)(a))&&!(0,c.isCommunityChat)(t,e)},toggleImText:function(e){void 0===e&&(e=this.isNeedRenderTemplates()),_(e)},update:function(){this.toggleImText()},unmount:function(){this.toggleImText(!1)}}}function E(e,t,a,l){var c=(0,(0,o.createMutations)(C).bindMutations)((0,o.createModule)({handlers:function(){}}),e,t,a,l);if("function"!=typeof c){c.toggleImText();var d=(0,i.jsx)(r.default,(0,n.__assign)({value:e},{children:(0,i.jsx)(h,{getTemplates:c.getPreparedTemplates,applyTemplate:c.applyTemplate.bind(c),isNeededRendering:c.isNeedRenderTemplates,showSettingsPopup:c.showSettingsPopup.bind(c,b),showCreatingTemplatePopup:c.showSettingsPopup.bind(c,y)},void 0)}),void 0);s.render(d,t)}return c}},981311:(e,t,a)=>{"use strict";var n=a(570655),i=a(19294),s=a(486125),r=a(41911),o=a(712439),l=a(645523),c=a(454593),d=a(549892),u=a(597903),_=a(968958),g=a(695724),m=a(786067),p=a(315544),h=a(520797),v=a.n(h),f=a(19331);window.IM={init:function(e){var t,a;if(window.imwl=e.imwl,(0,_.startLoggingAllUnhandled)(),(0,g.addTemplates)(v()),window.cur.lang.dont_attach=(0,m.getLang)("mail_dont_add_media"),e.failed)return(0,r.mount)((0,p.geByClass1)("im-sick",(0,p.ge)("page_body")),null);localStorage.removeItem("im_sick_timer"),window.cur.ctrl_submit=Boolean(e.settings.ctrl_submit),window.cur.module="im",window.cur.mutedPeers=e.mutedPeers,window.cur.gid=e.gid,window.cur.peer=e.peer,window.cur.options={blacklist_hash:e.thash};var h=-10800-60*(new Date).getTimezoneOffset(),b=e.timeshift,y=(0,n.__assign)((0,n.__assign)({},e),{owners:void 0,tabbedPeers:(e.tabbedPeersArray||[]).map((function(e){return{peer:e,type:"perm"}})),blockedFlagUpdates:{},msgid:(0,g.intval)(window.nav.objLoc.msgid),timeshift:b-h,oCache:{},ref_id:window.nav.objLoc.ref,ref_source:window.nav.objLoc.ref_source,topConvTree:new Promise((function(){})),hintsTree:new Promise((function(){})),imTopConvList:new Promise((function(){})),callbackEventButtons:new Map}),w=(0,o.default)(y);null===(t=e.owners)||void 0===t||t.forEach((function(e){return(0,d.oCacheAdd)(w,e)})),(0,u.normalizeTabsGotFromServer)(w,w.get().tabs),window.cur.imClassicInterface=(0,u.isClassicInterface)(w);var C=(0,i.mount)((0,p.geByClass1)("js-im-page",(0,p.ge)("page_body")),w);(0,c.updateMentions)(w.get()),e.group_calls_feature_tt_hash&&(0,u.showGroupCallsOnboardingBox)(w.get(),e.group_calls_feature_tt_hash),e.group_calls_new_year_feature_tt_hash&&(0,u.showGroupCallsNewYearTooltip)(w.get(),e.group_calls_new_year_feature_tt_hash),window.IMBRIDGE={chatPhotoSaved:function(e){(0,s.curBox)()&&(0,s.curBox)().hide();var t=(e||{})[1];return t?(window.cur.pvShown&&window.layers.fullhide(!0,!0),"im"!=window.cur.module||w.get().peer!=t?window.nav.go("/im?sel=c"+(t-2e9)):void 0):window.nav.reload()},syncHistory:function(){w.set((function(e){return(0,c.syncHistory)(e)})).then((function(){}),(function(){}))},activateTab:function(e,t){void 0===t&&(t="notifications"),w.get().gid||w.get().longpoll.push([(0,l.changePeer)((0,g.intval)(e),!1,!1,!0,t)])},selectedPeer:function(){return w.get().peer},openSettings:function(){C.openSettings()}},(0,f.partConfigEnabled)("debug_messenger")&&(window.IMBRIDGE.store=w);var E=!1;window.cur.nav.push((function(){var e;return!!E||((null===(e=w.get().audio_msg)||void 0===e?void 0:e.isRecording)&&C.cancelRecording(),window.AudioMessagePlayer.detachPlayer(),C.route.apply(null,arguments))})),null===(a=window.cur.destroy)||void 0===a||a.push((function(){if(E)return!0;C.unmount(),window.IMBRIDGE=void 0,w.unmount(),window.store=void 0,E=!0,e=!1,w=!1,C=!1,(0,_.stopLoggingAllUnhandled)()}))}};try{window.stManager.done("imn.js")}catch(e){}},954972:(e,t,a)=>{"use strict";a.d(t,{setMessageFlag:()=>s});var n=a(376473),i=a(459554);function s(e,t,a,s,r){var o=(0,i.getTab)(e,t),l=(0,n.getMessage)(e,t,a);return o&&o.msgs&&l?(l.flags=r?l.flags|s:l.flags&~s,o.msgs[a]=l,Promise.resolve(e)):Promise.resolve(e)}},974309:(e,t,a)=>{"use strict";a.d(t,{ContactList:()=>u});var n=a(570655),i=a(785893),s=a(204929),r=a(730365),o=a(161650),l=a(41650),c=a(973935),d=function(e){var t=e.store,a=e.browserEnv,c=e.onClose,d=e.onSelect;return(0,i.jsxs)(r.default,(0,n.__assign)({onClose:c,disableBodyScroll:!0},{children:[(0,i.jsx)(o.default.Header,{title:(0,l.getLang)("mail_contacts_list"),onClose:c},void 0),(0,i.jsx)("div",(0,n.__assign)({style:{width:550,height:560}},{children:(0,i.jsx)(s.ContactListApp,{store:t,env:a,onSelect:d},void 0)}),void 0)]}),void 0)},u=function(){function e(){this.isMounted=!1}return e.prototype.renderContactListPopup=function(t,a){var n=this,s=e.getContainer();s&&c.render((0,i.jsx)(d,{store:t,browserEnv:a,onClose:function(){return n.hide()},onSelect:function(e){return n.onSelectPeer(e)}},void 0),s)},e.getContainer=function(){return document.getElementById("ContactList")},e.prototype.hide=function(){if(this.isMounted){var t=e.getContainer();t&&c.unmountComponentAtNode(t),this.isMounted=!1}},e.prototype.show=function(){var e,t=null===(e=window.reforgedME)||void 0===e?void 0:e.contactListContext;if(t){var a=t.store,n=t.browserEnv;this.renderContactListPopup(a,n),this.isMounted=!0}},e.prototype.onSelectPeer=function(e){this.hide(),window.nav.go("/im?sel="+e,null,{params:{entrypoint:"contacts_list"}})},e}()},218233:(e,t,a)=>{"use strict";a.d(t,{Api:()=>d});var n=a(570655),i=a(816405),s=a(190831),r=a(891047),o=a(189798),l=a(726271),c=["messages.getLongPollServer","messages.getLongPollHistory","queue.subscribe"],d=function(){function e(e){var t=this;this.abortTrackers=new Map,this.fetch=function(e,a,i){return void 0===i&&(i={}),(0,n.__awaiter)(t,void 0,Promise,(function(){var t,s,r,o,d,u,g,m,p,h;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:if("queue.subscribe"===e)return[2,Promise.resolve({base_url:"mock",queues:[]})];a=this.enrichParams(e,a),t=c.includes(e),s=e+" "+JSON.stringify(a),r=i.retries||0,o=500,n.label=1;case 1:0,n.label=2;case 2:return n.trys.push([2,7,,9]),!t||!window.curNotifier||window.curNotifier.is_server||l.browser.safari?[3,5]:[4,_((v=500,f=1500,Math.random()*(f-v+1)+v))];case 3:return n.sent(),[4,this.cache.get(s)];case 4:if(d=n.sent())return[2,d];n.label=5;case 5:return u=this.request(e,a),g=u.response,m=u.abort,i.trackId&&this.abortTrackers.set(i.trackId,m),[4,g];case 6:if(p=n.sent(),i.trackId&&this.abortTrackers.delete(i.trackId),p.execute_errors)throw new Error("execute failed");return t&&this.cache.set(s,p).catch((function(){})),[2,p];case 7:if((h=n.sent())instanceof Error&&"AbortError"===h.name)throw h;if(0===r)throw h;return r--,[4,_(o)];case 8:return n.sent(),o=Math.min(2*o,2e4),[3,9];case 9:return[3,1];case 10:return[2]}var v,f}))}))},this.request=function(e,t){var a=new AbortController;return{response:(0,o.api)(e,t,{version:i.API_VERSION},{signal:a.signal}),abort:function(){a.abort()}}},this.enrichParams=function(e,t){var a=e.slice(0,e.indexOf(".")),i={messages:Array.from(new Set((0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(s.API_USER_FIELDS)),(0,n.__read)(s.API_GROUP_FIELDS)))).join(","),users:s.API_USER_FIELDS.join(","),groups:s.API_GROUP_FIELDS.join(",")}[a];return(0,n.__assign)((0,n.__assign)({},t),{extended:1,fields:i})},this.cache=new u(3e3,e)}return e.dropCache=function(){indexedDB.deleteDatabase(u.CACHE_DB_NAME)},e.prototype.dangerouslyAbort=function(e){var t;e&&(null===(t=this.abortTrackers.get(e))||void 0===t||t(),this.abortTrackers.delete(e))},e.prototype.fetchMany=function(e,t){var a,i;void 0===t&&(t={});var s=[],r=Object.keys(e);try{for(var o=(0,n.__values)(r),l=o.next();!l.done;l=o.next()){var c=l.value;s.push("'"+c+"': API."+c+"("+JSON.stringify(this.enrichParams(c,e[c]))+")")}}catch(e){a={error:e}}finally{try{l&&!l.done&&(i=o.return)&&i.call(o)}finally{if(a)throw a.error}}var d="return { "+s.join(",")+" };";return this.fetch("execute",{code:d},t)},e}(),u=function(){function e(t,a){this.invalidateTimeout=t,this.cache=r.createStore(e.CACHE_DB_NAME,"api-cache-"+a)}return e.prototype.get=function(e){var t=this;return r.get(e,this.cache).then((function(a){if(void 0!==a){if(!(a.expiresAt<Date.now()))return setTimeout((function(){r.del(e,t.cache).catch((function(){}))}),Date.now()-a.expiresAt),a.response;r.del(e,t.cache).catch((function(){}))}})).catch((function(){}))},e.prototype.set=function(e,t){var a=this,n={response:t,expiresAt:Date.now()+this.invalidateTimeout};return r.set(e,n,this.cache).then((function(){setTimeout((function(){r.del(e,a.cache).catch((function(){}))}),a.invalidateTimeout)})).catch((function(){}))},e.CACHE_DB_NAME="reforged-db-v1",e}();function _(e){return new Promise((function(t){return setTimeout(t,e)}))}},891747:(e,t,a)=>{"use strict";a.d(t,{BrowserNotifications:()=>i});var n=a(612202),i=function(){var e=this;this.getState=function(){var t;return(null===(t=window.pushNotifier)||void 0===t?void 0:t.loadEndpoint())||window.ls.get("im_ui_notify_off")?"external":e.isBrowserNotificationsEnabled()},this.onChange=function(t){return t&&!e.isBrowserNotificationsEnabled()?new Promise((function(t){window.DesktopNotifications.requestPermission((function(){e.statlogsBrowserNotificationsOn(),t("external")}))})):!t&&e.isBrowserNotificationsEnabled()?(window.ls.set("im_ui_notify_off",1),e.statlogsBrowserNotificationsOff(),Promise.resolve(!1)):Promise.resolve(t)},this.onExternal=function(){return window.nav.go("/settings?act=notify")},this.isBrowserNotificationsEnabled=function(){return window.DesktopNotifications.supported()&&!window.DesktopNotifications.checkPermissionNeeded()&&!window.ls.get("im_ui_notify_off")},this.statlogsBrowserNotificationsOn=function(){(0,n.statlogsProbValueEvent)(1,"im_browser_notifications_on",1)},this.statlogsBrowserNotificationsOff=function(){(0,n.statlogsProbValueEvent)(1,"im_browser_notifications_off",1)}}},497138:(e,t,a)=>{"use strict";a.d(t,{GeoLocation:()=>s});var n=a(570655),i=a(266372),s=function(){function e(){}return e.prototype.get=function(){return new Promise((function(e){(0,i.sendLocationFromKeyboard)((function(t){var a=(0,n.__read)(t,2)[1],i=(0,n.__read)(a.split("_"),2),s=i[0],r=i[1];e([s,r])}))}))},e}()},402508:(e,t,a)=>{"use strict";a.d(t,{Logger:()=>s});var n=a(570655),i=a(721422),s=function(){var e=this;this.visible=!1,this.info=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];e.visible&&console.log.apply(console,(0,n.__spreadArray)([],(0,n.__read)(t)))},this.error=function(e,t){t?console.error(e,t):console.error(e);var a=function(e){(0,i.logError)(e,{environment:"messenger"})};if(t instanceof Error){var n=new Error(e+" "+t.message);return n.name=t.name,n.stack=t.stack,a(n)}if("string"==typeof t)return a(new Error(e+" "+t));if(t&&"api_error"===t.type){var s=JSON.stringify(t.error);return a(new Error(e+" "+s))}return a(new Error(e))},this.show=function(){e.visible=!0},this.hide=function(){e.visible=!1}}},886204:(e,t,a)=>{"use strict";a.d(t,{Navigate:()=>r});var n=a(654612),i=a(850167),s=a(113165),r=function(){function e(){}return e.prototype.openApp=function(e){(0,i.showWiki)({w:e})},e.prototype.openLink=function(e,t,a){if(!(a.ctrlKey||a.metaKey||a.altKey||a.shiftKey)){if(a.preventDefault(),t)switch(t.kind){case"Photo":return window.showPhoto(t.ownerId+"_"+t.id,t.messageAccessKey||t.accessKey||"",{queue:1},a.nativeEvent);case"Video":return window.showVideo(t.ownerId+"_"+t.id,t.accessKey||"",{autoplay:1,minimized:0,module:"",queue:1},a.nativeEvent);case"Poll":return void(0,i.showWiki)({w:"poll"+t.ownerId+"_"+t.id},!1,a.nativeEvent,{queue:1});case"Story":return void(0,s.showStory)("story"+t.ownerId+"_"+t.id);case"Gift":return t.isStickerStyle&&t.id?window.Emoji.clickSticker(Math.abs(t.id)):void(0,n.showBox)("al_gifts.php",{act:"box",tab:"sent",mid:window.vk.id},{cache:1,stat:["gifts.css",window.jsc("web/gifts.js")]});case"MoneyTransfer":return void(0,n.showBox)("al_payments.php?act=money_transfer_history_box",{});case"Geo":return void(0,n.showBox)("al_places.php",{act:"show_photo_place",lat:t.coordinates.latitude,long:t.coordinates.longitude,provider:4});case"MiniApp":var r=t.appLink.replace("/","");return void(0,i.showWiki)({w:r,app_ref:"snippet_im"},!1,a.nativeEvent)}window.nav.go(e)}},e}()},189754:(e,t,a)=>{"use strict";a.d(t,{Player:()=>d});var n=a(570655),i=a(452715),s=a(659397),r=a(189158),o=a(200134),l=a(850167),c=a(67766),d=function(){function e(t){var a=this;this.logger=t,this.player=(0,l.getAudioPlayer)(),this.listeners=[],this.state=e.initial(),this.play=function(t,n){return void 0===n&&(n=0),Promise.resolve().then((function(){if("Audio"===t.kind){a.reforgedPlayer.stop();var i=e.toAudio(t),s=new r.WebPlayerAdapter(a.player).getPlaylistId()?a.player.getCurrentPlaylist():a.player.getPlaylist(c.AudioPlaylist.TYPE_TEMP,window.vk.id,"im"+(t.peerId||""));s.mergeWith({list:[i]}),a.player.play(i,s,"im"),n>0&&a.player.seek(n)}else if("Voice"===t.kind)return a.player.stop(),window.Notifier.pauseGlobalMedia(),a.reforgedPlayer.play(t,n)}))},this.pause=function(){"playing"===a.state.status&&("Audio"===a.state.currentTrack.kind?a.player.pause():"Voice"===a.state.currentTrack.kind&&a.reforgedPlayer.pause())},this.resume=function(){"paused"===a.state.status&&("Audio"===a.state.currentTrack.kind?a.player.play():"Voice"===a.state.currentTrack.kind&&a.reforgedPlayer.resume())},this.stop=function(){a.player.stop()},this.subscribe=function(e){return a.listeners.push(e),function(){a.listeners=a.listeners.filter((function(t){return t!==e}))}},this.timeLeft=function(e){var t=e?a.state.voiceDuration:a.state.duration,n=e?a.state.voiceTime:a.state.time,i=Math.floor(t-n);return"-"+(0,s.formatDuration)(i)};var n=Symbol();this.reforgedPlayer=new i.Player(t),this.player.on(this,o.events.PLAY_REQUESTED,(function(t){a.setState({status:"loading",currentVoice:a.state.currentVoice||null,currentTrack:e.toTrack(t),progress:0,duration:t[5],time:0,voiceProgress:a.state.voiceProgress||0,voiceDuration:a.state.voiceDuration||0,voiceTime:a.state.voiceTime||0})})),this.player.on(n,o.events.PLAY,(function(t){a.setState({status:"playing",currentVoice:a.state.currentVoice||null,currentTrack:e.toTrack(t),progress:0,duration:t[5],time:0,voiceProgress:a.state.voiceProgress||0,voiceDuration:a.state.voiceDuration||0,voiceTime:a.state.voiceTime||0})})),this.player.on(this,o.events.PAUSE,(function(){"stopped"!==a.state.status&&a.setState({status:"paused",currentVoice:a.state.currentVoice||null,currentTrack:a.state.currentTrack,progress:a.state.progress||0,duration:a.state.duration||0,time:a.state.time||0,voiceProgress:a.state.voiceProgress||0,voiceDuration:a.state.voiceDuration||0,voiceTime:a.state.voiceTime||0})})),this.player.on(this,[o.events.STOP,o.events.ENDED],(function(){a.setState(e.initial())})),this.player.on(this,o.events.PROGRESS,(function(t,n){var i=t[5];a.setState({status:"playing",currentVoice:a.state.currentVoice||null,currentTrack:e.toTrack(t),progress:n,duration:i,time:n*i,voiceProgress:a.state.voiceProgress||0,voiceDuration:a.state.voiceDuration||0,voiceTime:a.state.voiceTime||0})})),this.reforgedPlayer.subscribe((function(e){a.setState(e),"stopped"!==e.status&&"ended"!==e.status||window.Notifier.resumeGlobalMedia()})),window.Notifier.addRecvClbk("video_start","fastchats",this.pause),window.Notifier.addRecvClbk("audio_start","fastchats",this.pause),window.Notifier.addRecvClbk("stories_video_start","fastchats",this.pause),window.Notifier.addRecvClbk("logged_off","fastchats",(function(){a.player.stop(),a.reforgedPlayer.stop()}))}return e.prototype.setState=function(e){var t=this;this.state=e,this.listeners.forEach((function(e){return e(t.state)}))},e.initial=function(){return{status:"stopped",currentVoice:null,currentTrack:null,progress:0,duration:0,time:0,voiceProgress:0,voiceDuration:0,voiceTime:0}},e.toTrack=function(e){var t=(0,n.__read)(e,25);return{kind:"Audio",id:t[0],ownerId:t[1],url:t[2],title:t[3],artist:t[4],duration:t[5],albumId:t[6],subtitle:t[16],trackCode:t[20],contentRestricted:t[21],albumPartNumber:t[22],accessKey:t[24],peerId:null}},e.toAudio=function(e){var t=e.id,a=e.ownerId,n=e.url,i=e.title,s=e.artist,r=e.duration,o=e.albumId,l=e.subtitle,c=e.trackCode,d=e.contentRestricted,u=e.albumPartNumber,_=e.accessKey;return[t,a,n,i,s,r,o||0,0,"",0,0,"im","[]","/////"+_+"/","",{},l||"","","",!1,c||"",d||0,u||0,0,_||"",!1]},e}()},607660:(e,t,a)=>{"use strict";a.d(t,{ProxyStorage:()=>i});var n=a(617254),i=function(e){var t=this;this.identify=function(e){t.storage.identify(e)},this.get=function(e){return"settings-sound-notifications-on"===e?!window.ls.get("sound_notify_off"):t.storage.get(e)},this.set=function(e,a){"settings-sound-notifications-on"!==e?t.storage.set(e,a):window.ls.set("sound_notify_off",Number(!a))},this.del=function(e){"settings-sound-notifications-on"!==e?t.storage.del(e):window.ls.remove("sound_notify_off")},this.storage=new n.Storage(e),this.dbName=e}},334943:(e,t,a)=>{"use strict";a.d(t,{SharedEngine:()=>i});var n=a(211719),i=function(e,t){var a=this;if(this.logger=e,this.isMaster=t,this.queued={kind:"Buffer",buffer:[]},this.ts=0,this.pts=0,this.connect=function(e){return a.ts=e.ts,a.pts=e.pts,a.engine.connect(e)},this.poll=function(){return a.engine.poll()},this.isConnected=function(){return a.engine.isConnected()},this.skipWaiting=function(){if(a.isMaster)return a.engine.skipWaiting();a.broadcast&&a.broadcast({type:"skip-waiting"})},this.switch=function(e){if(a.broadcast)switch(a.logger.info("[SHARED ENGINE] switch to",e),e){case"master":switch(a.queued.kind){case"Callback":a.queued.cancel();break;case"Buffer":a.queued.buffer=[]}return void(a.isMaster=!0);case"slave":return void(a.isMaster=!1)}},this.fetch=function(e,t){return Promise.resolve().then((function(){if(!a.isMaster)return a.fetchSlave();var n=+(new URL(e).searchParams.get("ts")||1/0);return a.logger.info("[SHARED ENIGNE]",a.ts,n),n>a.ts?Promise.resolve({failed:1}):a.fetchMaster(e,t)})).then((function(e){return"ts"in e&&(a.ts=e.ts,a.pts=e.pts),e}))},this.fetchMaster=function(e,t){a.logger.info("[SHARED ENGINE] fetch master",e);var n,i=window.AbortController?new AbortController:void 0;return t&&i&&(n=window.setTimeout((function(){return i.abort()}),t)),fetch(e,{method:"POST",signal:null==i?void 0:i.signal,headers:{Connection:"keep-alive"}}).then((function(e){return e.json()})).then((function(e){var t=a.ts;return setTimeout((function(){a.broadcast&&a.broadcast({type:"updates",payload:{tsOld:t,data:e}})})),e})).finally((function(){n&&clearTimeout(n)}))},this.fetchSlave=function(){if("Callback"===a.queued.kind)return Promise.reject(new Error("vkcom engine slave double fetch error"));a.logger.info("[SHARED ENGINE] fetch slave");var e=a.queued.buffer.shift(),t=e?Promise.resolve(e):new Promise((function(e){a.queued={kind:"Callback",push:function(t){a.queued={kind:"Buffer",buffer:[]},e(t)},cancel:function(){a.queued={kind:"Buffer",buffer:[]},e({tsOld:a.ts,data:{ts:a.ts,pts:a.pts,updates:[]}})}}}));return t.then((function(e){return e.tsOld>a.ts?(a.queued={kind:"Buffer",buffer:[]},Promise.resolve({failed:1})):e.data}))},this.engine=new n.Engine(this.logger,this.fetch),this.version=this.engine.version,void 0!==window.BroadcastChannel){var i=new BroadcastChannel("messenger-shared-engine");this.broadcast=function(e){return i.postMessage(e)},i.onmessage=function(e){switch(e.data.type){case"updates":var t=e.data.payload;if(a.isMaster)return;if(a.logger.info("[SHARED ENGINE] broadcast received",t),!a.isConnected())return;return"Callback"===a.queued.kind?void a.queued.push(t):void a.queued.buffer.push(t);case"skip-waiting":return void a.engine.skipWaiting();default:a.logger.error("[SHARED ENGINE] Неизвестный бродкаст")}}}}},246767:(e,t,a)=>{"use strict";a.d(t,{SharedQueue:()=>n});var n=function(){function e(){var e=this;this.MAX_BUFFER_SIZE=50,this.unsubscribe=null,this.empty=function(){return{kind:"Buffer",buffer:[]}},this.poll=function(){if("Callback"===e.queued.kind)return e.queued.reject("Queue.poll вызван дважды!"),new Promise((function(t,a){e.queued={kind:"Callback",resolve:t,reject:a}}));var t=e.queued.buffer.shift();if(t)return Promise.resolve(t);if(!e.isConnected())throw new Error("Queue.connect еще не был вызван!");return new Promise((function(t,a){e.queued={kind:"Callback",resolve:t,reject:a}}))},this.disconnect=function(){switch(e.unsubscribe&&e.unsubscribe(),e.unsubscribe=null,e.queued.kind){case"Callback":e.queued.resolve({kind:"Disconnected",reason:"manual"}),e.queued=e.empty();break;case"Buffer":e.queued.buffer.push({kind:"Disconnected",reason:"manual"});break;default:e.queued}},this.isConnected=function(){return!!e.unsubscribe},this.queued=this.empty()}return e.prototype.connect=function(){var e=this;if(!this.isConnected()){this.queued=this.empty();var t=window.Notifier.getEventQueueInstance();this.unsubscribe=t.subscribe((function(t){var a={kind:"Batch",ts:"1",events:[t]};if("Callback"===e.queued.kind){var n=e.queued.resolve;return e.queued=e.empty(),void n(a)}if(e.queued.buffer.length>=e.MAX_BUFFER_SIZE)return e.unsubscribe&&e.unsubscribe(),e.unsubscribe=null,void e.queued.buffer.push({kind:"Disconnected",reason:"backpressure"});e.queued.buffer.push(a)}))}},e}()},927866:(e,t,a)=>{"use strict";a.d(t,{Stats:()=>o});var n=a(940441),i=a(724702),s=a(746133),r=a(95642),o=function(){this.logEvent=function(e,t){!function(e,t){if("type_action"===e){var a=t;switch(a.type){case"type_ab_custom_metrics_item":n.customMetricsCollector.logEvent(a.type_ab_custom_metrics_item);break;case"type_messaging_action_item":i.messagingActionItemStatCollector.logEvent(a.type_messaging_action_item);break;case"type_messaging_audio_message_item":s.audioMessageStatCollector.logEvent(a.type_messaging_audio_message_item);break;case"type_settings_changes_item":r.settingsChangesStatCollector.logEvent(a.type_settings_changes_item)}}}(e,t)}}},37426:(e,t,a)=>{"use strict";a.d(t,{Settings:()=>B});var n=a(570655),i=a(785893),s=a(844996),r=a(207388),o=a(16032),l=a(817170),c=a(878221),d=a(227778),u=a(475234),_=a(352111),g=a(189754),m=a(218233),p=a(402508),h=a(607660),v=a(891747),f=a(246767),b=a(334943),y=a(927866),w=a(886204),C=a(497138),E=a(973935),S=a(476288),T=a(730365),I=a(743927),L=a(41650),M=a(471996),k=a(645523),P=a(191040),A=a(961540),D=function(e){var t=e.onClose,a=e.store,r=e.browserEnv;return(0,i.jsxs)(T.default,(0,n.__assign)({onClose:t},{children:[(0,i.jsx)(I.ModalHeader,{title:(0,L.getLang)("mail_im_settings_header"),onClose:t},void 0),(0,i.jsx)(S.ModalBody,(0,n.__assign)({hasScroll:!1},{children:(0,i.jsx)("div",(0,n.__assign)({style:{width:"560px",margin:"0 -25px",padding:"4px 20px"}},{children:(0,i.jsx)(s.SettingsApp,{store:a,env:r},void 0)}),void 0)}),void 0)]}),void 0)},B=function(){function e(e,t){this.isMounted=!1,this.imStore=e,this.imPageMutations=t}return e.prototype.renderSettingsPopup=function(t,a){var n=this,s=e.getContainer();s&&E.render((0,i.jsx)(D,{onClose:function(){return n.hide()},store:t,browserEnv:a},void 0),s)},e.getContainer=function(){return document.querySelector("#MessengerSettings")},e.prototype.getContext=function(){var e;if(null===(e=window.reforgedME)||void 0===e?void 0:e.settingsContext)return window.reforgedME.settingsContext;if(this.ownContext)return this.ownContext;(0,r.initConfig)();var t=window.vk.id,a=(0,M.createFeatureFlags)(),n=new m.Api(t),i=new p.Logger,s=new h.ProxyStorage("reforged-db"),u=new b.SharedEngine(i,(0,M.isMasterTab)()),_=new y.Stats,E=(0,M.createLang)(i),S={system:new o.Modals,stack:new o.Stack},T={vkDomain:(0,A.getHostName)(),api:n,lang:E,logger:i,navigate:new w.Navigate,storage:s,player:new g.Player(i),browserNotifications:new v.BrowserNotifications,externalEvents:new l.ExternalEvents,idle:new c.Idle(i),stats:_,geoLocation:new C.GeoLocation,openApp:function(){},vkcom_textInput:(0,M.vkcom_textInputStub)(),vkcom_mediaSelector:(0,M.vkcom_mediaSelectorStub)(),botKeyboard:{update:function(){},subscribe:function(){return function(){}},openApp:function(){},openLink:function(){},openSnackbar:function(){},addEventId:function(){}},modals:S,router:M.fastchatRouter},I={api:n,engine:u,queue:new f.SharedQueue,lang:E,logger:i,storage:s,stats:_,botKeyboard:{update:function(){},subscribe:function(){return function(){}},openApp:function(){},openLink:function(){},openSnackbar:function(){},addEventId:function(){}},modals:S,router:M.fastchatRouter},L=(0,d.createStore)(I,a);return L.start(),this.ownContext={store:L,browserEnv:T},this.ownContext},e.prototype.hide=function(){if(this.isMounted){var t=e.getContainer();t&&E.unmountComponentAtNode(t),this.unsubscribe(),this.isMounted=!1}},e.prototype.show=function(){var e=this,t=this.getContext(),a=t.store,n=t.browserEnv,i=a.getState().userSettings;this.unsubscribe=a.subscribe((function(t){var a=t.userSettings;i.ctrSubmit!==a.ctrSubmit&&(window.cur.ctrl_submit=a.ctrSubmit,e.imStore.set((function(e){return(0,u.setLocalSettingsValue)("ctrl_submit",Number(a.ctrSubmit),e)}))),i.showRecommendations!==a.showRecommendations&&e.imStore.set((function(e){return(0,u.setLocalSettingsValue)("messages_recommendation_list_hidden",Number(!a.showRecommendations),e)})).finally((function(){a.showRecommendations?e.imPageMutations().setRecommendationListVisibility(!0)||(e.hide(),window.nav.reload()):e.imPageMutations().setRecommendationListVisibility(!1)})),i.countOnlyNotMuted!==a.countOnlyNotMuted&&e.imStore.set((function(e){return(0,u.setLocalSettingsValue)("show_only_not_muted_messages",Number(a.countOnlyNotMuted),e)})).then((function(e){(0,_.updateUnreadCounter)(e)})),i.transcriptAutoShow!==a.transcriptAutoShow&&e.imStore.set((function(e){return(0,u.setLocalSettingsValue)("transcript_auto_show",Number(a.transcriptAutoShow),e)})).then((function(){return(0,P.pause)(.25)})).then((function(){var t;return null===(t=e.imStore.get().longpoll)||void 0===t?void 0:t.push([(0,k.changeVoiceTranscriptUI)()])})),i=t.userSettings})),this.renderSettingsPopup(a,n),this.isMounted=!0},e}()},471996:(e,t,a)=>{"use strict";a.d(t,{createFeatureFlags:()=>l,createLang:()=>c,vkcom_textInputStub:()=>d,vkcom_mediaSelectorStub:()=>u,fastchatRouter:()=>_,isMasterTab:()=>g});var n=a(570655),i=a(553890),s=a(427144),r=a(19331),o=a(726271);function l(){var e,t,a={helloStickersPack:[21,12467,53098,50456,50459,18164,134,51117,16263,4275,6329,12296,21560,13312,20952,56896,20465,11607,53320,53647],helloKeywordPack:(null===(t=null===(e=window.stickersKeywords)||void 0===e?void 0:e["привет"])||void 0===t?void 0:t.filter((function(e){return e>0})))||[]};return{me_fc_pinned_message:(0,r.partConfigEnabled)("me_fc_pinned_message"),me_fc_archive:(0,r.partConfigEnabled)("im_archive_web"),me_voice_asr:(0,r.partConfigEnabled)("me_fc_voice_asr"),me_fc_blue_unread_counters:(0,r.partConfigEnabled)("fc_blue_unread_counters"),me_re_disable_merge_convos:(0,r.partConfigEnabled)("me_re_disable_merge_convos"),me_fc_friends_online:(0,r.partConfigEnabled)("me_fc_friends_online"),me_sticker_packs:a,me_vkme:(0,r.partConfigEnabled)("me_vkme_release"),me_fc_multiple_windows:!0,me_fc_tooltips:!0,me_fc_simple_composer:!1,me_fc_message_actions:(0,r.partConfigEnabled)("me_fc_message_actions")}}function c(e){return new i.Lang(e,"ru",{keys:(0,n.__assign)((0,n.__assign)({},window.lang),{global_months_of:Array.from(new Array(12),(function(e,t){return window.lang["Month"+(t+1)+"_of"].toLowerCase()}))}),config:window.langConfig})}function d(){return{init:function(){return 1},destroy:function(){},show:function(){},hide:function(){},val:function(){return""},focus:function(){},swapCallbacks:function(){}}}function u(){return{create:function(){return function(){}},isUploading:function(){return!1},removeMedia:function(){}}}var _=new s.Router;function g(){return!window.curNotifier||window.curNotifier.is_server||o.browser.safari}},314057:(e,t,a)=>{"use strict";a.d(t,{renderHistoryStub:()=>f,prepareEmptyDialogStickersTemplate:()=>b});var n=a(570655),i=a(104958),s=a(993421),r=a(826338),o=a(695724),l=a(19331),c=a(923876),d=a(786067),u=a(49031),_=a(310083),g=a(340753),m=a(826896),p=a(459554),h=a(222131),v=a(140449);function f(e){var t=(0,s.getPeer)(e),a=(0,r.isContactPeer)(t),i=t&&(0,p.getTab)(e,t),v=(0,c.getEmptyScreenUserInfo)(e,t);if(i&&(0,p.isCasperChatTab)(i))return(0,o.getTemplate)("sImEmptyCasper");var f=a||(0,p.isUserEmptyScreenRich)(e,t)&&v&&0!==(null==v?void 0:v.canWrite);if(!i||!(0,l.partConfigEnabled)("messages_new_empty_dialog_screen")||!f)return(0,d.getLang)("mail_im_here_history");var y,w,C=a?(0,h.prepareContactName)(i.tab):(0,o.stripHTML)(i.tab),E=a?(0,h.prepareContactName)(i.name):i.name,S=i.contact_name,T=a?(0,d.getLang)("mail_empty_history_with_contact").replace("{user_name}",E):(0,d.langSex)(i.sex,(0,d.getLang)("mail_empty_history_with_user","raw")).replace("{user_name}",E),I=S?(0,d.langSex)(i.sex,(0,d.getLang)("mail_saved_in_contacts_as","raw")).replace("{contact_name}",S):"",L=i.photo?'<img src="'+i.photo+'" alt="'+E+'">':(0,o.getTemplate)("sImContactAvatar",{name:(0,h.getUserInitials)(E),size:80,classes:""}),M=i.is_subscribed,k=M?"sImEmptyDialogStubUnsubscribeButton":"sImEmptyDialogStubSubscribeButton",P=M?(0,d.getLang)("mail_friend_request_sent"):(0,d.getLang)("mail_add_to_friends"),A=a||i.is_friend?"":(0,o.getTemplate)(k,{button_text:P}),D=(0,n.__read)(v?function(e){if(e.occupation){var t=("work"===e.occupationType?(0,u.getIcon20WorkOutline)():(0,_.getIcon20EducationOutline)()).icon;return[e.occupation,t]}if(e.bdate){t=(0,g.getIcon20CakeOutline)().icon;var a=(0,n.__read)(e.bdate.split("."),2),i=a[0],s=a[1],r=new Date;return r.setDate(+i),r.setMonth(+s-1),[(0,d.langDate)(r.getTime(),(0,d.getLang)("mail_birthday_day_month","raw"),0,(0,d.getLang)("months_of","raw"),!0),t]}if(e.city){t=(0,m.getIcon20HomeOutline)().icon;return[e.city,t]}return["",""]}(v):["",""],2),B=D[0],x=D[1],O=(null==v?void 0:v.mutualFriends.length)?(w=(y=v).mutualFriends.map((function(e){return(0,o.getTemplate)("sImEmptyDialogStubMutualFriend",{name:e.name,src:e.photo})})).join(""),(0,o.getTemplate)("sImEmptyDialogStubMutualFriends",{friends:w,text:(0,d.langNumeric)(y.commonCount,(0,d.getLang)("mail_mutual_friends_count","raw"))})):"",R=a?"":(0,o.getTemplate)("sImEmptyDialogStubUserInfo",{profile_href:i.href,subscribe_button:A,additional_info:B,additional_icon:x,mutual_friends:O});return""+(0,o.getTemplate)("sImEmptyDialogStub",{avatar:L,name:C,stub_text:T,secondary_block:R,saved_as:I,classes:(0,s.isClassicInterface)(e)?"EmptyDialogStub--classic":""})+b(e)}function b(e){var t,a,r=(0,s.getPeer)(e),l=(0,p.getTab)(e,r),c=(0,s.getEmojiOptId)(e);if(!l)return"";var d=l.is_new,u=(null===(t=window.stickersKeywords)||void 0===t?void 0:t["привет"])||[],_=new Map;(u.reduce((function(e,t){var a,n=(null===(a=window.Emoji.stickersById)||void 0===a?void 0:a[t])||{},i=n.packId,s=n.sticker;return t<0||!s?e:e.set(t,[t,256,"",s[3],i])}),_),d)&&((null===(a=window.Emoji.stickers[i.Emoji.TAB_NEW_CONVO_STICKERS])||void 0===a?void 0:a.stickers)||[]).reduce((function(e,t){return e.set(t[0],t)}),_);var g=(0,n.__spreadArray)([],(0,n.__read)(_.values())).reduce((function(e,t){var a=(0,n.__read)(t,5),i=a[0],s=a[3],r=a[4],l={sticker_id:i,sticker_url:v.Stickers.getStickerUrl(i,((0,o.isRetina)()?256:128)+"b"),animation_url:s,set_id:r||0,opt_id:c},d=s?"sImEmptyDialogAnimatedSticker":"sImEmptyDialogSticker";return""+e+(0,o.getTemplate)(d,l)}),"");if(!g)return"";var m=(0,o.getTemplate)("sImCarousel",{content:g,controls_class:"",scroll_count:"3"});return(0,o.getTemplate)("sImEmptyDialogStickers",{content:m})}},730412:(e,t,a)=>{"use strict";a.d(t,{updateFolderCounters:()=>o});var n=a(712439),i=a(179288),s=a(578843),r=[i.ConvoListFolder.MR,i.ConvoListFolder.BUSINESS_NOTIFY,i.ConvoListFolder.ARCHIVE];function o(e){var t=(0,n.unpackStore)(e);r.forEach((function(e){var a,n,i=(0,s.getFolderUnreadCount)(t,e),r=document.querySelector('._im_right_menu_counter[data-tab="'+e+'"]');r&&(r.innerHTML=i,null===(n=null===(a=r.closest(".ui_rmenu_item"))||void 0===a?void 0:a.classList)||void 0===n||n.toggle("ui_rmenu_item_hidden",(0,s.isConvoListFolderHidden)(t,e)))}));var a=(0,s.getFolderMentionsCount)(t,i.ConvoListFolder.ARCHIVE),o=document.querySelector('._im_right_menu_mentions[data-tab="'+i.ConvoListFolder.ARCHIVE+'"]');o&&(o.dataset.mentions=a)}},823908:(e,t,a)=>{"use strict";function n(){window.cur.videoAutoplayScrollHandler&&window.cur.videoAutoplayScrollHandler()}a.d(t,{videoAutoPlayHandler:()=>n})},988058:(e,t,a)=>{"use strict";a.d(t,{createLongpoll:()=>l});var n=a(49267),i=a(437361),s=a(887294),r=a(454593),o=a(460615);function l(e,t){return(0,n.createLongpollConnect)(e,{onEvents:t,onData:u,onRequestError:_,onHistoryLost:g,onKeyExpired:m,onLpBroken:p})}var c={},d=Date.now();function u(e,t){if(t&&t.status&&e.lpstat){var a=t.status.toString();t.status>=500&&t.status<600&&(0,o.statlogsValueEvent)("fc_longpoll",1,a,t.getResponseHeader("x-frontend")||""),c[a]=a in c?c[a]+1:1,Date.now()-d>=3e4&&(Object.keys(c).forEach((function(e){(0,o.statlogsValueEvent)("fc_longpoll",c[e],e,t.getResponseHeader("x-frontend")||"")})),c={},d=Date.now())}}function _(e){(0,i.lpLogFc)("red","LP error",e.message||"no message (probably browser reset)")}function g(e,t){(0,i.lpLogFc)("red","LP failed: old timestamp; resync, next ts",t.ts)}function m(e){return(0,i.lpLogFc)("red","LP failed: key is incorrect; refresh key"),(0,s.post)(r.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0},1e3)}function p(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}},437361:(e,t,a)=>{"use strict";a.d(t,{lpLogFc:()=>s,longpollTestingOnFcEvents:()=>_});var n=a(570655),i=a(968958);function s(e,t){for(var a=[],i=2;i<arguments.length;i++)a[i-2]=arguments[i];if(window.vk.lpConfig.debug){var s="background: "+e+"; color: white",r=new Date,o=function(e){return e<10?"0"+e.toString():e.toString()};console.log.apply(console,(0,n.__spreadArray)(["%c "+r.getHours()+":"+o(r.getMinutes())+":"+o(r.getSeconds())+":"+r.getMilliseconds()+" "+t+" ",s],(0,n.__read)(a)))}}function r(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function o(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function l(e,t){var a;window.lpWeird||(window.lpWeird=[]),window.lpWeird.push({msg:e,ev:t,is_master:!!(null===(a=window.curNotifier)||void 0===a?void 0:a.is_server)}),setTimeout(c,1e4)}function c(){window.lpWeird&&window.lpWeird.length&&((0,i.imWeirdLog)("fc_im_differ",{diff:window.lpWeird},!1),window.lpWeird=[])}function d(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function u(){var e;d()&&(o().forEach((function(e){!r().find((function(t){return e.ev===t.ev}))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,s("red","im not fc",e.ev),(0,i.isWeirdLogging)()&&l("im not fc",e.ev))})),r().forEach((function(e){var t=o().find((function(t){return t.ev===e.ev}));t&&t.warned&&!e.warned&&(e.warned=!0,s("red","now fc like im",e.ev),(0,i.isWeirdLogging)()&&l("now fc like im",e.ev))}))),e=Date.now()-3e4,window.lpBufferFc=r().filter((function(t){return t.time>e})),window.lpBufferIm=o().filter((function(t){return t.time>e}))}function _(e){var t;d()&&((t=r()).push.apply(t,(0,n.__spreadArray)([],(0,n.__read)(e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))))),setTimeout(u,0)),s.apply(void 0,(0,n.__spreadArray)(["green","fc"],(0,n.__read)(e)))}window.longpollTestingOnImEvents=function(e){var t;d()&&((t=o()).push.apply(t,(0,n.__spreadArray)([],(0,n.__read)(e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))))),setTimeout(u,1100)),s.apply(void 0,(0,n.__spreadArray)(["blue","im"],(0,n.__read)(e)))}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(a.exports,a,a.exports,__webpack_require__),a.loaded=!0,a.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,a,n)=>{if(!t){var i=1/0;for(l=0;l<deferred.length;l++){for(var[t,a,n]=deferred[l],s=!0,r=0;r<t.length;r++)(!1&n||i>=n)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[r])))?t.splice(r--,1):(s=!1,n<i&&(i=n));if(s){deferred.splice(l--,1);var o=a();void 0!==o&&(e=o)}}return e}n=n||0;for(var l=deferred.length;l>0&&deferred[l-1][2]>n;l--)deferred[l]=deferred[l-1];deferred[l]=[t,a,n]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var a=Object.create(null);__webpack_require__.r(a);var n={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&t&&e;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((t=>n[t]=()=>e[t]));return n.default=()=>e,__webpack_require__.d(a,n),a},__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.e=()=>Promise.resolve(),__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={655:0};__webpack_require__.O.j=t=>0===e[t];var t=(t,a)=>{var n,i,[s,r,o]=a,l=0;for(n in r)__webpack_require__.o(r,n)&&(__webpack_require__.m[n]=r[n]);if(o)var c=o(__webpack_require__);for(t&&t(a);l<s.length;l++)i=s[l],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[s[l]]=0;return __webpack_require__.O(c)},a=self.webpackChunkvk=self.webpackChunkvk||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var __webpack_exports__=__webpack_require__.O(void 0,[11216,24509,38288,40885,68592,75672,76032,79542,23299,43639,43087,56058],(()=>__webpack_require__(981311)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();