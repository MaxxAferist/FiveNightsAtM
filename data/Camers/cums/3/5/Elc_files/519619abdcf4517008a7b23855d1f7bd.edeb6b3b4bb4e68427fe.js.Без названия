(self.webpackChunkvk=self.webpackChunkvk||[]).push([[56058],{337057:(e,t,n)=>{"use strict";n.d(t,{VkIndexer:()=>a});var a=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},a=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),o=a.length;o--;){var r=a[o],i="";if(r){for(var s=0;s<6;s++){var l=r.charCodeAt(s);if(l){var c=this.toTranslit[l],u=r.substr(s,1);i+=null!=c?c:u}}n[i]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),a=n.length;a--;){var o={},r=n[a],i="",s="",l="",c=r.length>1;if(r){for(var u=0;u<6;u++){var d=r.charCodeAt(u);if(d){var h=this.toTranslit[d],v=r.substr(u,1);if(i+=null!=h?h:v,c){var g=this.toLocalCase[v],_=this.toLocalTranslit[d];s+=null!=g?g:v,l+=null!=_?_:v}}}o[i]=1,c&&(o[s]=2,o[l]=3),t.push(o)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,a=0;a<6;a++){var o=e.substr(a,1)||-1;n=n[o]?n[o]:n[o]=5==a?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)if(n.hasOwnProperty(a)){for(var o=this.index,r=0;r<6;r++){var i=a.substr(r,1)||-1;if(!o[i])break;o=o[i]}if(o.length)for(var r in o)if(this.equals(o[r],e)){o.splice(r,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(o(e[0])||o(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var a=e.shift();a&&n.push(a)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)n.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),a=[],o=!1;for(var r in n)if(n.hasOwnProperty(r)){if(o&&!a)break;var i=this.localSearch(n[r],0,t);i.sort((function(e,t){return e._order-t._order})),a=o?this.intersect(a,i):i,o=!0}for(var s=a[0],l=a.length+1,c=[],u=1;u<l;u++){var d=a[u];d!=s&&(c.push(s),s=d)}return c},e.prototype.localSearch=function(e,t,n){if(!n)return[];var a={};for(var o in e)e.hasOwnProperty(o)&&(a[i=o.substr(t,1)||-1]||(a[i]={}),a[i][o]=1);if(6==t++)return n;var r=[];for(var i in a)if("-1"===i)for(var s in n)n.hasOwnProperty(s)&&r.push.apply(r,this.localSearch(a[i],t,n[s]));else{var l=this.localSearch(a[i],t,n[i]);r.push.apply(r,l)}return r},e}();function o(e){return!isNaN(e)}},947934:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(379333).makeIcon)("Icon20Add","add_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="add_20"><path clip-rule="evenodd" d="M10 2a.75.75 0 0 1 .75.75v6.499h6.499a.75.75 0 0 1 0 1.5H10.75v6.499a.75.75 0 0 1-1.5 0v-6.5H2.751a.75.75 0 0 1 0-1.5H9.25V2.75A.75.75 0 0 1 10 2z" fill="currentColor" fill-rule="evenodd" /></symbol>',20,20)},265187:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(379333).makeIcon)("Icon20CalendarOutline","calendar_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="calendar_outline_20"><path fill="currentColor" fill-rule="evenodd" d="M6.25 1a.75.75 0 0 1 .75.75v.257C7.393 2 7.83 2 8.317 2h3.366c.487 0 .924 0 1.317.007V1.75a.75.75 0 0 1 1.5 0v.356c.428.064.816.172 1.18.357a4.25 4.25 0 0 1 1.857 1.857c.253.498.361 1.04.413 1.67.05.614.05 1.375.05 2.327v3.366c0 .952 0 1.713-.05 2.327-.052.63-.16 1.172-.413 1.67a4.251 4.251 0 0 1-1.857 1.857c-.498.253-1.04.361-1.67.413-.614.05-1.375.05-2.327.05H8.317c-.952 0-1.713 0-2.327-.05-.63-.052-1.172-.16-1.67-.413a4.25 4.25 0 0 1-1.857-1.857c-.253-.498-.361-1.04-.413-1.67C2 13.396 2 12.635 2 11.683V8.317c0-.952 0-1.713.05-2.327.052-.63.16-1.172.413-1.67A4.25 4.25 0 0 1 4.32 2.463a3.793 3.793 0 0 1 1.18-.357V1.75A.75.75 0 0 1 6.25 1ZM5.5 3.63a2.02 2.02 0 0 0-.498.17A2.75 2.75 0 0 0 3.8 5.002c-.128.25-.21.573-.255 1.11-.02.255-.032.543-.038.878h12.986a14.08 14.08 0 0 0-.038-.878c-.044-.537-.127-.86-.255-1.11A2.75 2.75 0 0 0 14.998 3.8a2.016 2.016 0 0 0-.498-.17v.12a.75.75 0 0 1-1.5 0v-.243a80.02 80.02 0 0 0-1.35-.007h-3.3c-.525 0-.968 0-1.35.007v.243a.75.75 0 0 1-1.5 0v-.12Zm11 4.86h-13v3.16c0 .993 0 1.692.045 2.238.044.537.127.86.255 1.11A2.75 2.75 0 0 0 5.002 16.2c.25.128.573.21 1.11.255.546.044 1.246.045 2.238.045h3.3c.992 0 1.692 0 2.238-.045.537-.044.86-.127 1.11-.255a2.751 2.751 0 0 0 1.202-1.202c.128-.25.21-.573.255-1.11.044-.546.045-1.246.045-2.238V8.49ZM15 13.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" /></symbol>',20,20)},927384:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(379333).makeIcon)("Icon20MailOutline","mail_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="mail_outline_20"><path fill="currentColor" fill-rule="evenodd" d="M6.577 2.5h6.846c1.773 0 2.418.18 3.067.528.64.343 1.14.845 1.483 1.486.347.65.527 1.296.527 3.074v4.824c0 1.778-.18 2.424-.527 3.074a3.568 3.568 0 0 1-1.483 1.486c-.649.347-1.294.528-3.067.528H6.577c-1.773 0-2.418-.18-3.067-.528a3.567 3.567 0 0 1-1.483-1.486c-.347-.65-.527-1.296-.527-3.074V7.588c0-1.778.18-2.424.527-3.074A3.568 3.568 0 0 1 3.51 3.028c.649-.347 1.294-.528 3.067-.528ZM3 12.412V7.588c0-1.598.156-1.997.33-2.328l4.463 4.464c.28.28.52.52.736.703.226.192.473.363.776.462a2.249 2.249 0 0 0 1.39 0c.303-.099.55-.27.776-.462.215-.182.456-.424.736-.703L16.67 5.26c.173.331.329.73.329 2.328v4.824c0 1.663-.169 2.027-.35 2.368-.203.379-.49.667-.868.87-.34.181-.701.35-2.36.35H6.578c-1.658 0-2.02-.169-2.359-.35a2.068 2.068 0 0 1-.867-.87C3.169 14.44 3 14.075 3 12.412ZM13.423 4H6.577c-1.326 0-1.823.108-2.142.244l4.398 4.399c.306.305.504.502.666.64.156.133.23.166.27.179a.75.75 0 0 0 .463 0c.04-.013.113-.046.269-.179.162-.138.36-.335.666-.64l4.398-4.399C15.245 4.108 14.75 4 13.423 4Z" clip-rule="evenodd" /></symbol>',20,20)},6057:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(379333).makeIcon)("Icon20PhoneOutline","phone_outline_20","0 0 20 20",'<symbol viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="phone_outline_20"><g fill="none" fill-rule="evenodd"><path opacity=".1" d="M0 0h20v20H0z" /><path d="m7.78 2.7.7.833c1.373 1.628 1.229 4.054-.299 5.582l-.297.296c.226.38.633.878 1.23 1.475.53.53.984.912 1.344 1.149l.13.082.298-.297c1.526-1.527 3.95-1.672 5.58-.302l.833.702c1.46 1.229 1.602 3.419.346 4.894a3.859 3.859 0 0 1-2.29 1.289l-.506.06c-3.005.292-6.037-1.16-9.094-4.217-3.056-3.056-4.51-6.09-4.226-9.025l.06-.515a3.834 3.834 0 0 1 1.3-2.354l.168-.135c1.462-1.107 3.54-.924 4.723.484Zm-3.911.788c-.321.276-.562.633-.698 1.033a2.37 2.37 0 0 0-.115.552c-.343 2.548.898 5.25 3.76 8.112 2.86 2.862 5.562 4.103 8.123 3.758a2.376 2.376 0 0 0 1.571-.81c.719-.844.636-2.082-.177-2.766l-.833-.701-.142-.112c-1.02-.739-2.471-.614-3.411.326l-.597.598-.088.076a.903.903 0 0 1-.862.133c-.648-.238-1.425-.818-2.346-1.74-.923-.923-1.503-1.7-1.74-2.347a.903.903 0 0 1 .209-.95l.598-.597.129-.137c.862-.987.906-2.44.084-3.416l-.702-.834-.112-.122c-.7-.697-1.853-.735-2.651-.056Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',20,20)},601931:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(379333).makeIcon)("Icon20PlaceOutline","place_outline_20","0 0 20 20",'<symbol viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="place_outline_20"><g fill="none" fill-rule="evenodd"><path opacity=".4" d="M0 0h20v20H0z" /><path d="M10 1c4.148 0 7.5 3.433 7.5 7.5 0 2.85-1.843 6.172-5.435 10.095a2.8 2.8 0 0 1-4.13 0C4.343 14.672 2.5 11.35 2.5 8.5 2.5 4.433 5.852 1 10 1Zm0 1.5c-3.382 0-6 2.825-6 6 0 2.383 1.68 5.41 5.041 9.082a1.3 1.3 0 0 0 1.918 0C14.319 13.911 16 10.883 16 8.5c0-3.175-2.618-6-6-6ZM10 5a3.5 3.5 0 1 1-.001 7.001A3.5 3.5 0 0 1 10 5Zm0 1.5a2 2 0 1 0 .001 4.001A2 2 0 0 0 10 6.5Z" fill="currentColor" fill-rule="nonzero" /></g></symbol>',20,20)},282725:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(379333).makeIcon)("Icon20Sync","sync_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="sync_20"><clipPath id="sync_20_a"><path d="M0 0h20v20H0z" /></clipPath><g clip-path="url(#sync_20_a)" fill="currentColor"><path d="M16.25 1.5a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-.75.75h-3a.75.75 0 0 1 0-1.5h1.081a6.977 6.977 0 0 0-4.33-1.5 6.976 6.976 0 0 0-4.95 2.05 6.976 6.976 0 0 0-1.973 5.996c.073.483-.278.954-.766.954a.69.69 0 0 1-.69-.563A8.54 8.54 0 0 1 1.5 10c0-2.174.83-4.35 2.49-6.01A8.476 8.476 0 0 1 10 1.5c1.958 0 3.918.673 5.5 2.019V2.25a.75.75 0 0 1 .75-.75zM3 14.75a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H5.669C6.935 16.5 8.467 17 10 17a6.976 6.976 0 0 0 4.95-2.05 6.976 6.976 0 0 0 1.972-5.996C16.85 8.47 17.2 8 17.688 8a.69.69 0 0 1 .69.563 8.476 8.476 0 0 1-2.368 7.448A8.476 8.476 0 0 1 10 18.5a8.476 8.476 0 0 1-5.5-2.019v1.269a.75.75 0 0 1-1.5 0z" /></g></symbol>',20,20)},125396:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(379333).makeIcon)("Icon24Settings","settings_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="settings_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M9.127 5.052c1.256-.72 1.473-1.469 1.623-2.219.167-.833.417-.833.833-.833h.834c.416 0 .583 0 .833.833.225.751.383 1.502 1.631 2.223 1.397.379 2.08.002 2.717-.422.707-.471.884-.294 1.178 0l.59.59c.294.294.412.412 0 1.178-.372.69-.791 1.333-.418 2.725.72 1.256 1.469 1.473 2.219 1.623.833.167.833.417.833.833v.834c0 .416 0 .583-.833.833-.751.225-1.502.383-2.223 1.631-.379 1.397-.002 2.08.422 2.717.471.707.294.884 0 1.178l-.59.59c-.294.294-.412.412-1.178 0-.69-.372-1.333-.791-2.725-.418-1.256.72-1.473 1.469-1.623 2.219-.167.833-.417.833-.833.833h-.834c-.416 0-.583 0-.833-.833-.225-.751-.383-1.502-1.631-2.223-1.397-.379-2.08-.002-2.717.422-.707.471-.884.294-1.178 0l-.59-.59c-.294-.294-.412-.412 0-1.178.372-.69.791-1.333.418-2.725-.72-1.256-1.469-1.473-2.219-1.623C2 13.083 2 12.833 2 12.417v-.834c0-.416 0-.583.833-.833.751-.225 1.502-.383 2.223-1.631.379-1.397.002-2.08-.422-2.717-.471-.707-.294-.884 0-1.178l.59-.59c.294-.294.412-.412 1.178 0 .69.372 1.333.791 2.725.418ZM12 16.75a4.75 4.75 0 1 0 0-9.5 4.75 4.75 0 0 0 0 9.5Z" fill="currentColor" /></g></symbol>',24,24)},147650:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(379333).makeIcon)("Icon24SmileOutline","smile_outline_24","0 0 24 24",'<symbol viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" id="smile_outline_24"><path d="M8.438 14.297a.9.9 0 0 1 1.259.133c.013.016.196.223.53.432.383.24.97.488 1.773.488a3.3 3.3 0 0 0 1.773-.488c.191-.12.382-.26.53-.432a.9.9 0 0 1 1.4 1.132 4.045 4.045 0 0 1-.976.826A5.094 5.094 0 0 1 12 17.15a5.094 5.094 0 0 1-2.727-.762 3.987 3.987 0 0 1-.976-.826.9.9 0 0 1 .14-1.265zm1.812-4.047a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0zM15 11.5A1.25 1.25 0 1 0 15 9a1.25 1.25 0 0 0 0 2.5z" fill="currentColor" /><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.1c-5.468 0-9.9 4.432-9.9 9.9s4.432 9.9 9.9 9.9 9.9-4.432 9.9-9.9-4.432-9.9-9.9-9.9zM3.9 12a8.1 8.1 0 1 1 16.2 0 8.1 8.1 0 0 1-16.2 0z" fill="currentColor" /></symbol>',24,24)},890470:(e,t,n)=>{"use strict";function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="m7.28 4.99-.52 1.2c-.04.1-.06.14-.09.17a.28.28 0 0 1-.09.07.62.62 0 0 1-.17.04l-.75.1c-2.15.3-3.23.46-3.68.96a1.86 1.86 0 0 0-.44 1.61c.13.67.98 1.35 2.68 2.7l.27.23c.08.06.12.09.14.13a.28.28 0 0 1 .04.11c.01.05 0 .1-.02.2l-.08.44c-.48 2.5-.71 3.75-.34 4.36a1.85 1.85 0 0 0 1.5.9c.72.02 1.7-.79 3.65-2.42l.34-.28c.1-.08.15-.12.2-.14a.28.28 0 0 1 .16 0c.06.02.11.06.21.14l.34.28c1.95 1.63 2.93 2.44 3.65 2.41a1.85 1.85 0 0 0 1.5-.89c.37-.6.14-1.86-.34-4.36l-.08-.45c-.02-.1-.03-.14-.02-.19a.28.28 0 0 1 .04-.11.62.62 0 0 1 .14-.13l.27-.22c1.7-1.36 2.55-2.04 2.68-2.7a1.86 1.86 0 0 0-.44-1.62c-.45-.5-1.53-.65-3.68-.96l-.75-.1c-.09-.02-.13-.02-.17-.04a.28.28 0 0 1-.1-.07l-.08-.16-.52-1.21c-.86-2-1.3-2.99-1.9-3.29a1.85 1.85 0 0 0-1.66 0C8.57 2 8.14 3 7.28 5Z"/></svg>',name:"favorite_20"}}n.d(t,{getIcon20Favorite:()=>a})},75874:(e,t,n)=>{"use strict";function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" fill-rule="evenodd" d="M10.4 3.13a.92.92 0 0 0-.82 0c-.05.03-.19.13-.44.6-.24.45-.52 1.09-.92 2-.16.38-.33.74-.48 1.12-.02.05-.09.2-.2.33a1.02 1.02 0 0 1-.33.25c-.16.08-.35.1-.38.1l-.68.1c-1 .14-1.69.24-2.19.35-.52.13-.66.23-.7.27a.92.92 0 0 0-.21.8c0 .05.07.22.46.59.37.35.92.8 1.7 1.42l.25.2a1.02 1.02 0 0 1 .42 1.13l-.08.41a35.03 35.03 0 0 0-.43 2.56c-.07.64 0 .82.03.86a.92.92 0 0 0 .74.44c.05 0 .24-.02.77-.39.49-.34 1.13-.87 2.03-1.62l.31-.26.15-.12c.07-.04.17-.11.32-.15a1.02 1.02 0 0 1 .55 0c.15.04.25.1.32.15l.15.12.31.26c.9.75 1.54 1.28 2.03 1.62.53.37.72.4.77.4a.92.92 0 0 0 .74-.45c.03-.04.1-.22.03-.86-.06-.6-.21-1.4-.43-2.56l-.08-.42a1.25 1.25 0 0 1-.02-.4 1.03 1.03 0 0 1 .15-.42c.1-.17.26-.28.3-.3l.24-.2c.78-.63 1.33-1.07 1.7-1.42.39-.37.45-.54.46-.59a.92.92 0 0 0-.22-.8c-.03-.04-.17-.14-.7-.27-.5-.11-1.18-.21-2.18-.35l-.7-.1c-.04 0-.2-.03-.36-.1a1.02 1.02 0 0 1-.33-.25c-.12-.14-.19-.31-.2-.34l-.48-1.1c-.4-.92-.68-1.56-.92-2-.25-.48-.4-.58-.44-.6ZM8.9 1.76a2.45 2.45 0 0 1 2.2 0c.5.25.82.73 1.1 1.24.28.51.58 1.22.96 2.09l.41.95.53.07c.94.14 1.7.24 2.28.38.56.13 1.11.32 1.49.74a2.46 2.46 0 0 1 .58 2.12c-.11.55-.5 1-.9 1.4-.43.4-1.03.89-1.78 1.48l-.11.1.04.22c.21 1.1.38 1.99.45 2.66.06.64.07 1.3-.25 1.81a2.46 2.46 0 0 1-1.99 1.18c-.6.02-1.18-.3-1.7-.67-.56-.38-1.24-.95-2.1-1.67l-.11-.09-.11.09c-.87.72-1.55 1.29-2.1 1.67-.53.37-1.1.7-1.71.67a2.46 2.46 0 0 1-2-1.18c-.3-.51-.3-1.17-.24-1.81.07-.67.24-1.55.45-2.66l.04-.23-.11-.09c-.74-.6-1.35-1.07-1.77-1.48-.42-.4-.8-.85-.9-1.4a2.46 2.46 0 0 1 .58-2.12c.37-.42.92-.61 1.48-.74.58-.14 1.34-.24 2.28-.38l.53-.07.4-.95c.39-.87.7-1.58.97-2.1.28-.5.6-.98 1.1-1.23Z" clip-rule="evenodd"/></svg>',name:"favorite_outline_20"}}n.d(t,{getIcon20FavoriteOutline:()=>a})},161381:(e,t,n)=>{"use strict";function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="M12.6 2.22a.75.75 0 0 0-1.27.38l-.3 1.54a.3.3 0 0 1-.09.16L8.48 6.76a.3.3 0 0 1-.19.08l-3.86.3a1.01 1.01 0 0 0-.63 1.73l2.96 2.96-4.47 4.46a1 1 0 0 0 1.42 1.42l4.46-4.47 2.97 2.96c.61.62 1.65.22 1.72-.63l.3-3.86a.3.3 0 0 1 .08-.19l2.47-2.46a.3.3 0 0 1 .15-.08l1.54-.31c.58-.12.8-.84.38-1.27L12.6 2.22Z"/></svg>',name:"pin_20"}}n.d(t,{getIcon20Pin:()=>a})},110757:(e,t,n)=>{"use strict";n.d(t,{MessageForward:()=>L});n(175115),n(530522),n(66108),n(991181),n(579665),n(95767),n(820075),n(940851),n(296253);var a=n(667294),o=n(486125),r=(n(45697),n(268959)),i=n(439664),s=n(413374),l=n(454593),c=n(191040),u=n(597903),d=n(104837),h=n(459554),v=n(645523),g=n(41650),_=n(412947),m=n(483295),p=n(329164),f=n(863729),C=n(654612),b=n(923876),I=n(147650),w=n(254589);function y(){return y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},y.apply(this,arguments)}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,o=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{a||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var A=(0,c.debouncedPromise)(l.searchHints,300),k=g.default.getLang;class M extends a.Component{constructor(e){var t;super(e),t=this,this.toggleMode=()=>{var e=this.props.store;if((0,d.isCommunityInterface)(e)){var t=0===this.state.mode?1:0,n=0===t?l.searchImTopConv:l.searchTopConv;this.setState({value:"",mode:t,loading:!0,selected:null,found:[]},(()=>n("",e.get()).then((e=>this.setSearchResults(this.filterResults(e)))).then((()=>this.searchInput.focus())).catch((e=>console.error(e)))))}},this.onChange=e=>{this.setState({value:e.target.value,loading:!0,error:null});var t=e.target.value;this.searchQuery!==t&&(this.searchQuery=t,this.onSearch(t))},this.filterResults=e=>{var t=(0,d.isCommunityInterface)(this.props.store)&&1===this.state.mode;return e.filter((e=>{var n=e.peerId;return!(t&&n<0)&&(!(t&&n>2e9&&!(0,h.doesChatTabHaveFlag)(e,1024))&&!(!t&&n>2e9&&(0,h.doesChatTabHaveFlag)(e,1024)))}))},this.onSearch=e=>{var t=this.props.store,n=t.get(),a=(0,d.isCommunityInterface)(t)&&0===this.state.mode,o=a?l.searchImTopConv:l.searchTopConv;return 1===this.state.mode&&""===e?this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})):o(e,n).then((t=>{var o=t.map((e=>e.peerId));return t=this.filterResults(t),this.setSearchResults(t,!1,!t.length),e?A(e,o,"all",{hidegid:a,skipStoreUpdate:a},n):Promise.resolve([])})).then((t=>{e===this.state.value&&this.setSearchResults(this.filterResults(t),!0)})).catch((()=>{}))},this.emptySearch=()=>{var e=this.props.store,t=e.get(),n=t.dialog_tabs.all,a={},o={};return(0,l.searchTopConv)("",t).then((r=>(r.forEach((e=>{o[e.peerId]=e})),[t.peer].concat(n.filter((e=>e!==t.peer))).map((t=>{var n=(0,d.getTab)(e,t);return a[t]=!0,{name:o[t]&&o[t].tab||n.tab,photo:o[t]&&o[t].photo||n.photo,lastmsg:n.lastmsg,major_sort_id:n.major_sort_id,minor_sort_id:n.minor_sort_id,data:n.data,peerId:t}})).concat(r.filter((e=>!a[e.peerId]))).sort(((n,a)=>n.peerId===t.peer?-1:a.peerId===t.peer?1:(0,b.sortFn)(e,n,a))))))},this.sendRecipient=e=>{var t=this.props.store,n=t.get();1===this.state.mode?(n.longpoll.push([(0,v.changePeer)(e,!1,!0,!0,"forward_messages_popup")]),(0,_.statlogsForwardEvent)(t),(0,d.isCommunityInterface)(t)&&(0,_.statlogsForwardFromCommunityEvent)(t,!1)):this.setState({selected:e,error:null},(()=>{Emoji.focus(this.input)}))},this.loadMore=()=>{},this.getSearchInputEl=e=>this.searchInput=e,this.setSearchResults=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t.unmounted)if(n){var o=e.filter((e=>!t.found[e.peerId]));o.forEach((e=>{t.found[e.peerId]=!0})),t.setState({found:[].concat(t.state.found,o),loading:a})}else t.found=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),{}),t.setState({found:e,loading:a,activeElement:0})},this.getFormRef=e=>{this.form=e},this.getInputRef=e=>{this.input=e},this.getEmojiButtonRef=e=>{this.emojiButton=e},this.onEmojiButtonMouseOver=e=>{e.persist(),Emoji.show(this.emojiButton,e)},this.onEmojiButtonMouseOut=e=>{e.persist(),Emoji.hide(this.emojiButton,e)},this.send=()=>{var e=this.props.store,t=this.state.selected,n=Emoji.val(this.input).trim(),a=new p.ImDraft({},0),r=e.get().pendingForward;if(t&&!(0,u.isMessageTooLong)(val)){this.setState({sending:!0});var i=(0,d.isCommunityInterface)(e)&&0===this.state.mode;i||a.addAttach("mail",r.msgIds.join(";"),r.object||null);var s={message:n,attaches:a.dData.attaches.map((e=>[e.type,e.id]))||[]},c={hidegid:!0,external:{original_gid:e.get().id,fwd_group_msg_ids:i?r.msgIds.join(";"):void 0}};new Promise((n=>{(0,l.loadHashes)([t],{hidegid:!0},e.get()).then((e=>{var a=S(e,1)[0];return n(a[t])}))})).then((n=>e.set(l.sendMessage.bind(null,t,s,y({hash:n},c))))).then((()=>{(0,_.statlogsForwardFromCommunityEvent)(e,!0),e.setState({pendingForward:null}),this.props.closePopup(),(0,o.showDoneBox)(k("mail_send3"))})).catch((e=>{this.unmounted||this.setState({sending:!1},(()=>{(0,C.showFastBox)(k("mail_error"),e)}))}))}},this.onSearchKeyDown=e=>{27===e.keyCode&&this.state.value&&(this.searchInput.blur(),this.searchQuery="",this.setState({value:"",loading:!0,error:null},this.onSearch.bind(this,"")),e.stopPropagation())},this.onMessageInputKeyDown=e=>{27===e.keyCode&&(this.state.sending||(Emoji.val(this.input,""),this.setState({selected:null}),this.searchInput.focus()),e.stopPropagation())},this.state={value:"",found:[],mode:1,loading:!0,sending:!1,selected:null,activeElement:0},this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})).catch((e=>console.error(e)))}componentDidMount(){this.props.updatePopup(),Emoji.init(this.input,{noStickers:!0,onSend:this.send}),this.input.addEventListener("keydown",this.onMessageInputKeyDown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onMessageInputKeyDown),this.unmounted=!0}render(){var e=this.props,t=e.store,n=e.closePopup,o=this.state,l=o.mode,c=o.loading,u=o.selected,h=o.found,v=o.sending,g=(0,m.classNames)("MessageForward",{"MessageForward--form":0===l&&!!u});return a.createElement("section",{className:g},a.createElement(r.default,{title:a.createElement(a.Fragment,null,a.createElement("span",{className:"MessageForward__title"},k("mail_forward_messages")),(0,d.isCommunityInterface)(t)&&a.createElement("span",{className:"MessageForward__switch",onClick:this.toggleMode},k(0===l?"mail_forward_to_community_messages":"mail_forward_to_im"))),onCloseClick:n}),a.createElement("div",{className:"MessageForward__content"},a.createElement(s.ConvoPicker,{searchValue:this.state.value,isLoading:c,convos:h.map((e=>e||(0,d.getTab)(t,e.peerId))),mode:1===l?s.convoPickerMode.DEFAULT:s.convoPickerMode.RADIO,selectedConvos:[u],onSearchValueChange:this.onChange,onSearchInputKeydown:this.onSearchKeyDown,onConvoSelect:this.sendRecipient,onListLoadMore:this.loadMore,searchInputGetter:this.getSearchInputEl,className:"MessageForward__convoPicker"}),a.createElement("footer",{className:"MessageForward__footer",ref:this.getFormRef,key:"footer"},a.createElement("div",{className:"MessageForward__form _emoji_field_wrap"},a.createElement("div",{className:"MessageForward__input",tabIndex:"0",contentEditable:!0,role:"textbox","aria-multiline":!0,ref:this.getInputRef,placeholder:k("mail_im_enter_msg")}),a.createElement("div",{className:"MessageForward__emoji emoji_smile_wrap _emoji_wrap"},a.createElement("div",{ref:this.getEmojiButtonRef,className:"emoji_smile _emoji_btn",title:k("global_emoji_hint"),onMouseOver:this.onEmojiButtonMouseOver,onMouseOut:this.onEmojiButtonMouseOut,onClick:this.onEmojiButtonClick},a.createElement(I.default,null)))),v?a.createElement("div",{className:"MessageForward__send-spinner"},a.createElement(i.default,null)):a.createElement("button",{className:"MessageForward__send",onClick:this.send},a.createElement(w.default,null)))))}}var L=(0,f.connect)(M)},31847:(e,t,n)=>{"use strict";n.d(t,{checkContactListLoaded:()=>q,mount:()=>re});n(820075),n(991181),n(59357),n(940851),n(296253);var a=n(376852),o=n(49535),r=n(486125),i=n(786067),s=n(610124),l=n(454593),c=n(597903),u=n(663825),d=n(645523),h=n(104837),v=n(483295),g=n(294940),_=n(549892),m=n(778755),p=n(204477),f=n(983813),C=n(456286),b=n(19331),I=n(459554),w=n(993421),y=n(315544),S=n(695724),T=n(57757),A=n(124041),k=n(890470),M=n(75874),L=n(491372),E=n(161381),x=n(748136),P="_im_dialog_action_wrapper",N="_im_dialog_call_action_wrapper",R="_im_header_icon",j="_im_page_action",B="_im_chat_verified",F="._im_page_status",O="im-page--chat-header_reconnected",D="im-page--header-action_loading";function H(e,t,n){return!e.map((e=>{var a=(0,h.getMessage)(t,n,e);return a&&(0,g.isImportant)(a)})).reduce(((e,t)=>e&&t),!0)}function U(e,t){var n=t.get(),a=n.peer,o=n.tabs[a].pinned;return 1===e.length&&o&&e[0]===(0,h.parserMessage)(o).messageId}function q(e){return e.get().contactsList?Promise.resolve(e):e.set(l.getContactsList)}function V(e,t,n){var a=(0,i.getLang)("mail_selected_shorted",t.length);Z({actions:!0},"im-page--chat-header"),(0,y.val)((0,y.geByClass1)("im-page--selected-messages"),(0,S.getTemplate)("im_selected_messages",{label:a.replace("{count}",t.length),tip:(0,i.getLang)("mail_deselect_all")}));var o=(0,h.getTab)(n,n.get().peer),r=t.some((e=>{var t=(0,h.getMessage)(n,n.get().peer,e);if(!t)return!1;var a=t.attaches[0];return!(!a||"widget"!==a.type)})),s=e.querySelector("._im_mess_actions"),l=H(t,n,n.get().peer),u=U(t,n),d=t.length>1,g=!d&&(0,c.isChatPeer)(o.peerId)&&(0,c.canPinMessage)(n,t[0]),_=(0,c.canForwardMessages)(n,t)&&!r,m=e.querySelector('._im_page_action[data-action="pin"]'),p=e.querySelector('._im_page_action[data-action="star"]'),f=e.querySelector('._im_page_action[data-action="respond"]'),C=e.querySelector('._im_page_action[data-action="forward"]'),b=Boolean((0,h.tabIsOutgoingMessageRequest)(o)),w=Boolean((0,h.tabIsMessageRequest)(o)),T=(0,I.isBusinessNotifyPeer)(n,n.get().peer);s.className=(0,v.classNames)("im-page--mess-actions _im_mess_actions",{"im-page--mess-actions_important":!l&&!r,"im-page--mess-actions_pinned":u,"im-page--mess-actions_channel":(0,h.isChannelPeer)(o)&&!n.get().gid,"im-page--mess-actions_multiple-selection":d,"im-page--mess-actions_no-pin-btn":!g,"im-page--mess-actions_out-mr":b,"im-page--mess-actions_in-mr":w,"im-page--mess-actions_business-notify":T,"im-page--mess-actions_no-important-btn":!(0,c.canMarkImportant)(n,t)||r}),m.innerHTML=u?(0,E.getIcon20Pin)().icon:(0,L.getIcon20PinOutline)().icon,p.innerHTML=l||r?(0,M.getIcon20FavoriteOutline)().icon:(0,k.getIcon20Favorite)().icon,t.length>1?A.FlatButton.setLabel(f,(0,i.getLang)("mail_forward_here")):A.FlatButton.setLabel(f,(0,i.getLang)("mail_im_mark_reply")),_?A.FlatButton.setDisabled(C,!1):A.FlatButton.setDisabled(C,!0),d&&!_||(0,I.isBusinessNotifyTab)(o)||r?A.FlatButton.setDisabled(f,!0):A.FlatButton.setDisabled(f,!1);var x=l?(0,i.getLang)("mail_im_toggle_important"):(0,i.getLang)("mail_im_toggle_important_off"),P=u?(0,i.getLang)("mail_unpin"):(0,i.getLang)("mail_pin");(0,y.attr)((0,y.geByClass1)("im-page-action_star",e),"aria-label",x),(0,y.attr)((0,y.geByClass1)("im-page-action_pin",e),"aria-label",P)}function z(e,t,n){var a=t.get(),o=a.peer,r=a.tabs[o],i=(0,y.geByClass1)(B,e),s=(0,y.geByClass1)(c.PINNED_CONTAINER_CLASS,e),u=(0,c.isChatPeer)(o),d=u&&(0,h.isChannelPeer)(r),v=u&&(0,I.isBusinessNotifyTab)(r)&&(0,w.isBusinessNotifyEnabled)(t),g=a.selectedMessages&&!!a.selectedMessages.length;i.tt=!1;var p=(0,c.renderPhotosFromTab)(t,r,!1),f=(0,S.getTemplate)("im_simple_link",{href:d?"/club"+-r.ownerId:r.href,content:(0,S.getTemplate)("im_peer_photo",{online_class:"",owner_photo:p,modifier_class:"nim-peer_smaller"})});(0,y.val)((0,y.geByClass1)("im-page--aside-photo",e),f);var C=u&&(0,h.isChatActive)(r),b={muted:inArray(o,a.mutedPeers),verified:!!r.verified,chat:u,vkcomgroup:d,actions:g,derelict:u&&!C&&!d&&!v,pinned:!1};if(u){var T=(0,h.getPinnedMessage)(t),A=function(e){var t=(0,h.getPinnedMessage)(e);if(!t||(0,_.oCacheGet)(e,t.userId))return!1;return t.userId}(t);T&&(0,m.isPinnedMessageVisibleInTab)(t,o)&&(A?t.set(l.loadChatMember.bind(null,{[o]:[A]})).then(z.bind(null,e,t,n)):b.pinned=!0)}G(t,r,e);var k=!r.top_banner&&s.innerHTML,M=!r.top_banner&&K(t,e,s),L=(0,y.geByClass1)("_im_page_peer_name",e);(0,y.removeClass)(L,c.DESELECT_ALL_CLASS),function(e,t,n){var a=n.length>0;(0,y.geByClass)(R,e).forEach((e=>{if("star"===e.dataset.type&&(0,c.isFoldersAvailable)(t)&&((0,y.toggleClass)(e,"im-page--header-icon_shown",!a),(0,y.toggleClass)(e,"im-page--header-icon_star-active",(0,c.isImportant)(t))),"answer"===e.dataset.type&&(0,c.isFoldersAvailable)(t)&&(0,y.toggleClass)(e,"im-page--header-icon_shown",!a&&(0,c.isUnrespond)(t)),"search"===e.dataset.type&&!(0,c.isCommunityInterface)(t)){var n=t.get().peer,o=!a&&(0,c.isFullyLoadedTab)(t,n)&&(0,h.getTab)(t,n).offset&&!(0,c.isCommunityInterface)(t)&&(!(0,c.isCallToPeerAvailable)(t,n)||!(0,c.isClassicInterface)(t));(0,y.toggleClass)(e,"im-page--header-icon_shown",o)}}))}(e,t,[]);var E=e.querySelector("._im_dialog_call_action_wrapper"),x=e.querySelector("._im_header_icon[data-type=call]");if(E&&E.classList.toggle("im-page--header-call-is-hidden",!(0,c.isCallToPeerAvailable)(t,o)||!!r.callInProgress),x&&(x.classList.toggle("im-page--header-icon_shown",(0,c.isCallToPeerAvailable)(t,o)&&!!r.callInProgress),x.classList.toggle("im-page--header-icon_call-active",!!r.callInProgress&&r.callInProgress.participants.count>0)),(0,c.isClassicInterface)(t)){var P=(0,y.geByClass1)("_im_page_back",e);(0,y.attr)(P,"href",`${(0,c.getBaseLink)(t)}?tab=${a.active_tab}`)}Z(b,"im-page--chat-header"),(0,c.compensateHistoryHeightChange)(t,M,k,n)}function G(e,t,n){var a=(0,c.isChatPeer)(t.peerId),o=a&&(0,h.isChannelPeer)(t),r=a&&(0,h.isChatActive)(t),s=a&&(0,h.isCasperChatTab)(t),l=a&&(0,I.isBusinessNotifyTab)(t)&&(0,w.isBusinessNotifyEnabled)(e),u=(0,c.isContactPeer)(t.peerId),d=t.isDonutChat,v="";a?v=o?(0,S.getTemplate)("im_vkcomgroup_members",{name:(0,i.getLang)("mail_im_n_vkcomgroup_members",(0,c.getAliveMembersCount)(t))}):r?(0,S.getTemplate)("im_chat_members",{name:(0,i.getLang)("mail_im_n_chat_members",(0,c.getAliveMembersCount)(t))}):"":(0,c.isUserPeer)(t.peerId)&&(v=(0,c.getLastSeenTextInHeader)(e,t.peerId));var g=[];""!==v||l||g.push("im-page--title--1line"),s&&g.push("im-page--title--casper"),d&&g.push("im-page--title--donut"),l&&g.push("im-page--title--business-notify"),g=g.join(" ");var _=u?(0,c.prepareContactName)(t.name):t.tab,m=(0,S.getTemplate)("im_simple_name",{name:_,href:o?"/club"+-t.ownerId:t.href,name_attr:stripHTML(_),ads_union:t.ad_union_ids_attr,online:v,more_cls:g,more_children:l?(0,S.getTemplate)("sImSimpleNameBusinessNotifyLabel",{text:(0,i.getLang)("mail_tab_business_notify")}):""});(0,y.val)((0,y.geByClass1)("im-page--title-wrapper",n),m)}function K(e,t,n){var a=(0,h.getPinnedMessage)(e),o=n||(0,y.geByClass1)(c.PINNED_CONTAINER_CLASS,t);if((0,y.removeClass)(o,"im-page--pinned_with-bar"),a&&(0,g.isMoneyRequest)(a)){if(void 0===a.kludges.attach1_tr_amount)return;a.kludges.attach1_total_amount&&(0,y.addClass)(o,"im-page--pinned_with-bar")}var r=(0,c.renderPinnedMessage)(e);return(0,y.val)(o,r),!!r}function Z(e,t){var n=(0,y.geByClass1)(t);Object.keys(e).forEach((a=>{(0,y.toggleClass)(n,`${t}_${a}`,!!e[a])}))}function W(e,t,n,a,o){e.set(l.removeMessagesWithRestore.bind(null,n,o,a)).then(t().removeMessagesRestore.bind(null,n,o,a)),(0,l.removeMessageSend)(n,o,null,a,e.get()).then((()=>{var a=(0,h.getTab)(e,o);n.includes(a.lastmsg)&&(0,l.loadActualLastMessage)(e,o).then((()=>{(0,b.partConfigEnabled)("messenger_empty_pinned_support")&&t().updateConvoInList(o,e),t().updateState(o,e)}))}))}function Y(e,t,n,a,o){var r=e.get().selectedMessages,i=(0,y.domData)(o,"action"),s=e.get().peer,d=(0,h.getTab)(e,s),v=!0;if(!["star","delete"].includes(i)&&(0,h.tabIsOutgoingMessageRequest)(d))return Q(e,t,n);switch(i){case"delete":var g=!(vk.id==s&&!e.get().gid)&&r.every((t=>(0,c.canMessageBeDeletedForAll)(e,(0,h.getMessage)(e,s,t))));if(g||r.length>1){v=!1;var _=(0,c.showMsgDeleteDialog)(s,r.length,g,(a=>{Q(e,t,n),_.hide(),cur.imDb.updateByKey("del_forall_checked",a),a?(0,l.removeMessageSend)(r,s,null,"deleteforall",e.get()):W(e,t,r,i,s)}))}else W(e,t,r,i,s);break;case"spam":W(e,t,r,i,s);break;case"forward":if(!(0,c.canForwardMessages)(e,r))return;(0,l.processFwd)(r,s,e).then((t=>e.set(l.prepareForward.bind(null,t)))).then((()=>n().showForward(e))).catch((e=>console.error(e)));break;case"star":var m=H(r,e,s);e.set(l.favMessage.bind(null,r,m,s)),e.get().longpoll.push(r.map((e=>({type:m?u.SET_FLAGS:u.RESET_FLAGS,messageId:e,peerId:s,flags:u.FLAG_IMPORTANT}))));break;case"respond":var p=e.get(),f=1===r.length;(0,l.processFwd)(r,p.peer,e).then((t=>e.set(l.forwardMessages.bind(null,t,p.tfdraft,f)))).then((()=>{t().respond(e,s)}));break;case"pin":var C=(0,h.getLocalId)(e,r[0]);if(!(0,c.canPinMessage)(e,C))return;var b=U(r,e),I=b?l.unpinMessageOptimistic.bind(null,s):l.pinMessageOptimistic.bind(null,C,s),w=b?l.unpinMessage.bind(null,s):l.pinMessage.bind(null,C,s),S=ae.bind(null,t,s);e.set(l.checkChatMember.bind(null,e,C,s)).then((e=>e.set(I))).then(S).then((e=>e.set(w))).then(S)}v&&Q(e,t,n)}function $(e,t,n,a,o,r,i){var s=(0,y.domData)(i,"action"),l=a.querySelector(`.${P} ._ui_menu`).parentNode,c=e.get().peer;(0,T.handleUiActionForPeer)(e,t,n,s,c,o),uiActionsMenu.toggle(l,!1),t().cancelEditing()}function Q(e,t,n){var a=e.get().selectedMessages;e.set(l.cleanSelected).then(n().changedMessageSelection).then(t().cleanSelection.bind(null,a))}function J(e,t,n,o){var r,s,l=(0,c.isClassicInterface)(e);switch((0,y.domData)(o,"type")){case"star":s=[4,6],r=()=>(0,c.isImportant)(e)?(0,i.getLang)("mail_im_toggle_important_off"):(0,i.getLang)("mail_im_toggle_important");break;case"answer":s=[4,6],r=(0,i.getLang)("mail_end_conversation");break;case"search":s=l?[5,6]:[4,-9],r=(0,i.getLang)("mail_search_in_peer")}(0,a.showTooltip)(o,{text:r||"",black:1,shift:s,forcetoup:!0,appendParentCls:l?"_im_dialog_actions":"_im_mess_actions"})}function X(e,t,n){var o=(0,c.isClassicInterface)(e),r=(0,y.domData)(n.target,"action");"respond"!==r&&"forward"!==r&&(0,a.showTooltip)(n.target,{text:ee.bind(null,e,r)||"",black:1,shift:[2,o?-4:11],forcetodown:!0,appendParentCls:"_im_dialog_actions"})}function ee(e,t){var n=e.get(),a=n.selectedMessages,o=n.peer;switch(t){case"pin":return U(a,e)?(0,i.getLang)("mail_unpin"):(0,i.getLang)("mail_pin");case"star":return H(a,e,o)?(0,i.getLang)("mail_im_toggle_important"):(0,i.getLang)("mail_im_toggle_important_off");case"delete":return(0,i.getLang)("mail_delete");case"spam":return(0,i.getLang)("mail_im_mark_spam")}}function te(e,t,n,a,o){var s=(0,y.domData)(o,"type"),u=e.get().peer;switch(s){case"star":e.set(l.toggleDialogImportant.bind(null,u)).then((()=>{setTimeout((()=>J(e,0,0,o)),40)}));break;case"search":n().showSearch(e),window.tooltips&&tooltips.hide(o,{fasthide:!0});break;case"answer":(0,h.getTab)(e,u)&&(e.set(l.markDialogAnswered.bind(null,e.get().peer)),(0,r.showDoneBox)((0,i.getLang)("mail_marked_as_answered"),{out:1e3}),e.get().longpoll.push([(0,d.resetPeer)()]));break;case"call":if((0,c.isCallToPeerAvailable)(e,u)){var v=(0,h.getTab)(e,u).callInProgress;v&&(0,c.joinCallFromIm)(e,u,v.join_link,!1,c.CALL_ENTRY_POINT_JOIN_HEADER)}}}function ne(e,t){var n=Number(t),a=(0,c.formatTimespan)(n,!0),o=(0,i.getLang)("mail_network_waiting").replace(/{timer}/gi,a);e.querySelector(F).innerHTML=o}function ae(e,t,n){return e().updateChatTopic(t,n),n}function oe(e,t,n,a){var o={};return{changeActions(t){var n=e.querySelector(`.${P} ._ui_menu`),a=e.querySelector(`.${P}`),o=t.get().curActions||{},r=Object.keys(o).sort(((e,t)=>l.ACTION_PRIORITIES[e]-l.ACTION_PRIORITIES[t]));if(0!==r.length){for(var i=(0,S.getTemplate)("sUiActionsMenuSeparator"),s="",c=0,u=0;u<r.length;u++){var d=r[u];u>0&&(c/10|0)!=(l.ACTION_PRIORITIES[d]/10|0)&&(s+=i),s+=(0,S.getTemplate)("sImUiActionMenuItem",{action:d,name:o[d].name,icon:o[d].icon,classes:"_im_action"}),c=l.ACTION_PRIORITIES[d]}n.innerHTML=s,a.classList.remove(D)}else a.classList.add(D)},setNetworkWaitingStatus(t,n){o.interval&&clearInterval(o.interval);var a=(0,h.getTab)(n,(0,I.getCurrentTab)(n));a&&!(0,I.isBusinessNotifyTab)(a)&&(ne(e,t),o.timeout=t,o.interval=setInterval((()=>{o.timeout>1?(o.timeout--,ne(e,o.timeout)):(clearInterval(o.interval),o={})}),1e3))},setNetworkReconnectingStatus(t){o.interval&&clearInterval(o.interval),o={};var n,a,r=(0,h.getTab)(t,(0,I.getCurrentTab)(t));r&&!(0,I.isBusinessNotifyTab)(r)&&(n=e.querySelector(F),a=(0,i.getLang)("mail_network_reconnecting"),n&&(n.innerHTML=a))},clearNetworkStatus(){o.interval&&clearInterval(o.interval),o={},e.querySelector(F).innerHTML=""},showSettings(t){var n=t.get(),o=(0,h.getTab)(t,n.peer);(0,h.isChatActive)(o)&&(0,p.mount)(e,t,a)},showForward(t){(0,f.mount)(e,t,a)},renderPeer(n){z(e,n,t)},reRenderPinned(t){var n=(0,I.getCurrentTab)(t);n&&n.pinned&&K(t,e)},reRenderTitle(t){var n=(0,I.getCurrentTab)(t);n&&G(t,n,e)},renderActions(t){var n=t.get().selectedMessages||[];n.length>0&&V(e,n,t)},hideActions(t){if(!(0,c.isFullyLoadedTab)(t,t.get().peer)){(0,y.geByClass)(R,e).forEach((e=>{(0,y.addClass)(e,D)}));var n=(0,y.geByClass1)(P,e);(0,y.addClass)(n,D);var a=(0,y.geByClass1)(N,e);(0,y.addClass)(a,D)}},showActions(t){if((0,c.isFullyLoadedTab)(t,t.get().peer)){(0,y.geByClass)(R,e).forEach((e=>{(0,y.removeClass)(e,D)}));var n=(0,y.geByClass1)(P,e);(0,y.removeClass)(n,D);var a=(0,y.geByClass1)(N,e);(0,y.removeClass)(a,D)}},changedMessageSelection(n){if(0!==n.get().peer){var a=n.get().selectedMessages||[];a.length>0?V(e,a,n):z(e,n,t)}},updateLastSeen(t){!function(e,t){var n=e.get().peer,a=(0,y.geByClass1)("_im_page_peer_online",t);a&&(0,c.isUserPeer)(n)&&(0,h.getTab)(e,n)&&(0,c.applyInnerHtml)(a,(0,c.getLastSeenTextInHeader)(e,n))}(t,e)},deselectAll(e){Q(e,t,a)},updateState(e){t().updateState.bind(null,e)},unmount(){(0,s.destroyModule)(n),cancelStackFilter("forward")}}}function re(e,t,n){var a=(0,s.createMutations)(oe),r=a.callMutations,i=a.bindMutations,u=new x.ConvoAttaches(t,n),v=Y.bind(null,t,n,r),g=$.bind(null,t,n,r,e,u),_=Q.bind(null,t,n,r),m=(e,n)=>{var a=t.get().peer,o=(0,h.getTab)(t,a);(0,c.showVerifiedTooltip)(n,(0,I.isBusinessNotifyTab)(o)?o.ownerId:a)},p=J.bind(null,t,e),f=X.bind(null,t,e),b=te.bind(null,t,e,n),w=()=>r().showSettings(t),S=n=>{var a=t.get().peer;(0,c.isContactPeer)(a)&&((0,C.mount)(t,a,e),(0,o.cancelEvent)(n)),!(0,y.gpeByClass)("im-page--chat-header_chat",n.target,e)||(0,y.gpeByClass)("im-page--chat-header_vkcomgroup",n.target,e)||(0,o.checkEvent)(n)||(w(),(0,o.cancelEvent)(n))},T=()=>function(e,t){var n=()=>{t&&(t.classList.remove(O),t.removeEventListener("mouseleave",n))};t&&(t.classList.add(O),t.addEventListener("mouseleave",n)),e.get().longpoll.abortWaiting()}(t,e),A=(0,s.createModule)({handlers:(n,a)=>{a(e,"click",j,v),a(e,"click","_im_action",g),a(e,"click",c.DESELECT_ALL_CLASS,_),a(e,"mouseover",B,m),a(e,"mouseover",R,p),a(e,"mouseover",j,f),a(e,"click",R,b),a(e,"click","_im_header_link",S),a(e,"click","_im_page_peer_name",S),a(e,"click","_im_chat_members",w),a(e,"click","_im_page_reconnect",T),a(e,"click","_im_page_back",(e=>{(0,o.checkEvent)(e)||(t.get().longpoll.push([(0,d.resetPeer)()]),(0,o.cancelEvent)(e))}))}});return(0,c.isReservedPeer)(t.get().peer)||setTimeout((()=>{t.set(l.setActions).then(r().changeActions)})),i(e,n,A,r)}},456286:(e,t,n)=>{"use strict";n.d(t,{mount:()=>d});n(940851),n(296253);var a=n(667294),o=n(610124),r=n(973935),i=n(336022),s=n(31847);function l(e,t,n){var o=c();if(o){var l=t-19e8;r.render(a.createElement(i.ContactPopup,{store:e,onClose:n.closeContactPopup,getContactInfo:()=>function(e,t){return(0,s.checkContactListLoaded)(e).then((e=>{var n=function(e,t){var n=e.get().contactsList;return n?n.find((e=>e.id===t)):null}(e,t);return Promise.resolve(n)}))}(e,l)}),o)}}function c(){return document.getElementById("ContactPopup")}function u(e,t){return{unmount:()=>function(e,t){var n=c();n&&r.unmountComponentAtNode(n),(0,o.destroyModule)(e)}(e),closeContactPopup(){var e=c();r.unmountComponentAtNode(e)}}}function d(e,t,n,a){var r=(0,(0,o.createMutations)(u).bindMutations)((0,o.createModule)({handlers:(e,t)=>{}}),e);return l(e,t,r),r}},983813:(e,t,n)=>{"use strict";n.d(t,{mount:()=>p});n(940851),n(296253);var a,o=n(610124),r=n(315544),i=n(486125),s=n(667294),l=n(973935),c=n(863729),u=n(110757),d=n(454593),h=n(654612);function v(){a&&a.hide()}function g(){a&&a.updateBoxCoords()}function _(){return document.querySelector("#MessageForward")}function m(e){var t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),a=(0,r.isVisible)(t);return{unmount(){var t=_();t&&l.unmountComponentAtNode(t),(0,o.destroyModule)(e)},showLoader(){(0,i.boxRefreshCoords)(n),(0,r.show)(n),a||(0,r.show)(t)},hideLoader(){(0,r.hide)(n),a||(0,r.hide)(t)}}}function p(e,t,n){var r=(0,(0,o.createMutations)(m).bindMutations)((0,o.createModule)({handlers:(e,t)=>{}})),i={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow(){!function(e){var t=_();t&&l.render(s.createElement(c.default,{value:e},s.createElement(u.MessageForward,{closePopup:v,updatePopup:g})),t)}(t),requestAnimationFrame((()=>a.updateBoxCoords()))},onHideAttempt:()=>(t.set(d.prepareForward.bind(null,null)),r.unmount(),!0)};return r.showLoader(),Promise.resolve().then((e=>{r.hideLoader(),a=new h.MessageBox(i).content('<div id="MessageForward"></div>').show()})),r}},957680:(e,t,n)=>{"use strict";n.d(t,{ChatCreation:()=>S});var a,o=n(570655),r=n(785893),i=n(667294),s=n(41650),l=n(792110),c=n(790422),u=n(903739),d=n(385211),h=n(623481),v=n(150382),g=n(288420),_=n(476288),m=n(179203),p=n(712439),f=n(191040),C=n(917791),b=n(826542),I=n(31847),w=n(923876),y=n(827749);!function(e){e[e.LOADING=0]="LOADING",e[e.LIST=1]="LIST",e[e.SETTINGS=2]="SETTINGS",e[e.PHOTO=3]="PHOTO",e[e.ERROR=4]="ERROR"}(a||(a={}));var S=function(e){var t=e.store,n=e.uploadAvatar,S=e.onClose,T=e.onBack,A=e.onCreateChat,k=e.onGoToConvo,M=e.preselectedUsers,L=(0,o.__read)((0,i.useState)([]),2),E=L[0],x=L[1],P=(0,o.__read)((0,i.useState)(a.LOADING),2),N=P[0],R=P[1],j=(0,o.__read)((0,i.useState)(0),2),B=j[0],F=j[1],O=(0,o.__read)((0,i.useState)(""),2),D=O[0],H=O[1],U=(0,o.__read)((0,i.useState)(""),2),q=U[0],V=U[1],z=(0,o.__read)((0,i.useState)(void 0),2),G=z[0],K=z[1],Z=(0,o.__read)((0,i.useState)(M?new Map(M.map((function(e){return[e.id,(0,d.getTokenFromUserItem)(e)]}))):new Map),2),W=Z[0],Y=Z[1];(0,i.useEffect)((function(){(function(e){return(0,p.unpackStore)(e).hintsTree.then((function(t){var n=t.list.map((function(e){var t=(0,o.__read)(e,3),n=t[0];return{id:+n,peerId:+n,name:t[1],photo:t[2]}}));return function(e,t){return(0,I.checkContactListLoaded)(e).then((function(e){var n=e.get().contactsList.filter((function(e){return!e.user})).sort((function(e,t){return e.id<t.id?1:-1})).map((function(e){return{id:(0,w.getContactPeerId)(e.id),peerId:(0,w.getContactPeerId)(e.id),name:e.name,photo:e.photo||""}})),a=n.splice(0,n.length<3?n.length:3);return(0,o.__spreadArray)((0,o.__spreadArray)((0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(t.slice(0,4))),(0,o.__read)(a)),(0,o.__read)(t.slice(4))),(0,o.__read)(n))}))}(e,n)}))})(t).then((function(e){if(M){var t=M.reduce((function(e,t){return e[t.peerId]=!0,e}),{}),n=M.concat(e.filter((function(e){return!t[e.peerId]})));x(n)}else x(e)})).then((function(){return R(a.LIST)})).catch((function(){R(a.ERROR)}))}),[]);var $=(0,f.debouncedPromise)(C.searchHints,300);switch(N){case a.SETTINGS:return(0,r.jsx)(c.ChatCreationModal,(0,o.__assign)({title:(0,s.getLang)("mail_chat_creation_settings"),onClose:S,onBack:function(){return R(a.LIST)}},{children:(0,r.jsx)(u.ChatSettingsContainer,{flags:B,setFlags:F,onClose:function(){return R(a.LIST)}},void 0)}),void 0);case a.LIST:return(0,r.jsxs)(c.ChatCreationModal,(0,o.__assign)({title:(0,s.getLang)("mail_im_create_chat"),onBack:T,onClose:S},{children:[(0,r.jsx)(d.UsersListContainer,{usersList:E,selectedMap:W,setSelectedMap:Y,onServerSearch:function(e,n){return $(e,n,b.HintsSearchType.FRIENDS_AND_CONTACTS,{},t.get())}},void 0),(0,r.jsx)(h.ConvoInfoContainer,{title:D,photo:q,selectedUserIds:Array.from(W.keys()),onTitleChange:H,onShowSettings:function(){return R(a.SETTINGS)},onCreateChat:function(){var e=Array.from(W.keys()),n=G||void 0;return t.set((function(t){return(0,m.createChatAction)(t,n,e,D,B)})).then((function(e){var t=e.get().next_peer;A(t),(0,y.collectChatCreateStats)(t,"create_chat__create_new")}))},onUploadAvatar:function(){R(a.PHOTO),n().then((function(e){if(e.photo&&e.photoData){var t=e.photo,n=e.photoData;V(t),K(n)}else K(void 0);R(a.LIST)})).catch((function(){R(a.ERROR)}))},onRemoveAvatar:function(){V(""),K(void 0)},onGoToConvo:k},void 0)]}),void 0);case a.ERROR:return(0,r.jsxs)(c.ChatCreationModal,(0,o.__assign)({title:(0,s.getLang)("global_error"),onClose:S},{children:[(0,r.jsx)(_.ModalBody,{children:(0,r.jsx)("p",{children:(0,s.getLang)("global_error")},void 0)},void 0),(0,r.jsx)(v.ModalFooter,{actionButtons:(0,r.jsx)(g.default,(0,o.__assign)({onClick:S},{children:(0,s.getLang)("global_close")}),void 0)},void 0)]}),void 0);case a.LOADING:return(0,r.jsx)(l.default,{},void 0);case a.PHOTO:return(0,r.jsx)(r.Fragment,{},void 0)}}},523928:(e,t,n)=>{"use strict";n.d(t,{ChatCreationInfo:()=>d});var a=n(570655),o=n(785893),r=n(25432),i=n(897404),s=n(889366),l=n(118690),c=n(41650),u=n(125396),d=function(e){var t=e.onChangeTitle,n=e.onResetTitle,d=e.onShowSettings,h=e.onButtonClickHandler,v=e.title,g=e.photo,_=e.loading,m=e.onUploadAvatar,p=e.onRemoveAvatar,f=e.isButtonDisabled,C=e.buttonText;return(0,o.jsxs)("div",(0,a.__assign)({className:"ChatCreationInfo"},{children:[(0,o.jsxs)("div",(0,a.__assign)({className:"ChatCreationInfo__avatarWrapper"},{children:[(0,o.jsx)(r.default,{photo:g,title:v,className:"ChatCreationInfo__avatar",onClick:m},void 0),g&&(0,o.jsx)(i.default,(0,a.__assign)({text:(0,c.getLang)("mail_settings_remove_photo"),position:"t",align:"left"},{children:(0,o.jsx)("button",{onClick:p,className:"ChatCreationInfo__avatarRemove"},void 0)}),void 0)]}),void 0),(0,o.jsx)(s.default,{className:"ChatCreationInfo__titleInput",isControlledOutside:!0,value:v,onChange:function(e){return t(e.target.value)},onCancel:n,placeholder:(0,c.getLang)("mail_im_chat_title_intro")},void 0),(0,o.jsx)(i.default,(0,a.__assign)({text:(0,c.getLang)("mail_chat_creation_settings_icon_tooltip"),position:"t"},{children:(0,o.jsx)("button",(0,a.__assign)({className:"ChatCreationInfo__settings",onClick:d,"aria-label":(0,c.getLang)("mail_chat_creation_settings_icon_tooltip")},{children:(0,o.jsx)(u.default,{},void 0)}),void 0)}),void 0),(0,o.jsx)(l.default,(0,a.__assign)({disabled:f,loading:_,onClick:h},{children:C}),void 0)]}),void 0)}},790422:(e,t,n)=>{"use strict";n.d(t,{ChatCreationModal:()=>l});var a=n(570655),o=n(785893),r=n(730365),i=n(743927),s=n(41650),l=function(e){var t=e.children,n=e.title,l=e.onClose,c=e.onBack;return(0,o.jsxs)(r.default,(0,a.__assign)({onClose:l,disableBodyScroll:!0,className:"ChatCreationModal"},{children:[(0,o.jsx)(i.ModalHeader,{title:n,onClose:l,backText:c?(0,s.getLang)("global_back"):void 0,onBack:c},void 0),(0,o.jsx)("div",(0,a.__assign)({className:"ChatCreationModal__content"},{children:t}),void 0)]}),void 0)}},270800:(e,t,n)=>{"use strict";n.d(t,{ChatCreationUserRow:()=>u});var a=n(570655),o=n(785893),r=n(919316),i=n(787255),s=n(814210),l=n(597903),c=n(406042),u=function(e){var t=e.data,n=e.onSelect,u=e.isSelected,d=t.photo?t.photo:(0,o.jsx)(c.ConversationNoPhoto,{id:t.peerId,text:(0,l.getUserInitials)(t.name),size:"34",specificType:7},void 0);return(0,o.jsx)(i.default,(0,a.__assign)({"data-id":t.peerId,onClick:function(){return n(t.peerId)},selectable:!0,aside:(0,o.jsx)(s.ListMultiSelectControl,{isSelected:u},void 0)},{children:(0,o.jsx)(r.default,{"data-id":t.peerId,size:"34",title:t.name,photo:d},void 0)}),void 0)}},182747:(e,t,n)=>{"use strict";n.d(t,{ChatCreationUserList:()=>i});var a=n(785893),o=n(470720),r=n(41650),i=function(e){var t=e.usersList,n=e.onRemoveToken,i=e.onChange,s=e.onSelect,l=e.renderSuggest,c=e.tokens,u=e.query;return(0,a.jsx)(o.default,{className:"ChatCreationUserList",tokens:c,removeTokenPlaceholder:(0,r.getLang)("mail_create_chat_remove_user"),onRemoveToken:n,placeholder:(0,r.getLang)("mail_search_creation"),value:u,onChange:i,onSelect:s,useInfiniteScroll:!0,hasMore:!1,virtualized:!0,loadMore:function(){},notFoundText:(0,r.getLang)("mail_no_users_found"),autoFocus:!0,isSearching:!1,renderSuggest:l,data:t},void 0)}},903739:(e,t,n)=>{"use strict";n.d(t,{ChatSettingsContainer:()=>r});var a=n(785893),o=n(367033),r=function(e){var t=e.setFlags,n=e.flags,r=e.onClose;return(0,a.jsx)(o.ChatSettingsOptions,{flags:n,back:r,isChatCreation:!0,onSave:function(e){return t(e),Promise.resolve()},afterSave:r,onCancel:r},void 0)}},623481:(e,t,n)=>{"use strict";n.d(t,{ConvoInfoContainer:()=>l});var a=n(570655),o=n(785893),r=n(523928),i=n(667294),s=n(41650),l=function(e){var t=e.title,n=e.photo,l=e.selectedUserIds,u=e.onShowSettings,d=e.onTitleChange,h=e.onCreateChat,v=e.onUploadAvatar,g=e.onRemoveAvatar,_=e.onGoToConvo,m=(0,a.__read)((0,i.useState)(!1),2),p=m[0],f=m[1],C=(0,a.__read)((0,i.useState)(!c(t)),2),b=C[0],I=C[1],w=1===l.length&&!b&&!n,y=0!==l.length||b,S=(0,i.useCallback)((function(e){I(!c(e)),d(e)}),[]),T=!w&&!y,A=w?(0,s.getLang)("mail_im_go_to_dialog"):(0,s.getLang)("mail_im_create_chat");return(0,o.jsx)(r.ChatCreationInfo,{title:t,onResetTitle:function(){return S("")},onChangeTitle:S,photo:n,onShowSettings:u,onButtonClickHandler:function(){if(!p)if(f(!0),w){var e=(0,a.__read)(l,1)[0];_(+e)}else h().catch((function(){f(!1)}))},loading:p,isButtonDisabled:T,onUploadAvatar:v,onRemoveAvatar:g,buttonText:A},void 0)};function c(e){return!e.trim().replace("\n","")}},385211:(e,t,n)=>{"use strict";n.d(t,{UsersListContainer:()=>u,getTokenFromUserItem:()=>h});var a=n(570655),o=n(785893),r=n(667294),i=n(182747),s=n(270800),l=n(203524),c=n(495283),u=function(e){var t=e.usersList,n=e.selectedMap,c=e.setSelectedMap,u=e.onServerSearch,v=(0,a.__read)((0,r.useState)(""),2),g=v[0],_=v[1],m=(0,a.__read)((0,r.useState)(t.map((function(e){return e.peerId}))),2),p=m[0],f=m[1],C=(0,r.useRef)(d(t)),b=(0,r.useCallback)((function(e){return e.name}),[]),I=(0,r.useCallback)((function(e){return e.peerId}),[]),w=(0,l.useIndexer)(Array.from(C.current.values()),b,I),y=(0,r.useMemo)((function(){return Array.from(C.current.keys())}),[C.current]),S=(0,r.useCallback)((function(e,t){return u(e,t)}),[u]);(0,r.useEffect)((function(){var e=w.search(g).map((function(e){return e.peerId}));f(e),S(g,e).then((function(t){if(0!==g.length){var n=[],o=[];t.forEach((function(e){C.current.has(e.peerId)||(o.push(e.peerId),n.push(function(e){return{id:e.peerId,peerId:e.peerId,name:e.name,photo:e.photo}}(e)))})),n.length&&(r=C,i=d(n),r.current=new Map((0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)(Array.from(r.current.entries()))),(0,a.__read)(Array.from(i.entries())))),f((0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)(e)),(0,a.__read)(o))))}var r,i})).catch((function(){}))}),[g]);var T=function(e){n.delete(e),c((function(){return new Map(n)}))},A=function(e){n.has(e)?T(e):(!function(e){var t=C.current.get(e);t&&(n.set(e,h(t)),c((function(){return new Map(n)})))}(e),_(""))},k=(0,r.useCallback)((function(e){T(+e)}),[n]),M=(0,r.useCallback)((function(e){_(e.target.value)}),[g]),L=Array.from(n.values());return(0,o.jsx)(i.ChatCreationUserList,{query:g,tokens:L,usersList:g?p:y,onSelect:A,onChange:M,onRemoveToken:k,renderSuggest:function(e){var t=C.current.get(e);return t?(0,o.jsx)(s.ChatCreationUserRow,{data:t,onSelect:A,isSelected:n.has(e)},e):(0,o.jsx)(o.Fragment,{},void 0)}},void 0)};function d(e){return e.reduce((function(e,t){return t.name=(0,c.decodeHTMLEntities)(t.name),e.set(t.id,t)}),new Map)}function h(e){return{id:e.id.toString(),text:e.name}}},336022:(e,t,n)=>{"use strict";n.d(t,{ContactPopup:()=>h});var a=n(570655),o=n(785893),r=n(667294),i=n(730365),s=n(161650),l=n(80291),c=n(792110),u=n(41650),d=n(982452),h=function(e){var t=e.getContactInfo,n=e.onClose,h=(0,a.__read)((0,r.useState)({kind:"loading"}),2),v=h[0],g=h[1];switch((0,r.useEffect)((function(){var e=function(e){(0,d.showErrorBox)(e),g({kind:"failed"}),n()};t().then((function(t){t?g({kind:"loaded",contact:t}):e((0,u.getLang)("mail_contact_was_removed"))})).catch((function(){e((0,u.getLang)("global_error"))}))}),[]),v.kind){case"failed":return(0,o.jsx)(o.Fragment,{},void 0);case"loading":return(0,o.jsx)(c.default,{},void 0);case"loaded":return(0,o.jsxs)(i.default,(0,a.__assign)({onClose:n,className:"ContactPopup"},{children:[(0,o.jsx)(s.default.Header,{title:(0,u.getLang)("mail_contact"),onClose:n},void 0),(0,o.jsx)(l.ContactPopupContent,{contact:v.contact},void 0)]}),void 0)}}},387765:(e,t,n)=>{"use strict";n.d(t,{ContactIconRow:()=>d});var a=n(570655),o=n(785893),r=n(6057),i=n(927384),s=n(265187),l=n(601931),c=n(282725),u=function(e){switch(e){case"phone":return(0,o.jsx)(r.default,{},void 0);case"mail":return(0,o.jsx)(i.default,{},void 0);case"calendar":return(0,o.jsx)(s.default,{},void 0);case"location":return(0,o.jsx)(l.default,{},void 0);case"sync":return(0,o.jsx)(c.default,{},void 0)}},d=function(e){var t=e.icon,n=e.children;return(0,o.jsxs)("div",(0,a.__assign)({className:"ContactIconRow"},{children:[(0,o.jsx)("div",(0,a.__assign)({className:"ContactIconRow__icon"},{children:u(t)}),void 0),(0,o.jsx)("div",(0,a.__assign)({className:"ContactIconRow__text"},{children:n}),void 0)]}),void 0)}},80291:(e,t,n)=>{"use strict";n.d(t,{ContactPopupContent:()=>d});var a=n(570655),o=n(785893),r=n(597903),i=n(387765),s=n(406042),l=n(213984),c=n(41650),u=n(923876),d=function(e){var t=e.contact,n=(0,u.getContactPeerId)(t.id);return(0,o.jsxs)("div",(0,a.__assign)({className:"ContactPopupContent"},{children:[(0,o.jsxs)("header",(0,a.__assign)({className:"ContactPopupContent__header"},{children:[(0,o.jsx)("div",(0,a.__assign)({className:"ContactPopupContent__photo"},{children:t.photo?(0,o.jsx)("img",{className:"ContactPopupContent__contactAvatarImage",src:t.photo,alt:t.name},void 0):(0,o.jsx)(s.ConversationNoPhoto,{text:(0,r.getUserInitials)(t.name),size:"80",id:n,specificType:7},t.id)}),void 0),(0,o.jsx)("h3",(0,a.__assign)({className:"ContactPopupContent__title"},{children:(0,o.jsx)(l.default,{children:(0,r.prepareContactName)(t.name)},void 0)}),void 0),(0,o.jsx)("div",(0,a.__assign)({className:"ContactPopupContent__meta"},{children:(0,c.getLang)("mail_from_contacts_list")}),void 0)]}),void 0),(0,o.jsxs)("div",(0,a.__assign)({className:"ContactPopupContent__info"},{children:[t.main_phone&&(0,o.jsx)(i.ContactIconRow,(0,a.__assign)({icon:"phone"},{children:(0,r.formatPhoneNumber)(t.main_phone)}),void 0),t.emails[0]&&(0,o.jsx)(i.ContactIconRow,(0,a.__assign)({icon:"mail"},{children:(0,o.jsx)("a",(0,a.__assign)({href:"mailto:"+t.emails[0]},{children:t.emails[0]}),void 0)}),void 0)]}),void 0),t.sync_date&&(0,o.jsx)("div",(0,a.__assign)({className:"ContactPopupContent__info"},{children:(0,o.jsx)(i.ContactIconRow,(0,a.__assign)({icon:"sync"},{children:t.sync_date}),void 0)}),void 0)]}),void 0)}},413374:(e,t,n)=>{"use strict";n.d(t,{convoPickerMode:()=>a,ConvoPicker:()=>I});var a,o=n(570655),r=n(785893),i=n(667294),s=n(973935),l=n(483295),c=n(878517),u=n(841118),d=n(439664),h=n(423985),v=n(254692),g=n(41650),_=n(61580),m=n(104837),p=n(597903),f=n(787255),C=n(239132),b=g.default.getLang;!function(e){e.DEFAULT="default",e.RADIO="radio"}(a||(a={}));var I=function(e){var t,n=e.searchValue,g=void 0===n?"":n,I=e.isLoading,w=void 0!==I&&I,y=e.convos,S=e.mode,T=void 0===S?a.DEFAULT:S,A=e.selectedConvos,k=void 0===A?[]:A,M=e.checkDisabled,L=e.onSearchValueChange,E=e.onSearchInputKeydown,x=e.onConvoSelect,P=e.onListLoadMore,N=void 0===P?function(){}:P,R=e.onAddClick,j=e.searchInputGetter,B=e.className,F=e.style,O=(0,o.__rest)(e,["searchValue","isLoading","convos","mode","selectedConvos","checkDisabled","onSearchValueChange","onSearchInputKeydown","onConvoSelect","onListLoadMore","onAddClick","searchInputGetter","className","style"]),D=(0,l.classNames)("ConvoPicker",B),H=(0,i.createRef)(),U=(0,o.__read)((0,i.useState)(0),2),q=U[0],V=U[1],z=function(e){var t=Math.max(e-1,0);return M&&M(y[t])?z(t):t},G=function(e){var t=Math.min(e+1,y.length-1);return M&&M(y[t])?G(t):t},K=function(e){e!==q&&(V(e),function(e){if(t){var n=y[e].peerId,a=t.querySelector('[data-id="'+n+'"]');if(a&&a instanceof HTMLElement){var o=a.offsetTop,r=t.scrollTop;if(o<r)t.scrollTop=o;else{var i=t.offsetHeight,s=o+a.offsetHeight;s>r+i&&(t.scrollTop=s-i)}}}}(e))};(0,i.useEffect)((function(){j&&H.current&&j(H.current.element)}),[]);var Z=!!R&&!g,W=(Z?[(0,r.jsx)(f.default,(0,o.__assign)({selectable:!1,"data-id":0},{children:(0,r.jsx)(C.ListAddControl,(0,o.__assign)({onClick:R,size:34},{children:b("mail_new_convo_from_invite")}),void 0)}),"add")]:[]).concat(y.map((function(e,t){var n=e.peerId,a=e.photo,o=e.name,i=e.online,s=!!M&&M(e);return(0,r.jsx)(_.ConvoPickerRow,{"data-id":n,peerId:n,photo:a,name:o,online:i,memberCount:(0,p.getChatMemberCount)(e),mode:T,isCasper:(0,m.isCasperChatTab)(e),isSelected:k.includes(n),isActive:t===q,isDisabled:s,onClick:function(){s||x(n)},onMouseEnter:function(){return V(s?-1:t)}},n)})));return(0,r.jsxs)("div",(0,o.__assign)({className:D,onMouseLeave:function(){return V(-1)},style:F},O,{children:[(0,r.jsx)(c.BlockSearchInput,{value:g,onChange:L,onKeyDown:function(e){switch(e.which||e.keyCode){case v.ARROW_UP:K(z(q)),e.preventDefault();break;case v.ARROW_DOWN:K(G(q)),e.preventDefault();break;case v.ENTER:x(y[q].peerId),e.preventDefault()}E(e)},placeholder:b("mail_top_search"),autoFocus:!0,ref:H},"search"),w&&(0,r.jsx)(u.default,(0,o.__assign)({className:"ConvoPicker__stub"},{children:(0,r.jsx)(d.default,{},void 0)}),"loading"),!w&&g&&0===y.length&&(0,r.jsx)(u.default,(0,o.__assign)({className:"ConvoPicker__stub"},{children:b("mail_im_search_empty_chats")}),"no-results"),!w&&(y.length>0||Z)&&(0,r.jsx)(h.default,(0,o.__assign)({virtualized:!0,className:"ConvoPicker__results",loadMore:N,hasMore:!1,ref:function(e){var n=s.findDOMNode(e);n&&n instanceof HTMLElement&&(t=n)}},{children:W}),"results")]}),void 0)}},61580:(e,t,n)=>{"use strict";n.d(t,{ConvoPickerRow:()=>g});var a=n(570655),o=n(785893),r=n(483295),i=n(787255),s=n(919316),l=n(597903),c=n(413374),u=n(654857),d=n(406042),h=n(25432),v=n(726271),g=function(e){var t=e.peerId,n=e.name,g=e.photo,_=e.online,m=e.memberCount,p=e.mode,f=void 0===p?c.convoPickerMode.DEFAULT:p,C=e.isSelected,b=e.isDisabled,I=e.isActive,w=e.isCasper,y=e.className,S=(0,a.__rest)(e,["peerId","name","photo","online","memberCount","mode","isSelected","isDisabled","isActive","isCasper","className"]),T=function(e,t,n,a){void 0===a&&(a=0);var r=(0,l.isContactPeer)(e);switch(!0){case Array.isArray(n):return(0,o.jsx)(u.default,{photos:n},void 0);case r:return(0,o.jsx)(d.ConversationNoPhoto,{id:e,text:(0,l.getUserInitials)(t),size:"34",specificType:7},void 0);default:return(0,o.jsx)(h.default,{isOnline:!!a,isMobile:!!v.mobPlatforms[a],title:t,photo:n,onlineSize:"s"},void 0)}}(t,n,g,_),A=w?'<span class="ConvoPickerRow__itemTitle ConvoPickerRow__itemTitle--casper">\n        <span class="ConvoPickerRow__itemTitleText">\n          '+n+"\n        </span>\n      </span>":n,k=f===c.convoPickerMode.RADIO?(0,o.jsx)("span",{className:(0,r.classNames)("ConvoPickerRow__radio",{"ConvoPickerRow__radio--selected":C})},void 0):void 0,M=(0,r.classNames)("ConvoPickerRow",y,{"ConvoPickerRow--disabled":b});return(0,o.jsx)(i.default,(0,a.__assign)({active:I,selectable:!b,canBeHovered:!1,chevron:f===c.convoPickerMode.DEFAULT&&!b,aside:k,className:M},S,{children:(0,o.jsx)(s.default,{ignoreDecodeHTML:!0,size:"34",title:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:A}},void 0),photo:T,description:m,className:"ConvoPickerRow__itemContent"},void 0)}),void 0)}},195477:(e,t,n)=>{"use strict";n.d(t,{UserConvoInviteContainer:()=>E});var a,o=n(570655),r=n(785893),i=n(667294),s=n(327012),l=n(150382),c=n(674041),u=n(413374),d=n(179203),h=n(672385),v=n(459554),g=n(654612),_=n(41650),m=n(792110),p=n(917791),f=n(786067),C=n(475234),b=n(407381),I=n(826338),w=n(608490),y=n(475632),S=n(923876),T=n(826542),A=n(957680),k=n(62839),M=n(827749),L=_.default.getLang;!function(e){e[e.PICKER=0]="PICKER",e[e.CREATION=1]="CREATION"}(a||(a={}));var E=function(e){var t=e.user,n=e.store,_=e.onClose,E=e.onInviteSent,x=e.onGoToConvo,P=(0,o.__read)((0,i.useState)(a.PICKER),2),N=P[0],R=P[1],j=(0,o.__read)((0,i.useState)(!function(e){var t,n=e.get(),a=n.chatList||(null===(t=n.dialog_tabs)||void 0===t?void 0:t.all);return Boolean(a&&a.length>0)}(n)),2),B=j[0],F=j[1],O=(0,o.__read)((0,i.useState)(!0),2),D=O[0],H=O[1],U=(0,o.__read)((0,i.useState)(!1),2),q=U[0],V=U[1],z=(0,o.__read)((0,i.useState)(function(e){var t,n=e.get(),a=n.chatList||((null===(t=n.dialog_tabs)||void 0===t?void 0:t.all)||[]).filter(I.isChatPeer);if(a&&a.length>0)return a.map((function(t){return(0,v.getTab)(e,t)}));return[]}(n)),2),G=z[0],K=z[1],Z=(0,o.__read)((0,i.useState)(""),2),W=Z[0],Y=Z[1],$=(0,i.useCallback)((function(e){Y(e.target.value)}),[W]),Q=(0,i.useCallback)((function(){}),[]),J=(0,i.useRef)(null),X=(0,o.__read)((0,w.useHints)(n,G,W,{queryType:T.HintsSearchType.ALL,filterFn:function(e){return(0,I.isChatPeer)(e.peerId)}}),2),ee=X[0],te=X[1];(0,i.useEffect)((function(){return(0,p.loadConversations)(n.get(),h.ConvoFilters.CHATS,200).then((function(e){var t=e.items;return K((0,S.mergeConvoLists)(G,t)),t})).then((function(e){var t=e.reduce((function(e,t){return e[t.peerId]=t,e}),{});return n.set((function(n){return(0,b.mergeTabs)(n,t).then((function(t){return(0,C.setChatList)(t,e.map((function(e){return e.peerId})))}))}))})).finally((function(){return F(!1)})),(0,y.cancelStackPush)("convo_invite",(function(){})),function(){setTimeout((function(){return(0,y.cancelStackFilter)("convo_invite")}),0)}}),[]);var ne=t.inv_name?(0,f.langStr)((0,f.langSex)(t.sex,L("mail_im_invite_user",!0)),"user",t.inv_name):L("mail_convo_invite_title");return(0,r.jsxs)(r.Fragment,{children:[N===a.PICKER&&(0,r.jsx)(s.UserConvoInviteModal,(0,o.__assign)({title:ne,onCloseModal:_,footer:(0,r.jsx)(l.ModalFooter,{children:(0,r.jsx)(c.default,(0,o.__assign)({checked:D,onChange:function(e,t){return H(t)}},{children:L("mail_im_chat_add_members_show_history")}),void 0)},void 0)},{children:(0,r.jsx)(u.ConvoPicker,{convos:ee.map((function(e){return(0,v.getTab)(n,e.peerId)||e})),searchValue:W,onSearchValueChange:$,onSearchInputKeydown:Q,onConvoSelect:function(e){V(!0),Promise.resolve().then((function(){return n.set((function(n){return(0,d.addNewMember)(e,[t.id],D,n)}))})).then((function(){return E(e)})).then((function(){_(),V(!1)})).catch((function(e){V(!1),(0,g.showFastBox)(L("global_error"),e)}))},checkDisabled:function(e){return!e.canInvite},searchInputGetter:function(e){return J.current=e},isLoading:B||te&&0===ee.length,style:{height:410},onAddClick:function(){return R(a.CREATION)}},void 0)}),void 0),N===a.CREATION&&(0,r.jsx)(A.ChatCreation,{store:n,uploadAvatar:k.uploadConvoPhoto,onClose:_,onBack:function(){return R(a.PICKER)},onCreateChat:function(e){E(e).then((function(){}),(function(){})),_(),(0,M.collectChatCreateStats)(e,"create_chat__create_invite")},onGoToConvo:function(e){x(e),_()},preselectedUsers:[{id:t.id,peerId:t.id,name:t.name,photo:t.photo}]},void 0),q&&(0,r.jsx)(m.default,{},void 0)]},void 0)}},327012:(e,t,n)=>{"use strict";n.d(t,{UserConvoInviteModal:()=>l});var a=n(570655),o=n(785893),r=n(730365),i=n(41650),s=n(743927),l=function(e){var t=e.title,n=e.onCloseModal,l=e.footer,c=e.isWithBackButton,u=void 0!==c&&c,d=e.onBackClick,h=e.children;return(0,o.jsxs)(r.default,(0,a.__assign)({className:"UserConvoInviteModal",disableBodyScroll:!0,onClose:n},{children:[(0,o.jsx)(s.ModalHeader,{title:t,onClose:n,backText:u?(0,i.getLang)("global_back"):void 0,onBack:d,className:"UserConvoInviteModal__header"},void 0),(0,o.jsx)("div",(0,a.__assign)({className:"UserConvoInviteModal__content"},{children:h}),void 0),l]}),void 0)}},614413:(e,t,n)=>{"use strict";n.d(t,{mount:()=>c});var a=n(785893),o=n(610124),r=n(973935),i=n(195477);function s(){var e="_im_user_convo_invite",t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}function l(e){return{unmount:function(){var t=s();t&&r.unmountComponentAtNode(t),(0,o.destroyModule)(e)}}}function c(e,t,n,c){var u=(0,(0,o.createMutations)(l).bindMutations)((0,o.createModule)({handlers:function(){}}));return function(e,t,n,o,l){var c=s();r.render((0,a.jsx)(i.UserConvoInviteContainer,{user:n,store:e,onClose:t.unmount,onInviteSent:o,onGoToConvo:l},void 0),c)}(e,u,t,n,c),u}},57757:(e,t,n)=>{"use strict";n.d(t,{handleUiActionForPeer:()=>L});var a=n(179288),o=n(597903),r=n(454593),i=n(850167),s=n(645523),l=n(786067),c=n(654612),u=n(917791),d=n(982452),h=n(827749),v=n(309756),g=n(222131),_=n(606542),m=n(614413),p=n(778755),f=n(993421),C=n(695724),b=n(386409),I=n(240367),w=n(407381),y=n(486125),S=n(459554),T=n(968958),A=n(663825),k=n(712860),M=n(19331);function L(e,t,n,L,E,x,P){var N,R,j,B,F,O,D;switch(void 0===P&&(P=function(e){return(0,T.imWeirdLog)("im_ui_action",{error:e},!1)}),L){case a.ConvoAction.CLEAR:var H=(0,S.getTab)(e,E),U=(0,o.showFlushChat)(H,E,(function(){(0,o.cleanHistory)(e,U,t,r.flushHistory,E)}));break;case a.ConvoAction.MEDIA:(0,M.partConfigEnabled)("me_fc_attaches_new_modal")?x.show(E):(0,i.showWiki)({w:"history"+(0,o.convertPeerToUrl)(E)+"_photo"},null,{});break;case a.ConvoAction.CALL_AUDIO:case a.ConvoAction.CALL_VIDEO:(0,o.isCallToPeerAvailable)(e,E)&&(0,o.startCallFromIm)(e,E,L===a.ConvoAction.CALL_VIDEO,[],o.CALL_ENTRY_POINT_HEADER);break;case a.ConvoAction.CALL_APP:(0,o.isCallToPeerAvailable)(e,E)&&(null===(N=window.Calls)||void 0===N?void 0:N.showStartCallModal)&&(0,o.startCallFromIm)(e,E,!1,[],o.CALL_ENTRY_POINT_HEADER,!0);break;case a.ConvoAction.CALL_BY_NAME:(0,o.isCallToPeerAvailable)(e,E)&&(null===(R=window.Calls)||void 0===R?void 0:R.showCallByNamePopup)&&(0,o.startCallFromIm)(e,E,!1,[],o.CALL_ENTRY_POINT_HEADER,!1,!0);break;case a.ConvoAction.SEARCH:null===(B=(j=t()).showSearch)||void 0===B||B.call(j,e);break;case a.ConvoAction.ADD_FRIEND:H=e.get().tabs[E];var q=(0,_.oCacheGet)(e,E);if(!H||!q)return;var V={type:"done_box",text:H.is_subscribed_to_me?(0,l.getLang)("mail_im_friend_added").replace("{name}",q.first_name_gen):(0,l.langSex)(q.sex,(0,l.getLang)("mail_im_friend_request_sent","raw")).replace("{name}",q.first_name)};e.set((function(e){return(0,k.setPeerSubscribedStatus)(E,!1,e)})).then((function(){return e.set(w.setActions)})).then((function(){var n,a,o,r;(0,v.showNotification)(V),null===(a=(n=t()).updateState)||void 0===a||a.call(n,E,e),null===(r=(o=t()).updateActions)||void 0===r||r.call(o,e)})).catch(P);break;case a.ConvoAction.BLOCK_NOTIFY:case a.ConvoAction.BLOCK_COMMUNITY:e.set(r.toggleCommunityMessages.bind(null,!1,E)).then((function(){var t,n;null===(n=null===(t=e.get())||void 0===t?void 0:t.longpoll)||void 0===n||n.push([(0,s.resetPeer)()]),(0,y.showDoneBox)((0,l.getLang)("mail_community_was_blocked"))})).catch(P);break;case a.ConvoAction.ALLOW_COMMUNITY:e.set(r.toggleCommunityMessages.bind(null,!0,E)).then((function(){var t,a;return null===(a=(t=n()).changeActions)||void 0===a?void 0:a.call(t,e)})).catch(P);break;case a.ConvoAction.BLOCK:(0,o.showBlacklistBox)(E,e).once("success",(function(t){var n,a;t.delta&&((0,y.showDoneBox)(t.msg),null===(a=null===(n=e.get())||void 0===n?void 0:n.longpoll)||void 0===a||a.push([(0,s.resetPeer)()]))}));break;case a.ConvoAction.LEAVE:var z=(0,o.showLeaveDialog)(e,E,(function(n){var a,i,l=e.set(r.leaveChat.bind(null,E)).then((function(){return e.set(r.unpinMessageOptimistic.bind(null,E))}));n&&l.then((function(){return(0,o.cleanHistory)(e,z,t,r.flushHistory,E)})).catch(P),z.hide(),null===(i=null===(a=e.get())||void 0===a?void 0:a.longpoll)||void 0===i||i.push([(0,s.resetPeer)()])}));break;case a.ConvoAction.UNREAD:(0,r.markDialogUnread)(E,e.get()).catch(P);break;case a.ConvoAction.RETURN:e.set(r.returnToChat.bind(null,E)).then((function(e){return e.set(r.getPinnedMessage.bind(null,E))})).then(null===(F=t().updateChatTopic)||void 0===F?void 0:F.bind(null,E)).catch((function(e){(0,c.showFastBox)((0,l.getLang)("global_error"),e),P(e)}));break;case a.ConvoAction.MUTE:case a.ConvoAction.UNMUTE:var G=L===a.ConvoAction.MUTE;e.set((function(e){return(0,r.setMutedPeer)(E,G,e)})).then((function(e){var n,a;return null===(a=(n=t()).updateState)||void 0===a?void 0:a.call(n,E,e)})).then((function(){return e.set((function(e){return(0,r.toggleMutePeer)(E,G,-1,e)}))})).catch(P);break;case a.ConvoAction.PIN_CONVO:(0,u.pinConvoHandler)(e.get(),E).catch((function(e){(0,d.showErrorBox)(e),P(e)}));break;case a.ConvoAction.UNPIN_CONVO:(0,u.unpinConvoHandler)(e.get(),E).catch((function(e){(0,d.showErrorBox)(e),P(e)}));break;case a.ConvoAction.CHAT_INVITE:(0,o.inviteUser)(e,E,t,r.setCreationType);break;case a.ConvoAction.USER_INVITE:if((H=(0,S.getTab)(e,E))&&((0,S.isUserConvo)(H)||(0,S.isContactConvo)(H))&&H.canBeAddedToChat){(0,h.collectConvoInviteStats)(h.ConvoInviteEntryPoint.DIALOG_ACTIONS,E);(q=(0,S.isContactConvo)(H)?(0,g.makeUserFromUserConvo)(H):(0,_.oCacheGet)(e,E))&&(0,m.mount)(e,q,(function(t){var n;return Promise.resolve(null===(n=e.get().longpoll)||void 0===n?void 0:n.push([(0,s.changePeer)(t,!1,!1,!1,"convo_invite")]))}),(function(t){var n;return null===(n=e.get().longpoll)||void 0===n?void 0:n.push([(0,s.changePeer)(t,!1,!1,!1,"convo_invite")])}))}break;case a.ConvoAction.CREATE_CHAT:H=(0,S.getTab)(e,E);var K=[[E,null==H?void 0:H.tab]];e.set(r.setCreationType.bind(null,"chat",[])).then((function(){var n,a;return null===(a=(n=t()).showCreation)||void 0===a?void 0:a.call(n,e,K)})).catch(P);break;case a.ConvoAction.PIN_HIDE:(0,p.pinnedMessageHide)(e,(0,f.getPeer)(e),t);break;case a.ConvoAction.PIN_UNHIDE:(0,p.pinnedMessageUnHide)(e,(0,f.getPeer)(e),t);break;case a.ConvoAction.UNPIN:(0,p.pinnedMessageUnpin)(e,(0,f.getPeer)(e),t);break;case a.ConvoAction.SETTINGS:null===(D=(O=n()).showSettings)||void 0===D||D.call(O,e);break;case a.ConvoAction.DISABLE_BUSINESS_NOTIFY:var Z=(H=(0,S.getTab)(e,E))&&(0,S.isChatConvo)(H)&&H.ownerId;if(!Z)return;var W=new c.MessageBox({title:(0,l.getLang)("mail_business_notify_disable_box_title")}).content((0,C.getTemplate)("sImBusinessNotifyDisableBoxContent",{text:(0,l.getLang)("mail_business_notify_disable_box_text")})).addButton((0,l.getLang)("mail_business_notify_disable_box_button"),(function(n){(0,b.lockButton)(n),e.set((function(e){return(0,w.setConvoBusinessNotifyEnabled)(e,E,!1)})).then((function(){return e.set(w.setActions)})).then((function(){var n,a,o,r;return null===(a=(n=t()).updateActions)||void 0===a||a.call(n,e),null===(r=(o=t()).updateState)||void 0===r||r.call(o,E,e),(0,I.denyMessagesFromGroup)({group_id:-Z})})).then((function(){W.hide()})).catch(P)})).show();break;case a.ConvoAction.ENABLE_BUSINESS_NOTIFY:var Y=(H=(0,S.getTab)(e,E))&&(0,S.isChatConvo)(H)&&H.ownerId;if(!Y)return;e.set((function(e){return(0,w.setConvoBusinessNotifyEnabled)(e,E,!0)})).then((function(){return e.set(w.setActions)})).then((function(){var n,a,o,r;return null===(a=(n=t()).updateActions)||void 0===a||a.call(n,e),null===(r=(o=t()).updateState)||void 0===r||r.call(o,E,e),(0,I.allowMessagesFromGroup)({group_id:-Y})})).catch(P);break;case a.ConvoAction.ARCHIVE:if(!(H=(0,S.getTab)(e,E)))break;e.set((function(e){return(0,r.updateFolderState)(E,a.FOLDER_MASKS[a.FOLDER_ARCHIVE],A.SET_DIRECTORIES,!0,!1,(0,d.unpackStore)(e))})).then((function(){return e.set(w.setActions)})).then((function(){var n,a,o,r,i,s;null===(a=(n=t()).updateActions)||void 0===a||a.call(n,e),null===(r=(o=t()).removePeer)||void 0===r||r.call(o,e,E),null===(s=(i=t()).updateFolderCounters)||void 0===s||s.call(i,e)})).then((function(){return(0,I.archiveConversation)({peer_id:E})})).catch(P);break;case a.ConvoAction.UNARCHIVE:if(!(H=(0,S.getTab)(e,E)))break;e.set((function(e){return(0,r.updateFolderState)(E,a.FOLDER_MASKS[a.FOLDER_ARCHIVE],A.RESET_DIRECTORIES,!0,!1,(0,d.unpackStore)(e))})).then((function(){return e.set(w.setActions)})).then((function(){var n,o,r,i,l,c;null===(o=(n=t()).updateActions)||void 0===o||o.call(n,e),null===(i=(r=t()).removePeer)||void 0===i||i.call(r,e,E);var u=(0,d.unpackStore)(e);u.active_tab!==a.ConvoListFolder.ARCHIVE||(null===(l=u.dialog_tabs[a.ConvoListFolder.ARCHIVE])||void 0===l?void 0:l.length)||null===(c=null==u?void 0:u.longpoll)||void 0===c||c.push([(0,s.changeTab)(a.ConvoListFolder.ALL)])})).then((function(){return(0,I.unarchiveConversation)({peer_id:E})})).catch(P)}}},203524:(e,t,n)=>{"use strict";n.d(t,{useIndexer:()=>i});var a=n(570655),o=n(337057),r=n(667294),i=function(e,t,n){var i=(0,r.useRef)(null);i.current=i.current?i.current:new o.VkIndexer(e,t);var s=i.current,l=(0,r.useCallback)((function(e){return e.reduce((function(e,t){return e[n(t)]=!0,e}),{})}),[]),c=(0,a.__read)((0,r.useState)(e),2),u=c[0],d=c[1],h=(0,a.__read)((0,r.useState)(l(e)),2),v=h[0],g=h[1];return(0,r.useEffect)((function(){var t=l(e),a=e.filter((function(e){return!v[n(e)]})),o=u.filter((function(e){return!t[n(e)]}));(a.length||o.length)&&(a.forEach((function(e){s.add(e)})),o.forEach((function(e){s.remove(e)})),d(e),g(t))}),[e]),s}},608490:(e,t,n)=>{"use strict";n.d(t,{useHints:()=>h});var a=n(570655),o=n(667294),r=n(191040),i=n(917791),s=n(203524),l=n(923876),c=n(826542),u=(0,r.debouncedPromise)(i.searchHints,300),d=function(){return!0};function h(e,t,n,r){var i=(0,a.__read)((0,o.useState)(t),2),h=i[0],v=i[1],g=(0,a.__read)((0,o.useState)(!1),2),_=g[0],m=g[1],p=(0,o.useRef)(n),f=(0,o.useCallback)((function(e){return e.name}),[]),C=(0,o.useCallback)((function(e){return e.peerId}),[]),b=(0,s.useIndexer)(t,f,C),I=(0,o.useCallback)((function(e){return r.filterFn?e.filter(r.filterFn):e}),[r.filterFn]);return(0,o.useEffect)((function(){if(p.current=n,n){var a=b.search(n),o=a.map((function(e){return e.peerId}));v(I(a)),m(!0),u(n,o,r.queryType||c.HintsSearchType.ALL,r,e.get()).then((function(e){p.current===n&&(v((0,l.mergeConvoLists)(a,e,r.filterFn||d)),m(!1))})).catch((function(){}))}else v(I(t)),m(!1)}),[n,t]),[h,_]}},62839:(e,t,n)=>{"use strict";n.d(t,{uploadConvoPhoto:()=>i});var a=n(40906),o=n(486125),r=n(826542);function i(){var e=2e9+Math.round((0,a.rand)(1e6,2e6));return new Promise((function(t){window.cur.recieveCropResult=function(n){window.cur.recieveCropResult=!1,(0,r.ownerPhoto)(JSON.parse(n).data[0],e).then((function(e){var a=Array.isArray(e)?e[0]:e;t({photo:a,photoData:n}),(0,o.curBox)()&&(0,o.curBox)().hide(!0)}),(function(){}))},window.Page.ownerPhoto(e),(0,o.curBox)().setOptions({onHideAttempt:function(e){return e||t({}),!0}})}))}},672385:(e,t,n)=>{"use strict";var a;n.d(t,{ConvoFilters:()=>a}),function(e){e.ALL="all",e.ARCHIVE="archive",e.UNREAD="unread",e.IMPORTANT="important",e.UNANSWERED="unanswered",e.MESSAGE_REQUEST="message_request",e.BUSINESS_NOTIFY="business_notify",e.CHATS="chats"}(a||(a={}))}}]);try{stManager.done("dist/519619abdcf4517008a7b23855d1f7bd.edeb6b3b4bb4e68427fe.js")}catch(e){}